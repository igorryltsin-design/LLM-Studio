var eA=Object.defineProperty;var ov=s=>{throw TypeError(s)};var tA=(s,e,t)=>e in s?eA(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var Pe=(s,e,t)=>tA(s,typeof e!="symbol"?e+"":e,t),R0=(s,e,t)=>e.has(s)||ov("Cannot "+t);var c=(s,e,t)=>(R0(s,e,"read from private field"),t?t.call(s):e.get(s)),T=(s,e,t)=>e.has(s)?ov("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),S=(s,e,t,n)=>(R0(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t),j=(s,e,t)=>(R0(s,e,"access private method"),t);var Us=(s,e,t,n)=>({set _(r){S(s,e,r,t)},get _(){return c(s,e,n)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();var Of=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sA(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var pw={exports:{}},o0={},mw={exports:{}},Xe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tf=Symbol.for("react.element"),nA=Symbol.for("react.portal"),rA=Symbol.for("react.fragment"),iA=Symbol.for("react.strict_mode"),aA=Symbol.for("react.profiler"),oA=Symbol.for("react.provider"),lA=Symbol.for("react.context"),cA=Symbol.for("react.forward_ref"),dA=Symbol.for("react.suspense"),uA=Symbol.for("react.memo"),hA=Symbol.for("react.lazy"),lv=Symbol.iterator;function fA(s){return s===null||typeof s!="object"?null:(s=lv&&s[lv]||s["@@iterator"],typeof s=="function"?s:null)}var gw={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},xw=Object.assign,bw={};function $d(s,e,t){this.props=s,this.context=e,this.refs=bw,this.updater=t||gw}$d.prototype.isReactComponent={};$d.prototype.setState=function(s,e){if(typeof s!="object"&&typeof s!="function"&&s!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,s,e,"setState")};$d.prototype.forceUpdate=function(s){this.updater.enqueueForceUpdate(this,s,"forceUpdate")};function yw(){}yw.prototype=$d.prototype;function Vb(s,e,t){this.props=s,this.context=e,this.refs=bw,this.updater=t||gw}var Wb=Vb.prototype=new yw;Wb.constructor=Vb;xw(Wb,$d.prototype);Wb.isPureReactComponent=!0;var cv=Array.isArray,vw=Object.prototype.hasOwnProperty,qb={current:null},ww={key:!0,ref:!0,__self:!0,__source:!0};function kw(s,e,t){var n,r={},i=null,a=null;if(e!=null)for(n in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)vw.call(e,n)&&!ww.hasOwnProperty(n)&&(r[n]=e[n]);var o=arguments.length-2;if(o===1)r.children=t;else if(1<o){for(var l=Array(o),d=0;d<o;d++)l[d]=arguments[d+2];r.children=l}if(s&&s.defaultProps)for(n in o=s.defaultProps,o)r[n]===void 0&&(r[n]=o[n]);return{$$typeof:Tf,type:s,key:i,ref:a,props:r,_owner:qb.current}}function pA(s,e){return{$$typeof:Tf,type:s.type,key:e,ref:s.ref,props:s.props,_owner:s._owner}}function Xb(s){return typeof s=="object"&&s!==null&&s.$$typeof===Tf}function mA(s){var e={"=":"=0",":":"=2"};return"$"+s.replace(/[=:]/g,function(t){return e[t]})}var dv=/\/+/g;function I0(s,e){return typeof s=="object"&&s!==null&&s.key!=null?mA(""+s.key):e.toString(36)}function hp(s,e,t,n,r){var i=typeof s;(i==="undefined"||i==="boolean")&&(s=null);var a=!1;if(s===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(s.$$typeof){case Tf:case nA:a=!0}}if(a)return a=s,r=r(a),s=n===""?"."+I0(a,0):n,cv(r)?(t="",s!=null&&(t=s.replace(dv,"$&/")+"/"),hp(r,e,t,"",function(d){return d})):r!=null&&(Xb(r)&&(r=pA(r,t+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(dv,"$&/")+"/")+s)),e.push(r)),1;if(a=0,n=n===""?".":n+":",cv(s))for(var o=0;o<s.length;o++){i=s[o];var l=n+I0(i,o);a+=hp(i,e,t,l,r)}else if(l=fA(s),typeof l=="function")for(s=l.call(s),o=0;!(i=s.next()).done;)i=i.value,l=n+I0(i,o++),a+=hp(i,e,t,l,r);else if(i==="object")throw e=String(s),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function zf(s,e,t){if(s==null)return s;var n=[],r=0;return hp(s,n,"","",function(i){return e.call(t,i,r++)}),n}function gA(s){if(s._status===-1){var e=s._result;e=e(),e.then(function(t){(s._status===0||s._status===-1)&&(s._status=1,s._result=t)},function(t){(s._status===0||s._status===-1)&&(s._status=2,s._result=t)}),s._status===-1&&(s._status=0,s._result=e)}if(s._status===1)return s._result.default;throw s._result}var en={current:null},fp={transition:null},xA={ReactCurrentDispatcher:en,ReactCurrentBatchConfig:fp,ReactCurrentOwner:qb};function _w(){throw Error("act(...) is not supported in production builds of React.")}Xe.Children={map:zf,forEach:function(s,e,t){zf(s,function(){e.apply(this,arguments)},t)},count:function(s){var e=0;return zf(s,function(){e++}),e},toArray:function(s){return zf(s,function(e){return e})||[]},only:function(s){if(!Xb(s))throw Error("React.Children.only expected to receive a single React element child.");return s}};Xe.Component=$d;Xe.Fragment=rA;Xe.Profiler=aA;Xe.PureComponent=Vb;Xe.StrictMode=iA;Xe.Suspense=dA;Xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=xA;Xe.act=_w;Xe.cloneElement=function(s,e,t){if(s==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+s+".");var n=xw({},s.props),r=s.key,i=s.ref,a=s._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=qb.current),e.key!==void 0&&(r=""+e.key),s.type&&s.type.defaultProps)var o=s.type.defaultProps;for(l in e)vw.call(e,l)&&!ww.hasOwnProperty(l)&&(n[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)n.children=t;else if(1<l){o=Array(l);for(var d=0;d<l;d++)o[d]=arguments[d+2];n.children=o}return{$$typeof:Tf,type:s.type,key:r,ref:i,props:n,_owner:a}};Xe.createContext=function(s){return s={$$typeof:lA,_currentValue:s,_currentValue2:s,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},s.Provider={$$typeof:oA,_context:s},s.Consumer=s};Xe.createElement=kw;Xe.createFactory=function(s){var e=kw.bind(null,s);return e.type=s,e};Xe.createRef=function(){return{current:null}};Xe.forwardRef=function(s){return{$$typeof:cA,render:s}};Xe.isValidElement=Xb;Xe.lazy=function(s){return{$$typeof:hA,_payload:{_status:-1,_result:s},_init:gA}};Xe.memo=function(s,e){return{$$typeof:uA,type:s,compare:e===void 0?null:e}};Xe.startTransition=function(s){var e=fp.transition;fp.transition={};try{s()}finally{fp.transition=e}};Xe.unstable_act=_w;Xe.useCallback=function(s,e){return en.current.useCallback(s,e)};Xe.useContext=function(s){return en.current.useContext(s)};Xe.useDebugValue=function(){};Xe.useDeferredValue=function(s){return en.current.useDeferredValue(s)};Xe.useEffect=function(s,e){return en.current.useEffect(s,e)};Xe.useId=function(){return en.current.useId()};Xe.useImperativeHandle=function(s,e,t){return en.current.useImperativeHandle(s,e,t)};Xe.useInsertionEffect=function(s,e){return en.current.useInsertionEffect(s,e)};Xe.useLayoutEffect=function(s,e){return en.current.useLayoutEffect(s,e)};Xe.useMemo=function(s,e){return en.current.useMemo(s,e)};Xe.useReducer=function(s,e,t){return en.current.useReducer(s,e,t)};Xe.useRef=function(s){return en.current.useRef(s)};Xe.useState=function(s){return en.current.useState(s)};Xe.useSyncExternalStore=function(s,e,t){return en.current.useSyncExternalStore(s,e,t)};Xe.useTransition=function(){return en.current.useTransition()};Xe.version="18.3.1";mw.exports=Xe;var z=mw.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bA=z,yA=Symbol.for("react.element"),vA=Symbol.for("react.fragment"),wA=Object.prototype.hasOwnProperty,kA=bA.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_A={key:!0,ref:!0,__self:!0,__source:!0};function Sw(s,e,t){var n,r={},i=null,a=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)wA.call(e,n)&&!_A.hasOwnProperty(n)&&(r[n]=e[n]);if(s&&s.defaultProps)for(n in e=s.defaultProps,e)r[n]===void 0&&(r[n]=e[n]);return{$$typeof:yA,type:s,key:i,ref:a,props:r,_owner:kA.current}}o0.Fragment=vA;o0.jsx=Sw;o0.jsxs=Sw;pw.exports=o0;var u=pw.exports,Aw={exports:{}},$n={},Ew={exports:{}},Nw={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(s){function e(Q,H){var oe=Q.length;Q.push(H);e:for(;0<oe;){var X=oe-1>>>1,U=Q[X];if(0<r(U,H))Q[X]=H,Q[oe]=U,oe=X;else break e}}function t(Q){return Q.length===0?null:Q[0]}function n(Q){if(Q.length===0)return null;var H=Q[0],oe=Q.pop();if(oe!==H){Q[0]=oe;e:for(var X=0,U=Q.length,Y=U>>>1;X<Y;){var V=2*(X+1)-1,ee=Q[V],fe=V+1,se=Q[fe];if(0>r(ee,oe))fe<U&&0>r(se,ee)?(Q[X]=se,Q[fe]=oe,X=fe):(Q[X]=ee,Q[V]=oe,X=V);else if(fe<U&&0>r(se,oe))Q[X]=se,Q[fe]=oe,X=fe;else break e}}return H}function r(Q,H){var oe=Q.sortIndex-H.sortIndex;return oe!==0?oe:Q.id-H.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;s.unstable_now=function(){return i.now()}}else{var a=Date,o=a.now();s.unstable_now=function(){return a.now()-o}}var l=[],d=[],h=1,f=null,p=3,m=!1,b=!1,x=!1,v=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(Q){for(var H=t(d);H!==null;){if(H.callback===null)n(d);else if(H.startTime<=Q)n(d),H.sortIndex=H.expirationTime,e(l,H);else break;H=t(d)}}function k(Q){if(x=!1,w(Q),!b)if(t(l)!==null)b=!0,J(C);else{var H=t(d);H!==null&&W(k,H.startTime-Q)}}function C(Q,H){b=!1,x&&(x=!1,g(I),I=-1),m=!0;var oe=p;try{for(w(H),f=t(l);f!==null&&(!(f.expirationTime>H)||Q&&!$());){var X=f.callback;if(typeof X=="function"){f.callback=null,p=f.priorityLevel;var U=X(f.expirationTime<=H);H=s.unstable_now(),typeof U=="function"?f.callback=U:f===t(l)&&n(l),w(H)}else n(l);f=t(l)}if(f!==null)var Y=!0;else{var V=t(d);V!==null&&W(k,V.startTime-H),Y=!1}return Y}finally{f=null,p=oe,m=!1}}var P=!1,N=null,I=-1,M=5,L=-1;function $(){return!(s.unstable_now()-L<M)}function E(){if(N!==null){var Q=s.unstable_now();L=Q;var H=!0;try{H=N(!0,Q)}finally{H?D():(P=!1,N=null)}}else P=!1}var D;if(typeof y=="function")D=function(){y(E)};else if(typeof MessageChannel<"u"){var _=new MessageChannel,K=_.port2;_.port1.onmessage=E,D=function(){K.postMessage(null)}}else D=function(){v(E,0)};function J(Q){N=Q,P||(P=!0,D())}function W(Q,H){I=v(function(){Q(s.unstable_now())},H)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(Q){Q.callback=null},s.unstable_continueExecution=function(){b||m||(b=!0,J(C))},s.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<Q?Math.floor(1e3/Q):5},s.unstable_getCurrentPriorityLevel=function(){return p},s.unstable_getFirstCallbackNode=function(){return t(l)},s.unstable_next=function(Q){switch(p){case 1:case 2:case 3:var H=3;break;default:H=p}var oe=p;p=H;try{return Q()}finally{p=oe}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(Q,H){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var oe=p;p=Q;try{return H()}finally{p=oe}},s.unstable_scheduleCallback=function(Q,H,oe){var X=s.unstable_now();switch(typeof oe=="object"&&oe!==null?(oe=oe.delay,oe=typeof oe=="number"&&0<oe?X+oe:X):oe=X,Q){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=oe+U,Q={id:h++,callback:H,priorityLevel:Q,startTime:oe,expirationTime:U,sortIndex:-1},oe>X?(Q.sortIndex=oe,e(d,Q),t(l)===null&&Q===t(d)&&(x?(g(I),I=-1):x=!0,W(k,oe-X))):(Q.sortIndex=U,e(l,Q),b||m||(b=!0,J(C))),Q},s.unstable_shouldYield=$,s.unstable_wrapCallback=function(Q){var H=p;return function(){var oe=p;p=H;try{return Q.apply(this,arguments)}finally{p=oe}}}})(Nw);Ew.exports=Nw;var SA=Ew.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AA=z,zn=SA;function pe(s){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+s,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+s+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Cw=new Set,Du={};function $l(s,e){Rd(s,e),Rd(s+"Capture",e)}function Rd(s,e){for(Du[s]=e,s=0;s<e.length;s++)Cw.add(e[s])}var Ji=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ng=Object.prototype.hasOwnProperty,EA=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,uv={},hv={};function NA(s){return Ng.call(hv,s)?!0:Ng.call(uv,s)?!1:EA.test(s)?hv[s]=!0:(uv[s]=!0,!1)}function CA(s,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function TA(s,e,t,n){if(e===null||typeof e>"u"||CA(s,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function tn(s,e,t,n,r,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=s,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var _s={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){_s[s]=new tn(s,0,!1,s,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var e=s[0];_s[e]=new tn(e,1,!1,s[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(s){_s[s]=new tn(s,2,!1,s.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){_s[s]=new tn(s,2,!1,s,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){_s[s]=new tn(s,3,!1,s.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(s){_s[s]=new tn(s,3,!0,s,null,!1,!1)});["capture","download"].forEach(function(s){_s[s]=new tn(s,4,!1,s,null,!1,!1)});["cols","rows","size","span"].forEach(function(s){_s[s]=new tn(s,6,!1,s,null,!1,!1)});["rowSpan","start"].forEach(function(s){_s[s]=new tn(s,5,!1,s.toLowerCase(),null,!1,!1)});var Kb=/[\-:]([a-z])/g;function Yb(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var e=s.replace(Kb,Yb);_s[e]=new tn(e,1,!1,s,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var e=s.replace(Kb,Yb);_s[e]=new tn(e,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(s){var e=s.replace(Kb,Yb);_s[e]=new tn(e,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(s){_s[s]=new tn(s,1,!1,s.toLowerCase(),null,!1,!1)});_s.xlinkHref=new tn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(s){_s[s]=new tn(s,1,!1,s.toLowerCase(),null,!0,!0)});function Qb(s,e,t,n){var r=_s.hasOwnProperty(e)?_s[e]:null;(r!==null?r.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(TA(e,t,r,n)&&(t=null),n||r===null?NA(e)&&(t===null?s.removeAttribute(e):s.setAttribute(e,""+t)):r.mustUseProperty?s[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,n=r.attributeNamespace,t===null?s.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,n?s.setAttributeNS(n,e,t):s.setAttribute(e,t))))}var ia=AA.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,$f=Symbol.for("react.element"),rc=Symbol.for("react.portal"),ic=Symbol.for("react.fragment"),Zb=Symbol.for("react.strict_mode"),Cg=Symbol.for("react.profiler"),Tw=Symbol.for("react.provider"),jw=Symbol.for("react.context"),Jb=Symbol.for("react.forward_ref"),Tg=Symbol.for("react.suspense"),jg=Symbol.for("react.suspense_list"),ey=Symbol.for("react.memo"),da=Symbol.for("react.lazy"),Pw=Symbol.for("react.offscreen"),fv=Symbol.iterator;function Hd(s){return s===null||typeof s!="object"?null:(s=fv&&s[fv]||s["@@iterator"],typeof s=="function"?s:null)}var It=Object.assign,L0;function nu(s){if(L0===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);L0=e&&e[1]||""}return`
`+L0+s}var D0=!1;function F0(s,e){if(!s||D0)return"";D0=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var n=d}Reflect.construct(s,[],e)}else{try{e.call()}catch(d){n=d}s.call(e.prototype)}else{try{throw Error()}catch(d){n=d}s()}}catch(d){if(d&&n&&typeof d.stack=="string"){for(var r=d.stack.split(`
`),i=n.stack.split(`
`),a=r.length-1,o=i.length-1;1<=a&&0<=o&&r[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==i[o]){if(a!==1||o!==1)do if(a--,o--,0>o||r[a]!==i[o]){var l=`
`+r[a].replace(" at new "," at ");return s.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",s.displayName)),l}while(1<=a&&0<=o);break}}}finally{D0=!1,Error.prepareStackTrace=t}return(s=s?s.displayName||s.name:"")?nu(s):""}function jA(s){switch(s.tag){case 5:return nu(s.type);case 16:return nu("Lazy");case 13:return nu("Suspense");case 19:return nu("SuspenseList");case 0:case 2:case 15:return s=F0(s.type,!1),s;case 11:return s=F0(s.type.render,!1),s;case 1:return s=F0(s.type,!0),s;default:return""}}function Pg(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case ic:return"Fragment";case rc:return"Portal";case Cg:return"Profiler";case Zb:return"StrictMode";case Tg:return"Suspense";case jg:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case jw:return(s.displayName||"Context")+".Consumer";case Tw:return(s._context.displayName||"Context")+".Provider";case Jb:var e=s.render;return s=s.displayName,s||(s=e.displayName||e.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case ey:return e=s.displayName||null,e!==null?e:Pg(s.type)||"Memo";case da:e=s._payload,s=s._init;try{return Pg(s(e))}catch{}}return null}function PA(s){var e=s.type;switch(s.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=e.render,s=s.displayName||s.name||"",e.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Pg(e);case 8:return e===Zb?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function so(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Mw(s){var e=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function MA(s){var e=Mw(s)?"checked":"value",t=Object.getOwnPropertyDescriptor(s.constructor.prototype,e),n=""+s[e];if(!s.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,i=t.set;return Object.defineProperty(s,e,{configurable:!0,get:function(){return r.call(this)},set:function(a){n=""+a,i.call(this,a)}}),Object.defineProperty(s,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(a){n=""+a},stopTracking:function(){s._valueTracker=null,delete s[e]}}}}function Bf(s){s._valueTracker||(s._valueTracker=MA(s))}function Rw(s){if(!s)return!1;var e=s._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return s&&(n=Mw(s)?s.checked?"true":"false":s.value),s=n,s!==t?(e.setValue(s),!0):!1}function nm(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function Mg(s,e){var t=e.checked;return It({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??s._wrapperState.initialChecked})}function pv(s,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=so(e.value!=null?e.value:t),s._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Iw(s,e){e=e.checked,e!=null&&Qb(s,"checked",e,!1)}function Rg(s,e){Iw(s,e);var t=so(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&s.value===""||s.value!=t)&&(s.value=""+t):s.value!==""+t&&(s.value=""+t);else if(n==="submit"||n==="reset"){s.removeAttribute("value");return}e.hasOwnProperty("value")?Ig(s,e.type,t):e.hasOwnProperty("defaultValue")&&Ig(s,e.type,so(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(s.defaultChecked=!!e.defaultChecked)}function mv(s,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+s._wrapperState.initialValue,t||e===s.value||(s.value=e),s.defaultValue=e}t=s.name,t!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,t!==""&&(s.name=t)}function Ig(s,e,t){(e!=="number"||nm(s.ownerDocument)!==s)&&(t==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+t&&(s.defaultValue=""+t))}var ru=Array.isArray;function vc(s,e,t,n){if(s=s.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<s.length;t++)r=e.hasOwnProperty("$"+s[t].value),s[t].selected!==r&&(s[t].selected=r),r&&n&&(s[t].defaultSelected=!0)}else{for(t=""+so(t),e=null,r=0;r<s.length;r++){if(s[r].value===t){s[r].selected=!0,n&&(s[r].defaultSelected=!0);return}e!==null||s[r].disabled||(e=s[r])}e!==null&&(e.selected=!0)}}function Lg(s,e){if(e.dangerouslySetInnerHTML!=null)throw Error(pe(91));return It({},e,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function gv(s,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(pe(92));if(ru(t)){if(1<t.length)throw Error(pe(93));t=t[0]}e=t}e==null&&(e=""),t=e}s._wrapperState={initialValue:so(t)}}function Lw(s,e){var t=so(e.value),n=so(e.defaultValue);t!=null&&(t=""+t,t!==s.value&&(s.value=t),e.defaultValue==null&&s.defaultValue!==t&&(s.defaultValue=t)),n!=null&&(s.defaultValue=""+n)}function xv(s){var e=s.textContent;e===s._wrapperState.initialValue&&e!==""&&e!==null&&(s.value=e)}function Dw(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Dg(s,e){return s==null||s==="http://www.w3.org/1999/xhtml"?Dw(e):s==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var Uf,Fw=function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return s(e,t,n,r)})}:s}(function(s,e){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=e;else{for(Uf=Uf||document.createElement("div"),Uf.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Uf.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;e.firstChild;)s.appendChild(e.firstChild)}});function Fu(s,e){if(e){var t=s.firstChild;if(t&&t===s.lastChild&&t.nodeType===3){t.nodeValue=e;return}}s.textContent=e}var Su={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},RA=["Webkit","ms","Moz","O"];Object.keys(Su).forEach(function(s){RA.forEach(function(e){e=e+s.charAt(0).toUpperCase()+s.substring(1),Su[e]=Su[s]})});function Ow(s,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Su.hasOwnProperty(s)&&Su[s]?(""+e).trim():e+"px"}function zw(s,e){s=s.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,r=Ow(t,e[t],n);t==="float"&&(t="cssFloat"),n?s.setProperty(t,r):s[t]=r}}var IA=It({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Fg(s,e){if(e){if(IA[s]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(pe(137,s));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(pe(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(pe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(pe(62))}}function Og(s,e){if(s.indexOf("-")===-1)return typeof e.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var zg=null;function ty(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var $g=null,wc=null,kc=null;function bv(s){if(s=Mf(s)){if(typeof $g!="function")throw Error(pe(280));var e=s.stateNode;e&&(e=h0(e),$g(s.stateNode,s.type,e))}}function $w(s){wc?kc?kc.push(s):kc=[s]:wc=s}function Bw(){if(wc){var s=wc,e=kc;if(kc=wc=null,bv(s),e)for(s=0;s<e.length;s++)bv(e[s])}}function Uw(s,e){return s(e)}function Hw(){}var O0=!1;function Gw(s,e,t){if(O0)return s(e,t);O0=!0;try{return Uw(s,e,t)}finally{O0=!1,(wc!==null||kc!==null)&&(Hw(),Bw())}}function Ou(s,e){var t=s.stateNode;if(t===null)return null;var n=h0(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(s=s.type,n=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!n;break e;default:s=!1}if(s)return null;if(t&&typeof t!="function")throw Error(pe(231,e,typeof t));return t}var Bg=!1;if(Ji)try{var Gd={};Object.defineProperty(Gd,"passive",{get:function(){Bg=!0}}),window.addEventListener("test",Gd,Gd),window.removeEventListener("test",Gd,Gd)}catch{Bg=!1}function LA(s,e,t,n,r,i,a,o,l){var d=Array.prototype.slice.call(arguments,3);try{e.apply(t,d)}catch(h){this.onError(h)}}var Au=!1,rm=null,im=!1,Ug=null,DA={onError:function(s){Au=!0,rm=s}};function FA(s,e,t,n,r,i,a,o,l){Au=!1,rm=null,LA.apply(DA,arguments)}function OA(s,e,t,n,r,i,a,o,l){if(FA.apply(this,arguments),Au){if(Au){var d=rm;Au=!1,rm=null}else throw Error(pe(198));im||(im=!0,Ug=d)}}function Bl(s){var e=s,t=s;if(s.alternate)for(;e.return;)e=e.return;else{s=e;do e=s,e.flags&4098&&(t=e.return),s=e.return;while(s)}return e.tag===3?t:null}function Vw(s){if(s.tag===13){var e=s.memoizedState;if(e===null&&(s=s.alternate,s!==null&&(e=s.memoizedState)),e!==null)return e.dehydrated}return null}function yv(s){if(Bl(s)!==s)throw Error(pe(188))}function zA(s){var e=s.alternate;if(!e){if(e=Bl(s),e===null)throw Error(pe(188));return e!==s?null:s}for(var t=s,n=e;;){var r=t.return;if(r===null)break;var i=r.alternate;if(i===null){if(n=r.return,n!==null){t=n;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===t)return yv(r),s;if(i===n)return yv(r),e;i=i.sibling}throw Error(pe(188))}if(t.return!==n.return)t=r,n=i;else{for(var a=!1,o=r.child;o;){if(o===t){a=!0,t=r,n=i;break}if(o===n){a=!0,n=r,t=i;break}o=o.sibling}if(!a){for(o=i.child;o;){if(o===t){a=!0,t=i,n=r;break}if(o===n){a=!0,n=i,t=r;break}o=o.sibling}if(!a)throw Error(pe(189))}}if(t.alternate!==n)throw Error(pe(190))}if(t.tag!==3)throw Error(pe(188));return t.stateNode.current===t?s:e}function Ww(s){return s=zA(s),s!==null?qw(s):null}function qw(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var e=qw(s);if(e!==null)return e;s=s.sibling}return null}var Xw=zn.unstable_scheduleCallback,vv=zn.unstable_cancelCallback,$A=zn.unstable_shouldYield,BA=zn.unstable_requestPaint,Bt=zn.unstable_now,UA=zn.unstable_getCurrentPriorityLevel,sy=zn.unstable_ImmediatePriority,Kw=zn.unstable_UserBlockingPriority,am=zn.unstable_NormalPriority,HA=zn.unstable_LowPriority,Yw=zn.unstable_IdlePriority,l0=null,li=null;function GA(s){if(li&&typeof li.onCommitFiberRoot=="function")try{li.onCommitFiberRoot(l0,s,void 0,(s.current.flags&128)===128)}catch{}}var Pr=Math.clz32?Math.clz32:qA,VA=Math.log,WA=Math.LN2;function qA(s){return s>>>=0,s===0?32:31-(VA(s)/WA|0)|0}var Hf=64,Gf=4194304;function iu(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function om(s,e){var t=s.pendingLanes;if(t===0)return 0;var n=0,r=s.suspendedLanes,i=s.pingedLanes,a=t&268435455;if(a!==0){var o=a&~r;o!==0?n=iu(o):(i&=a,i!==0&&(n=iu(i)))}else a=t&~r,a!==0?n=iu(a):i!==0&&(n=iu(i));if(n===0)return 0;if(e!==0&&e!==n&&!(e&r)&&(r=n&-n,i=e&-e,r>=i||r===16&&(i&4194240)!==0))return e;if(n&4&&(n|=t&16),e=s.entangledLanes,e!==0)for(s=s.entanglements,e&=n;0<e;)t=31-Pr(e),r=1<<t,n|=s[t],e&=~r;return n}function XA(s,e){switch(s){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function KA(s,e){for(var t=s.suspendedLanes,n=s.pingedLanes,r=s.expirationTimes,i=s.pendingLanes;0<i;){var a=31-Pr(i),o=1<<a,l=r[a];l===-1?(!(o&t)||o&n)&&(r[a]=XA(o,e)):l<=e&&(s.expiredLanes|=o),i&=~o}}function Hg(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function Qw(){var s=Hf;return Hf<<=1,!(Hf&4194240)&&(Hf=64),s}function z0(s){for(var e=[],t=0;31>t;t++)e.push(s);return e}function jf(s,e,t){s.pendingLanes|=e,e!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,e=31-Pr(e),s[e]=t}function YA(s,e){var t=s.pendingLanes&~e;s.pendingLanes=e,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=e,s.mutableReadLanes&=e,s.entangledLanes&=e,e=s.entanglements;var n=s.eventTimes;for(s=s.expirationTimes;0<t;){var r=31-Pr(t),i=1<<r;e[r]=0,n[r]=-1,s[r]=-1,t&=~i}}function ny(s,e){var t=s.entangledLanes|=e;for(s=s.entanglements;t;){var n=31-Pr(t),r=1<<n;r&e|s[n]&e&&(s[n]|=e),t&=~r}}var ct=0;function Zw(s){return s&=-s,1<s?4<s?s&268435455?16:536870912:4:1}var Jw,ry,ek,tk,sk,Gg=!1,Vf=[],qa=null,Xa=null,Ka=null,zu=new Map,$u=new Map,ha=[],QA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function wv(s,e){switch(s){case"focusin":case"focusout":qa=null;break;case"dragenter":case"dragleave":Xa=null;break;case"mouseover":case"mouseout":Ka=null;break;case"pointerover":case"pointerout":zu.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":$u.delete(e.pointerId)}}function Vd(s,e,t,n,r,i){return s===null||s.nativeEvent!==i?(s={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:i,targetContainers:[r]},e!==null&&(e=Mf(e),e!==null&&ry(e)),s):(s.eventSystemFlags|=n,e=s.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),s)}function ZA(s,e,t,n,r){switch(e){case"focusin":return qa=Vd(qa,s,e,t,n,r),!0;case"dragenter":return Xa=Vd(Xa,s,e,t,n,r),!0;case"mouseover":return Ka=Vd(Ka,s,e,t,n,r),!0;case"pointerover":var i=r.pointerId;return zu.set(i,Vd(zu.get(i)||null,s,e,t,n,r)),!0;case"gotpointercapture":return i=r.pointerId,$u.set(i,Vd($u.get(i)||null,s,e,t,n,r)),!0}return!1}function nk(s){var e=ko(s.target);if(e!==null){var t=Bl(e);if(t!==null){if(e=t.tag,e===13){if(e=Vw(t),e!==null){s.blockedOn=e,sk(s.priority,function(){ek(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){s.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}s.blockedOn=null}function pp(s){if(s.blockedOn!==null)return!1;for(var e=s.targetContainers;0<e.length;){var t=Vg(s.domEventName,s.eventSystemFlags,e[0],s.nativeEvent);if(t===null){t=s.nativeEvent;var n=new t.constructor(t.type,t);zg=n,t.target.dispatchEvent(n),zg=null}else return e=Mf(t),e!==null&&ry(e),s.blockedOn=t,!1;e.shift()}return!0}function kv(s,e,t){pp(s)&&t.delete(e)}function JA(){Gg=!1,qa!==null&&pp(qa)&&(qa=null),Xa!==null&&pp(Xa)&&(Xa=null),Ka!==null&&pp(Ka)&&(Ka=null),zu.forEach(kv),$u.forEach(kv)}function Wd(s,e){s.blockedOn===e&&(s.blockedOn=null,Gg||(Gg=!0,zn.unstable_scheduleCallback(zn.unstable_NormalPriority,JA)))}function Bu(s){function e(r){return Wd(r,s)}if(0<Vf.length){Wd(Vf[0],s);for(var t=1;t<Vf.length;t++){var n=Vf[t];n.blockedOn===s&&(n.blockedOn=null)}}for(qa!==null&&Wd(qa,s),Xa!==null&&Wd(Xa,s),Ka!==null&&Wd(Ka,s),zu.forEach(e),$u.forEach(e),t=0;t<ha.length;t++)n=ha[t],n.blockedOn===s&&(n.blockedOn=null);for(;0<ha.length&&(t=ha[0],t.blockedOn===null);)nk(t),t.blockedOn===null&&ha.shift()}var _c=ia.ReactCurrentBatchConfig,lm=!0;function eE(s,e,t,n){var r=ct,i=_c.transition;_c.transition=null;try{ct=1,iy(s,e,t,n)}finally{ct=r,_c.transition=i}}function tE(s,e,t,n){var r=ct,i=_c.transition;_c.transition=null;try{ct=4,iy(s,e,t,n)}finally{ct=r,_c.transition=i}}function iy(s,e,t,n){if(lm){var r=Vg(s,e,t,n);if(r===null)K0(s,e,n,cm,t),wv(s,n);else if(ZA(r,s,e,t,n))n.stopPropagation();else if(wv(s,n),e&4&&-1<QA.indexOf(s)){for(;r!==null;){var i=Mf(r);if(i!==null&&Jw(i),i=Vg(s,e,t,n),i===null&&K0(s,e,n,cm,t),i===r)break;r=i}r!==null&&n.stopPropagation()}else K0(s,e,n,null,t)}}var cm=null;function Vg(s,e,t,n){if(cm=null,s=ty(n),s=ko(s),s!==null)if(e=Bl(s),e===null)s=null;else if(t=e.tag,t===13){if(s=Vw(e),s!==null)return s;s=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;s=null}else e!==s&&(s=null);return cm=s,null}function rk(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(UA()){case sy:return 1;case Kw:return 4;case am:case HA:return 16;case Yw:return 536870912;default:return 16}default:return 16}}var Va=null,ay=null,mp=null;function ik(){if(mp)return mp;var s,e=ay,t=e.length,n,r="value"in Va?Va.value:Va.textContent,i=r.length;for(s=0;s<t&&e[s]===r[s];s++);var a=t-s;for(n=1;n<=a&&e[t-n]===r[i-n];n++);return mp=r.slice(s,1<n?1-n:void 0)}function gp(s){var e=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&e===13&&(s=13)):s=e,s===10&&(s=13),32<=s||s===13?s:0}function Wf(){return!0}function _v(){return!1}function Bn(s){function e(t,n,r,i,a){this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var o in s)s.hasOwnProperty(o)&&(t=s[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Wf:_v,this.isPropagationStopped=_v,this}return It(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Wf)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Wf)},persist:function(){},isPersistent:Wf}),e}var Bd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},oy=Bn(Bd),Pf=It({},Bd,{view:0,detail:0}),sE=Bn(Pf),$0,B0,qd,c0=It({},Pf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ly,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==qd&&(qd&&s.type==="mousemove"?($0=s.screenX-qd.screenX,B0=s.screenY-qd.screenY):B0=$0=0,qd=s),$0)},movementY:function(s){return"movementY"in s?s.movementY:B0}}),Sv=Bn(c0),nE=It({},c0,{dataTransfer:0}),rE=Bn(nE),iE=It({},Pf,{relatedTarget:0}),U0=Bn(iE),aE=It({},Bd,{animationName:0,elapsedTime:0,pseudoElement:0}),oE=Bn(aE),lE=It({},Bd,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),cE=Bn(lE),dE=It({},Bd,{data:0}),Av=Bn(dE),uE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pE(s){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(s):(s=fE[s])?!!e[s]:!1}function ly(){return pE}var mE=It({},Pf,{key:function(s){if(s.key){var e=uE[s.key]||s.key;if(e!=="Unidentified")return e}return s.type==="keypress"?(s=gp(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?hE[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ly,charCode:function(s){return s.type==="keypress"?gp(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?gp(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),gE=Bn(mE),xE=It({},c0,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ev=Bn(xE),bE=It({},Pf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ly}),yE=Bn(bE),vE=It({},Bd,{propertyName:0,elapsedTime:0,pseudoElement:0}),wE=Bn(vE),kE=It({},c0,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),_E=Bn(kE),SE=[9,13,27,32],cy=Ji&&"CompositionEvent"in window,Eu=null;Ji&&"documentMode"in document&&(Eu=document.documentMode);var AE=Ji&&"TextEvent"in window&&!Eu,ak=Ji&&(!cy||Eu&&8<Eu&&11>=Eu),Nv=" ",Cv=!1;function ok(s,e){switch(s){case"keyup":return SE.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function lk(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var ac=!1;function EE(s,e){switch(s){case"compositionend":return lk(e);case"keypress":return e.which!==32?null:(Cv=!0,Nv);case"textInput":return s=e.data,s===Nv&&Cv?null:s;default:return null}}function NE(s,e){if(ac)return s==="compositionend"||!cy&&ok(s,e)?(s=ik(),mp=ay=Va=null,ac=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return ak&&e.locale!=="ko"?null:e.data;default:return null}}var CE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Tv(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e==="input"?!!CE[s.type]:e==="textarea"}function ck(s,e,t,n){$w(n),e=dm(e,"onChange"),0<e.length&&(t=new oy("onChange","change",null,t,n),s.push({event:t,listeners:e}))}var Nu=null,Uu=null;function TE(s){vk(s,0)}function d0(s){var e=cc(s);if(Rw(e))return s}function jE(s,e){if(s==="change")return e}var dk=!1;if(Ji){var H0;if(Ji){var G0="oninput"in document;if(!G0){var jv=document.createElement("div");jv.setAttribute("oninput","return;"),G0=typeof jv.oninput=="function"}H0=G0}else H0=!1;dk=H0&&(!document.documentMode||9<document.documentMode)}function Pv(){Nu&&(Nu.detachEvent("onpropertychange",uk),Uu=Nu=null)}function uk(s){if(s.propertyName==="value"&&d0(Uu)){var e=[];ck(e,Uu,s,ty(s)),Gw(TE,e)}}function PE(s,e,t){s==="focusin"?(Pv(),Nu=e,Uu=t,Nu.attachEvent("onpropertychange",uk)):s==="focusout"&&Pv()}function ME(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return d0(Uu)}function RE(s,e){if(s==="click")return d0(e)}function IE(s,e){if(s==="input"||s==="change")return d0(e)}function LE(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var Rr=typeof Object.is=="function"?Object.is:LE;function Hu(s,e){if(Rr(s,e))return!0;if(typeof s!="object"||s===null||typeof e!="object"||e===null)return!1;var t=Object.keys(s),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var r=t[n];if(!Ng.call(e,r)||!Rr(s[r],e[r]))return!1}return!0}function Mv(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Rv(s,e){var t=Mv(s);s=0;for(var n;t;){if(t.nodeType===3){if(n=s+t.textContent.length,s<=e&&n>=e)return{node:t,offset:e-s};s=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Mv(t)}}function hk(s,e){return s&&e?s===e?!0:s&&s.nodeType===3?!1:e&&e.nodeType===3?hk(s,e.parentNode):"contains"in s?s.contains(e):s.compareDocumentPosition?!!(s.compareDocumentPosition(e)&16):!1:!1}function fk(){for(var s=window,e=nm();e instanceof s.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)s=e.contentWindow;else break;e=nm(s.document)}return e}function dy(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e&&(e==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||e==="textarea"||s.contentEditable==="true")}function DE(s){var e=fk(),t=s.focusedElem,n=s.selectionRange;if(e!==t&&t&&t.ownerDocument&&hk(t.ownerDocument.documentElement,t)){if(n!==null&&dy(t)){if(e=n.start,s=n.end,s===void 0&&(s=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(s,t.value.length);else if(s=(e=t.ownerDocument||document)&&e.defaultView||window,s.getSelection){s=s.getSelection();var r=t.textContent.length,i=Math.min(n.start,r);n=n.end===void 0?i:Math.min(n.end,r),!s.extend&&i>n&&(r=n,n=i,i=r),r=Rv(t,i);var a=Rv(t,n);r&&a&&(s.rangeCount!==1||s.anchorNode!==r.node||s.anchorOffset!==r.offset||s.focusNode!==a.node||s.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),s.removeAllRanges(),i>n?(s.addRange(e),s.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),s.addRange(e)))}}for(e=[],s=t;s=s.parentNode;)s.nodeType===1&&e.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)s=e[t],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var FE=Ji&&"documentMode"in document&&11>=document.documentMode,oc=null,Wg=null,Cu=null,qg=!1;function Iv(s,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;qg||oc==null||oc!==nm(n)||(n=oc,"selectionStart"in n&&dy(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Cu&&Hu(Cu,n)||(Cu=n,n=dm(Wg,"onSelect"),0<n.length&&(e=new oy("onSelect","select",null,e,t),s.push({event:e,listeners:n}),e.target=oc)))}function qf(s,e){var t={};return t[s.toLowerCase()]=e.toLowerCase(),t["Webkit"+s]="webkit"+e,t["Moz"+s]="moz"+e,t}var lc={animationend:qf("Animation","AnimationEnd"),animationiteration:qf("Animation","AnimationIteration"),animationstart:qf("Animation","AnimationStart"),transitionend:qf("Transition","TransitionEnd")},V0={},pk={};Ji&&(pk=document.createElement("div").style,"AnimationEvent"in window||(delete lc.animationend.animation,delete lc.animationiteration.animation,delete lc.animationstart.animation),"TransitionEvent"in window||delete lc.transitionend.transition);function u0(s){if(V0[s])return V0[s];if(!lc[s])return s;var e=lc[s],t;for(t in e)if(e.hasOwnProperty(t)&&t in pk)return V0[s]=e[t];return s}var mk=u0("animationend"),gk=u0("animationiteration"),xk=u0("animationstart"),bk=u0("transitionend"),yk=new Map,Lv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function oo(s,e){yk.set(s,e),$l(e,[s])}for(var W0=0;W0<Lv.length;W0++){var q0=Lv[W0],OE=q0.toLowerCase(),zE=q0[0].toUpperCase()+q0.slice(1);oo(OE,"on"+zE)}oo(mk,"onAnimationEnd");oo(gk,"onAnimationIteration");oo(xk,"onAnimationStart");oo("dblclick","onDoubleClick");oo("focusin","onFocus");oo("focusout","onBlur");oo(bk,"onTransitionEnd");Rd("onMouseEnter",["mouseout","mouseover"]);Rd("onMouseLeave",["mouseout","mouseover"]);Rd("onPointerEnter",["pointerout","pointerover"]);Rd("onPointerLeave",["pointerout","pointerover"]);$l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));$l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));$l("onBeforeInput",["compositionend","keypress","textInput","paste"]);$l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));$l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));$l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var au="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$E=new Set("cancel close invalid load scroll toggle".split(" ").concat(au));function Dv(s,e,t){var n=s.type||"unknown-event";s.currentTarget=t,OA(n,e,void 0,s),s.currentTarget=null}function vk(s,e){e=(e&4)!==0;for(var t=0;t<s.length;t++){var n=s[t],r=n.event;n=n.listeners;e:{var i=void 0;if(e)for(var a=n.length-1;0<=a;a--){var o=n[a],l=o.instance,d=o.currentTarget;if(o=o.listener,l!==i&&r.isPropagationStopped())break e;Dv(r,o,d),i=l}else for(a=0;a<n.length;a++){if(o=n[a],l=o.instance,d=o.currentTarget,o=o.listener,l!==i&&r.isPropagationStopped())break e;Dv(r,o,d),i=l}}}if(im)throw s=Ug,im=!1,Ug=null,s}function vt(s,e){var t=e[Zg];t===void 0&&(t=e[Zg]=new Set);var n=s+"__bubble";t.has(n)||(wk(e,s,2,!1),t.add(n))}function X0(s,e,t){var n=0;e&&(n|=4),wk(t,s,n,e)}var Xf="_reactListening"+Math.random().toString(36).slice(2);function Gu(s){if(!s[Xf]){s[Xf]=!0,Cw.forEach(function(t){t!=="selectionchange"&&($E.has(t)||X0(t,!1,s),X0(t,!0,s))});var e=s.nodeType===9?s:s.ownerDocument;e===null||e[Xf]||(e[Xf]=!0,X0("selectionchange",!1,e))}}function wk(s,e,t,n){switch(rk(e)){case 1:var r=eE;break;case 4:r=tE;break;default:r=iy}t=r.bind(null,e,t,s),r=void 0,!Bg||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),n?r!==void 0?s.addEventListener(e,t,{capture:!0,passive:r}):s.addEventListener(e,t,!0):r!==void 0?s.addEventListener(e,t,{passive:r}):s.addEventListener(e,t,!1)}function K0(s,e,t,n,r){var i=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var a=n.tag;if(a===3||a===4){var o=n.stateNode.containerInfo;if(o===r||o.nodeType===8&&o.parentNode===r)break;if(a===4)for(a=n.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;a=a.return}for(;o!==null;){if(a=ko(o),a===null)return;if(l=a.tag,l===5||l===6){n=i=a;continue e}o=o.parentNode}}n=n.return}Gw(function(){var d=i,h=ty(t),f=[];e:{var p=yk.get(s);if(p!==void 0){var m=oy,b=s;switch(s){case"keypress":if(gp(t)===0)break e;case"keydown":case"keyup":m=gE;break;case"focusin":b="focus",m=U0;break;case"focusout":b="blur",m=U0;break;case"beforeblur":case"afterblur":m=U0;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=Sv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=rE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=yE;break;case mk:case gk:case xk:m=oE;break;case bk:m=wE;break;case"scroll":m=sE;break;case"wheel":m=_E;break;case"copy":case"cut":case"paste":m=cE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=Ev}var x=(e&4)!==0,v=!x&&s==="scroll",g=x?p!==null?p+"Capture":null:p;x=[];for(var y=d,w;y!==null;){w=y;var k=w.stateNode;if(w.tag===5&&k!==null&&(w=k,g!==null&&(k=Ou(y,g),k!=null&&x.push(Vu(y,k,w)))),v)break;y=y.return}0<x.length&&(p=new m(p,b,null,t,h),f.push({event:p,listeners:x}))}}if(!(e&7)){e:{if(p=s==="mouseover"||s==="pointerover",m=s==="mouseout"||s==="pointerout",p&&t!==zg&&(b=t.relatedTarget||t.fromElement)&&(ko(b)||b[ea]))break e;if((m||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,m?(b=t.relatedTarget||t.toElement,m=d,b=b?ko(b):null,b!==null&&(v=Bl(b),b!==v||b.tag!==5&&b.tag!==6)&&(b=null)):(m=null,b=d),m!==b)){if(x=Sv,k="onMouseLeave",g="onMouseEnter",y="mouse",(s==="pointerout"||s==="pointerover")&&(x=Ev,k="onPointerLeave",g="onPointerEnter",y="pointer"),v=m==null?p:cc(m),w=b==null?p:cc(b),p=new x(k,y+"leave",m,t,h),p.target=v,p.relatedTarget=w,k=null,ko(h)===d&&(x=new x(g,y+"enter",b,t,h),x.target=w,x.relatedTarget=v,k=x),v=k,m&&b)t:{for(x=m,g=b,y=0,w=x;w;w=Xl(w))y++;for(w=0,k=g;k;k=Xl(k))w++;for(;0<y-w;)x=Xl(x),y--;for(;0<w-y;)g=Xl(g),w--;for(;y--;){if(x===g||g!==null&&x===g.alternate)break t;x=Xl(x),g=Xl(g)}x=null}else x=null;m!==null&&Fv(f,p,m,x,!1),b!==null&&v!==null&&Fv(f,v,b,x,!0)}}e:{if(p=d?cc(d):window,m=p.nodeName&&p.nodeName.toLowerCase(),m==="select"||m==="input"&&p.type==="file")var C=jE;else if(Tv(p))if(dk)C=IE;else{C=ME;var P=PE}else(m=p.nodeName)&&m.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(C=RE);if(C&&(C=C(s,d))){ck(f,C,t,h);break e}P&&P(s,p,d),s==="focusout"&&(P=p._wrapperState)&&P.controlled&&p.type==="number"&&Ig(p,"number",p.value)}switch(P=d?cc(d):window,s){case"focusin":(Tv(P)||P.contentEditable==="true")&&(oc=P,Wg=d,Cu=null);break;case"focusout":Cu=Wg=oc=null;break;case"mousedown":qg=!0;break;case"contextmenu":case"mouseup":case"dragend":qg=!1,Iv(f,t,h);break;case"selectionchange":if(FE)break;case"keydown":case"keyup":Iv(f,t,h)}var N;if(cy)e:{switch(s){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else ac?ok(s,t)&&(I="onCompositionEnd"):s==="keydown"&&t.keyCode===229&&(I="onCompositionStart");I&&(ak&&t.locale!=="ko"&&(ac||I!=="onCompositionStart"?I==="onCompositionEnd"&&ac&&(N=ik()):(Va=h,ay="value"in Va?Va.value:Va.textContent,ac=!0)),P=dm(d,I),0<P.length&&(I=new Av(I,s,null,t,h),f.push({event:I,listeners:P}),N?I.data=N:(N=lk(t),N!==null&&(I.data=N)))),(N=AE?EE(s,t):NE(s,t))&&(d=dm(d,"onBeforeInput"),0<d.length&&(h=new Av("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:d}),h.data=N))}vk(f,e)})}function Vu(s,e,t){return{instance:s,listener:e,currentTarget:t}}function dm(s,e){for(var t=e+"Capture",n=[];s!==null;){var r=s,i=r.stateNode;r.tag===5&&i!==null&&(r=i,i=Ou(s,t),i!=null&&n.unshift(Vu(s,i,r)),i=Ou(s,e),i!=null&&n.push(Vu(s,i,r))),s=s.return}return n}function Xl(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function Fv(s,e,t,n,r){for(var i=e._reactName,a=[];t!==null&&t!==n;){var o=t,l=o.alternate,d=o.stateNode;if(l!==null&&l===n)break;o.tag===5&&d!==null&&(o=d,r?(l=Ou(t,i),l!=null&&a.unshift(Vu(t,l,o))):r||(l=Ou(t,i),l!=null&&a.push(Vu(t,l,o)))),t=t.return}a.length!==0&&s.push({event:e,listeners:a})}var BE=/\r\n?/g,UE=/\u0000|\uFFFD/g;function Ov(s){return(typeof s=="string"?s:""+s).replace(BE,`
`).replace(UE,"")}function Kf(s,e,t){if(e=Ov(e),Ov(s)!==e&&t)throw Error(pe(425))}function um(){}var Xg=null,Kg=null;function Yg(s,e){return s==="textarea"||s==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Qg=typeof setTimeout=="function"?setTimeout:void 0,HE=typeof clearTimeout=="function"?clearTimeout:void 0,zv=typeof Promise=="function"?Promise:void 0,GE=typeof queueMicrotask=="function"?queueMicrotask:typeof zv<"u"?function(s){return zv.resolve(null).then(s).catch(VE)}:Qg;function VE(s){setTimeout(function(){throw s})}function Y0(s,e){var t=e,n=0;do{var r=t.nextSibling;if(s.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(n===0){s.removeChild(r),Bu(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=r}while(t);Bu(e)}function Ya(s){for(;s!=null;s=s.nextSibling){var e=s.nodeType;if(e===1||e===3)break;if(e===8){if(e=s.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return s}function $v(s){s=s.previousSibling;for(var e=0;s;){if(s.nodeType===8){var t=s.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return s;e--}else t==="/$"&&e++}s=s.previousSibling}return null}var Ud=Math.random().toString(36).slice(2),oi="__reactFiber$"+Ud,Wu="__reactProps$"+Ud,ea="__reactContainer$"+Ud,Zg="__reactEvents$"+Ud,WE="__reactListeners$"+Ud,qE="__reactHandles$"+Ud;function ko(s){var e=s[oi];if(e)return e;for(var t=s.parentNode;t;){if(e=t[ea]||t[oi]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(s=$v(s);s!==null;){if(t=s[oi])return t;s=$v(s)}return e}s=t,t=s.parentNode}return null}function Mf(s){return s=s[oi]||s[ea],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function cc(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(pe(33))}function h0(s){return s[Wu]||null}var Jg=[],dc=-1;function lo(s){return{current:s}}function kt(s){0>dc||(s.current=Jg[dc],Jg[dc]=null,dc--)}function yt(s,e){dc++,Jg[dc]=s.current,s.current=e}var no={},zs=lo(no),pn=lo(!1),Pl=no;function Id(s,e){var t=s.type.contextTypes;if(!t)return no;var n=s.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var r={},i;for(i in t)r[i]=e[i];return n&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=e,s.__reactInternalMemoizedMaskedChildContext=r),r}function mn(s){return s=s.childContextTypes,s!=null}function hm(){kt(pn),kt(zs)}function Bv(s,e,t){if(zs.current!==no)throw Error(pe(168));yt(zs,e),yt(pn,t)}function kk(s,e,t){var n=s.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var r in n)if(!(r in e))throw Error(pe(108,PA(s)||"Unknown",r));return It({},t,n)}function fm(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||no,Pl=zs.current,yt(zs,s),yt(pn,pn.current),!0}function Uv(s,e,t){var n=s.stateNode;if(!n)throw Error(pe(169));t?(s=kk(s,e,Pl),n.__reactInternalMemoizedMergedChildContext=s,kt(pn),kt(zs),yt(zs,s)):kt(pn),yt(pn,t)}var wi=null,f0=!1,Q0=!1;function _k(s){wi===null?wi=[s]:wi.push(s)}function XE(s){f0=!0,_k(s)}function co(){if(!Q0&&wi!==null){Q0=!0;var s=0,e=ct;try{var t=wi;for(ct=1;s<t.length;s++){var n=t[s];do n=n(!0);while(n!==null)}wi=null,f0=!1}catch(r){throw wi!==null&&(wi=wi.slice(s+1)),Xw(sy,co),r}finally{ct=e,Q0=!1}}return null}var uc=[],hc=0,pm=null,mm=0,Jn=[],er=0,Ml=null,Xi=1,Ki="";function mo(s,e){uc[hc++]=mm,uc[hc++]=pm,pm=s,mm=e}function Sk(s,e,t){Jn[er++]=Xi,Jn[er++]=Ki,Jn[er++]=Ml,Ml=s;var n=Xi;s=Ki;var r=32-Pr(n)-1;n&=~(1<<r),t+=1;var i=32-Pr(e)+r;if(30<i){var a=r-r%5;i=(n&(1<<a)-1).toString(32),n>>=a,r-=a,Xi=1<<32-Pr(e)+r|t<<r|n,Ki=i+s}else Xi=1<<i|t<<r|n,Ki=s}function uy(s){s.return!==null&&(mo(s,1),Sk(s,1,0))}function hy(s){for(;s===pm;)pm=uc[--hc],uc[hc]=null,mm=uc[--hc],uc[hc]=null;for(;s===Ml;)Ml=Jn[--er],Jn[er]=null,Ki=Jn[--er],Jn[er]=null,Xi=Jn[--er],Jn[er]=null}var Fn=null,Dn=null,Nt=!1,Cr=null;function Ak(s,e){var t=nr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=s,e=s.deletions,e===null?(s.deletions=[t],s.flags|=16):e.push(t)}function Hv(s,e){switch(s.tag){case 5:var t=s.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(s.stateNode=e,Fn=s,Dn=Ya(e.firstChild),!0):!1;case 6:return e=s.pendingProps===""||e.nodeType!==3?null:e,e!==null?(s.stateNode=e,Fn=s,Dn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Ml!==null?{id:Xi,overflow:Ki}:null,s.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=nr(18,null,null,0),t.stateNode=e,t.return=s,s.child=t,Fn=s,Dn=null,!0):!1;default:return!1}}function ex(s){return(s.mode&1)!==0&&(s.flags&128)===0}function tx(s){if(Nt){var e=Dn;if(e){var t=e;if(!Hv(s,e)){if(ex(s))throw Error(pe(418));e=Ya(t.nextSibling);var n=Fn;e&&Hv(s,e)?Ak(n,t):(s.flags=s.flags&-4097|2,Nt=!1,Fn=s)}}else{if(ex(s))throw Error(pe(418));s.flags=s.flags&-4097|2,Nt=!1,Fn=s}}}function Gv(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;Fn=s}function Yf(s){if(s!==Fn)return!1;if(!Nt)return Gv(s),Nt=!0,!1;var e;if((e=s.tag!==3)&&!(e=s.tag!==5)&&(e=s.type,e=e!=="head"&&e!=="body"&&!Yg(s.type,s.memoizedProps)),e&&(e=Dn)){if(ex(s))throw Ek(),Error(pe(418));for(;e;)Ak(s,e),e=Ya(e.nextSibling)}if(Gv(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(pe(317));e:{for(s=s.nextSibling,e=0;s;){if(s.nodeType===8){var t=s.data;if(t==="/$"){if(e===0){Dn=Ya(s.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}s=s.nextSibling}Dn=null}}else Dn=Fn?Ya(s.stateNode.nextSibling):null;return!0}function Ek(){for(var s=Dn;s;)s=Ya(s.nextSibling)}function Ld(){Dn=Fn=null,Nt=!1}function fy(s){Cr===null?Cr=[s]:Cr.push(s)}var KE=ia.ReactCurrentBatchConfig;function Xd(s,e,t){if(s=t.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(pe(309));var n=t.stateNode}if(!n)throw Error(pe(147,s));var r=n,i=""+s;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var o=r.refs;a===null?delete o[i]:o[i]=a},e._stringRef=i,e)}if(typeof s!="string")throw Error(pe(284));if(!t._owner)throw Error(pe(290,s))}return s}function Qf(s,e){throw s=Object.prototype.toString.call(e),Error(pe(31,s==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":s))}function Vv(s){var e=s._init;return e(s._payload)}function Nk(s){function e(g,y){if(s){var w=g.deletions;w===null?(g.deletions=[y],g.flags|=16):w.push(y)}}function t(g,y){if(!s)return null;for(;y!==null;)e(g,y),y=y.sibling;return null}function n(g,y){for(g=new Map;y!==null;)y.key!==null?g.set(y.key,y):g.set(y.index,y),y=y.sibling;return g}function r(g,y){return g=eo(g,y),g.index=0,g.sibling=null,g}function i(g,y,w){return g.index=w,s?(w=g.alternate,w!==null?(w=w.index,w<y?(g.flags|=2,y):w):(g.flags|=2,y)):(g.flags|=1048576,y)}function a(g){return s&&g.alternate===null&&(g.flags|=2),g}function o(g,y,w,k){return y===null||y.tag!==6?(y=rg(w,g.mode,k),y.return=g,y):(y=r(y,w),y.return=g,y)}function l(g,y,w,k){var C=w.type;return C===ic?h(g,y,w.props.children,k,w.key):y!==null&&(y.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===da&&Vv(C)===y.type)?(k=r(y,w.props),k.ref=Xd(g,y,w),k.return=g,k):(k=_p(w.type,w.key,w.props,null,g.mode,k),k.ref=Xd(g,y,w),k.return=g,k)}function d(g,y,w,k){return y===null||y.tag!==4||y.stateNode.containerInfo!==w.containerInfo||y.stateNode.implementation!==w.implementation?(y=ig(w,g.mode,k),y.return=g,y):(y=r(y,w.children||[]),y.return=g,y)}function h(g,y,w,k,C){return y===null||y.tag!==7?(y=jl(w,g.mode,k,C),y.return=g,y):(y=r(y,w),y.return=g,y)}function f(g,y,w){if(typeof y=="string"&&y!==""||typeof y=="number")return y=rg(""+y,g.mode,w),y.return=g,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case $f:return w=_p(y.type,y.key,y.props,null,g.mode,w),w.ref=Xd(g,null,y),w.return=g,w;case rc:return y=ig(y,g.mode,w),y.return=g,y;case da:var k=y._init;return f(g,k(y._payload),w)}if(ru(y)||Hd(y))return y=jl(y,g.mode,w,null),y.return=g,y;Qf(g,y)}return null}function p(g,y,w,k){var C=y!==null?y.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return C!==null?null:o(g,y,""+w,k);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case $f:return w.key===C?l(g,y,w,k):null;case rc:return w.key===C?d(g,y,w,k):null;case da:return C=w._init,p(g,y,C(w._payload),k)}if(ru(w)||Hd(w))return C!==null?null:h(g,y,w,k,null);Qf(g,w)}return null}function m(g,y,w,k,C){if(typeof k=="string"&&k!==""||typeof k=="number")return g=g.get(w)||null,o(y,g,""+k,C);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case $f:return g=g.get(k.key===null?w:k.key)||null,l(y,g,k,C);case rc:return g=g.get(k.key===null?w:k.key)||null,d(y,g,k,C);case da:var P=k._init;return m(g,y,w,P(k._payload),C)}if(ru(k)||Hd(k))return g=g.get(w)||null,h(y,g,k,C,null);Qf(y,k)}return null}function b(g,y,w,k){for(var C=null,P=null,N=y,I=y=0,M=null;N!==null&&I<w.length;I++){N.index>I?(M=N,N=null):M=N.sibling;var L=p(g,N,w[I],k);if(L===null){N===null&&(N=M);break}s&&N&&L.alternate===null&&e(g,N),y=i(L,y,I),P===null?C=L:P.sibling=L,P=L,N=M}if(I===w.length)return t(g,N),Nt&&mo(g,I),C;if(N===null){for(;I<w.length;I++)N=f(g,w[I],k),N!==null&&(y=i(N,y,I),P===null?C=N:P.sibling=N,P=N);return Nt&&mo(g,I),C}for(N=n(g,N);I<w.length;I++)M=m(N,g,I,w[I],k),M!==null&&(s&&M.alternate!==null&&N.delete(M.key===null?I:M.key),y=i(M,y,I),P===null?C=M:P.sibling=M,P=M);return s&&N.forEach(function($){return e(g,$)}),Nt&&mo(g,I),C}function x(g,y,w,k){var C=Hd(w);if(typeof C!="function")throw Error(pe(150));if(w=C.call(w),w==null)throw Error(pe(151));for(var P=C=null,N=y,I=y=0,M=null,L=w.next();N!==null&&!L.done;I++,L=w.next()){N.index>I?(M=N,N=null):M=N.sibling;var $=p(g,N,L.value,k);if($===null){N===null&&(N=M);break}s&&N&&$.alternate===null&&e(g,N),y=i($,y,I),P===null?C=$:P.sibling=$,P=$,N=M}if(L.done)return t(g,N),Nt&&mo(g,I),C;if(N===null){for(;!L.done;I++,L=w.next())L=f(g,L.value,k),L!==null&&(y=i(L,y,I),P===null?C=L:P.sibling=L,P=L);return Nt&&mo(g,I),C}for(N=n(g,N);!L.done;I++,L=w.next())L=m(N,g,I,L.value,k),L!==null&&(s&&L.alternate!==null&&N.delete(L.key===null?I:L.key),y=i(L,y,I),P===null?C=L:P.sibling=L,P=L);return s&&N.forEach(function(E){return e(g,E)}),Nt&&mo(g,I),C}function v(g,y,w,k){if(typeof w=="object"&&w!==null&&w.type===ic&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case $f:e:{for(var C=w.key,P=y;P!==null;){if(P.key===C){if(C=w.type,C===ic){if(P.tag===7){t(g,P.sibling),y=r(P,w.props.children),y.return=g,g=y;break e}}else if(P.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===da&&Vv(C)===P.type){t(g,P.sibling),y=r(P,w.props),y.ref=Xd(g,P,w),y.return=g,g=y;break e}t(g,P);break}else e(g,P);P=P.sibling}w.type===ic?(y=jl(w.props.children,g.mode,k,w.key),y.return=g,g=y):(k=_p(w.type,w.key,w.props,null,g.mode,k),k.ref=Xd(g,y,w),k.return=g,g=k)}return a(g);case rc:e:{for(P=w.key;y!==null;){if(y.key===P)if(y.tag===4&&y.stateNode.containerInfo===w.containerInfo&&y.stateNode.implementation===w.implementation){t(g,y.sibling),y=r(y,w.children||[]),y.return=g,g=y;break e}else{t(g,y);break}else e(g,y);y=y.sibling}y=ig(w,g.mode,k),y.return=g,g=y}return a(g);case da:return P=w._init,v(g,y,P(w._payload),k)}if(ru(w))return b(g,y,w,k);if(Hd(w))return x(g,y,w,k);Qf(g,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,y!==null&&y.tag===6?(t(g,y.sibling),y=r(y,w),y.return=g,g=y):(t(g,y),y=rg(w,g.mode,k),y.return=g,g=y),a(g)):t(g,y)}return v}var Dd=Nk(!0),Ck=Nk(!1),gm=lo(null),xm=null,fc=null,py=null;function my(){py=fc=xm=null}function gy(s){var e=gm.current;kt(gm),s._currentValue=e}function sx(s,e,t){for(;s!==null;){var n=s.alternate;if((s.childLanes&e)!==e?(s.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),s===t)break;s=s.return}}function Sc(s,e){xm=s,py=fc=null,s=s.dependencies,s!==null&&s.firstContext!==null&&(s.lanes&e&&(fn=!0),s.firstContext=null)}function ar(s){var e=s._currentValue;if(py!==s)if(s={context:s,memoizedValue:e,next:null},fc===null){if(xm===null)throw Error(pe(308));fc=s,xm.dependencies={lanes:0,firstContext:s}}else fc=fc.next=s;return e}var _o=null;function xy(s){_o===null?_o=[s]:_o.push(s)}function Tk(s,e,t,n){var r=e.interleaved;return r===null?(t.next=t,xy(e)):(t.next=r.next,r.next=t),e.interleaved=t,ta(s,n)}function ta(s,e){s.lanes|=e;var t=s.alternate;for(t!==null&&(t.lanes|=e),t=s,s=s.return;s!==null;)s.childLanes|=e,t=s.alternate,t!==null&&(t.childLanes|=e),t=s,s=s.return;return t.tag===3?t.stateNode:null}var ua=!1;function by(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function jk(s,e){s=s.updateQueue,e.updateQueue===s&&(e.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function Yi(s,e){return{eventTime:s,lane:e,tag:0,payload:null,callback:null,next:null}}function Qa(s,e,t){var n=s.updateQueue;if(n===null)return null;if(n=n.shared,et&2){var r=n.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),n.pending=e,ta(s,t)}return r=n.interleaved,r===null?(e.next=e,xy(n)):(e.next=r.next,r.next=e),n.interleaved=e,ta(s,t)}function xp(s,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=s.pendingLanes,t|=n,e.lanes=t,ny(s,t)}}function Wv(s,e){var t=s.updateQueue,n=s.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var r=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?r=i=a:i=i.next=a,t=t.next}while(t!==null);i===null?r=i=e:i=i.next=e}else r=i=e;t={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:n.shared,effects:n.effects},s.updateQueue=t;return}s=t.lastBaseUpdate,s===null?t.firstBaseUpdate=e:s.next=e,t.lastBaseUpdate=e}function bm(s,e,t,n){var r=s.updateQueue;ua=!1;var i=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(o!==null){r.shared.pending=null;var l=o,d=l.next;l.next=null,a===null?i=d:a.next=d,a=l;var h=s.alternate;h!==null&&(h=h.updateQueue,o=h.lastBaseUpdate,o!==a&&(o===null?h.firstBaseUpdate=d:o.next=d,h.lastBaseUpdate=l))}if(i!==null){var f=r.baseState;a=0,h=d=l=null,o=i;do{var p=o.lane,m=o.eventTime;if((n&p)===p){h!==null&&(h=h.next={eventTime:m,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var b=s,x=o;switch(p=e,m=t,x.tag){case 1:if(b=x.payload,typeof b=="function"){f=b.call(m,f,p);break e}f=b;break e;case 3:b.flags=b.flags&-65537|128;case 0:if(b=x.payload,p=typeof b=="function"?b.call(m,f,p):b,p==null)break e;f=It({},f,p);break e;case 2:ua=!0}}o.callback!==null&&o.lane!==0&&(s.flags|=64,p=r.effects,p===null?r.effects=[o]:p.push(o))}else m={eventTime:m,lane:p,tag:o.tag,payload:o.payload,callback:o.callback,next:null},h===null?(d=h=m,l=f):h=h.next=m,a|=p;if(o=o.next,o===null){if(o=r.shared.pending,o===null)break;p=o,o=p.next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}while(!0);if(h===null&&(l=f),r.baseState=l,r.firstBaseUpdate=d,r.lastBaseUpdate=h,e=r.shared.interleaved,e!==null){r=e;do a|=r.lane,r=r.next;while(r!==e)}else i===null&&(r.shared.lanes=0);Il|=a,s.lanes=a,s.memoizedState=f}}function qv(s,e,t){if(s=e.effects,e.effects=null,s!==null)for(e=0;e<s.length;e++){var n=s[e],r=n.callback;if(r!==null){if(n.callback=null,n=t,typeof r!="function")throw Error(pe(191,r));r.call(n)}}}var Rf={},ci=lo(Rf),qu=lo(Rf),Xu=lo(Rf);function So(s){if(s===Rf)throw Error(pe(174));return s}function yy(s,e){switch(yt(Xu,e),yt(qu,s),yt(ci,Rf),s=e.nodeType,s){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Dg(null,"");break;default:s=s===8?e.parentNode:e,e=s.namespaceURI||null,s=s.tagName,e=Dg(e,s)}kt(ci),yt(ci,e)}function Fd(){kt(ci),kt(qu),kt(Xu)}function Pk(s){So(Xu.current);var e=So(ci.current),t=Dg(e,s.type);e!==t&&(yt(qu,s),yt(ci,t))}function vy(s){qu.current===s&&(kt(ci),kt(qu))}var Pt=lo(0);function ym(s){for(var e=s;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Z0=[];function wy(){for(var s=0;s<Z0.length;s++)Z0[s]._workInProgressVersionPrimary=null;Z0.length=0}var bp=ia.ReactCurrentDispatcher,J0=ia.ReactCurrentBatchConfig,Rl=0,Rt=null,Jt=null,cs=null,vm=!1,Tu=!1,Ku=0,YE=0;function Ns(){throw Error(pe(321))}function ky(s,e){if(e===null)return!1;for(var t=0;t<e.length&&t<s.length;t++)if(!Rr(s[t],e[t]))return!1;return!0}function _y(s,e,t,n,r,i){if(Rl=i,Rt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,bp.current=s===null||s.memoizedState===null?eN:tN,s=t(n,r),Tu){i=0;do{if(Tu=!1,Ku=0,25<=i)throw Error(pe(301));i+=1,cs=Jt=null,e.updateQueue=null,bp.current=sN,s=t(n,r)}while(Tu)}if(bp.current=wm,e=Jt!==null&&Jt.next!==null,Rl=0,cs=Jt=Rt=null,vm=!1,e)throw Error(pe(300));return s}function Sy(){var s=Ku!==0;return Ku=0,s}function Ur(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return cs===null?Rt.memoizedState=cs=s:cs=cs.next=s,cs}function or(){if(Jt===null){var s=Rt.alternate;s=s!==null?s.memoizedState:null}else s=Jt.next;var e=cs===null?Rt.memoizedState:cs.next;if(e!==null)cs=e,Jt=s;else{if(s===null)throw Error(pe(310));Jt=s,s={memoizedState:Jt.memoizedState,baseState:Jt.baseState,baseQueue:Jt.baseQueue,queue:Jt.queue,next:null},cs===null?Rt.memoizedState=cs=s:cs=cs.next=s}return cs}function Yu(s,e){return typeof e=="function"?e(s):e}function eg(s){var e=or(),t=e.queue;if(t===null)throw Error(pe(311));t.lastRenderedReducer=s;var n=Jt,r=n.baseQueue,i=t.pending;if(i!==null){if(r!==null){var a=r.next;r.next=i.next,i.next=a}n.baseQueue=r=i,t.pending=null}if(r!==null){i=r.next,n=n.baseState;var o=a=null,l=null,d=i;do{var h=d.lane;if((Rl&h)===h)l!==null&&(l=l.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:s(n,d.action);else{var f={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};l===null?(o=l=f,a=n):l=l.next=f,Rt.lanes|=h,Il|=h}d=d.next}while(d!==null&&d!==i);l===null?a=n:l.next=o,Rr(n,e.memoizedState)||(fn=!0),e.memoizedState=n,e.baseState=a,e.baseQueue=l,t.lastRenderedState=n}if(s=t.interleaved,s!==null){r=s;do i=r.lane,Rt.lanes|=i,Il|=i,r=r.next;while(r!==s)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function tg(s){var e=or(),t=e.queue;if(t===null)throw Error(pe(311));t.lastRenderedReducer=s;var n=t.dispatch,r=t.pending,i=e.memoizedState;if(r!==null){t.pending=null;var a=r=r.next;do i=s(i,a.action),a=a.next;while(a!==r);Rr(i,e.memoizedState)||(fn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,n]}function Mk(){}function Rk(s,e){var t=Rt,n=or(),r=e(),i=!Rr(n.memoizedState,r);if(i&&(n.memoizedState=r,fn=!0),n=n.queue,Ay(Dk.bind(null,t,n,s),[s]),n.getSnapshot!==e||i||cs!==null&&cs.memoizedState.tag&1){if(t.flags|=2048,Qu(9,Lk.bind(null,t,n,r,e),void 0,null),ds===null)throw Error(pe(349));Rl&30||Ik(t,e,r)}return r}function Ik(s,e,t){s.flags|=16384,s={getSnapshot:e,value:t},e=Rt.updateQueue,e===null?(e={lastEffect:null,stores:null},Rt.updateQueue=e,e.stores=[s]):(t=e.stores,t===null?e.stores=[s]:t.push(s))}function Lk(s,e,t,n){e.value=t,e.getSnapshot=n,Fk(e)&&Ok(s)}function Dk(s,e,t){return t(function(){Fk(e)&&Ok(s)})}function Fk(s){var e=s.getSnapshot;s=s.value;try{var t=e();return!Rr(s,t)}catch{return!0}}function Ok(s){var e=ta(s,1);e!==null&&Mr(e,s,1,-1)}function Xv(s){var e=Ur();return typeof s=="function"&&(s=s()),e.memoizedState=e.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Yu,lastRenderedState:s},e.queue=s,s=s.dispatch=JE.bind(null,Rt,s),[e.memoizedState,s]}function Qu(s,e,t,n){return s={tag:s,create:e,destroy:t,deps:n,next:null},e=Rt.updateQueue,e===null?(e={lastEffect:null,stores:null},Rt.updateQueue=e,e.lastEffect=s.next=s):(t=e.lastEffect,t===null?e.lastEffect=s.next=s:(n=t.next,t.next=s,s.next=n,e.lastEffect=s)),s}function zk(){return or().memoizedState}function yp(s,e,t,n){var r=Ur();Rt.flags|=s,r.memoizedState=Qu(1|e,t,void 0,n===void 0?null:n)}function p0(s,e,t,n){var r=or();n=n===void 0?null:n;var i=void 0;if(Jt!==null){var a=Jt.memoizedState;if(i=a.destroy,n!==null&&ky(n,a.deps)){r.memoizedState=Qu(e,t,i,n);return}}Rt.flags|=s,r.memoizedState=Qu(1|e,t,i,n)}function Kv(s,e){return yp(8390656,8,s,e)}function Ay(s,e){return p0(2048,8,s,e)}function $k(s,e){return p0(4,2,s,e)}function Bk(s,e){return p0(4,4,s,e)}function Uk(s,e){if(typeof e=="function")return s=s(),e(s),function(){e(null)};if(e!=null)return s=s(),e.current=s,function(){e.current=null}}function Hk(s,e,t){return t=t!=null?t.concat([s]):null,p0(4,4,Uk.bind(null,e,s),t)}function Ey(){}function Gk(s,e){var t=or();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&ky(e,n[1])?n[0]:(t.memoizedState=[s,e],s)}function Vk(s,e){var t=or();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&ky(e,n[1])?n[0]:(s=s(),t.memoizedState=[s,e],s)}function Wk(s,e,t){return Rl&21?(Rr(t,e)||(t=Qw(),Rt.lanes|=t,Il|=t,s.baseState=!0),e):(s.baseState&&(s.baseState=!1,fn=!0),s.memoizedState=t)}function QE(s,e){var t=ct;ct=t!==0&&4>t?t:4,s(!0);var n=J0.transition;J0.transition={};try{s(!1),e()}finally{ct=t,J0.transition=n}}function qk(){return or().memoizedState}function ZE(s,e,t){var n=Ja(s);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},Xk(s))Kk(e,t);else if(t=Tk(s,e,t,n),t!==null){var r=Ys();Mr(t,s,n,r),Yk(t,e,n)}}function JE(s,e,t){var n=Ja(s),r={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(Xk(s))Kk(e,r);else{var i=s.alternate;if(s.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,o=i(a,t);if(r.hasEagerState=!0,r.eagerState=o,Rr(o,a)){var l=e.interleaved;l===null?(r.next=r,xy(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}t=Tk(s,e,r,n),t!==null&&(r=Ys(),Mr(t,s,n,r),Yk(t,e,n))}}function Xk(s){var e=s.alternate;return s===Rt||e!==null&&e===Rt}function Kk(s,e){Tu=vm=!0;var t=s.pending;t===null?e.next=e:(e.next=t.next,t.next=e),s.pending=e}function Yk(s,e,t){if(t&4194240){var n=e.lanes;n&=s.pendingLanes,t|=n,e.lanes=t,ny(s,t)}}var wm={readContext:ar,useCallback:Ns,useContext:Ns,useEffect:Ns,useImperativeHandle:Ns,useInsertionEffect:Ns,useLayoutEffect:Ns,useMemo:Ns,useReducer:Ns,useRef:Ns,useState:Ns,useDebugValue:Ns,useDeferredValue:Ns,useTransition:Ns,useMutableSource:Ns,useSyncExternalStore:Ns,useId:Ns,unstable_isNewReconciler:!1},eN={readContext:ar,useCallback:function(s,e){return Ur().memoizedState=[s,e===void 0?null:e],s},useContext:ar,useEffect:Kv,useImperativeHandle:function(s,e,t){return t=t!=null?t.concat([s]):null,yp(4194308,4,Uk.bind(null,e,s),t)},useLayoutEffect:function(s,e){return yp(4194308,4,s,e)},useInsertionEffect:function(s,e){return yp(4,2,s,e)},useMemo:function(s,e){var t=Ur();return e=e===void 0?null:e,s=s(),t.memoizedState=[s,e],s},useReducer:function(s,e,t){var n=Ur();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:e},n.queue=s,s=s.dispatch=ZE.bind(null,Rt,s),[n.memoizedState,s]},useRef:function(s){var e=Ur();return s={current:s},e.memoizedState=s},useState:Xv,useDebugValue:Ey,useDeferredValue:function(s){return Ur().memoizedState=s},useTransition:function(){var s=Xv(!1),e=s[0];return s=QE.bind(null,s[1]),Ur().memoizedState=s,[e,s]},useMutableSource:function(){},useSyncExternalStore:function(s,e,t){var n=Rt,r=Ur();if(Nt){if(t===void 0)throw Error(pe(407));t=t()}else{if(t=e(),ds===null)throw Error(pe(349));Rl&30||Ik(n,e,t)}r.memoizedState=t;var i={value:t,getSnapshot:e};return r.queue=i,Kv(Dk.bind(null,n,i,s),[s]),n.flags|=2048,Qu(9,Lk.bind(null,n,i,t,e),void 0,null),t},useId:function(){var s=Ur(),e=ds.identifierPrefix;if(Nt){var t=Ki,n=Xi;t=(n&~(1<<32-Pr(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=Ku++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=YE++,e=":"+e+"r"+t.toString(32)+":";return s.memoizedState=e},unstable_isNewReconciler:!1},tN={readContext:ar,useCallback:Gk,useContext:ar,useEffect:Ay,useImperativeHandle:Hk,useInsertionEffect:$k,useLayoutEffect:Bk,useMemo:Vk,useReducer:eg,useRef:zk,useState:function(){return eg(Yu)},useDebugValue:Ey,useDeferredValue:function(s){var e=or();return Wk(e,Jt.memoizedState,s)},useTransition:function(){var s=eg(Yu)[0],e=or().memoizedState;return[s,e]},useMutableSource:Mk,useSyncExternalStore:Rk,useId:qk,unstable_isNewReconciler:!1},sN={readContext:ar,useCallback:Gk,useContext:ar,useEffect:Ay,useImperativeHandle:Hk,useInsertionEffect:$k,useLayoutEffect:Bk,useMemo:Vk,useReducer:tg,useRef:zk,useState:function(){return tg(Yu)},useDebugValue:Ey,useDeferredValue:function(s){var e=or();return Jt===null?e.memoizedState=s:Wk(e,Jt.memoizedState,s)},useTransition:function(){var s=tg(Yu)[0],e=or().memoizedState;return[s,e]},useMutableSource:Mk,useSyncExternalStore:Rk,useId:qk,unstable_isNewReconciler:!1};function hr(s,e){if(s&&s.defaultProps){e=It({},e),s=s.defaultProps;for(var t in s)e[t]===void 0&&(e[t]=s[t]);return e}return e}function nx(s,e,t,n){e=s.memoizedState,t=t(n,e),t=t==null?e:It({},e,t),s.memoizedState=t,s.lanes===0&&(s.updateQueue.baseState=t)}var m0={isMounted:function(s){return(s=s._reactInternals)?Bl(s)===s:!1},enqueueSetState:function(s,e,t){s=s._reactInternals;var n=Ys(),r=Ja(s),i=Yi(n,r);i.payload=e,t!=null&&(i.callback=t),e=Qa(s,i,r),e!==null&&(Mr(e,s,r,n),xp(e,s,r))},enqueueReplaceState:function(s,e,t){s=s._reactInternals;var n=Ys(),r=Ja(s),i=Yi(n,r);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Qa(s,i,r),e!==null&&(Mr(e,s,r,n),xp(e,s,r))},enqueueForceUpdate:function(s,e){s=s._reactInternals;var t=Ys(),n=Ja(s),r=Yi(t,n);r.tag=2,e!=null&&(r.callback=e),e=Qa(s,r,n),e!==null&&(Mr(e,s,n,t),xp(e,s,n))}};function Yv(s,e,t,n,r,i,a){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(n,i,a):e.prototype&&e.prototype.isPureReactComponent?!Hu(t,n)||!Hu(r,i):!0}function Qk(s,e,t){var n=!1,r=no,i=e.contextType;return typeof i=="object"&&i!==null?i=ar(i):(r=mn(e)?Pl:zs.current,n=e.contextTypes,i=(n=n!=null)?Id(s,r):no),e=new e(t,i),s.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=m0,s.stateNode=e,e._reactInternals=s,n&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=r,s.__reactInternalMemoizedMaskedChildContext=i),e}function Qv(s,e,t,n){s=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==s&&m0.enqueueReplaceState(e,e.state,null)}function rx(s,e,t,n){var r=s.stateNode;r.props=t,r.state=s.memoizedState,r.refs={},by(s);var i=e.contextType;typeof i=="object"&&i!==null?r.context=ar(i):(i=mn(e)?Pl:zs.current,r.context=Id(s,i)),r.state=s.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(nx(s,e,i,t),r.state=s.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&m0.enqueueReplaceState(r,r.state,null),bm(s,t,r,n),r.state=s.memoizedState),typeof r.componentDidMount=="function"&&(s.flags|=4194308)}function Od(s,e){try{var t="",n=e;do t+=jA(n),n=n.return;while(n);var r=t}catch(i){r=`
Error generating stack: `+i.message+`
`+i.stack}return{value:s,source:e,stack:r,digest:null}}function sg(s,e,t){return{value:s,source:null,stack:t??null,digest:e??null}}function ix(s,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var nN=typeof WeakMap=="function"?WeakMap:Map;function Zk(s,e,t){t=Yi(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){_m||(_m=!0,mx=n),ix(s,e)},t}function Jk(s,e,t){t=Yi(-1,t),t.tag=3;var n=s.type.getDerivedStateFromError;if(typeof n=="function"){var r=e.value;t.payload=function(){return n(r)},t.callback=function(){ix(s,e)}}var i=s.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){ix(s,e),typeof n!="function"&&(Za===null?Za=new Set([this]):Za.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function Zv(s,e,t){var n=s.pingCache;if(n===null){n=s.pingCache=new nN;var r=new Set;n.set(e,r)}else r=n.get(e),r===void 0&&(r=new Set,n.set(e,r));r.has(t)||(r.add(t),s=xN.bind(null,s,e,t),e.then(s,s))}function Jv(s){do{var e;if((e=s.tag===13)&&(e=s.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return s;s=s.return}while(s!==null);return null}function e1(s,e,t,n,r){return s.mode&1?(s.flags|=65536,s.lanes=r,s):(s===e?s.flags|=65536:(s.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Yi(-1,1),e.tag=2,Qa(t,e,1))),t.lanes|=1),s)}var rN=ia.ReactCurrentOwner,fn=!1;function Ks(s,e,t,n){e.child=s===null?Ck(e,null,t,n):Dd(e,s.child,t,n)}function t1(s,e,t,n,r){t=t.render;var i=e.ref;return Sc(e,r),n=_y(s,e,t,n,i,r),t=Sy(),s!==null&&!fn?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~r,sa(s,e,r)):(Nt&&t&&uy(e),e.flags|=1,Ks(s,e,n,r),e.child)}function s1(s,e,t,n,r){if(s===null){var i=t.type;return typeof i=="function"&&!Iy(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,e2(s,e,i,n,r)):(s=_p(t.type,null,n,e,e.mode,r),s.ref=e.ref,s.return=e,e.child=s)}if(i=s.child,!(s.lanes&r)){var a=i.memoizedProps;if(t=t.compare,t=t!==null?t:Hu,t(a,n)&&s.ref===e.ref)return sa(s,e,r)}return e.flags|=1,s=eo(i,n),s.ref=e.ref,s.return=e,e.child=s}function e2(s,e,t,n,r){if(s!==null){var i=s.memoizedProps;if(Hu(i,n)&&s.ref===e.ref)if(fn=!1,e.pendingProps=n=i,(s.lanes&r)!==0)s.flags&131072&&(fn=!0);else return e.lanes=s.lanes,sa(s,e,r)}return ax(s,e,t,n,r)}function t2(s,e,t){var n=e.pendingProps,r=n.children,i=s!==null?s.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},yt(mc,Rn),Rn|=t;else{if(!(t&1073741824))return s=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:s,cachePool:null,transitions:null},e.updateQueue=null,yt(mc,Rn),Rn|=s,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:t,yt(mc,Rn),Rn|=n}else i!==null?(n=i.baseLanes|t,e.memoizedState=null):n=t,yt(mc,Rn),Rn|=n;return Ks(s,e,r,t),e.child}function s2(s,e){var t=e.ref;(s===null&&t!==null||s!==null&&s.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function ax(s,e,t,n,r){var i=mn(t)?Pl:zs.current;return i=Id(e,i),Sc(e,r),t=_y(s,e,t,n,i,r),n=Sy(),s!==null&&!fn?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~r,sa(s,e,r)):(Nt&&n&&uy(e),e.flags|=1,Ks(s,e,t,r),e.child)}function n1(s,e,t,n,r){if(mn(t)){var i=!0;fm(e)}else i=!1;if(Sc(e,r),e.stateNode===null)vp(s,e),Qk(e,t,n),rx(e,t,n,r),n=!0;else if(s===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,d=t.contextType;typeof d=="object"&&d!==null?d=ar(d):(d=mn(t)?Pl:zs.current,d=Id(e,d));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";f||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==n||l!==d)&&Qv(e,a,n,d),ua=!1;var p=e.memoizedState;a.state=p,bm(e,n,a,r),l=e.memoizedState,o!==n||p!==l||pn.current||ua?(typeof h=="function"&&(nx(e,t,h,n),l=e.memoizedState),(o=ua||Yv(e,t,o,n,p,l,d))?(f||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=l),a.props=n,a.state=l,a.context=d,n=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{a=e.stateNode,jk(s,e),o=e.memoizedProps,d=e.type===e.elementType?o:hr(e.type,o),a.props=d,f=e.pendingProps,p=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=ar(l):(l=mn(t)?Pl:zs.current,l=Id(e,l));var m=t.getDerivedStateFromProps;(h=typeof m=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==f||p!==l)&&Qv(e,a,n,l),ua=!1,p=e.memoizedState,a.state=p,bm(e,n,a,r);var b=e.memoizedState;o!==f||p!==b||pn.current||ua?(typeof m=="function"&&(nx(e,t,m,n),b=e.memoizedState),(d=ua||Yv(e,t,d,n,p,b,l)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(n,b,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(n,b,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===s.memoizedProps&&p===s.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===s.memoizedProps&&p===s.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=b),a.props=n,a.state=b,a.context=l,n=d):(typeof a.componentDidUpdate!="function"||o===s.memoizedProps&&p===s.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===s.memoizedProps&&p===s.memoizedState||(e.flags|=1024),n=!1)}return ox(s,e,t,n,i,r)}function ox(s,e,t,n,r,i){s2(s,e);var a=(e.flags&128)!==0;if(!n&&!a)return r&&Uv(e,t,!1),sa(s,e,i);n=e.stateNode,rN.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,s!==null&&a?(e.child=Dd(e,s.child,null,i),e.child=Dd(e,null,o,i)):Ks(s,e,o,i),e.memoizedState=n.state,r&&Uv(e,t,!0),e.child}function n2(s){var e=s.stateNode;e.pendingContext?Bv(s,e.pendingContext,e.pendingContext!==e.context):e.context&&Bv(s,e.context,!1),yy(s,e.containerInfo)}function r1(s,e,t,n,r){return Ld(),fy(r),e.flags|=256,Ks(s,e,t,n),e.child}var lx={dehydrated:null,treeContext:null,retryLane:0};function cx(s){return{baseLanes:s,cachePool:null,transitions:null}}function r2(s,e,t){var n=e.pendingProps,r=Pt.current,i=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=s!==null&&s.memoizedState===null?!1:(r&2)!==0),o?(i=!0,e.flags&=-129):(s===null||s.memoizedState!==null)&&(r|=1),yt(Pt,r&1),s===null)return tx(e),s=e.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?(e.mode&1?s.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=n.children,s=n.fallback,i?(n=e.mode,i=e.child,a={mode:"hidden",children:a},!(n&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=b0(a,n,0,null),s=jl(s,n,t,null),i.return=e,s.return=e,i.sibling=s,e.child=i,e.child.memoizedState=cx(t),e.memoizedState=lx,s):Ny(e,a));if(r=s.memoizedState,r!==null&&(o=r.dehydrated,o!==null))return iN(s,e,a,n,o,r,t);if(i){i=n.fallback,a=e.mode,r=s.child,o=r.sibling;var l={mode:"hidden",children:n.children};return!(a&1)&&e.child!==r?(n=e.child,n.childLanes=0,n.pendingProps=l,e.deletions=null):(n=eo(r,l),n.subtreeFlags=r.subtreeFlags&14680064),o!==null?i=eo(o,i):(i=jl(i,a,t,null),i.flags|=2),i.return=e,n.return=e,n.sibling=i,e.child=n,n=i,i=e.child,a=s.child.memoizedState,a=a===null?cx(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=s.childLanes&~t,e.memoizedState=lx,n}return i=s.child,s=i.sibling,n=eo(i,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,s!==null&&(t=e.deletions,t===null?(e.deletions=[s],e.flags|=16):t.push(s)),e.child=n,e.memoizedState=null,n}function Ny(s,e){return e=b0({mode:"visible",children:e},s.mode,0,null),e.return=s,s.child=e}function Zf(s,e,t,n){return n!==null&&fy(n),Dd(e,s.child,null,t),s=Ny(e,e.pendingProps.children),s.flags|=2,e.memoizedState=null,s}function iN(s,e,t,n,r,i,a){if(t)return e.flags&256?(e.flags&=-257,n=sg(Error(pe(422))),Zf(s,e,a,n)):e.memoizedState!==null?(e.child=s.child,e.flags|=128,null):(i=n.fallback,r=e.mode,n=b0({mode:"visible",children:n.children},r,0,null),i=jl(i,r,a,null),i.flags|=2,n.return=e,i.return=e,n.sibling=i,e.child=n,e.mode&1&&Dd(e,s.child,null,a),e.child.memoizedState=cx(a),e.memoizedState=lx,i);if(!(e.mode&1))return Zf(s,e,a,null);if(r.data==="$!"){if(n=r.nextSibling&&r.nextSibling.dataset,n)var o=n.dgst;return n=o,i=Error(pe(419)),n=sg(i,n,void 0),Zf(s,e,a,n)}if(o=(a&s.childLanes)!==0,fn||o){if(n=ds,n!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(n.suspendedLanes|a)?0:r,r!==0&&r!==i.retryLane&&(i.retryLane=r,ta(s,r),Mr(n,s,r,-1))}return Ry(),n=sg(Error(pe(421))),Zf(s,e,a,n)}return r.data==="$?"?(e.flags|=128,e.child=s.child,e=bN.bind(null,s),r._reactRetry=e,null):(s=i.treeContext,Dn=Ya(r.nextSibling),Fn=e,Nt=!0,Cr=null,s!==null&&(Jn[er++]=Xi,Jn[er++]=Ki,Jn[er++]=Ml,Xi=s.id,Ki=s.overflow,Ml=e),e=Ny(e,n.children),e.flags|=4096,e)}function i1(s,e,t){s.lanes|=e;var n=s.alternate;n!==null&&(n.lanes|=e),sx(s.return,e,t)}function ng(s,e,t,n,r){var i=s.memoizedState;i===null?s.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:r}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=t,i.tailMode=r)}function i2(s,e,t){var n=e.pendingProps,r=n.revealOrder,i=n.tail;if(Ks(s,e,n.children,t),n=Pt.current,n&2)n=n&1|2,e.flags|=128;else{if(s!==null&&s.flags&128)e:for(s=e.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&i1(s,t,e);else if(s.tag===19)i1(s,t,e);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break e;for(;s.sibling===null;){if(s.return===null||s.return===e)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}n&=1}if(yt(Pt,n),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)s=t.alternate,s!==null&&ym(s)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),ng(e,!1,r,t,i);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(s=r.alternate,s!==null&&ym(s)===null){e.child=r;break}s=r.sibling,r.sibling=t,t=r,r=s}ng(e,!0,t,null,i);break;case"together":ng(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function vp(s,e){!(e.mode&1)&&s!==null&&(s.alternate=null,e.alternate=null,e.flags|=2)}function sa(s,e,t){if(s!==null&&(e.dependencies=s.dependencies),Il|=e.lanes,!(t&e.childLanes))return null;if(s!==null&&e.child!==s.child)throw Error(pe(153));if(e.child!==null){for(s=e.child,t=eo(s,s.pendingProps),e.child=t,t.return=e;s.sibling!==null;)s=s.sibling,t=t.sibling=eo(s,s.pendingProps),t.return=e;t.sibling=null}return e.child}function aN(s,e,t){switch(e.tag){case 3:n2(e),Ld();break;case 5:Pk(e);break;case 1:mn(e.type)&&fm(e);break;case 4:yy(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,r=e.memoizedProps.value;yt(gm,n._currentValue),n._currentValue=r;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(yt(Pt,Pt.current&1),e.flags|=128,null):t&e.child.childLanes?r2(s,e,t):(yt(Pt,Pt.current&1),s=sa(s,e,t),s!==null?s.sibling:null);yt(Pt,Pt.current&1);break;case 19:if(n=(t&e.childLanes)!==0,s.flags&128){if(n)return i2(s,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),yt(Pt,Pt.current),n)break;return null;case 22:case 23:return e.lanes=0,t2(s,e,t)}return sa(s,e,t)}var a2,dx,o2,l2;a2=function(s,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)s.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};dx=function(){};o2=function(s,e,t,n){var r=s.memoizedProps;if(r!==n){s=e.stateNode,So(ci.current);var i=null;switch(t){case"input":r=Mg(s,r),n=Mg(s,n),i=[];break;case"select":r=It({},r,{value:void 0}),n=It({},n,{value:void 0}),i=[];break;case"textarea":r=Lg(s,r),n=Lg(s,n),i=[];break;default:typeof r.onClick!="function"&&typeof n.onClick=="function"&&(s.onclick=um)}Fg(t,n);var a;t=null;for(d in r)if(!n.hasOwnProperty(d)&&r.hasOwnProperty(d)&&r[d]!=null)if(d==="style"){var o=r[d];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Du.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in n){var l=n[d];if(o=r!=null?r[d]:void 0,n.hasOwnProperty(d)&&l!==o&&(l!=null||o!=null))if(d==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(i||(i=[]),i.push(d,t)),t=l;else d==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(i=i||[]).push(d,l)):d==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(d,""+l):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Du.hasOwnProperty(d)?(l!=null&&d==="onScroll"&&vt("scroll",s),i||o===l||(i=[])):(i=i||[]).push(d,l))}t&&(i=i||[]).push("style",t);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};l2=function(s,e,t,n){t!==n&&(e.flags|=4)};function Kd(s,e){if(!Nt)switch(s.tailMode){case"hidden":e=s.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?s.tail=null:t.sibling=null;break;case"collapsed":t=s.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||s.tail===null?s.tail=null:s.tail.sibling=null:n.sibling=null}}function Cs(s){var e=s.alternate!==null&&s.alternate.child===s.child,t=0,n=0;if(e)for(var r=s.child;r!==null;)t|=r.lanes|r.childLanes,n|=r.subtreeFlags&14680064,n|=r.flags&14680064,r.return=s,r=r.sibling;else for(r=s.child;r!==null;)t|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=s,r=r.sibling;return s.subtreeFlags|=n,s.childLanes=t,e}function oN(s,e,t){var n=e.pendingProps;switch(hy(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Cs(e),null;case 1:return mn(e.type)&&hm(),Cs(e),null;case 3:return n=e.stateNode,Fd(),kt(pn),kt(zs),wy(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(s===null||s.child===null)&&(Yf(e)?e.flags|=4:s===null||s.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Cr!==null&&(bx(Cr),Cr=null))),dx(s,e),Cs(e),null;case 5:vy(e);var r=So(Xu.current);if(t=e.type,s!==null&&e.stateNode!=null)o2(s,e,t,n,r),s.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(pe(166));return Cs(e),null}if(s=So(ci.current),Yf(e)){n=e.stateNode,t=e.type;var i=e.memoizedProps;switch(n[oi]=e,n[Wu]=i,s=(e.mode&1)!==0,t){case"dialog":vt("cancel",n),vt("close",n);break;case"iframe":case"object":case"embed":vt("load",n);break;case"video":case"audio":for(r=0;r<au.length;r++)vt(au[r],n);break;case"source":vt("error",n);break;case"img":case"image":case"link":vt("error",n),vt("load",n);break;case"details":vt("toggle",n);break;case"input":pv(n,i),vt("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},vt("invalid",n);break;case"textarea":gv(n,i),vt("invalid",n)}Fg(t,i),r=null;for(var a in i)if(i.hasOwnProperty(a)){var o=i[a];a==="children"?typeof o=="string"?n.textContent!==o&&(i.suppressHydrationWarning!==!0&&Kf(n.textContent,o,s),r=["children",o]):typeof o=="number"&&n.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&Kf(n.textContent,o,s),r=["children",""+o]):Du.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&vt("scroll",n)}switch(t){case"input":Bf(n),mv(n,i,!0);break;case"textarea":Bf(n),xv(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=um)}n=r,e.updateQueue=n,n!==null&&(e.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=Dw(t)),s==="http://www.w3.org/1999/xhtml"?t==="script"?(s=a.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof n.is=="string"?s=a.createElement(t,{is:n.is}):(s=a.createElement(t),t==="select"&&(a=s,n.multiple?a.multiple=!0:n.size&&(a.size=n.size))):s=a.createElementNS(s,t),s[oi]=e,s[Wu]=n,a2(s,e,!1,!1),e.stateNode=s;e:{switch(a=Og(t,n),t){case"dialog":vt("cancel",s),vt("close",s),r=n;break;case"iframe":case"object":case"embed":vt("load",s),r=n;break;case"video":case"audio":for(r=0;r<au.length;r++)vt(au[r],s);r=n;break;case"source":vt("error",s),r=n;break;case"img":case"image":case"link":vt("error",s),vt("load",s),r=n;break;case"details":vt("toggle",s),r=n;break;case"input":pv(s,n),r=Mg(s,n),vt("invalid",s);break;case"option":r=n;break;case"select":s._wrapperState={wasMultiple:!!n.multiple},r=It({},n,{value:void 0}),vt("invalid",s);break;case"textarea":gv(s,n),r=Lg(s,n),vt("invalid",s);break;default:r=n}Fg(t,r),o=r;for(i in o)if(o.hasOwnProperty(i)){var l=o[i];i==="style"?zw(s,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Fw(s,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Fu(s,l):typeof l=="number"&&Fu(s,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Du.hasOwnProperty(i)?l!=null&&i==="onScroll"&&vt("scroll",s):l!=null&&Qb(s,i,l,a))}switch(t){case"input":Bf(s),mv(s,n,!1);break;case"textarea":Bf(s),xv(s);break;case"option":n.value!=null&&s.setAttribute("value",""+so(n.value));break;case"select":s.multiple=!!n.multiple,i=n.value,i!=null?vc(s,!!n.multiple,i,!1):n.defaultValue!=null&&vc(s,!!n.multiple,n.defaultValue,!0);break;default:typeof r.onClick=="function"&&(s.onclick=um)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Cs(e),null;case 6:if(s&&e.stateNode!=null)l2(s,e,s.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(pe(166));if(t=So(Xu.current),So(ci.current),Yf(e)){if(n=e.stateNode,t=e.memoizedProps,n[oi]=e,(i=n.nodeValue!==t)&&(s=Fn,s!==null))switch(s.tag){case 3:Kf(n.nodeValue,t,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&Kf(n.nodeValue,t,(s.mode&1)!==0)}i&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[oi]=e,e.stateNode=n}return Cs(e),null;case 13:if(kt(Pt),n=e.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(Nt&&Dn!==null&&e.mode&1&&!(e.flags&128))Ek(),Ld(),e.flags|=98560,i=!1;else if(i=Yf(e),n!==null&&n.dehydrated!==null){if(s===null){if(!i)throw Error(pe(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(pe(317));i[oi]=e}else Ld(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Cs(e),i=!1}else Cr!==null&&(bx(Cr),Cr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(s!==null&&s.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(s===null||Pt.current&1?es===0&&(es=3):Ry())),e.updateQueue!==null&&(e.flags|=4),Cs(e),null);case 4:return Fd(),dx(s,e),s===null&&Gu(e.stateNode.containerInfo),Cs(e),null;case 10:return gy(e.type._context),Cs(e),null;case 17:return mn(e.type)&&hm(),Cs(e),null;case 19:if(kt(Pt),i=e.memoizedState,i===null)return Cs(e),null;if(n=(e.flags&128)!==0,a=i.rendering,a===null)if(n)Kd(i,!1);else{if(es!==0||s!==null&&s.flags&128)for(s=e.child;s!==null;){if(a=ym(s),a!==null){for(e.flags|=128,Kd(i,!1),n=a.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)i=t,s=n,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=s,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,s=a.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),t=t.sibling;return yt(Pt,Pt.current&1|2),e.child}s=s.sibling}i.tail!==null&&Bt()>zd&&(e.flags|=128,n=!0,Kd(i,!1),e.lanes=4194304)}else{if(!n)if(s=ym(a),s!==null){if(e.flags|=128,n=!0,t=s.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Kd(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!Nt)return Cs(e),null}else 2*Bt()-i.renderingStartTime>zd&&t!==1073741824&&(e.flags|=128,n=!0,Kd(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(t=i.last,t!==null?t.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Bt(),e.sibling=null,t=Pt.current,yt(Pt,n?t&1|2:t&1),e):(Cs(e),null);case 22:case 23:return My(),n=e.memoizedState!==null,s!==null&&s.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Rn&1073741824&&(Cs(e),e.subtreeFlags&6&&(e.flags|=8192)):Cs(e),null;case 24:return null;case 25:return null}throw Error(pe(156,e.tag))}function lN(s,e){switch(hy(e),e.tag){case 1:return mn(e.type)&&hm(),s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 3:return Fd(),kt(pn),kt(zs),wy(),s=e.flags,s&65536&&!(s&128)?(e.flags=s&-65537|128,e):null;case 5:return vy(e),null;case 13:if(kt(Pt),s=e.memoizedState,s!==null&&s.dehydrated!==null){if(e.alternate===null)throw Error(pe(340));Ld()}return s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 19:return kt(Pt),null;case 4:return Fd(),null;case 10:return gy(e.type._context),null;case 22:case 23:return My(),null;case 24:return null;default:return null}}var Jf=!1,Fs=!1,cN=typeof WeakSet=="function"?WeakSet:Set,Ae=null;function pc(s,e){var t=s.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){Dt(s,e,n)}else t.current=null}function ux(s,e,t){try{t()}catch(n){Dt(s,e,n)}}var a1=!1;function dN(s,e){if(Xg=lm,s=fk(),dy(s)){if("selectionStart"in s)var t={start:s.selectionStart,end:s.selectionEnd};else e:{t=(t=s.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var r=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,d=0,h=0,f=s,p=null;t:for(;;){for(var m;f!==t||r!==0&&f.nodeType!==3||(o=a+r),f!==i||n!==0&&f.nodeType!==3||(l=a+n),f.nodeType===3&&(a+=f.nodeValue.length),(m=f.firstChild)!==null;)p=f,f=m;for(;;){if(f===s)break t;if(p===t&&++d===r&&(o=a),p===i&&++h===n&&(l=a),(m=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=m}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Kg={focusedElem:s,selectionRange:t},lm=!1,Ae=e;Ae!==null;)if(e=Ae,s=e.child,(e.subtreeFlags&1028)!==0&&s!==null)s.return=e,Ae=s;else for(;Ae!==null;){e=Ae;try{var b=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(b!==null){var x=b.memoizedProps,v=b.memoizedState,g=e.stateNode,y=g.getSnapshotBeforeUpdate(e.elementType===e.type?x:hr(e.type,x),v);g.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(pe(163))}}catch(k){Dt(e,e.return,k)}if(s=e.sibling,s!==null){s.return=e.return,Ae=s;break}Ae=e.return}return b=a1,a1=!1,b}function ju(s,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var r=n=n.next;do{if((r.tag&s)===s){var i=r.destroy;r.destroy=void 0,i!==void 0&&ux(e,t,i)}r=r.next}while(r!==n)}}function g0(s,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&s)===s){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function hx(s){var e=s.ref;if(e!==null){var t=s.stateNode;switch(s.tag){case 5:s=t;break;default:s=t}typeof e=="function"?e(s):e.current=s}}function c2(s){var e=s.alternate;e!==null&&(s.alternate=null,c2(e)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(e=s.stateNode,e!==null&&(delete e[oi],delete e[Wu],delete e[Zg],delete e[WE],delete e[qE])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function d2(s){return s.tag===5||s.tag===3||s.tag===4}function o1(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||d2(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function fx(s,e,t){var n=s.tag;if(n===5||n===6)s=s.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(s,e):t.insertBefore(s,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(s,t)):(e=t,e.appendChild(s)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=um));else if(n!==4&&(s=s.child,s!==null))for(fx(s,e,t),s=s.sibling;s!==null;)fx(s,e,t),s=s.sibling}function px(s,e,t){var n=s.tag;if(n===5||n===6)s=s.stateNode,e?t.insertBefore(s,e):t.appendChild(s);else if(n!==4&&(s=s.child,s!==null))for(px(s,e,t),s=s.sibling;s!==null;)px(s,e,t),s=s.sibling}var vs=null,Er=!1;function la(s,e,t){for(t=t.child;t!==null;)u2(s,e,t),t=t.sibling}function u2(s,e,t){if(li&&typeof li.onCommitFiberUnmount=="function")try{li.onCommitFiberUnmount(l0,t)}catch{}switch(t.tag){case 5:Fs||pc(t,e);case 6:var n=vs,r=Er;vs=null,la(s,e,t),vs=n,Er=r,vs!==null&&(Er?(s=vs,t=t.stateNode,s.nodeType===8?s.parentNode.removeChild(t):s.removeChild(t)):vs.removeChild(t.stateNode));break;case 18:vs!==null&&(Er?(s=vs,t=t.stateNode,s.nodeType===8?Y0(s.parentNode,t):s.nodeType===1&&Y0(s,t),Bu(s)):Y0(vs,t.stateNode));break;case 4:n=vs,r=Er,vs=t.stateNode.containerInfo,Er=!0,la(s,e,t),vs=n,Er=r;break;case 0:case 11:case 14:case 15:if(!Fs&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){r=n=n.next;do{var i=r,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&ux(t,e,a),r=r.next}while(r!==n)}la(s,e,t);break;case 1:if(!Fs&&(pc(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(o){Dt(t,e,o)}la(s,e,t);break;case 21:la(s,e,t);break;case 22:t.mode&1?(Fs=(n=Fs)||t.memoizedState!==null,la(s,e,t),Fs=n):la(s,e,t);break;default:la(s,e,t)}}function l1(s){var e=s.updateQueue;if(e!==null){s.updateQueue=null;var t=s.stateNode;t===null&&(t=s.stateNode=new cN),e.forEach(function(n){var r=yN.bind(null,s,n);t.has(n)||(t.add(n),n.then(r,r))})}}function dr(s,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var r=t[n];try{var i=s,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:vs=o.stateNode,Er=!1;break e;case 3:vs=o.stateNode.containerInfo,Er=!0;break e;case 4:vs=o.stateNode.containerInfo,Er=!0;break e}o=o.return}if(vs===null)throw Error(pe(160));u2(i,a,r),vs=null,Er=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(d){Dt(r,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)h2(e,s),e=e.sibling}function h2(s,e){var t=s.alternate,n=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(dr(e,s),Or(s),n&4){try{ju(3,s,s.return),g0(3,s)}catch(x){Dt(s,s.return,x)}try{ju(5,s,s.return)}catch(x){Dt(s,s.return,x)}}break;case 1:dr(e,s),Or(s),n&512&&t!==null&&pc(t,t.return);break;case 5:if(dr(e,s),Or(s),n&512&&t!==null&&pc(t,t.return),s.flags&32){var r=s.stateNode;try{Fu(r,"")}catch(x){Dt(s,s.return,x)}}if(n&4&&(r=s.stateNode,r!=null)){var i=s.memoizedProps,a=t!==null?t.memoizedProps:i,o=s.type,l=s.updateQueue;if(s.updateQueue=null,l!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&Iw(r,i),Og(o,a);var d=Og(o,i);for(a=0;a<l.length;a+=2){var h=l[a],f=l[a+1];h==="style"?zw(r,f):h==="dangerouslySetInnerHTML"?Fw(r,f):h==="children"?Fu(r,f):Qb(r,h,f,d)}switch(o){case"input":Rg(r,i);break;case"textarea":Lw(r,i);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!i.multiple;var m=i.value;m!=null?vc(r,!!i.multiple,m,!1):p!==!!i.multiple&&(i.defaultValue!=null?vc(r,!!i.multiple,i.defaultValue,!0):vc(r,!!i.multiple,i.multiple?[]:"",!1))}r[Wu]=i}catch(x){Dt(s,s.return,x)}}break;case 6:if(dr(e,s),Or(s),n&4){if(s.stateNode===null)throw Error(pe(162));r=s.stateNode,i=s.memoizedProps;try{r.nodeValue=i}catch(x){Dt(s,s.return,x)}}break;case 3:if(dr(e,s),Or(s),n&4&&t!==null&&t.memoizedState.isDehydrated)try{Bu(e.containerInfo)}catch(x){Dt(s,s.return,x)}break;case 4:dr(e,s),Or(s);break;case 13:dr(e,s),Or(s),r=s.child,r.flags&8192&&(i=r.memoizedState!==null,r.stateNode.isHidden=i,!i||r.alternate!==null&&r.alternate.memoizedState!==null||(jy=Bt())),n&4&&l1(s);break;case 22:if(h=t!==null&&t.memoizedState!==null,s.mode&1?(Fs=(d=Fs)||h,dr(e,s),Fs=d):dr(e,s),Or(s),n&8192){if(d=s.memoizedState!==null,(s.stateNode.isHidden=d)&&!h&&s.mode&1)for(Ae=s,h=s.child;h!==null;){for(f=Ae=h;Ae!==null;){switch(p=Ae,m=p.child,p.tag){case 0:case 11:case 14:case 15:ju(4,p,p.return);break;case 1:pc(p,p.return);var b=p.stateNode;if(typeof b.componentWillUnmount=="function"){n=p,t=p.return;try{e=n,b.props=e.memoizedProps,b.state=e.memoizedState,b.componentWillUnmount()}catch(x){Dt(n,t,x)}}break;case 5:pc(p,p.return);break;case 22:if(p.memoizedState!==null){d1(f);continue}}m!==null?(m.return=p,Ae=m):d1(f)}h=h.sibling}e:for(h=null,f=s;;){if(f.tag===5){if(h===null){h=f;try{r=f.stateNode,d?(i=r.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=f.stateNode,l=f.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=Ow("display",a))}catch(x){Dt(s,s.return,x)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=d?"":f.memoizedProps}catch(x){Dt(s,s.return,x)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===s)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===s)break e;for(;f.sibling===null;){if(f.return===null||f.return===s)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:dr(e,s),Or(s),n&4&&l1(s);break;case 21:break;default:dr(e,s),Or(s)}}function Or(s){var e=s.flags;if(e&2){try{e:{for(var t=s.return;t!==null;){if(d2(t)){var n=t;break e}t=t.return}throw Error(pe(160))}switch(n.tag){case 5:var r=n.stateNode;n.flags&32&&(Fu(r,""),n.flags&=-33);var i=o1(s);px(s,i,r);break;case 3:case 4:var a=n.stateNode.containerInfo,o=o1(s);fx(s,o,a);break;default:throw Error(pe(161))}}catch(l){Dt(s,s.return,l)}s.flags&=-3}e&4096&&(s.flags&=-4097)}function uN(s,e,t){Ae=s,f2(s)}function f2(s,e,t){for(var n=(s.mode&1)!==0;Ae!==null;){var r=Ae,i=r.child;if(r.tag===22&&n){var a=r.memoizedState!==null||Jf;if(!a){var o=r.alternate,l=o!==null&&o.memoizedState!==null||Fs;o=Jf;var d=Fs;if(Jf=a,(Fs=l)&&!d)for(Ae=r;Ae!==null;)a=Ae,l=a.child,a.tag===22&&a.memoizedState!==null?u1(r):l!==null?(l.return=a,Ae=l):u1(r);for(;i!==null;)Ae=i,f2(i),i=i.sibling;Ae=r,Jf=o,Fs=d}c1(s)}else r.subtreeFlags&8772&&i!==null?(i.return=r,Ae=i):c1(s)}}function c1(s){for(;Ae!==null;){var e=Ae;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Fs||g0(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Fs)if(t===null)n.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:hr(e.type,t.memoizedProps);n.componentDidUpdate(r,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&qv(e,i,n);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}qv(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&Bu(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(pe(163))}Fs||e.flags&512&&hx(e)}catch(p){Dt(e,e.return,p)}}if(e===s){Ae=null;break}if(t=e.sibling,t!==null){t.return=e.return,Ae=t;break}Ae=e.return}}function d1(s){for(;Ae!==null;){var e=Ae;if(e===s){Ae=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Ae=t;break}Ae=e.return}}function u1(s){for(;Ae!==null;){var e=Ae;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{g0(4,e)}catch(l){Dt(e,t,l)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var r=e.return;try{n.componentDidMount()}catch(l){Dt(e,r,l)}}var i=e.return;try{hx(e)}catch(l){Dt(e,i,l)}break;case 5:var a=e.return;try{hx(e)}catch(l){Dt(e,a,l)}}}catch(l){Dt(e,e.return,l)}if(e===s){Ae=null;break}var o=e.sibling;if(o!==null){o.return=e.return,Ae=o;break}Ae=e.return}}var hN=Math.ceil,km=ia.ReactCurrentDispatcher,Cy=ia.ReactCurrentOwner,rr=ia.ReactCurrentBatchConfig,et=0,ds=null,Wt=null,ks=0,Rn=0,mc=lo(0),es=0,Zu=null,Il=0,x0=0,Ty=0,Pu=null,hn=null,jy=0,zd=1/0,bi=null,_m=!1,mx=null,Za=null,ep=!1,Wa=null,Sm=0,Mu=0,gx=null,wp=-1,kp=0;function Ys(){return et&6?Bt():wp!==-1?wp:wp=Bt()}function Ja(s){return s.mode&1?et&2&&ks!==0?ks&-ks:KE.transition!==null?(kp===0&&(kp=Qw()),kp):(s=ct,s!==0||(s=window.event,s=s===void 0?16:rk(s.type)),s):1}function Mr(s,e,t,n){if(50<Mu)throw Mu=0,gx=null,Error(pe(185));jf(s,t,n),(!(et&2)||s!==ds)&&(s===ds&&(!(et&2)&&(x0|=t),es===4&&fa(s,ks)),gn(s,n),t===1&&et===0&&!(e.mode&1)&&(zd=Bt()+500,f0&&co()))}function gn(s,e){var t=s.callbackNode;KA(s,e);var n=om(s,s===ds?ks:0);if(n===0)t!==null&&vv(t),s.callbackNode=null,s.callbackPriority=0;else if(e=n&-n,s.callbackPriority!==e){if(t!=null&&vv(t),e===1)s.tag===0?XE(h1.bind(null,s)):_k(h1.bind(null,s)),GE(function(){!(et&6)&&co()}),t=null;else{switch(Zw(n)){case 1:t=sy;break;case 4:t=Kw;break;case 16:t=am;break;case 536870912:t=Yw;break;default:t=am}t=w2(t,p2.bind(null,s))}s.callbackPriority=e,s.callbackNode=t}}function p2(s,e){if(wp=-1,kp=0,et&6)throw Error(pe(327));var t=s.callbackNode;if(Ac()&&s.callbackNode!==t)return null;var n=om(s,s===ds?ks:0);if(n===0)return null;if(n&30||n&s.expiredLanes||e)e=Am(s,n);else{e=n;var r=et;et|=2;var i=g2();(ds!==s||ks!==e)&&(bi=null,zd=Bt()+500,Tl(s,e));do try{mN();break}catch(o){m2(s,o)}while(!0);my(),km.current=i,et=r,Wt!==null?e=0:(ds=null,ks=0,e=es)}if(e!==0){if(e===2&&(r=Hg(s),r!==0&&(n=r,e=xx(s,r))),e===1)throw t=Zu,Tl(s,0),fa(s,n),gn(s,Bt()),t;if(e===6)fa(s,n);else{if(r=s.current.alternate,!(n&30)&&!fN(r)&&(e=Am(s,n),e===2&&(i=Hg(s),i!==0&&(n=i,e=xx(s,i))),e===1))throw t=Zu,Tl(s,0),fa(s,n),gn(s,Bt()),t;switch(s.finishedWork=r,s.finishedLanes=n,e){case 0:case 1:throw Error(pe(345));case 2:go(s,hn,bi);break;case 3:if(fa(s,n),(n&130023424)===n&&(e=jy+500-Bt(),10<e)){if(om(s,0)!==0)break;if(r=s.suspendedLanes,(r&n)!==n){Ys(),s.pingedLanes|=s.suspendedLanes&r;break}s.timeoutHandle=Qg(go.bind(null,s,hn,bi),e);break}go(s,hn,bi);break;case 4:if(fa(s,n),(n&4194240)===n)break;for(e=s.eventTimes,r=-1;0<n;){var a=31-Pr(n);i=1<<a,a=e[a],a>r&&(r=a),n&=~i}if(n=r,n=Bt()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*hN(n/1960))-n,10<n){s.timeoutHandle=Qg(go.bind(null,s,hn,bi),n);break}go(s,hn,bi);break;case 5:go(s,hn,bi);break;default:throw Error(pe(329))}}}return gn(s,Bt()),s.callbackNode===t?p2.bind(null,s):null}function xx(s,e){var t=Pu;return s.current.memoizedState.isDehydrated&&(Tl(s,e).flags|=256),s=Am(s,e),s!==2&&(e=hn,hn=t,e!==null&&bx(e)),s}function bx(s){hn===null?hn=s:hn.push.apply(hn,s)}function fN(s){for(var e=s;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var r=t[n],i=r.getSnapshot;r=r.value;try{if(!Rr(i(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function fa(s,e){for(e&=~Ty,e&=~x0,s.suspendedLanes|=e,s.pingedLanes&=~e,s=s.expirationTimes;0<e;){var t=31-Pr(e),n=1<<t;s[t]=-1,e&=~n}}function h1(s){if(et&6)throw Error(pe(327));Ac();var e=om(s,0);if(!(e&1))return gn(s,Bt()),null;var t=Am(s,e);if(s.tag!==0&&t===2){var n=Hg(s);n!==0&&(e=n,t=xx(s,n))}if(t===1)throw t=Zu,Tl(s,0),fa(s,e),gn(s,Bt()),t;if(t===6)throw Error(pe(345));return s.finishedWork=s.current.alternate,s.finishedLanes=e,go(s,hn,bi),gn(s,Bt()),null}function Py(s,e){var t=et;et|=1;try{return s(e)}finally{et=t,et===0&&(zd=Bt()+500,f0&&co())}}function Ll(s){Wa!==null&&Wa.tag===0&&!(et&6)&&Ac();var e=et;et|=1;var t=rr.transition,n=ct;try{if(rr.transition=null,ct=1,s)return s()}finally{ct=n,rr.transition=t,et=e,!(et&6)&&co()}}function My(){Rn=mc.current,kt(mc)}function Tl(s,e){s.finishedWork=null,s.finishedLanes=0;var t=s.timeoutHandle;if(t!==-1&&(s.timeoutHandle=-1,HE(t)),Wt!==null)for(t=Wt.return;t!==null;){var n=t;switch(hy(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&hm();break;case 3:Fd(),kt(pn),kt(zs),wy();break;case 5:vy(n);break;case 4:Fd();break;case 13:kt(Pt);break;case 19:kt(Pt);break;case 10:gy(n.type._context);break;case 22:case 23:My()}t=t.return}if(ds=s,Wt=s=eo(s.current,null),ks=Rn=e,es=0,Zu=null,Ty=x0=Il=0,hn=Pu=null,_o!==null){for(e=0;e<_o.length;e++)if(t=_o[e],n=t.interleaved,n!==null){t.interleaved=null;var r=n.next,i=t.pending;if(i!==null){var a=i.next;i.next=r,n.next=a}t.pending=n}_o=null}return s}function m2(s,e){do{var t=Wt;try{if(my(),bp.current=wm,vm){for(var n=Rt.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}vm=!1}if(Rl=0,cs=Jt=Rt=null,Tu=!1,Ku=0,Cy.current=null,t===null||t.return===null){es=1,Zu=e,Wt=null;break}e:{var i=s,a=t.return,o=t,l=e;if(e=ks,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var d=l,h=o,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var m=Jv(a);if(m!==null){m.flags&=-257,e1(m,a,o,i,e),m.mode&1&&Zv(i,d,e),e=m,l=d;var b=e.updateQueue;if(b===null){var x=new Set;x.add(l),e.updateQueue=x}else b.add(l);break e}else{if(!(e&1)){Zv(i,d,e),Ry();break e}l=Error(pe(426))}}else if(Nt&&o.mode&1){var v=Jv(a);if(v!==null){!(v.flags&65536)&&(v.flags|=256),e1(v,a,o,i,e),fy(Od(l,o));break e}}i=l=Od(l,o),es!==4&&(es=2),Pu===null?Pu=[i]:Pu.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var g=Zk(i,l,e);Wv(i,g);break e;case 1:o=l;var y=i.type,w=i.stateNode;if(!(i.flags&128)&&(typeof y.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Za===null||!Za.has(w)))){i.flags|=65536,e&=-e,i.lanes|=e;var k=Jk(i,o,e);Wv(i,k);break e}}i=i.return}while(i!==null)}b2(t)}catch(C){e=C,Wt===t&&t!==null&&(Wt=t=t.return);continue}break}while(!0)}function g2(){var s=km.current;return km.current=wm,s===null?wm:s}function Ry(){(es===0||es===3||es===2)&&(es=4),ds===null||!(Il&268435455)&&!(x0&268435455)||fa(ds,ks)}function Am(s,e){var t=et;et|=2;var n=g2();(ds!==s||ks!==e)&&(bi=null,Tl(s,e));do try{pN();break}catch(r){m2(s,r)}while(!0);if(my(),et=t,km.current=n,Wt!==null)throw Error(pe(261));return ds=null,ks=0,es}function pN(){for(;Wt!==null;)x2(Wt)}function mN(){for(;Wt!==null&&!$A();)x2(Wt)}function x2(s){var e=v2(s.alternate,s,Rn);s.memoizedProps=s.pendingProps,e===null?b2(s):Wt=e,Cy.current=null}function b2(s){var e=s;do{var t=e.alternate;if(s=e.return,e.flags&32768){if(t=lN(t,e),t!==null){t.flags&=32767,Wt=t;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{es=6,Wt=null;return}}else if(t=oN(t,e,Rn),t!==null){Wt=t;return}if(e=e.sibling,e!==null){Wt=e;return}Wt=e=s}while(e!==null);es===0&&(es=5)}function go(s,e,t){var n=ct,r=rr.transition;try{rr.transition=null,ct=1,gN(s,e,t,n)}finally{rr.transition=r,ct=n}return null}function gN(s,e,t,n){do Ac();while(Wa!==null);if(et&6)throw Error(pe(327));t=s.finishedWork;var r=s.finishedLanes;if(t===null)return null;if(s.finishedWork=null,s.finishedLanes=0,t===s.current)throw Error(pe(177));s.callbackNode=null,s.callbackPriority=0;var i=t.lanes|t.childLanes;if(YA(s,i),s===ds&&(Wt=ds=null,ks=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||ep||(ep=!0,w2(am,function(){return Ac(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=rr.transition,rr.transition=null;var a=ct;ct=1;var o=et;et|=4,Cy.current=null,dN(s,t),h2(t,s),DE(Kg),lm=!!Xg,Kg=Xg=null,s.current=t,uN(t),BA(),et=o,ct=a,rr.transition=i}else s.current=t;if(ep&&(ep=!1,Wa=s,Sm=r),i=s.pendingLanes,i===0&&(Za=null),GA(t.stateNode),gn(s,Bt()),e!==null)for(n=s.onRecoverableError,t=0;t<e.length;t++)r=e[t],n(r.value,{componentStack:r.stack,digest:r.digest});if(_m)throw _m=!1,s=mx,mx=null,s;return Sm&1&&s.tag!==0&&Ac(),i=s.pendingLanes,i&1?s===gx?Mu++:(Mu=0,gx=s):Mu=0,co(),null}function Ac(){if(Wa!==null){var s=Zw(Sm),e=rr.transition,t=ct;try{if(rr.transition=null,ct=16>s?16:s,Wa===null)var n=!1;else{if(s=Wa,Wa=null,Sm=0,et&6)throw Error(pe(331));var r=et;for(et|=4,Ae=s.current;Ae!==null;){var i=Ae,a=i.child;if(Ae.flags&16){var o=i.deletions;if(o!==null){for(var l=0;l<o.length;l++){var d=o[l];for(Ae=d;Ae!==null;){var h=Ae;switch(h.tag){case 0:case 11:case 15:ju(8,h,i)}var f=h.child;if(f!==null)f.return=h,Ae=f;else for(;Ae!==null;){h=Ae;var p=h.sibling,m=h.return;if(c2(h),h===d){Ae=null;break}if(p!==null){p.return=m,Ae=p;break}Ae=m}}}var b=i.alternate;if(b!==null){var x=b.child;if(x!==null){b.child=null;do{var v=x.sibling;x.sibling=null,x=v}while(x!==null)}}Ae=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,Ae=a;else e:for(;Ae!==null;){if(i=Ae,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ju(9,i,i.return)}var g=i.sibling;if(g!==null){g.return=i.return,Ae=g;break e}Ae=i.return}}var y=s.current;for(Ae=y;Ae!==null;){a=Ae;var w=a.child;if(a.subtreeFlags&2064&&w!==null)w.return=a,Ae=w;else e:for(a=y;Ae!==null;){if(o=Ae,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:g0(9,o)}}catch(C){Dt(o,o.return,C)}if(o===a){Ae=null;break e}var k=o.sibling;if(k!==null){k.return=o.return,Ae=k;break e}Ae=o.return}}if(et=r,co(),li&&typeof li.onPostCommitFiberRoot=="function")try{li.onPostCommitFiberRoot(l0,s)}catch{}n=!0}return n}finally{ct=t,rr.transition=e}}return!1}function f1(s,e,t){e=Od(t,e),e=Zk(s,e,1),s=Qa(s,e,1),e=Ys(),s!==null&&(jf(s,1,e),gn(s,e))}function Dt(s,e,t){if(s.tag===3)f1(s,s,t);else for(;e!==null;){if(e.tag===3){f1(e,s,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Za===null||!Za.has(n))){s=Od(t,s),s=Jk(e,s,1),e=Qa(e,s,1),s=Ys(),e!==null&&(jf(e,1,s),gn(e,s));break}}e=e.return}}function xN(s,e,t){var n=s.pingCache;n!==null&&n.delete(e),e=Ys(),s.pingedLanes|=s.suspendedLanes&t,ds===s&&(ks&t)===t&&(es===4||es===3&&(ks&130023424)===ks&&500>Bt()-jy?Tl(s,0):Ty|=t),gn(s,e)}function y2(s,e){e===0&&(s.mode&1?(e=Gf,Gf<<=1,!(Gf&130023424)&&(Gf=4194304)):e=1);var t=Ys();s=ta(s,e),s!==null&&(jf(s,e,t),gn(s,t))}function bN(s){var e=s.memoizedState,t=0;e!==null&&(t=e.retryLane),y2(s,t)}function yN(s,e){var t=0;switch(s.tag){case 13:var n=s.stateNode,r=s.memoizedState;r!==null&&(t=r.retryLane);break;case 19:n=s.stateNode;break;default:throw Error(pe(314))}n!==null&&n.delete(e),y2(s,t)}var v2;v2=function(s,e,t){if(s!==null)if(s.memoizedProps!==e.pendingProps||pn.current)fn=!0;else{if(!(s.lanes&t)&&!(e.flags&128))return fn=!1,aN(s,e,t);fn=!!(s.flags&131072)}else fn=!1,Nt&&e.flags&1048576&&Sk(e,mm,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;vp(s,e),s=e.pendingProps;var r=Id(e,zs.current);Sc(e,t),r=_y(null,e,n,s,r,t);var i=Sy();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,mn(n)?(i=!0,fm(e)):i=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,by(e),r.updater=m0,e.stateNode=r,r._reactInternals=e,rx(e,n,s,t),e=ox(null,e,n,!0,i,t)):(e.tag=0,Nt&&i&&uy(e),Ks(null,e,r,t),e=e.child),e;case 16:n=e.elementType;e:{switch(vp(s,e),s=e.pendingProps,r=n._init,n=r(n._payload),e.type=n,r=e.tag=wN(n),s=hr(n,s),r){case 0:e=ax(null,e,n,s,t);break e;case 1:e=n1(null,e,n,s,t);break e;case 11:e=t1(null,e,n,s,t);break e;case 14:e=s1(null,e,n,hr(n.type,s),t);break e}throw Error(pe(306,n,""))}return e;case 0:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:hr(n,r),ax(s,e,n,r,t);case 1:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:hr(n,r),n1(s,e,n,r,t);case 3:e:{if(n2(e),s===null)throw Error(pe(387));n=e.pendingProps,i=e.memoizedState,r=i.element,jk(s,e),bm(e,n,null,t);var a=e.memoizedState;if(n=a.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){r=Od(Error(pe(423)),e),e=r1(s,e,n,t,r);break e}else if(n!==r){r=Od(Error(pe(424)),e),e=r1(s,e,n,t,r);break e}else for(Dn=Ya(e.stateNode.containerInfo.firstChild),Fn=e,Nt=!0,Cr=null,t=Ck(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Ld(),n===r){e=sa(s,e,t);break e}Ks(s,e,n,t)}e=e.child}return e;case 5:return Pk(e),s===null&&tx(e),n=e.type,r=e.pendingProps,i=s!==null?s.memoizedProps:null,a=r.children,Yg(n,r)?a=null:i!==null&&Yg(n,i)&&(e.flags|=32),s2(s,e),Ks(s,e,a,t),e.child;case 6:return s===null&&tx(e),null;case 13:return r2(s,e,t);case 4:return yy(e,e.stateNode.containerInfo),n=e.pendingProps,s===null?e.child=Dd(e,null,n,t):Ks(s,e,n,t),e.child;case 11:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:hr(n,r),t1(s,e,n,r,t);case 7:return Ks(s,e,e.pendingProps,t),e.child;case 8:return Ks(s,e,e.pendingProps.children,t),e.child;case 12:return Ks(s,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,r=e.pendingProps,i=e.memoizedProps,a=r.value,yt(gm,n._currentValue),n._currentValue=a,i!==null)if(Rr(i.value,a)){if(i.children===r.children&&!pn.current){e=sa(s,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var o=i.dependencies;if(o!==null){a=i.child;for(var l=o.firstContext;l!==null;){if(l.context===n){if(i.tag===1){l=Yi(-1,t&-t),l.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?l.next=l:(l.next=h.next,h.next=l),d.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),sx(i.return,t,e),o.lanes|=t;break}l=l.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(pe(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),sx(a,t,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}Ks(s,e,r.children,t),e=e.child}return e;case 9:return r=e.type,n=e.pendingProps.children,Sc(e,t),r=ar(r),n=n(r),e.flags|=1,Ks(s,e,n,t),e.child;case 14:return n=e.type,r=hr(n,e.pendingProps),r=hr(n.type,r),s1(s,e,n,r,t);case 15:return e2(s,e,e.type,e.pendingProps,t);case 17:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:hr(n,r),vp(s,e),e.tag=1,mn(n)?(s=!0,fm(e)):s=!1,Sc(e,t),Qk(e,n,r),rx(e,n,r,t),ox(null,e,n,!0,s,t);case 19:return i2(s,e,t);case 22:return t2(s,e,t)}throw Error(pe(156,e.tag))};function w2(s,e){return Xw(s,e)}function vN(s,e,t,n){this.tag=s,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function nr(s,e,t,n){return new vN(s,e,t,n)}function Iy(s){return s=s.prototype,!(!s||!s.isReactComponent)}function wN(s){if(typeof s=="function")return Iy(s)?1:0;if(s!=null){if(s=s.$$typeof,s===Jb)return 11;if(s===ey)return 14}return 2}function eo(s,e){var t=s.alternate;return t===null?(t=nr(s.tag,e,s.key,s.mode),t.elementType=s.elementType,t.type=s.type,t.stateNode=s.stateNode,t.alternate=s,s.alternate=t):(t.pendingProps=e,t.type=s.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=s.flags&14680064,t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,e=s.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=s.sibling,t.index=s.index,t.ref=s.ref,t}function _p(s,e,t,n,r,i){var a=2;if(n=s,typeof s=="function")Iy(s)&&(a=1);else if(typeof s=="string")a=5;else e:switch(s){case ic:return jl(t.children,r,i,e);case Zb:a=8,r|=8;break;case Cg:return s=nr(12,t,e,r|2),s.elementType=Cg,s.lanes=i,s;case Tg:return s=nr(13,t,e,r),s.elementType=Tg,s.lanes=i,s;case jg:return s=nr(19,t,e,r),s.elementType=jg,s.lanes=i,s;case Pw:return b0(t,r,i,e);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case Tw:a=10;break e;case jw:a=9;break e;case Jb:a=11;break e;case ey:a=14;break e;case da:a=16,n=null;break e}throw Error(pe(130,s==null?s:typeof s,""))}return e=nr(a,t,e,r),e.elementType=s,e.type=n,e.lanes=i,e}function jl(s,e,t,n){return s=nr(7,s,n,e),s.lanes=t,s}function b0(s,e,t,n){return s=nr(22,s,n,e),s.elementType=Pw,s.lanes=t,s.stateNode={isHidden:!1},s}function rg(s,e,t){return s=nr(6,s,null,e),s.lanes=t,s}function ig(s,e,t){return e=nr(4,s.children!==null?s.children:[],s.key,e),e.lanes=t,e.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},e}function kN(s,e,t,n,r){this.tag=e,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=z0(0),this.expirationTimes=z0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=z0(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Ly(s,e,t,n,r,i,a,o,l){return s=new kN(s,e,t,o,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=nr(3,null,null,e),s.current=i,i.stateNode=s,i.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},by(i),s}function _N(s,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:rc,key:n==null?null:""+n,children:s,containerInfo:e,implementation:t}}function k2(s){if(!s)return no;s=s._reactInternals;e:{if(Bl(s)!==s||s.tag!==1)throw Error(pe(170));var e=s;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(mn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(pe(171))}if(s.tag===1){var t=s.type;if(mn(t))return kk(s,t,e)}return e}function _2(s,e,t,n,r,i,a,o,l){return s=Ly(t,n,!0,s,r,i,a,o,l),s.context=k2(null),t=s.current,n=Ys(),r=Ja(t),i=Yi(n,r),i.callback=e??null,Qa(t,i,r),s.current.lanes=r,jf(s,r,n),gn(s,n),s}function y0(s,e,t,n){var r=e.current,i=Ys(),a=Ja(r);return t=k2(t),e.context===null?e.context=t:e.pendingContext=t,e=Yi(i,a),e.payload={element:s},n=n===void 0?null:n,n!==null&&(e.callback=n),s=Qa(r,e,a),s!==null&&(Mr(s,r,a,i),xp(s,r,a)),a}function Em(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function p1(s,e){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var t=s.retryLane;s.retryLane=t!==0&&t<e?t:e}}function Dy(s,e){p1(s,e),(s=s.alternate)&&p1(s,e)}function SN(){return null}var S2=typeof reportError=="function"?reportError:function(s){console.error(s)};function Fy(s){this._internalRoot=s}v0.prototype.render=Fy.prototype.render=function(s){var e=this._internalRoot;if(e===null)throw Error(pe(409));y0(s,e,null,null)};v0.prototype.unmount=Fy.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var e=s.containerInfo;Ll(function(){y0(null,s,null,null)}),e[ea]=null}};function v0(s){this._internalRoot=s}v0.prototype.unstable_scheduleHydration=function(s){if(s){var e=tk();s={blockedOn:null,target:s,priority:e};for(var t=0;t<ha.length&&e!==0&&e<ha[t].priority;t++);ha.splice(t,0,s),t===0&&nk(s)}};function Oy(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function w0(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function m1(){}function AN(s,e,t,n,r){if(r){if(typeof n=="function"){var i=n;n=function(){var d=Em(a);i.call(d)}}var a=_2(e,n,s,0,null,!1,!1,"",m1);return s._reactRootContainer=a,s[ea]=a.current,Gu(s.nodeType===8?s.parentNode:s),Ll(),a}for(;r=s.lastChild;)s.removeChild(r);if(typeof n=="function"){var o=n;n=function(){var d=Em(l);o.call(d)}}var l=Ly(s,0,!1,null,null,!1,!1,"",m1);return s._reactRootContainer=l,s[ea]=l.current,Gu(s.nodeType===8?s.parentNode:s),Ll(function(){y0(e,l,t,n)}),l}function k0(s,e,t,n,r){var i=t._reactRootContainer;if(i){var a=i;if(typeof r=="function"){var o=r;r=function(){var l=Em(a);o.call(l)}}y0(e,a,s,r)}else a=AN(t,e,s,r,n);return Em(a)}Jw=function(s){switch(s.tag){case 3:var e=s.stateNode;if(e.current.memoizedState.isDehydrated){var t=iu(e.pendingLanes);t!==0&&(ny(e,t|1),gn(e,Bt()),!(et&6)&&(zd=Bt()+500,co()))}break;case 13:Ll(function(){var n=ta(s,1);if(n!==null){var r=Ys();Mr(n,s,1,r)}}),Dy(s,1)}};ry=function(s){if(s.tag===13){var e=ta(s,134217728);if(e!==null){var t=Ys();Mr(e,s,134217728,t)}Dy(s,134217728)}};ek=function(s){if(s.tag===13){var e=Ja(s),t=ta(s,e);if(t!==null){var n=Ys();Mr(t,s,e,n)}Dy(s,e)}};tk=function(){return ct};sk=function(s,e){var t=ct;try{return ct=s,e()}finally{ct=t}};$g=function(s,e,t){switch(e){case"input":if(Rg(s,t),e=t.name,t.type==="radio"&&e!=null){for(t=s;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==s&&n.form===s.form){var r=h0(n);if(!r)throw Error(pe(90));Rw(n),Rg(n,r)}}}break;case"textarea":Lw(s,t);break;case"select":e=t.value,e!=null&&vc(s,!!t.multiple,e,!1)}};Uw=Py;Hw=Ll;var EN={usingClientEntryPoint:!1,Events:[Mf,cc,h0,$w,Bw,Py]},Yd={findFiberByHostInstance:ko,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},NN={bundleType:Yd.bundleType,version:Yd.version,rendererPackageName:Yd.rendererPackageName,rendererConfig:Yd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ia.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=Ww(s),s===null?null:s.stateNode},findFiberByHostInstance:Yd.findFiberByHostInstance||SN,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var tp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tp.isDisabled&&tp.supportsFiber)try{l0=tp.inject(NN),li=tp}catch{}}$n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=EN;$n.createPortal=function(s,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Oy(e))throw Error(pe(200));return _N(s,e,null,t)};$n.createRoot=function(s,e){if(!Oy(s))throw Error(pe(299));var t=!1,n="",r=S2;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Ly(s,1,!1,null,null,t,!1,n,r),s[ea]=e.current,Gu(s.nodeType===8?s.parentNode:s),new Fy(e)};$n.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var e=s._reactInternals;if(e===void 0)throw typeof s.render=="function"?Error(pe(188)):(s=Object.keys(s).join(","),Error(pe(268,s)));return s=Ww(e),s=s===null?null:s.stateNode,s};$n.flushSync=function(s){return Ll(s)};$n.hydrate=function(s,e,t){if(!w0(e))throw Error(pe(200));return k0(null,s,e,!0,t)};$n.hydrateRoot=function(s,e,t){if(!Oy(s))throw Error(pe(405));var n=t!=null&&t.hydratedSources||null,r=!1,i="",a=S2;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=_2(e,null,s,1,t??null,r,!1,i,a),s[ea]=e.current,Gu(s),n)for(s=0;s<n.length;s++)t=n[s],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new v0(e)};$n.render=function(s,e,t){if(!w0(e))throw Error(pe(200));return k0(null,s,e,!1,t)};$n.unmountComponentAtNode=function(s){if(!w0(s))throw Error(pe(40));return s._reactRootContainer?(Ll(function(){k0(null,null,s,!1,function(){s._reactRootContainer=null,s[ea]=null})}),!0):!1};$n.unstable_batchedUpdates=Py;$n.unstable_renderSubtreeIntoContainer=function(s,e,t,n){if(!w0(t))throw Error(pe(200));if(s==null||s._reactInternals===void 0)throw Error(pe(38));return k0(s,e,t,!1,n)};$n.version="18.3.1-next-f1338f8080-20240426";function A2(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(A2)}catch(s){console.error(s)}}A2(),Aw.exports=$n;var CN=Aw.exports,E2,g1=CN;E2=g1.createRoot,g1.hydrateRoot;/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var TN={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jN=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Te=(s,e)=>{const t=z.forwardRef(({color:n="currentColor",size:r=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:o="",children:l,...d},h)=>z.createElement("svg",{ref:h,...TN,width:r,height:r,stroke:n,strokeWidth:a?Number(i)*24/Number(r):i,className:["lucide",`lucide-${jN(s)}`,o].join(" "),...d},[...e.map(([f,p])=>z.createElement(f,p)),...Array.isArray(l)?l:[l]]));return t.displayName=`${s}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ru=Te("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PN=Te("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N2=Te("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x1=Te("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MN=Te("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RN=Te("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yx=Te("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IN=Te("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ag=Te("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LN=Te("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DN=Te("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FN=Te("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ON=Te("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b1=Te("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zN=Te("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $N=Te("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nm=Te("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BN=Te("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zy=Te("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vx=Te("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UN=Te("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HN=Te("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GN=Te("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VN=Te("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WN=Te("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $y=Te("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qN=Te("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y1=Te("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XN=Te("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KN=Te("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YN=Te("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C2=Te("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const og=Te("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QN=Te("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZN=Te("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JN=Te("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ju=Te("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cm=Te("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v1=Te("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eC=Te("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tC=Te("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sC=Te("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nC=Te("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T2=Te("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lg=Te("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const By=Te("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rC=Te("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tm=Te("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iC=Te("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jm=Te("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aC=Te("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j2=Te("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oC=Te("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lC=Te("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cC=Te("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wx=Te("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _0=Te("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Qd={status:"error",cpuPercent:null,cpuProcessPercent:null,ramPercent:null,ramUsedGb:null,ramTotalGb:null,modelsDirGb:null,gpuPercent:null,gpuMemoryUsedGb:null,gpuMemoryTotalGb:null,gpuName:null,gpuBackend:"cpu",message:void 0,timestamp:null,latencyMs:null},Uy=s=>typeof s=="object"&&s!==null,P2=(s,e)=>{if(!s||typeof s!="string")throw new Error("Не указан URL локального сервера");const t=s.trim();if(!t)throw new Error("Не указан URL локального сервера");let n;try{n=new URL(t)}catch(o){throw new Error(`Некорректный URL сервера: ${String(o)}`)}const a=`${n.pathname.replace(/\/+$/,"").replace(/\/chat\/completions$/i,"").replace(/\/v1$/i,"")}/${e}`.split("/").filter(Boolean);return n.pathname=`/${a.join("/")}`,n.search="",n.hash="",n.toString()},dC=s=>P2(s,"system/status"),fi=s=>typeof s=="number"&&!Number.isNaN(s)?s:null,uC=s=>{if(typeof s!="number"||Number.isNaN(s))return null;const e=s<1e12?s*1e3:s;return Number.isFinite(e)&&e>0?e:null},hC=(s,e)=>{var v,g,y,w,k,C,P,N,I;const t=uC(s.timestamp)??Date.now(),n=fi((v=s.cpu)==null?void 0:v.percent),r=fi((g=s.cpu)==null?void 0:g.process_percent),i=fi((y=s.memory)==null?void 0:y.percent),a=fi((w=s.memory)==null?void 0:w.used_gb),o=fi((k=s.memory)==null?void 0:k.total_gb),l=fi((C=s.memory)==null?void 0:C.models_dir_gb),d=Array.isArray((P=s.gpu)==null?void 0:P.devices)?s.gpu.devices[0]:void 0,h=fi((d==null?void 0:d.utilization_percent)??(d==null?void 0:d.memory_percent)),f=fi(d==null?void 0:d.memory_used_gb),p=fi(d==null?void 0:d.memory_total_gb),m=typeof(d==null?void 0:d.name)=="string"?d==null?void 0:d.name:null,b=typeof((N=s.gpu)==null?void 0:N.backend)=="string"?(I=s.gpu)==null?void 0:I.backend.toLowerCase():"";return{status:"ok",cpuPercent:n,cpuProcessPercent:r,ramPercent:i,ramUsedGb:a,ramTotalGb:o,modelsDirGb:l,gpuPercent:h,gpuMemoryUsedGb:f,gpuMemoryTotalGb:p,gpuName:m,gpuBackend:b==="cuda"?"cuda":b==="mps"?"mps":"cpu",timestamp:t,latencyMs:e}};async function M2(s){let e;try{e=dC(s)}catch(o){return{...Qd,message:o instanceof Error?o.message:String(o),latencyMs:null}}let t;const n=()=>typeof performance<"u"?performance.now():Date.now();let r=null;try{const o=n();t=await fetch(e,{method:"GET",cache:"no-store"}),r=Math.max(0,n()-o)}catch(o){return{...Qd,message:o instanceof Error?o.message:"Не удалось получить системные метрики",latencyMs:r}}let i;try{i=await t.json()}catch(o){return console.warn("Не удалось преобразовать ответ сервера системного статуса в JSON",o),{...Qd,message:"Некорректный формат ответа сервера системного статуса",latencyMs:r}}if(!Uy(i))return{...Qd,message:"Некорректный ответ сервера системного статуса",latencyMs:r};const a=typeof i.status=="string"?i.status:"";if(!t.ok||a&&a.toLowerCase()!=="ok"){const o=typeof i.message=="string"?i.message:"Сервер вернул ошибку";return{...Qd,message:o,latencyMs:r}}return hC(i,r)}const w1=(s,e)=>{if(!s)return e;if(typeof s=="string")return s;if(Uy(s)){const t=s.detail;if(typeof t=="string"&&t.trim())return t;const n=s.message;if(typeof n=="string"&&n.trim())return n;const r=s.error;if(typeof r=="string"&&r.trim())return r}try{return JSON.stringify(s)}catch(t){return console.warn("Не удалось преобразовать сообщение об ошибке в строку",t),e}};async function fC(s){const e=P2(s,"system/open-models-directory");let t;try{t=await fetch(e,{method:"POST",cache:"no-store"})}catch{throw new Error("Не удалось обратиться к локальному серверу базовой модели")}let n=null;try{n=await t.json()}catch{if(t.ok)return}if(!t.ok){const r=w1(n,"Не удалось открыть каталог моделей");throw new Error(r)}if(Uy(n)){const r=n.status;if(typeof r=="string"&&r.toLowerCase()!=="ok"){const i=w1(n,"Не удалось открыть каталог моделей");throw new Error(i)}}}const Zd="llm-studio-device-detected",cg={baseModelPath:"models/gemma",baseModelServerUrl:"http://127.0.0.1:8001",fineTunedModelPath:"",fineTunedBaseModelPath:"",fineTunedMethod:"",remoteApiUrl:"http://127.0.0.1:1234/v1",remoteApiKey:"",remoteModelId:"google/gemma-3n-e4b",quantization:"none",maxTokens:2048,temperature:.7,topP:.9,deviceType:"cpu",theme:"dark",autoSave:!0,maxHistoryItems:200},R2=z.createContext(void 0);function pC({children:s}){const[e,t]=z.useState(cg);z.useEffect(()=>{const i=localStorage.getItem("llm-studio-settings");if(i)try{const a=JSON.parse(i);t({...cg,...a});return}catch(a){console.error("Failed to parse saved settings:",a)}if(typeof window<"u"&&typeof window.matchMedia=="function"){const a=window.matchMedia("(prefers-color-scheme: dark)").matches;t(o=>{const l=a?"dark":"light";if(o.theme===l)return o;const d={...o,theme:l};return localStorage.setItem("llm-studio-settings",JSON.stringify(d)),d})}},[]);const n=i=>{const a={...e,...i};t(a),localStorage.setItem("llm-studio-settings",JSON.stringify(a)),Object.prototype.hasOwnProperty.call(i,"deviceType")&&localStorage.setItem(Zd,"manual")},r=()=>{t(cg),localStorage.removeItem("llm-studio-settings"),localStorage.removeItem(Zd)};return z.useEffect(()=>{if(localStorage.getItem(Zd))return;let a=!1;return(async()=>{try{const l=await M2(e.baseModelServerUrl);if(a||l.status!=="ok")return;l.gpuBackend==="cuda"||l.gpuBackend==="mps"?t(d=>{if(d.deviceType!=="cpu")return d;const h=l.gpuBackend,f={...d,deviceType:h};return localStorage.setItem("llm-studio-settings",JSON.stringify(f)),localStorage.setItem(Zd,l.gpuBackend),f}):localStorage.setItem(Zd,"cpu")}catch(l){console.error("Не удалось определить устройство выполнения:",l)}})(),()=>{a=!0}},[e.baseModelServerUrl]),u.jsx(R2.Provider,{value:{settings:e,updateSettings:n,resetSettings:r},children:s})}function aa(){const s=z.useContext(R2);if(s===void 0)throw new Error("useSettings must be used within a SettingsProvider");return s}const mC=s=>{if(!s||typeof s!="object"||typeof s.id!="string"||typeof s.timestamp!="number")return null;const e=s.status??"completed";return{...s,status:e,error:s.error??null}},I2=z.createContext(void 0);function gC({children:s}){const[e,t]=z.useState([]),[n,r]=z.useState([]),[i,a]=z.useState([]),[o,l]=z.useState([]),{settings:{maxHistoryItems:d}}=aa();z.useEffect(()=>{const v=localStorage.getItem("llm-studio-chat-history"),g=localStorage.getItem("llm-studio-training-history"),y=localStorage.getItem("llm-studio-processing-history"),w=localStorage.getItem("llm-studio-evaluation-history");if(v)try{const k=JSON.parse(v);t(k.slice(-d))}catch(k){console.error("Failed to parse chat history:",k)}if(g)try{const k=JSON.parse(g);r(k.slice(-d))}catch(k){console.error("Failed to parse training history:",k)}if(y)try{const k=JSON.parse(y);a(k.slice(-d))}catch(k){console.error("Failed to parse processing history:",k)}if(w)try{const C=JSON.parse(w).map(mC).filter(P=>P!==null);l(C.slice(-d))}catch(k){console.error("Failed to parse evaluation history:",k)}},[d]);const h=v=>{t(g=>{const y=[...g,v].slice(-d);return localStorage.setItem("llm-studio-chat-history",JSON.stringify(y)),y})},f=v=>{r(g=>{const y=[...g,v].slice(-d);return localStorage.setItem("llm-studio-training-history",JSON.stringify(y)),y})},p=v=>{a(g=>{const y=[...g,v].slice(-d);return localStorage.setItem("llm-studio-processing-history",JSON.stringify(y)),y})},m=v=>{l(g=>{const w=[...g.filter(k=>k.id!==v.id),v].sort((k,C)=>k.timestamp-C.timestamp).slice(-d);return localStorage.setItem("llm-studio-evaluation-history",JSON.stringify(w)),w})};z.useEffect(()=>{t(v=>{if(v.length<=d)return v;const g=v.slice(-d);return localStorage.setItem("llm-studio-chat-history",JSON.stringify(g)),g}),r(v=>{if(v.length<=d)return v;const g=v.slice(-d);return localStorage.setItem("llm-studio-training-history",JSON.stringify(g)),g}),a(v=>{if(v.length<=d)return v;const g=v.slice(-d);return localStorage.setItem("llm-studio-processing-history",JSON.stringify(g)),g}),l(v=>{if(v.length<=d)return v;const g=v.slice(-d);return localStorage.setItem("llm-studio-evaluation-history",JSON.stringify(g)),g})},[d]);const b=v=>{(v==="chat"||v==="all")&&(t([]),localStorage.removeItem("llm-studio-chat-history")),(v==="training"||v==="all")&&(r([]),localStorage.removeItem("llm-studio-training-history")),(v==="processing"||v==="all")&&(a([]),localStorage.removeItem("llm-studio-processing-history")),(v==="evaluation"||v==="all")&&(l([]),localStorage.removeItem("llm-studio-evaluation-history"))},x=(v,g)=>{if(v==="chat"){const P=e;if(g==="json")return JSON.stringify(P,null,2);const N=`# Chat History

`,I=P.map(M=>`## ${new Date(M.timestamp).toLocaleString()}
**${M.role}**: ${M.content}

`).join("");return`${N}${I}`}if(v==="training"){const P=n;if(g==="json")return JSON.stringify(P,null,2);const N=`# Training History

`,I=P.map(M=>{const L=new Date(M.timestamp).toLocaleString(),$=M.metrics?Object.entries(M.metrics).map(([E,D])=>`  - ${E}: ${D}`).join(`
`):"  - Метрики отсутствуют";return[`## ${L}`,`- Модель: ${M.modelName}`,`- Датасет: ${M.datasetSize} примеров`,`- Статус: ${M.status}`,"- Метрики:",$,""].join(`
`)}).join(`
`);return`${N}${I}`}if(v==="processing"){const P=i;if(g==="json")return JSON.stringify(P,null,2);const N=`# Processing History

`,I=P.map(M=>[`## ${new Date(M.timestamp).toLocaleString()}`,`- Файл: ${M.fileName}`,`- Сгенерированные QA-пары: ${M.qaGenerated}`,`- Статус: ${M.status}`,""].join(`
`)).join(`
`);return`${N}${I}`}const y=o;if(g==="json")return JSON.stringify(y,null,2);const w=`# Evaluation History

`,k={draft:"Черновик",queued:"В очереди",running:"Выполняется",waiting_review:"Ожидает проверки",completed:"Завершён",failed:"Ошибка"},C=y.map(P=>{const N=new Date(P.timestamp).toLocaleString(),I=k[P.status]??P.status,M=[`## ${N}`,`- Датасет: ${P.datasetName}`,`- Модель: ${P.modelVariant}`,`- Примеров: ${P.total}`,`- Оценено: ${P.scored}`,`- Итоговый скор: ${P.overallScore??"—"}`,`- Покрытие: ${(P.coverage*100).toFixed(1)}%`,`- Статус: ${I}`];if(typeof P.baselineScore=="number"&&M.push(`- Базовый скор: ${P.baselineScore}`),typeof P.scoreDelta=="number"){const L=P.scoreDelta>=0?`+${P.scoreDelta}`:String(P.scoreDelta);M.push(`- Δ к базе: ${L}`)}return P.error&&M.push(`- Ошибка: ${P.error}`),M.push(""),M.join(`
`)}).join(`
`);return`${w}${C}`};return u.jsx(I2.Provider,{value:{chatHistory:e,trainingHistory:n,processingHistory:i,evaluationHistory:o,addChatMessage:h,addTrainingSession:f,addProcessingJob:p,addEvaluationSession:m,clearHistory:b,exportHistory:x},children:s})}function Ul(){const s=z.useContext(I2);if(s===void 0)throw new Error("useHistory must be used within a HistoryProvider");return s}const k1=["training","evaluation","dataset","files","chat"],L2=z.createContext(void 0);function xC({children:s}){const[e,t]=z.useState({}),n=z.useCallback((l,d)=>{t(h=>({...h,[l]:{key:l,message:d.message,progress:d.progress,status:d.status??"running",startedAt:Date.now(),updatedAt:Date.now()}}))},[]),r=z.useCallback((l,d)=>{t(h=>{const f=h[l];return f?{...h,[l]:{...f,...d,updatedAt:Date.now()}}:h})},[]),i=z.useCallback(l=>{t(d=>({...d,[l]:null}))},[]),a=z.useMemo(()=>{for(const l of k1){const d=e[l];if(d&&d.status==="running")return d}for(const l of k1){const d=e[l];if(d)return d}return null},[e]),o=z.useMemo(()=>({activities:e,currentActivity:a,setActivity:n,updateActivity:r,clearActivity:i}),[e,a,n,r,i]);return u.jsx(L2.Provider,{value:o,children:s})}function If(){const s=z.useContext(L2);if(s===void 0)throw new Error("useStatus must be used within a StatusProvider");return s}class ai extends Error{constructor(e,t){super(e),this.name="RemoteChatError",this.details=t}}const kx=s=>typeof s=="object"&&s!==null,bC="google/gemma-3n-e4b",yC=s=>{const e=s.replace(/\/$/,"");return!/\/(chat\/)?completions$/i.test(e)},vC=s=>{if(!s)throw new ai("Не указан URL удалённого API");const e=s.trim();return yC(e)?`${e.replace(/\/$/,"")}/chat/completions`:e},D2=s=>{if(!s)return"Неизвестная ошибка удалённого API";if(typeof s=="string")return s;if(kx(s)&&"error"in s)return D2(s.error);if(kx(s)&&typeof s.message=="string")return s.message;try{return JSON.stringify(s)}catch(e){return console.warn("Не удалось сериализовать ответ ошибки удалённого API:",e),"Неизвестная ошибка удалённого API"}};async function S0(s,e){var o,l,d;const t=vC(e.apiUrl),n={"Content-Type":"application/json"};(o=e.apiKey)!=null&&o.trim()&&(n.Authorization=`Bearer ${e.apiKey.trim()}`);const r={model:e.model??bC,messages:s,max_tokens:e.maxTokens,temperature:e.temperature,top_p:e.topP};let i;try{i=await fetch(t,{method:"POST",headers:n,body:JSON.stringify(r),signal:e.signal})}catch(h){throw h instanceof DOMException&&h.name==="AbortError"?new ai("Запрос отменён пользователем",h):new ai("Не удалось обратиться к удалённому API",h)}let a=null;try{a=await i.json()}catch(h){throw new ai("Удалённый API вернул неверный JSON",h)}if(!i.ok)throw new ai(D2(a),a);if(kx(a)){const h=a;if(Array.isArray(h.choices)&&h.choices.length>0){const f=h.choices[0],p=((l=f==null?void 0:f.message)==null?void 0:l.content)??(f==null?void 0:f.text);if(typeof p!="string"||!p.trim())throw new ai("Удалённый API не вернул текст ответа",a);return{content:p.trim(),model:h.model??e.model??"remote",tokens:(d=h.usage)==null?void 0:d.total_tokens,raw:a}}if(typeof h.content=="string")return{content:h.content.trim(),model:h.model??e.model??"remote",tokens:h.tokens,raw:a}}throw new ai("Не удалось распознать формат ответа удалённого API",a)}class Zn extends Error{constructor(e,t){super(e),this.name="BaseChatError",this.details=t}}const F2=s=>typeof s=="object"&&s!==null,wC=s=>{if(!s)throw new Zn("Не указан URL сервера базовой модели");const e=s.trim().replace(/\/$/,"");return/\/chat\/completions$/i.test(e)?e:/\/v1$/i.test(e)?`${e}/chat/completions`:`${e}/v1/chat/completions`},Sp=s=>{if(!s)return"Неизвестная ошибка локального сервера";if(typeof s=="string")return s;if(Array.isArray(s)&&s.length>0)return Sp(s[0]);if(F2(s)){if("detail"in s)return Sp(s.detail);if("error"in s)return Sp(s.error);const e=s.message;if(typeof e=="string")return e}try{return JSON.stringify(s)}catch(e){return console.warn("Не удалось сериализовать ответ ошибки локального сервера:",e),"Неизвестная ошибка локального сервера"}};async function Pm(s,e){var a,o;const t=wC(e.serverUrl);if(!e.modelPath)throw new Zn("Не указан путь к базовой модели");const n={model_path:e.modelPath,adapter_path:e.adapterPath,messages:s,max_tokens:e.maxTokens,temperature:e.temperature,top_p:e.topP,quantization:e.quantization??"none",device:e.device??void 0};let r;try{r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),signal:e.signal})}catch(l){throw l instanceof DOMException&&l.name==="AbortError"?new Zn("Запрос отменён пользователем",l):new Zn("Не удалось обратиться к локальному серверу базовой модели",l)}let i=null;try{i=await r.json()}catch(l){throw new Zn("Локальный сервер вернул некорректный JSON",l)}if(!r.ok)throw new Zn(Sp(i),i);if(F2(i)){const l=i;if(Array.isArray(l.choices)&&l.choices.length>0){const d=l.choices[0],h=((a=d==null?void 0:d.message)==null?void 0:a.content)??(d==null?void 0:d.text);if(typeof h!="string"||!h.trim())throw new Zn("Локальный сервер не вернул текст ответа",i);return{content:h.trim(),model:l.model??"base",tokens:(o=l.usage)==null?void 0:o.total_tokens}}if(typeof l.content=="string")return{content:l.content.trim(),model:l.model??"base",tokens:l.tokens}}throw new Zn("Не удалось распознать формат ответа локального сервера",i)}const dg={base:!0,finetuned:!1,remote:!1},_1="llm-studio-chat-selected-models",S1={base:"Базовая модель",finetuned:"Дообученная",remote:"Удалённая API"},kC={base:"bg-slate-800 text-slate-200",finetuned:"bg-emerald-900 text-emerald-200",remote:"bg-sky-900 text-sky-200"},ug=["base","finetuned","remote"],_C=s=>s>=3?"grid-cols-1 md:grid-cols-2 xl:grid-cols-3":s===2?"grid-cols-1 md:grid-cols-2":"grid-cols-1",hg=(s,e={})=>{var n;const t=[];return s.forEach(r=>{const i=typeof r.content=="string"?r.content.trim():r.content;if(!i)return;const a={...r,content:i},o=t[t.length-1];o&&o.role===a.role&&(a.role==="user"&&e.collapseUser||a.role==="assistant"&&e.collapseAssistant)?t[t.length-1]=a:t.push(a)}),((n=t[0])==null?void 0:n.role)==="assistant"&&t.length>1&&t.shift(),t},A1=()=>{const[s,e]=z.useState([]),[t,n]=z.useState(""),[r,i]=z.useState(!1),[a,o]=z.useState(()=>{if(typeof window>"u")return{...dg};try{const N=localStorage.getItem(_1);if(N){const I=JSON.parse(N);return{...dg,...I}}}catch(N){console.warn("Не удалось восстановить выбранные модели чата из localStorage:",N)}return{...dg}}),l=z.useRef(null),{settings:d}=aa(),{chatHistory:h,addChatMessage:f,exportHistory:p,clearHistory:m}=Ul(),{setActivity:b,updateActivity:x,clearActivity:v}=If(),g=z.useMemo(()=>{const N=[];let I=null;return s.forEach(M=>{if(M.role==="user"){I={user:M,assistants:[]},N.push(I);return}if(!I){I={assistants:[M]},N.push(I);return}I.assistants.push(M)}),N},[s]);z.useEffect(()=>{e(h)},[h]);const y=()=>{var N;(N=l.current)==null||N.scrollIntoView({behavior:"smooth"})};z.useEffect(()=>{y()},[s]),z.useEffect(()=>{if(!(typeof window>"u"))try{localStorage.setItem(_1,JSON.stringify(a))}catch(N){console.warn("Не удалось сохранить выбранные модели чата:",N)}},[a]);const w=async N=>{if(N.preventDefault(),!t.trim()||r)return;const I={id:Date.now().toString(),role:"user",content:t.trim(),timestamp:Date.now()};e($=>[...$,I]),f(I),n(""),i(!0);const M=[];if(a.base){const $=k(s,I,"base"),E=(async()=>{try{const D=await Pm($,{serverUrl:d.baseModelServerUrl,modelPath:d.baseModelPath,maxTokens:d.maxTokens,temperature:d.temperature,topP:d.topP,quantization:d.quantization,device:d.deviceType});return{model:D.model??"base",content:D.content,tokens:D.tokens,source:"base"}}catch(D){const _=D instanceof Zn?D.message:"Неизвестная ошибка локального сервера";return console.error("Base chat error:",D),{model:"base",content:`[Базовая модель] Ошибка: ${_}`,source:"base",error:_}}})();M.push(E)}if(a.finetuned){const $=d.fineTunedModelPath.trim(),E=d.fineTunedMethod||"lora",D=(d.fineTunedBaseModelPath||d.baseModelPath).trim();if(!$)M.push(Promise.resolve({model:"finetuned",content:"[Дообученная модель] Путь до модели не указан в настройках",source:"finetuned",error:"Путь до модели не указан"}));else if(E==="lora"&&!D)M.push(Promise.resolve({model:"finetuned",content:"[Дообученная модель] Не указан путь к базовой модели для адаптера",source:"finetuned",error:"Не указан путь к базовой модели"}));else{const _=k(s,I,"finetuned"),K=$.split(/[\\/]/).filter(Boolean).pop()??"finetuned",J=(async()=>{try{const W=await Pm(_,E==="full"?{serverUrl:d.baseModelServerUrl,modelPath:$,maxTokens:d.maxTokens,temperature:d.temperature,topP:d.topP,quantization:d.quantization,device:d.deviceType}:{serverUrl:d.baseModelServerUrl,modelPath:D,adapterPath:$,maxTokens:d.maxTokens,temperature:d.temperature,topP:d.topP,quantization:d.quantization,device:d.deviceType});return{model:W.model??K,content:W.content,tokens:W.tokens,source:"finetuned"}}catch(W){const Q=W instanceof Zn?W.message:"Неизвестная ошибка при обращении к дообученной модели";return console.error("Fine-tuned chat error:",W),{model:"finetuned",content:`[Дообученная модель] Ошибка: ${Q}`,source:"finetuned",error:Q}}})();M.push(J)}}if(a.remote){const $=k(s,I,"remote"),E=(async()=>{try{const D=await S0($,{apiUrl:d.remoteApiUrl,apiKey:d.remoteApiKey,maxTokens:d.maxTokens,temperature:d.temperature,topP:d.topP,model:d.remoteModelId});return{model:D.model??"remote",content:D.content,tokens:D.tokens,source:"remote"}}catch(D){const _=D instanceof ai?D.message:"Неизвестная ошибка удалённого API";return console.error("Remote chat error:",D),{model:"remote",content:`[Удалённая модель] Ошибка: ${_}`,source:"remote",error:_}}})();M.push(E)}if(M.length===0){i(!1);return}b("chat",{message:"Формирует ответ"});let L=null;try{const $=await Promise.all(M);$.forEach(D=>{const _={id:Date.now().toString()+Math.random(),role:"assistant",content:D.content,model:D.model,timestamp:Date.now(),tokens:D.tokens,source:D.source};e(K=>[...K,_]),f(_)}),$.some(D=>D.error)?(x("chat",{status:"error",message:"Ответ получен с ошибками"}),L="error"):(x("chat",{status:"success",message:"Ответ готов"}),L="success")}catch($){console.error("Error getting model responses:",$),x("chat",{status:"error",message:"Ошибка генерации ответа"}),L="error"}finally{if(i(!1),L){const $=L==="error"?5e3:2e3;window.setTimeout(()=>{v("chat")},$)}else v("chat")}},k=(N,I,M)=>{const L=[...N,I].filter(E=>E.role==="user"||E.source===M||typeof E.source>"u").map(({role:E,content:D})=>({role:E,content:D})),$=M==="remote"?hg(L,{collapseUser:!0,collapseAssistant:!0}):M==="base"?hg(L,{collapseAssistant:!0}):hg(L,{collapseUser:!0,collapseAssistant:!0});if(M==="base"&&$.length>0){const E=$.length-1,D=$[E];if(D.role==="user"){const _=$.slice(Math.max(0,E-6),E).filter(K=>K.role==="user");if(_.length>0){const K=_.map(J=>`- ${J.content}`).join(`
`);$[E]={...D,content:`${D.content}

Контекст последних реплик пользователя:
${K}`}}}}return $},C=()=>{const N=p("chat","json"),I=new Blob([N],{type:"application/json"}),M=URL.createObjectURL(I),L=document.createElement("a");L.href=M,L.download=`chat-history-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(M)},P=()=>{m("chat"),e([])};return u.jsxs("div",{className:"h-full flex flex-col bg-slate-900",children:[u.jsxs("div",{className:"border-b border-slate-800 p-4 bg-slate-900",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h2",{className:"text-xl font-semibold",children:"Чат с моделями"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsxs("button",{onClick:C,className:"flex items-center gap-2 px-3 py-2 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:[u.jsx(Nm,{className:"w-4 h-4"}),"Экспорт"]}),u.jsxs("button",{onClick:P,className:"flex items-center gap-2 px-3 py-2 text-sm bg-rose-600 text-white rounded-lg hover:bg-rose-700 transition-colors",children:[u.jsx(jm,{className:"w-4 h-4"}),"Очистить"]})]})]}),u.jsxs("div",{className:"flex gap-4 text-slate-300",children:[u.jsxs("label",{className:"flex items-center gap-2",children:[u.jsx("input",{type:"checkbox",checked:a.base,onChange:N=>o(I=>({...I,base:N.target.checked})),className:"rounded border-slate-300 bg-white accent-blue-500 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-950"}),u.jsx("span",{className:"text-sm",children:"Базовая модель"})]}),u.jsxs("label",{className:"flex items-center gap-2",children:[u.jsx("input",{type:"checkbox",checked:a.finetuned,onChange:N=>o(I=>({...I,finetuned:N.target.checked})),className:"rounded border-slate-300 bg-white accent-blue-500 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-950"}),u.jsx("span",{className:"text-sm",children:"Дообученная"})]}),u.jsxs("label",{className:"flex items-center gap-2",children:[u.jsx("input",{type:"checkbox",checked:a.remote,onChange:N=>o(I=>({...I,remote:N.target.checked})),className:"rounded border-slate-300 bg-white accent-blue-500 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-950"}),u.jsx("span",{className:"text-sm",children:"Удалённая API"})]})]})]}),u.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[g.length===0&&!r&&u.jsxs("div",{className:"pointer-events-none mx-auto mt-16 max-w-xl text-center text-slate-400",children:[u.jsx("div",{className:"text-xs font-semibold uppercase tracking-[0.35em] text-slate-600",children:"Начните диалог"}),u.jsx("h3",{className:"mt-4 text-2xl font-semibold text-slate-100",children:"Задайте вопрос, чтобы сравнить модели"}),u.jsx("p",{className:"mt-3 text-sm text-slate-400",children:"Выберите базовую, дообученную или удалённую модель сверху, затем сформулируйте задачу. Ответы появятся рядом для удобного сравнения."}),u.jsxs("div",{className:"mt-6 flex flex-wrap justify-center gap-2 text-xs text-slate-500",children:[u.jsx("span",{className:"rounded-full border border-slate-700/60 bg-slate-900/40 px-3 py-1",children:"Например: Что такое ПВО?"}),u.jsx("span",{className:"rounded-full border border-slate-700/60 bg-slate-900/40 px-3 py-1",children:"Что такое научная новизна"})]})]}),g.map((N,I)=>{var W,Q;const M=((W=N.user)==null?void 0:W.id)??((Q=N.assistants[0])==null?void 0:Q.id)??`group-${I}`,L=I===g.length-1,$={},E=[];N.assistants.forEach(H=>{H.source&&ug.includes(H.source)?$[H.source]?E.push(H):$[H.source]=H:E.push(H)});const D=[...ug.flatMap(H=>{const oe=$[H];return oe?[{key:oe.id,message:oe,source:H,state:"ready"}]:[]}),...E.map(H=>({key:H.id,message:H,source:null,state:"ready"}))],_=ug.filter(H=>a[H]),K=L&&r?_.length>0?_.filter(H=>!$[H]):[]:[];K.forEach(H=>{D.push({key:`pending-${H}-${M}`,message:null,source:H,state:"pending"})}),L&&r&&K.length===0&&D.length===0&&D.push({key:`pending-generic-${M}`,message:null,source:null,state:"pending"});const J=_C(D.length||1);return u.jsxs("div",{className:"space-y-4",children:[N.user&&u.jsx("div",{className:"flex justify-end",children:u.jsxs("div",{className:"flex items-end gap-3",children:[u.jsxs("div",{className:"max-w-2xl rounded-2xl bg-blue-500 px-4 py-3 text-white shadow-lg shadow-blue-900/30",children:[u.jsx("div",{className:"whitespace-pre-wrap text-sm leading-relaxed",children:N.user.content}),N.user.timestamp&&u.jsx("div",{className:"mt-2 text-right text-[11px] text-blue-100/80",children:new Date(N.user.timestamp).toLocaleTimeString()})]}),u.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-slate-700 text-white",children:u.jsx(oC,{className:"h-5 w-5"})})]})}),D.length>0&&u.jsx("div",{className:`grid ${J} gap-4`,children:D.map(H=>{var ee,fe,se,ve,ce,Re;if(H.state==="pending"){const Ge=H.source?S1[H.source]:"Модель";return u.jsxs("div",{className:"flex items-center gap-3 rounded-2xl border border-slate-200 bg-white/85 p-4 text-slate-600 shadow-sm shadow-slate-900/10 dark:border-slate-800 dark:bg-slate-950/60 dark:text-slate-300",children:[u.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-blue-500/60 text-white",children:u.jsx(KN,{className:"h-5 w-5 animate-spin"})}),u.jsxs("div",{children:[u.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400",children:Ge}),u.jsx("div",{className:"mt-1 text-sm text-slate-300",children:"Генерирую ответ..."})]})]},H.key)}const oe=((ee=H.message)==null?void 0:ee.source)??null,X=oe?S1[oe]:"Ассистент",U=oe?kC[oe]:"border border-slate-700 bg-slate-900/60 text-slate-200",Y=(fe=H.message)==null?void 0:fe.model,V=(se=H.message)!=null&&se.timestamp?new Date(H.message.timestamp).toLocaleTimeString():null;return u.jsx("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-lg shadow-slate-900/10 transition-colors dark:border-slate-800 dark:bg-slate-950/70 dark:shadow-slate-950/25",children:u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-blue-500 text-white",children:u.jsx(RN,{className:"h-5 w-5"})}),u.jsxs("div",{className:"flex-1",children:[(X||Y)&&u.jsxs("div",{className:"mb-2 flex flex-wrap items-center gap-2 text-[11px] text-slate-400",children:[X&&u.jsx("span",{className:`px-2 py-0.5 rounded-full font-semibold uppercase tracking-wide ${U}`,children:X}),Y&&u.jsx("span",{className:"text-slate-400",children:Y})]}),u.jsx("div",{className:"whitespace-pre-wrap text-sm leading-relaxed text-slate-700 dark:text-slate-100",children:(ve=H.message)==null?void 0:ve.content}),(((ce=H.message)==null?void 0:ce.tokens)||V)&&u.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-3 text-[11px] text-slate-500 dark:text-slate-500",children:[((Re=H.message)==null?void 0:Re.tokens)&&u.jsxs("span",{children:[H.message.tokens," токенов"]}),V&&u.jsx("span",{children:V})]})]})]})},H.key)})}),L&&u.jsx("div",{ref:l})]},M)})]}),u.jsx("div",{className:"border-t border-slate-800 p-4 bg-slate-900",children:u.jsxs("form",{onSubmit:w,className:"flex gap-3",children:[u.jsx("input",{type:"text",value:t,onChange:N=>n(N.target.value),placeholder:"Введите ваше сообщение...",className:"flex-1 rounded-lg border border-slate-300 bg-white px-4 py-2 text-slate-900 placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100 dark:placeholder-slate-500",disabled:r}),u.jsx("button",{type:"submit",disabled:r||!t.trim(),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:u.jsx(nC,{className:"w-4 h-4"})})]})})]})},Hy={loss:{label:"Train Loss",color:"#2563eb",formatter:s=>s.toFixed(3),emphasis:!0},train_loss:{label:"Rolling Loss",color:"#1d4ed8",formatter:s=>s.toFixed(3)},perplexity:{label:"Perplexity",color:"#dc2626",formatter:s=>s>999?s.toExponential(2):s.toFixed(2),emphasis:!0},learning_rate:{label:"Learning Rate",color:"#16a34a",formatter:s=>s.toExponential(2)},grad_norm:{label:"Grad Norm",color:"#f97316",formatter:s=>s.toFixed(3)},epoch:{label:"Epoch",color:"#0ea5e9",formatter:s=>s.toFixed(2),showDelta:!1},train_runtime:{label:"Runtime (s)",color:"#2563eb",formatter:s=>`${s.toFixed(1)} s`,showDelta:!1},train_samples_per_second:{label:"Samples / s",color:"#10b981",formatter:s=>s.toFixed(2),emphasis:!0},train_steps_per_second:{label:"Steps / s",color:"#14b8a6",formatter:s=>s.toFixed(2)},train_tokens_per_second:{label:"Tokens / s",color:"#8b5cf6",formatter:s=>s>9999?s.toExponential(2):s.toFixed(0)},eval_loss:{label:"Eval Loss",color:"#a855f7",formatter:s=>s.toFixed(3),emphasis:!0},eval_runtime:{label:"Eval Runtime (s)",color:"#6366f1",formatter:s=>`${s.toFixed(1)} s`,showDelta:!1},eval_samples_per_second:{label:"Eval Samples / s",color:"#f59e0b",formatter:s=>s.toFixed(2)}},E1=["loss","train_loss","perplexity","eval_loss","learning_rate","grad_norm","train_samples_per_second","train_steps_per_second","train_tokens_per_second","train_runtime","epoch","eval_runtime","eval_samples_per_second"],_x=260,gc=120,Mm=16,Rm=16,N1=1e-6,SC=s=>Number.isFinite(s)?Math.abs(s)>=1?s.toFixed(2):s.toPrecision(3):"—",O2=s=>{var e;return((e=Hy[s])==null?void 0:e.formatter)??SC},AC=(s,e)=>{const n=O2(s)(Math.abs(e));return`${e>=0?"+":"-"}${n}`};function EC(s,e){const t=Hy[e],n=(t==null?void 0:t.label)??e,r=(t==null?void 0:t.color)??"#7c3aed",i=O2(e),a=new Map;let o=1;if(s.forEach($=>{const E=$.metrics[e];if(typeof E!="number"||!Number.isFinite(E))return;const D=typeof $.metrics.epoch=="number"&&Number.isFinite($.metrics.epoch)?$.metrics.epoch:null,_=D!==null?Math.max(1,Math.floor(D+N1)):o;a.set(_,E),D!==null?o=Math.max(o,_):t!=null&&t.showDelta?o+=1:o+=0}),a.size===0)return{key:e,label:n,color:r,lastValue:null,formattedLastValue:"—",formattedDelta:null,trend:"flat",minFormatted:"—",maxFormatted:"—",epochs:[],lastEpoch:null,points:[]};const l=Array.from(a.entries()).map(([$,E])=>({epoch:$,value:E})).sort(($,E)=>$.epoch-E.epoch),d=l.map($=>$.value),h=Math.min(...d),f=Math.max(...d),p=f-h,m=p===0?Math.max(Math.abs(f)*.1,1e-4):p,b=h-m*.05,x=f+m*.05,v=l[0].epoch,g=l[l.length-1].epoch,y=Math.max(g-v,1),w=l.map($=>{const E=($.epoch-v)/(y||1),D=($.value-b)/(x-b||1),_=Mm+E*(_x-Mm*2),K=gc-Rm-D*(gc-Rm*2);return{x:_,y:K}}),k=l[l.length-1].value,C=l[l.length-1].epoch,P=l.length>1?l[l.length-2].value:null,N=P===null?null:k-P,M=((t==null?void 0:t.showDelta)??!0)&&N!==null&&Math.abs(N)>N1,L=M?N>0?"up":"down":"flat";return{key:e,label:n,color:r,lastValue:k,formattedLastValue:i(k),formattedDelta:M?AC(e,N):null,trend:L,minFormatted:i(h),maxFormatted:i(f),epochs:l.map($=>$.epoch),lastEpoch:C,points:w}}function NC({series:s}){if(s.points.length===0)return u.jsx("div",{className:"h-28 flex items-center justify-center text-sm text-slate-500 bg-slate-950/40 border border-dashed border-slate-800 rounded-lg",children:"Нет данных для визуализации"});const e=s.points.map(t=>`${t.x},${t.y}`).join(" ");return u.jsxs("svg",{width:"100%",height:gc,viewBox:`0 0 ${_x} ${gc}`,className:"rounded-md bg-slate-900",children:[u.jsx("defs",{children:u.jsxs("linearGradient",{id:`gradient-${s.key}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[u.jsx("stop",{offset:"0%",stopColor:s.color,stopOpacity:"0.35"}),u.jsx("stop",{offset:"100%",stopColor:s.color,stopOpacity:"0"})]})}),u.jsx("polyline",{fill:"none",stroke:s.color,strokeWidth:2.5,strokeLinejoin:"round",strokeLinecap:"round",points:e}),u.jsx("polygon",{fill:`url(#gradient-${s.key})`,points:`${Mm},${gc-Rm} ${e} ${_x-Mm},${gc-Rm}`,opacity:.18}),s.points.length>0&&u.jsx("circle",{cx:s.points[s.points.length-1].x,cy:s.points[s.points.length-1].y,r:4,fill:"#ffffff",stroke:s.color,strokeWidth:2})]})}function CC({history:s,job:e,onClose:t}){const n=z.useMemo(()=>{if(!s.length)return[];const l=new Set;return s.forEach(h=>{Object.keys(h.metrics).forEach(f=>{typeof h.metrics[f]=="number"&&Number.isFinite(h.metrics[f])&&l.add(f)})}),Array.from(l).sort((h,f)=>{const p=E1.indexOf(h),m=E1.indexOf(f);return p===-1&&m===-1?h.localeCompare(f):p===-1?1:m===-1?-1:p-m}).map(h=>EC(s,h))},[s]),r=z.useMemo(()=>n.filter(l=>{var d;return((d=Hy[l.key])==null?void 0:d.emphasis)&&l.lastValue!==null}).slice(0,4),[n]),i=s.length>0?new Date(s[s.length-1].timestamp).toLocaleTimeString():null,a=s.length,o=n.length>0;return u.jsxs("div",{className:"w-96 bg-slate-900 border-l border-slate-800 p-4 flex flex-col gap-4 overflow-hidden",children:[u.jsxs("div",{className:"flex items-start justify-between gap-2",children:[u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold",children:"Метрики обучения"}),u.jsx("div",{className:"text-xs text-slate-400 mt-1",children:a>0?`Обновлено ${a} раз${a===1?"":a<5?"а":""}`:"Метрики появятся после первых шагов обучения"})]}),u.jsx("button",{type:"button",onClick:t,className:"p-1 text-slate-500 hover:text-slate-300","aria-label":"Закрыть панель метрик",title:"Закрыть панель метрик",children:u.jsx(wx,{className:"w-5 h-5"})})]}),e&&u.jsxs("div",{className:"text-xs text-slate-400 space-y-1",children:[u.jsxs("div",{children:[u.jsx("span",{className:"text-slate-200",children:"Статус:"})," ",e.status]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-slate-200",children:"Прогресс:"})," ",Math.round(e.progress),"%"]}),i&&u.jsxs("div",{children:[u.jsx("span",{className:"text-slate-200",children:"Последнее обновление:"})," ",i]})]}),r.length>0&&u.jsxs("div",{className:"space-y-2",children:[u.jsx("div",{className:"text-xs font-medium uppercase tracking-wide text-slate-400",children:"Быстрый обзор"}),u.jsx("div",{className:"grid grid-cols-2 gap-2",children:r.map(l=>u.jsxs("div",{className:"rounded-md border border-slate-800 bg-slate-900/60 px-2 py-2",title:`Последняя эпоха: ${l.lastEpoch??"—"}`,children:[u.jsx("div",{className:"text-[11px] uppercase tracking-wide text-slate-400",children:l.label}),u.jsx("div",{className:"text-sm font-semibold text-slate-50",style:{color:l.color},children:l.formattedLastValue}),l.formattedDelta&&u.jsx("div",{className:`text-[11px] ${l.trend==="down"?"text-rose-400":"text-emerald-400"}`,children:l.formattedDelta})]},`${l.key}-summary`))})]}),u.jsx("div",{className:"flex-1 overflow-y-auto pr-1",children:o?u.jsx("div",{className:"space-y-3 pb-2",children:n.map(l=>{const d=l.trend==="up"?"text-emerald-400":l.trend==="down"?"text-rose-400":"text-slate-500";return u.jsxs("div",{className:"border border-slate-800 rounded-lg p-3 shadow-md shadow-slate-950/20 bg-slate-900",title:`Эпохи: ${l.epochs.join(", ")}`,children:[u.jsxs("div",{className:"flex items-start justify-between gap-3",children:[u.jsxs("div",{className:"space-y-1",children:[u.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:l.label}),u.jsx("div",{className:"text-lg font-semibold text-slate-50",style:{color:l.color},children:l.formattedLastValue}),l.lastEpoch!==null&&u.jsxs("div",{className:"text-[11px] text-slate-500",children:["Эпоха ",l.lastEpoch]}),l.formattedDelta&&u.jsxs("div",{className:`text-xs ${d}`,children:["Δ ",l.formattedDelta," за эпоху"]})]}),u.jsxs("div",{className:"text-right text-[11px] text-slate-400 leading-tight",children:[u.jsxs("div",{children:["мин ",l.minFormatted]}),u.jsxs("div",{children:["макс ",l.maxFormatted]})]})]}),u.jsx("div",{className:"mt-3",children:u.jsx(NC,{series:l})})]},l.key)})}):u.jsxs("div",{className:"h-48 flex flex-col items-center justify-center text-sm text-slate-400 bg-slate-950/40 border border-dashed border-slate-800 rounded-lg",children:[u.jsx("div",{children:"Ждем первые метрики от тренировки…"}),u.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Панель обновляется автоматически"})]})})]})}const Sx="llm-studio-training-dataset",z2="llm-studio-training-config",Ap="llm-studio-training-active-job",sp={method:"lora",quantization:"none",loraRank:16,loraAlpha:32,learningRate:2e-4,batchSize:4,epochs:3,maxLength:512,warmupSteps:0,outputDir:"",targetModules:"",initialAdapterPath:""},TC=()=>{if(typeof window>"u")return[];try{const s=window.localStorage.getItem(Sx);if(!s)return[];const e=JSON.parse(s);return Array.isArray(e)?e.filter(t=>!!(t&&t.input&&t.output)):[]}catch(s){return console.warn("Failed to load training dataset from storage",s),[]}},jC=()=>{if(typeof window>"u")return sp;try{const s=window.localStorage.getItem(z2);if(!s)return sp;const e=JSON.parse(s);return{...sp,...e}}catch(s){return console.warn("Failed to load training config from storage",s),sp}},PC=()=>{if(typeof window>"u")return null;try{const s=window.localStorage.getItem(Ap);return s!=null&&s.trim()?s:null}catch(s){return console.warn("Failed to load active job id from storage",s),null}},$2=z.createContext(void 0);function MC({children:s}){const[e,t]=z.useState(()=>TC()),[n,r]=z.useState(()=>jC()),[i,a]=z.useState(!1),[o,l]=z.useState(0),[d,h]=z.useState(null),[f,p]=z.useState(()=>PC()),[m,b]=z.useState(null),[x,v]=z.useState({}),[g,y]=z.useState([]),w=z.useRef(!1);z.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Sx,JSON.stringify(e))}catch(E){const D=E instanceof DOMException&&(E.name==="QuotaExceededError"||E.code===22||E.code===1014);console.warn("Failed to persist training dataset",E),D&&!w.current&&(w.current=!0,window.setTimeout(()=>{alert("Не удалось сохранить датасет в локальном хранилище: лимит браузера исчерпан. Экспортируйте данные, очистите хранилище или уменьшите размер набора.")},0))}},[e]),z.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(z2,JSON.stringify(n))}catch(E){console.warn("Failed to persist training config",E)}},[n]);const k=z.useCallback(E=>{E.length&&t(D=>{const _=[...D,...E],K=new Set;return _.filter(J=>!J.input||!J.output||K.has(J.id)?!1:(K.add(J.id),!0))})},[]),C=z.useCallback(E=>{t(D=>D.filter(_=>_.id!==E))},[]),P=z.useCallback(()=>{if(t([]),a(!1),l(0),h(null),p(null),b(null),v({}),y([]),typeof window<"u")try{window.localStorage.removeItem(Sx),window.localStorage.removeItem(Ap)}catch(E){console.warn("Failed to clear persisted training state",E)}},[t,a,l,h,p,b,v,y]),N=z.useCallback(E=>{r(D=>({...D,...E}))},[]),I=z.useCallback(E=>{h(E);const D=(E==null?void 0:E.id)??null;if(p(D),typeof window<"u")try{D?window.localStorage.setItem(Ap,D):window.localStorage.removeItem(Ap)}catch(_){console.warn("Failed to persist active job id",_)}},[]),M=z.useCallback((E,D)=>{if(!E||!D)return;const _=Object.entries(D).filter(K=>{const[,J]=K;return typeof J=="number"&&Number.isFinite(J)});_.length!==0&&v(K=>{const J=K[E]??[],W=J[J.length-1],Q=Object.fromEntries(_);if(W&&Object.keys(Q).every(Y=>W.metrics[Y]===Q[Y]))return K;const H={timestamp:Date.now(),metrics:Q},oe=[...J,H],X=oe.length>300?oe.slice(-300):oe;return{...K,[E]:X}})},[]),L=z.useCallback(E=>{if(!E){v({});return}v(D=>{if(!(E in D))return D;const _={...D};return delete _[E],_})},[]),$=z.useMemo(()=>({dataset:e,addDatasetItems:k,removeDatasetItem:C,clearDataset:P,config:n,setConfig:r,updateConfig:N,isTraining:i,setIsTraining:a,trainingProgress:o,setTrainingProgress:l,activeJob:d,setActiveJob:I,activeJobId:f,lastError:m,setLastError:b,metricsHistory:x,appendMetrics:M,resetMetrics:L,trainingTasks:g,setTrainingTasks:y}),[e,k,C,P,n,i,a,o,d,I,f,m,b,x,M,L,N,g,y]);return u.jsx($2.Provider,{value:$,children:s})}function Gy(){const s=z.useContext($2);if(!s)throw new Error("useTraining must be used within a TrainingProvider");return s}class Tr extends Error{constructor(e,t){super(e),this.name="FineTuneError",this.details=t}}const Ax=s=>{if(!s)return"Неизвестная ошибка сервера дообучения";if(typeof s=="string")return s;if(Array.isArray(s)&&s.length>0)return Ax(s[0]);if(typeof s=="object"){const e=s;if("detail"in e)return Ax(e.detail);if(typeof e.message=="string")return e.message;if(typeof e.error=="string")return e.error}try{return JSON.stringify(s)}catch(e){return console.warn("Не удалось сериализовать ошибку fine-tune:",e),"Неизвестная ошибка сервера дообучения"}},RC=s=>{if(!s||typeof s!="string")throw new Tr("URL сервера дообучения не задан");const e=s.trim();if(!e)throw new Tr("URL сервера дообучения не задан");let t;try{t=new URL(e)}catch(a){throw new Tr(`Некорректный URL сервера: ${String(a)}`)}const r=t.pathname.replace(/\/+$/,"").replace(/\/chat\/completions$/i,"").replace(/\/system\/status$/i,"").replace(/\/v1$/i,"").split("/").filter(Boolean);return t.pathname=r.length?`/${r.join("/")}`:"",t.search="",t.hash="",t.toString().replace(/\/$/,"")||`${t.protocol}//${t.host}`},Hl=(s,e)=>{const t=RC(s),n=e.startsWith("/")?e.slice(1):e;return`${t}/${n}`},Gl=async(s,e)=>{let t;try{t=await fetch(s,e)}catch(r){throw new Tr("Не удалось обратиться к серверу дообучения",r)}let n;try{n=await t.json()}catch(r){throw new Tr("Сервер дообучения вернул некорректный JSON",r)}if(!t.ok)throw new Tr(Ax(n),n);return n},IC=async(s,e)=>{const t=Hl(s,"/v1/fine-tunes");return Gl(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})},LC=async s=>{const e=Hl(s,"/v1/fine-tunes");return Gl(e,{method:"GET",cache:"no-store"})},fg=async(s,e)=>{const t=Hl(s,`/v1/fine-tunes/${e}`);return Gl(t,{method:"GET",cache:"no-store"})},DC=async(s,e)=>{const t=Hl(s,`/v1/fine-tunes/${e}/cancel`);return Gl(t,{method:"POST",headers:{"Content-Type":"application/json"}})},FC=async(s,e)=>{const t=Hl(s,`/v1/fine-tunes/${e}/pause`);return Gl(t,{method:"POST",headers:{"Content-Type":"application/json"}})},OC=async(s,e)=>{const t=Hl(s,`/v1/fine-tunes/${e}/resume`);return Gl(t,{method:"POST",headers:{"Content-Type":"application/json"}})},zC=async s=>{const e=Hl(s,"/v1/fine-tunes/available");return Gl(e,{method:"GET",cache:"no-store"})};function B2(s,e={}){const{initialBatchSize:t=30,batchSize:n=t,threshold:r=.85,resetKey:i}=e,a=z.useRef(null),[o,l]=z.useState(()=>Math.min(t,s.length));z.useEffect(()=>{l(m=>Math.min(m,s.length))},[s.length]),z.useEffect(()=>{l(Math.min(t,s.length))},[s.length,t,i]);const d=z.useCallback(()=>{l(m=>m>=s.length?m:Math.min(s.length,m+n))},[n,s.length]),h=z.useCallback(m=>{const b=m.currentTarget;if(!b||b.scrollHeight<=b.clientHeight)return;(b.scrollTop+b.clientHeight)/b.scrollHeight>=r&&d()},[d,r]);z.useEffect(()=>{const m=a.current;if(!(!m||o>=s.length)&&m.scrollHeight<=m.clientHeight*1.05){if(typeof window>"u"){d();return}const b=window.requestAnimationFrame(()=>d());return()=>window.cancelAnimationFrame(b)}},[s.length,d,o]);const f=z.useMemo(()=>s.slice(0,o),[s,o]),p=o<s.length;return{containerRef:a,handleScroll:h,visibleItems:f,hasMore:p,loadMore:d,visibleCount:o}}const Un=({label:s,hint:e})=>u.jsx("label",{className:"mb-2 block text-sm font-medium text-slate-700 dark:text-slate-200",children:u.jsxs("span",{className:"flex items-center gap-1",children:[s,u.jsx("span",{className:"inline-flex h-4 w-4 items-center justify-center rounded-full border border-slate-300 bg-slate-100 text-[11px] leading-none text-slate-600 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-200",title:e,children:"?"})]})}),C1=s=>{const e=typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`${Date.now().toString(36)}-${Math.random().toString(16).slice(2,10)}`;return`${s}-${e}`},$C=({step:s})=>{const t={done:{circle:"bg-emerald-500 text-white border-emerald-400",text:"text-emerald-700 dark:text-emerald-100",bar:"bg-emerald-100 dark:bg-emerald-500/60"},current:{circle:"bg-blue-500 text-white border-blue-400",text:"text-blue-700 dark:text-blue-100",bar:"bg-blue-100 dark:bg-blue-500/40"},pending:{circle:"bg-slate-200 text-slate-500 border-slate-300 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-700",text:"text-slate-500 dark:text-slate-400",bar:"bg-slate-200 dark:bg-slate-800"}}[s.status];return u.jsxs("div",{className:"flex min-w-[160px] flex-1 flex-col items-center",children:[u.jsx("span",{className:`flex h-10 w-10 items-center justify-center rounded-full border text-sm font-semibold shadow-sm ${t.circle}`,children:s.status==="done"?u.jsx(IN,{className:"h-5 w-5"}):u.jsx(ON,{className:"h-5 w-5"})}),u.jsxs("div",{className:`mt-3 text-center ${t.text}`,children:[u.jsx("p",{className:"text-sm font-semibold",children:s.title}),u.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:s.description})]}),u.jsx("div",{className:`mt-4 h-1 w-full rounded-full ${t.bar}`,"aria-hidden":"true"})]})},BC=({tone:s="info",children:e})=>{const t=s==="error"?"border-rose-500/40 bg-rose-50 text-rose-700 dark:bg-rose-500/10 dark:text-rose-100":s==="warning"?"border-amber-400/40 bg-amber-50 text-amber-700 dark:bg-amber-500/10 dark:text-amber-100":"border-sky-400/40 bg-sky-50 text-sky-700 dark:bg-sky-500/10 dark:text-sky-100";return u.jsxs("div",{className:`flex items-start gap-3 rounded-lg border px-4 py-3 text-xs shadow-sm ${t}`,children:[u.jsx(PN,{className:"mt-0.5 h-4 w-4 flex-none"}),u.jsx("span",{className:"leading-relaxed",children:e})]})},T1=s=>{const e=[];let t="",n=!1;for(let r=0;r<s.length;r+=1){const i=s[r];if(i==='"'){n&&s[r+1]==='"'?(t+='"',r+=1):n=!n;continue}if(i===","&&!n){e.push(t),t="";continue}t+=i}return e.push(t),e.map(r=>r.trim())},U2=s=>{const e=s.input??s.question??s.prompt,t=s.output??s.answer??s.completion,n=typeof e=="string"?e.trim():"",r=typeof t=="string"?t.trim():"",i=typeof s.source=="string"&&s.source.trim().length>0?s.source.trim():void 0;return!n||!r?null:{input:n,output:r,source:i}},pg=s=>{const e=s.replace(/\r\n/g,`
`).replace(/\r/g,`
`).trim();if(!e)return[];const[t,...n]=e.split(/\n+/).filter(Boolean);if(!t)return[];const r=T1(t).map(a=>a.toLowerCase()),i=new Map;return r.forEach((a,o)=>i.set(o,a)),n.map(a=>{const o=T1(a),l={};return o.forEach((d,h)=>{const f=i.get(h)??`column_${h}`;l[f]=d}),U2(l)}).filter(a=>!!a)},mg=s=>{if(!s.trim())return[];const e=JSON.parse(s),t=Array.isArray(e)?e:typeof e=="object"&&e!==null&&Array.isArray(e.data)?e.data:null;if(!Array.isArray(t))throw new Error("Файл JSON должен содержать массив объектов с полями input/output.");return t.map(n=>n&&typeof n=="object"?U2(n):null).filter(n=>!!n)},UC=(s,e)=>{const t=s.toLowerCase();return t.endsWith(".json")||e==="application/json"?"json":t.endsWith(".csv")||e==="text/csv"||e==="application/vnd.ms-excel"?"csv":null},j1=.25,P1="llm-studio-training-presets",HC=(s,e,t)=>{var n;return{method:s.method,quantization:s.quantization,loraRank:s.lora_rank,loraAlpha:s.lora_alpha,learningRate:s.learning_rate,batchSize:s.batch_size,epochs:s.epochs,maxLength:s.max_length,warmupSteps:s.warmup_steps,outputDir:t,targetModules:((n=s.target_modules)==null?void 0:n.join(","))??e.targetModules,initialAdapterPath:s.initial_adapter_path??e.initialAdapterPath}},GC=({systemStats:s})=>{var ui,oa,fo;const{dataset:e,addDatasetItems:t,removeDatasetItem:n,clearDataset:r,config:i,setConfig:a,isTraining:o,setIsTraining:l,trainingProgress:d,setTrainingProgress:h,activeJob:f,setActiveJob:p,activeJobId:m,lastError:b,setLastError:x,metricsHistory:v,appendMetrics:g,resetMetrics:y,trainingTasks:w,setTrainingTasks:k}=Gy(),[C,P]=z.useState(!1),[N,I]=z.useState(!1),[M,L]=z.useState({input:"",output:""}),$=z.useRef(null),E=z.useRef(d),D=z.useRef(null),_=z.useRef(null),[K,J]=z.useState(!1),[W,Q]=z.useState(!1),{settings:H,updateSettings:oe}=aa(),{addTrainingSession:X}=Ul(),{setActivity:U,updateActivity:Y,clearActivity:V}=If(),[ee,fe]=z.useState(()=>{if(typeof window>"u")return[];try{const B=window.localStorage.getItem(P1);if(!B)return[];const ie=JSON.parse(B);return Array.isArray(ie)?ie.filter(me=>!!(me&&me.config)).slice(0,6):[]}catch(B){return console.warn("Failed to load training presets from storage",B),[]}}),se=z.useCallback(B=>{fe(ie=>{const me=B(ie);if(typeof window<"u")try{window.localStorage.setItem(P1,JSON.stringify(me.slice(0,6)))}catch(we){console.warn("Failed to persist training presets",we)}return me.slice(0,6)})},[]);z.useEffect(()=>{var B,ie;(ie=(B=f==null?void 0:f.config)==null?void 0:B.target_modules)!=null&&ie.length&&a(me=>({...me,targetModules:f.config.target_modules.join(",")}))},[(ui=f==null?void 0:f.config)==null?void 0:ui.target_modules,a]),z.useEffect(()=>{E.current=d},[d]);const ve=z.useMemo(()=>m?v[m]??[]:[],[m,v]),ce=e.length,Re=z.useMemo(()=>{if(ce===0)return{avgInputChars:0,avgOutputChars:0,avgTotalTokens:0,maxTotalTokens:0};let B=0,ie=0,me=0;e.forEach(F=>{const he=F.input.length,_e=F.output.length;B+=he,ie+=_e;const Le=Math.round((he+_e)*j1);Le>me&&(me=Le)});const we=B/ce,Ve=ie/ce,dt=Math.round((we+Ve)*j1);return{avgInputChars:we,avgOutputChars:Ve,avgTotalTokens:dt,maxTotalTokens:Math.max(me,dt)}},[e,ce]),Ge=z.useMemo(()=>Object.values(v).some(B=>Array.isArray(B)&&B.length>0),[v]),Ht=z.useMemo(()=>{const B=[];return ce===0&&B.push({tone:"warning",text:"Добавьте минимум одну QA-пару, чтобы запустить обучение."}),Re.maxTotalTokens>0&&i.maxLength<Re.maxTotalTokens&&B.push({tone:"warning",text:`Максимальная длина генерации (${i.maxLength} токенов) меньше максимальной длины примеров (${Re.maxTotalTokens}). Ответы могут обрываться.`}),i.learningRate<=0?B.push({tone:"error",text:"Learning rate должен быть больше нуля."}):i.learningRate>.01&&B.push({tone:"warning",text:"Learning rate выглядит подозрительно высоким. Попробуйте значения 0.0001–0.001."}),ce>0&&i.batchSize>ce&&B.push({tone:"warning",text:"Batch size больше размера датасета — обучение будет использовать одни и те же примеры."}),i.method==="full"&&i.quantization!=="none"&&B.push({tone:"error",text:"Полное дообучение не поддерживает квантизацию. Установите «Без квантизации»."}),i.method==="qlora"&&i.quantization!=="4bit"&&B.push({tone:"warning",text:"Для QLoRA выберите квантизацию 4-bit — иначе экономия памяти не сработает."}),i.initialAdapterPath&&i.method==="full"&&B.push({tone:"warning",text:"Стартовый адаптер используется только для LoRA/QLoRA и будет проигнорирован при полном обучении."}),B},[i.batchSize,i.initialAdapterPath,i.learningRate,i.maxLength,i.method,i.quantization,ce,Re.maxTotalTokens]),pt=ce>0,A=!!m||o,le=Ge||!!(f&&f.status==="completed"),ne=ve.length>0||Ge,O={queued:"в очереди",running:"в работе",completed:"завершено",failed:"ошибка",cancelled:"отменено",paused:"на паузе",pausing:"ставим на паузу"},R=z.useCallback(B=>{k(ie=>{const me=ie.filter(Ve=>Ve.id!==B.id),we=[B,...me];return we.sort((Ve,dt)=>(dt.createdAt||0)-(Ve.createdAt||0)),we})},[k]),q=z.useCallback(async()=>{if(!H.baseModelServerUrl){k([]);return}try{const B=await LC(H.baseModelServerUrl);B.sort((ie,me)=>(me.createdAt||0)-(ie.createdAt||0)),k(B)}catch(B){console.error("Не удалось получить список задач дообучения:",B)}},[H.baseModelServerUrl,k]);z.useEffect(()=>{let B=!1;if(!H.baseModelServerUrl)return k([]),()=>{B=!0};const ie=async()=>{B||await q()};ie();const me=window.setInterval(ie,15e3);return()=>{B=!0,window.clearInterval(me)}},[q,H.baseModelServerUrl,k]),z.useEffect(()=>{var we;const B=["queued","running","pausing"],ie=w.find(Ve=>B.includes(Ve.status));if(!ie)return;const me=f?B.includes(f.status):!1;me&&(f==null?void 0:f.id)===ie.id||(!f||!me)&&(p(ie),h(ie.progress),l(ie.status==="queued"||ie.status==="running"),g(ie.id,ie.metrics??{}),(we=D.current)==null||we.call(D,ie.id))},[f,w,p,h,l,g,D]);const ae=z.useMemo(()=>{const B=[{id:"collect",title:"Сбор датасета",description:"Импортируйте файлы или создайте пары вручную"},{id:"preview",title:"Предпросмотр",description:"Проверьте и почистите данные перед запуском"},{id:"launch",title:"Запуск",description:"Настройте гиперпараметры и запустите задачу"},{id:"monitor",title:"Мониторинг",description:"Следите за метриками и статусом обучения"}],ie={collect:pt,preview:pt,launch:A||le,monitor:ne||le};let me=!1;return B.map((we,Ve)=>{const dt=ie[we.id]??!1;let F="pending";return dt?F="done":me||(F="current",me=!0),{...we,status:F,description:we.description+(Ve===0&&!pt?" Добавьте минимум одну пару.":"")}})},[A,le,pt,ne]),{containerRef:de,handleScroll:te,visibleItems:G,hasMore:ue,loadMore:Z}=B2(e,{initialBatchSize:15,batchSize:15,resetKey:e.length}),re=z.useCallback(B=>{a(()=>({...B.config}))},[a]),xe=z.useCallback(()=>{$.current!==null&&(window.clearInterval($.current),$.current=null)},[]),be=z.useMemo(()=>{if(!s)return{canApply:!1,summary:"Автонастройка недоступна — нет данных о системе",details:[],warnings:["Проверьте, что сервер базовой модели запущен и доступен по указанному URL."],parameterHints:[]};if(s.status!=="ok")return{canApply:!1,summary:"Автонастройка недоступна — сервер вернул ошибку",details:[],warnings:[s.message??"Сервер системного статуса недоступен."],parameterHints:[]};const B=[],ie=[],me=[],we=s.gpuBackend,Ve=s.gpuName??(we==="cuda"?"CUDA GPU":we==="mps"?"Apple MPS":"CPU"),dt=s.gpuMemoryTotalGb??null,F={...i};if(ce>0){const ut=Re.avgTotalTokens;B.push(`В датасете ${ce} примеров (≈${ut} токенов в среднем). Параметры рассчитаны так, чтобы учесть текущий объём и среднюю длину примеров.`),ce<20?ie.push("Примеров < 20 — дообучение может переобучиться на отдельных ответах. Попробуйте собрать больше данных или добавьте искусственно сгенерированные пары."):ce<75?ie.push("Малый датасет (< 75 примеров). Рекомендуется увеличить объём или включить регуляризацию (dropout, label smoothing) при экспорте."):ce>1e3&&B.push("Большой датасет — можно постепенно повышать batch size и уменьшать число эпох, чтобы ускорить обучение."),ce<75&&me.push({title:"Генерация",suggestions:["Для небольших датасетов используйте temperature 0–0.3. Это снижает риск появления некорректных вероятностей при семплировании.","Если во время чата появляется ошибка про probability tensor, временно установите temperature = 0 (greedy) и перезапустите генерацию."]})}else ie.push("Датасет пуст — добавьте примеры перед запуском обучения.");let he=i.method,_e=i.quantization,Le=i.batchSize,Je=i.loraRank,Gt=i.loraAlpha,As=i.learningRate,xn=i.epochs,Es=i.maxLength,sn=i.warmupSteps;const hi=Re.avgTotalTokens||256,fs=Re.maxTotalTokens||hi,ss=ce>0&&ce<50,nn=ce>=1e3;if(we==="cuda"){const ut=dt??12;B.push(`Обнаружен GPU ${Ve}${dt?` (${dt.toFixed(1)} GB VRAM)`:""}.`),ut>=22?(he="full",_e="none",Le=ut>=32?6:4,As=ss||nn?8e-6:1e-5,xn=ce>=1500?2:ss?4:3,Es=Math.max(1024,Math.min(2048,Math.max(i.maxLength,fs+256))),sn=ce>0?Math.min(200,Math.max(10,Math.round(ce*.05))):0,B.push("VRAM ≥ 22 GB позволяет выполнить полное дообучение без квантизации.")):ut>=10?(he="qlora",_e="4bit",Je=ut>=16?64:48,Gt=Je*2,Le=ut>=16?4:2,As=ss?15e-5:2e-4,xn=ce>=800?3:ss?5:4,Es=Math.min(Math.max(768,fs+128),1536),sn=ce>0?Math.min(200,Math.max(10,Math.round(ce*.1))):0,B.push("QLoRA с 4-битной квантизацией экономит память и стабильно работает на доступной VRAM.")):(he="lora",_e=ut>=8?"8bit":"4bit",Je=32,Gt=64,Le=ut>=8?2:1,As=ss?18e-5:22e-5,xn=ce>=400?3:ss?5:4,Es=Math.min(Math.max(640,fs+96),1024),sn=ce>0?Math.min(120,Math.max(5,Math.round(ce*.1))):0,B.push("Недостаточно VRAM для полного обучения — предлагаем лёгкую LoRA с квантизацией для экономии памяти.")),H.deviceType!=="cuda"&&ie.push(`В настройках выбран режим ${H.deviceType.toUpperCase()} — переключитесь на CUDA, чтобы использовать обнаруженный GPU.`)}else we==="mps"?(he="lora",_e="none",Je=32,Gt=64,Le=1,As=ss?18e-5:22e-5,xn=ce>=350?3:ss?5:4,Es=Math.min(Math.max(640,fs+96),1024),sn=ce>0?Math.min(100,Math.max(5,Math.round(ce*.12))):0,B.push("Обнаружен Apple MPS — используем LoRA без квантизации, потому что bitsandbytes недоступен на этой платформе."),ie.push("Для QLoRA и инференса на CUDA потребуется видеокарта NVIDIA.")):(he="lora",_e="none",Je=16,Gt=32,Le=1,As=ss?18e-5:22e-5,xn=ce>=350?3:5,Es=Math.min(Math.max(512,fs+64),768),sn=ce>0?Math.min(80,Math.max(0,Math.round(ce*.12))):0,B.push("GPU не обнаружен — LoRA на CPU позволит быстро получить результат, но обучение будет медленным."),ie.push("Для QLoRA и быстрой генерации подключите CUDA-совместимый GPU."));if(F.method=he,F.quantization=_e,F.loraRank=Je,F.loraAlpha=Gt,F.batchSize=Math.max(1,Le),F.learningRate=Number(As.toFixed(6)),F.epochs=Math.max(1,xn),F.maxLength=Math.max(256,Es),F.warmupSteps=Math.max(0,sn),ce>0){const ut=Math.round(F.warmupSteps/Math.max(ce,1)*100),ge=F.maxLength<fs?"Рекомендуется сократить длину примеров или увеличить max length вручную.":`Макс. длина охватывает до ≈${Math.round(F.maxLength*.8)} токенов содержимого.`;B.push(`Warmup: ${F.warmupSteps} шагов (~${ut}% от датасета) для стабильного старта обучения.`),B.push(`Эпохи: ${F.epochs} — компромисс между обобщением и риском переобучения на ${ce} примерах.`),B.push(ge),F.maxLength<fs&&ie.push("Часть примеров длиннее допустимого контекста — укоротите ответы или увеличьте max length."),ce>=200&&ce<500?B.push("Средний датасет — можно экспериментировать с смешиванием prompt-ов и moderate augmentation без риска серьёзного переобучения."):ce>=500&&ce<=1e3&&B.push("Достаточный объём для стабильного обучения. Рассмотрите увеличение batch size и снижение learning rate для более плавной сходимости.")}const ze=_e==="none"?"без квантизации":`${_e}`,rt=`Метод: ${he.toUpperCase()}, квантизация: ${ze}, batch size: ${F.batchSize}, lr: ${F.learningRate}`,ps=(ut,ge)=>ge===0?1/0:Math.abs(ut-ge)/Math.abs(ge);return ce>0&&(ps(i.learningRate,F.learningRate)>=.25?me.push({title:"Learning rate",suggestions:[`Текущее значение ${i.learningRate.toExponential()} отличается от рекомендуемого ${F.learningRate.toExponential()}. При размере датасета ${ce} лучше держаться ближе к рекомендациям, чтобы избежать NaN или переобучения.`,"Если требуется более агрессивное обучение, увеличивайте lr постепенно по 1e-5 и обязательно следите за лоссом после каждой эпохи."]}):me.push({title:"Learning rate",suggestions:[`Диапазон lr выглядит разумно для ${ce} примеров. Если появятся NaN, попробуйте снизить его до ${Math.max(1e-6,F.learningRate*.5).toExponential()}.`]}),i.epochs!==F.epochs&&me.push({title:"Epochs",suggestions:[`Рекомендовано ${F.epochs} эпох(и), у вас установлено ${i.epochs}. При небольшом датасете больше эпох быстро ведёт к переобучению, а меньше — может не успеть адаптироваться.`]}),i.warmupSteps!==F.warmupSteps&&me.push({title:"Warmup steps",suggestions:[`Warmup сейчас ${i.warmupSteps}, рекомендовано ${F.warmupSteps}. Низкий warmup на маленьком датасете легко вызывает «скачок» лосса и ошибки генерации.`]}),i.batchSize!==F.batchSize&&me.push({title:"Batch size",suggestions:[`Текущее batch size = ${i.batchSize}. Для ${ce} примеров советуем ${F.batchSize}: слишком большой batch уменьшает количество шагов и ухудшает обобщение, слишком маленький растягивает время.`]}),i.maxLength<fs&&me.push({title:"Max length",suggestions:[`В датасете есть примеры до ≈${fs} токенов. Текущее ограничение (${i.maxLength}) их обрежет — увеличьте до ${Math.min(2048,Math.max(i.maxLength+128,fs+32))}.`]})),i.method==="lora"&&i.loraAlpha!==i.loraRank*2&&me.push({title:"LoRA alpha",suggestions:[`Обычно alpha ≈ 2 × rank для стабильности. Сейчас rank=${i.loraRank}, alpha=${i.loraAlpha}.`]}),i.method==="qlora"&&i.quantization!=="4bit"?me.push({title:"Quantization",suggestions:["QLoRA требует 4-bit квантизацию. Выберите режим 4bit, чтобы избежать ошибок запуска."]}):i.method==="full"&&i.quantization!=="none"&&me.push({title:"Quantization",suggestions:["Полное дообучение не поддерживает квантизацию — оставьте «Без квантизации»."]}),{canApply:!0,config:F,summary:rt,details:B,warnings:ie,parameterHints:me}},[s,i,ce,H.deviceType,Re]),Ze=z.useMemo(()=>be.config?["method","quantization","loraRank","loraAlpha","learningRate","batchSize","epochs","maxLength","warmupSteps"].every(ie=>{var me;return((me=be.config)==null?void 0:me[ie])===i[ie]}):!1,[be.config,i]),$s=z.useCallback(()=>{if(!be.canApply||!be.config)return;const B=be.config;a(()=>({...B}))},[be,a]),Ft=!be.canApply||!be.config||Ze,us=Ze?"Рекомендации применены":"Принять рекомендации",Oe=z.useCallback(B=>{var ie;if(xe(),p(B),l(!1),h(B.progress),g(B.id,B.metrics??{}),R(B),["completed","failed","cancelled"].includes(B.status)){const me=B.status==="completed"?"completed":(B.status==="failed","failed");X({id:B.id,timestamp:Math.round(B.finishedAt??Date.now()),modelName:B.outputDir,datasetSize:B.datasetSize,status:me,metrics:B.metrics})}if(B.status==="completed"){const me=HC(B.config,i,B.outputDir),we={id:B.id,label:((ie=B.outputDir)==null?void 0:ie.split("/").pop())||B.id,createdAt:Date.now(),datasetSize:B.datasetSize,avgTokens:Re.avgTotalTokens,config:me};se(Ve=>{const dt=Ve.filter(F=>F.label!==we.label&&F.id!==we.id);return[we,...dt]}),Y("training",{status:"success",message:B.message??"Обучение завершено",progress:100}),oe({fineTunedModelPath:B.outputDir,fineTunedBaseModelPath:B.baseModelPath??H.baseModelPath,fineTunedMethod:B.config.method==="full"?"full":"lora"})}else if(B.status==="cancelled"){const me=B.message??"Обучение отменено пользователем";x(me),Y("training",{status:"error",message:me,progress:B.progress})}else if(B.status==="paused")Y("training",{status:"running",message:B.message??"Обучение приостановлено",progress:B.progress});else{const me=B.error??B.message??"Обучение завершилось с ошибкой";x(me),Y("training",{status:"error",message:me,progress:B.progress})}q(),window.setTimeout(()=>{V("training")},B.status==="completed"?3e3:5e3)},[xe,p,l,h,g,X,Y,oe,H.baseModelPath,x,V,se,i,Re.avgTotalTokens,R,q]),nt=z.useCallback(B=>{if(!H.baseModelServerUrl)return;const ie=async()=>{try{const me=await fg(H.baseModelServerUrl,B);p(me),h(me.progress),l(me.status==="queued"||me.status==="running"),g(me.id,me.metrics??{}),R(me),me.status==="queued"||me.status==="running"?Y("training",{message:me.message??"Обучение запущено",progress:me.progress}):Oe(me)}catch(me){xe();const we=me instanceof Tr?me.message:"Не удалось получить статус дообучения";x(we),Y("training",{status:"error",message:we,progress:E.current}),window.setTimeout(()=>V("training"),5e3)}};xe(),ie(),$.current=window.setInterval(()=>{ie()},2e3)},[H.baseModelServerUrl,p,h,l,g,Y,Oe,xe,x,V,R]);z.useEffect(()=>(D.current=nt,()=>{D.current===nt&&(D.current=null)}),[nt]);const lr=z.useCallback(B=>{R(B),y(B.id),p(B),h(B.progress),l(B.status==="queued"||B.status==="running"),g(B.id,B.metrics??{}),B.status==="queued"||B.status==="running"?(Y("training",{message:B.message??"Задача поставлена в очередь",progress:B.progress}),nt(B.id)):Oe(B)},[g,Oe,y,p,l,h,nt,R,Y]);z.useEffect(()=>{if(!H.baseModelServerUrl||!m)return;const B=ie=>ie==="queued"||ie==="running"||ie==="pausing";if(!f){let ie=!1;return(async()=>{try{const we=await fg(H.baseModelServerUrl,m);if(ie)return;p(we),h(we.progress),l(B(we.status)),g(we.id,we.metrics??{}),R(we),B(we.status)?nt(we.id):Oe(we)}catch(we){console.error("Failed to restore fine-tune job state",we)}})(),()=>{ie=!0}}f&&B(f.status)&&$.current===null&&nt(f.id)},[m,f,H.baseModelServerUrl,nt,Oe,g,p,h,l,R]),z.useEffect(()=>()=>xe(),[xe]);const hs=()=>{if(M.input.trim()&&M.output.trim()){const B={id:C1("manual"),input:M.input.trim(),output:M.output.trim(),source:"manual"};t([B]),L({input:"",output:""})}},Bs=B=>{n(B)},ho=z.useCallback(()=>{e.length!==0&&window.confirm("Очистить все примеры из датасета?")&&r()},[r,e.length]),cr=async B=>{const ie=B.target,me=ie.files?Array.from(ie.files):[];if(ie.value="",me.length===0)return;const we=[],Ve=[];if(await Promise.all(me.map(async dt=>{const F=UC(dt.name,dt.type);let he;try{he=await dt.text()}catch(Je){Ve.push(`${dt.name}: не удалось прочитать файл (${Je instanceof Error?Je.message:"неизвестная ошибка"})`);return}const _e=F==="json"?[mg,pg]:F==="csv"?[pg,mg]:[mg,pg];let Le=[];for(const Je of _e)try{if(Le=Je(he),Le.length>0)break}catch(Gt){Ve.push(`${dt.name}: ${Gt instanceof Error?Gt.message:"ошибка разбора"}`)}if(Le.length===0){Ve.push(`${dt.name}: валидные записи не найдены`);return}Le.forEach(Je=>{we.push({id:C1("imported"),input:Je.input,output:Je.output,source:Je.source??dt.name})})})),we.length===0){Ve.length>0&&alert(`Не удалось импортировать данные:
${Ve.join(`
`)}`);return}t(we),Ve.length>0&&alert(`Импорт завершён с предупреждениями:
${Ve.join(`
`)}`)},mt=z.useCallback(B=>{const ie=B.target.value;a(me=>{const we={...me,method:ie};return ie==="qlora"?we.quantization="4bit":ie==="full"&&(we.quantization="none"),we})},[a]),Ye=z.useCallback(B=>{const ie=B.target.value;a(me=>me.method==="full"&&ie!=="none"?(alert("Полное обучение не поддерживает квантизацию."),me):me.method==="qlora"&&ie!=="4bit"?(alert("QLoRA поддерживает только режим 4-bit."),me):{...me,quantization:ie})},[a]),_t=async()=>{if(!H.baseModelPath){alert("Укажите путь к базовой модели на вкладке «Настройки».");return}if(!H.baseModelServerUrl){alert("Укажите URL сервера базовой модели на вкладке «Настройки».");return}if(e.length===0){alert("Добавьте хотя бы один пример для датасета.");return}if(i.method==="qlora"&&i.quantization!=="4bit"){alert("Для QLoRA необходимо выбрать квантизацию 4-bit.");return}if(i.method==="full"&&i.quantization!=="none"){alert("Полное обучение не поддерживает квантизацию.");return}const B=e.map(({input:we,output:Ve,source:dt})=>({input:we,output:Ve,source:dt})),ie={method:i.method,quantization:i.quantization,lora_rank:i.loraRank,lora_alpha:i.loraAlpha,learning_rate:i.learningRate,batch_size:i.batchSize,epochs:i.epochs,max_length:i.maxLength,warmup_steps:i.warmupSteps},me=i.targetModules.split(",").map(we=>we.trim()).filter(Boolean);me.length>0&&(ie.target_modules=me),i.initialAdapterPath.trim()&&(ie.initial_adapter_path=i.initialAdapterPath.trim()),xe(),x(null),l(!0),h(0),U("training",{message:"Подготовка задачи дообучения",progress:0});try{const we=await IC(H.baseModelServerUrl,{base_model_path:H.baseModelPath,output_dir:i.outputDir.trim()||void 0,dataset:B,config:ie});lr(we)}catch(we){const Ve=we instanceof Tr?we.message:"Не удалось запустить дообучение";x(Ve),l(!1),Y("training",{status:"error",message:Ve,progress:0}),window.setTimeout(()=>{V("training")},5e3)}},Ct=async()=>{if(f)try{const B=await DC(H.baseModelServerUrl,f.id);p(B),x(null),Y("training",{message:B.message??"Останавливаю обучение",progress:B.progress}),R(B),q()}catch(B){const ie=B instanceof Tr?B.message:"Не удалось отменить задачу";x(ie),Y("training",{status:"error",message:ie,progress:d}),window.setTimeout(()=>{V("training")},5e3)}},Dr=z.useCallback(async()=>{if(!(!f||!H.baseModelServerUrl)){J(!0);try{const B=await FC(H.baseModelServerUrl,f.id);R(B),p(B),l(!1),Y("training",{message:B.message??"Приостанавливаю обучение",progress:B.progress}),q()}catch(B){const ie=B instanceof Tr?B.message:"Не удалось поставить задачу на паузу";x(ie),alert(ie)}finally{J(!1)}}},[f,H.baseModelServerUrl,R,p,l,Y,x,q]),Ss=z.useCallback(async B=>{const ie=B??(f==null?void 0:f.id);if(!ie||!H.baseModelServerUrl)return;const me=!B||f&&f.id===B;me&&Q(!0);try{const we=await OC(H.baseModelServerUrl,ie);R(we),p(we),l(!0),Y("training",{message:we.message??"Возобновление обучения",progress:we.progress}),nt(we.id),q()}catch(we){const Ve=we instanceof Tr?we.message:"Не удалось возобновить обучение";x(Ve),alert(Ve)}finally{me&&Q(!1)}},[f,H.baseModelServerUrl,R,p,l,Y,nt,x,q]),Wl=z.useCallback(async B=>{if(!H.baseModelServerUrl){p(B),h(B.progress),l(B.status==="queued"||B.status==="running");return}try{const ie=await fg(H.baseModelServerUrl,B.id);p(ie),h(ie.progress),l(ie.status==="queued"||ie.status==="running"),g(ie.id,ie.metrics??{}),ie.status==="queued"||ie.status==="running"?nt(ie.id):xe()}catch(ie){console.error("Не удалось загрузить задачу дообучения",ie)}},[H.baseModelServerUrl,p,h,l,g,nt,xe]);return z.useEffect(()=>()=>{xe()},[xe]),u.jsxs("div",{className:"h-full flex",children:[u.jsx("div",{className:"flex-1 p-6 overflow-y-auto",children:u.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[u.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:"Обучение моделей"}),u.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Импортируйте примеры, настройте параметры и запустите адаптацию моделей."})]}),u.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[u.jsxs("button",{onClick:()=>I(!N),className:"flex items-center gap-2 rounded-lg bg-purple-600 px-4 py-2 text-white shadow-sm hover:bg-purple-700 transition-colors",title:N?"Скрыть панель метрик обучения":"Открыть панель метрик обучения",children:[u.jsx(x1,{className:"h-4 w-4"}),"Метрики"]}),u.jsxs("button",{onClick:()=>P(!0),className:"flex items-center gap-2 rounded-lg bg-emerald-500 px-4 py-2 text-white shadow-sm hover:bg-emerald-600 transition-colors",title:"Добавить один пример вручную",children:[u.jsx(Cm,{className:"h-4 w-4"}),"Добавить свой пример"]}),u.jsxs("button",{onClick:()=>{var B;return(B=_.current)==null?void 0:B.click()},className:"flex items-center gap-2 rounded-lg border border-slate-300 bg-white px-4 py-2 text-slate-700 shadow-sm hover:border-blue-400 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500/40 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200",title:"Импортировать набор примеров из CSV или JSON",children:[u.jsx(j2,{className:"h-4 w-4"}),"Импорт CSV/JSON"]}),u.jsxs("button",{onClick:ho,disabled:e.length===0,className:"flex items-center gap-2 rounded-lg border border-rose-200 bg-white px-4 py-2 text-rose-600 shadow-sm transition-colors hover:border-rose-400 hover:text-rose-700 disabled:cursor-not-allowed disabled:opacity-50 dark:border-rose-400/40 dark:bg-slate-900 dark:text-rose-300",title:"Удалить все примеры",children:[u.jsx(jm,{className:"h-4 w-4"}),"Очистить датасет"]})]})]}),u.jsx("input",{ref:_,type:"file",accept:".csv,.json",multiple:!0,onChange:cr,className:"hidden"}),u.jsxs("div",{className:"space-y-4",children:[u.jsx("div",{className:"rounded-2xl border border-slate-200 bg-white/90 p-5 shadow-sm shadow-slate-900/10 dark:border-slate-800 dark:bg-slate-950/60",children:u.jsx("div",{className:"flex flex-col gap-4 md:flex-row md:items-stretch md:gap-6",children:ae.map((B,ie)=>u.jsxs("div",{className:"flex flex-1 items-center",children:[u.jsx($C,{step:B}),ie<ae.length-1&&u.jsx("div",{className:"hidden h-1 flex-1 rounded-full bg-slate-200 dark:bg-slate-800 md:block","aria-hidden":"true"})]},B.id))})}),u.jsxs("div",{className:"space-y-4",children:[Ht.map((B,ie)=>u.jsx(BC,{tone:B.tone,children:B.text},`${B.text}-${ie}`)),ee.length>0&&u.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white/90 p-4 shadow-sm shadow-slate-900/10 dark:border-slate-800 dark:bg-slate-950/60",children:[u.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[u.jsx("h3",{className:"text-sm font-semibold text-slate-800 dark:text-slate-100",children:"Последние успешные конфигурации"}),u.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"До 6 пресетов"})]}),u.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:ee.map(B=>u.jsxs("button",{type:"button",onClick:()=>re(B),className:"rounded-xl border border-slate-200 bg-white p-3 text-left transition-transform hover:-translate-y-0.5 hover:border-blue-400 hover:shadow-lg hover:shadow-blue-900/10 dark:border-slate-700 dark:bg-slate-900/70",children:[u.jsxs("div",{className:"flex items-center justify-between gap-2",children:[u.jsx("span",{className:"text-sm font-semibold text-slate-700 dark:text-slate-100",children:B.label}),u.jsx("span",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:new Date(B.createdAt).toLocaleDateString()})]}),u.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-[11px] text-slate-500 dark:text-slate-400",children:[u.jsxs("span",{className:"rounded bg-slate-100 px-2 py-1 dark:bg-slate-800/60",children:["Метод: ",B.config.method]}),u.jsxs("span",{className:"rounded bg-slate-100 px-2 py-1 dark:bg-slate-800/60",children:["Эпохи: ",B.config.epochs]}),u.jsxs("span",{className:"rounded bg-slate-100 px-2 py-1 dark:bg-slate-800/60",children:["Batch: ",B.config.batchSize]}),u.jsxs("span",{className:"rounded bg-slate-100 px-2 py-1 dark:bg-slate-800/60",children:["Датасет: ",B.datasetSize]})]}),u.jsxs("p",{className:"mt-2 text-[11px] text-slate-500 dark:text-slate-400",children:["Средняя длина: ≈",B.avgTokens," токенов"]})]},B.id))})]})]})]}),u.jsx("div",{className:"rounded-2xl border border-blue-200 bg-blue-50 p-6 shadow-sm shadow-blue-900/10 dark:border-blue-900 dark:bg-blue-950/30",children:u.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[u.jsxs("div",{className:"flex-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(x1,{className:"w-5 h-5 text-blue-400"}),u.jsx("h3",{className:"text-lg font-semibold text-blue-700 dark:text-blue-200",children:"Автоматический подбор параметров"})]}),u.jsx("p",{className:"mt-2 text-sm text-blue-700 dark:text-blue-200",children:be.summary}),be.details.length>0&&u.jsx("ul",{className:"mt-3 list-disc list-inside space-y-1 text-sm text-blue-700 dark:text-blue-200",children:be.details.map((B,ie)=>u.jsx("li",{children:B},`rec-detail-${ie}`))}),be.warnings.length>0&&u.jsxs("div",{className:"mt-4 rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-sm text-amber-800 dark:border-amber-400/40 dark:bg-amber-500/10 dark:text-amber-100",children:[u.jsx("div",{className:"font-medium",children:"Что проверить:"}),u.jsx("ul",{className:"mt-1 list-disc list-inside space-y-1",children:be.warnings.map((B,ie)=>u.jsx("li",{children:B},`rec-warning-${ie}`))})]}),be.parameterHints.length>0&&u.jsx("div",{className:"mt-4 space-y-3",children:be.parameterHints.map((B,ie)=>u.jsxs("div",{className:"rounded-md border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 shadow-sm dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-200",children:[u.jsx("div",{className:"font-semibold text-slate-800 dark:text-slate-100",children:B.title}),u.jsx("ul",{className:"mt-1 list-disc list-inside space-y-1",children:B.suggestions.map((me,we)=>u.jsx("li",{children:me},`rec-parameter-${ie}-${we}`))})]},`rec-parameter-${ie}`))})]}),u.jsxs("div",{className:"w-full md:w-72 flex flex-col gap-3",children:[u.jsx("button",{type:"button",onClick:$s,disabled:Ft,className:`rounded-lg px-4 py-2 transition-colors ${Ft?"cursor-not-allowed bg-blue-200 text-blue-500 dark:bg-blue-900/40 dark:text-blue-300":"bg-blue-500 text-white hover:bg-blue-600"}`,children:us}),u.jsxs("div",{className:"space-y-1 rounded-lg border border-blue-200 bg-white px-3 py-2 text-xs text-blue-700 shadow-sm dark:border-blue-900 dark:bg-slate-950/60 dark:text-blue-200",children:[u.jsx("div",{className:"font-medium",children:"Обнаруженное окружение"}),u.jsxs("div",{children:["Устройство: ",s!=null&&s.gpuBackend?s.gpuBackend.toUpperCase():"—"]}),u.jsxs("div",{children:["GPU: ",(s==null?void 0:s.gpuName)??"—"]}),u.jsxs("div",{children:["VRAM: ",s!=null&&s.gpuMemoryTotalGb?`${s.gpuMemoryTotalGb.toFixed(1)} GB`:"—"]}),u.jsxs("div",{children:["RAM: ",s!=null&&s.ramTotalGb?`${s.ramTotalGb.toFixed(1)} GB`:"—"]})]})]})]})}),u.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm shadow-slate-900/10 dark:border-slate-800 dark:bg-slate-950/60",children:[u.jsx("h3",{className:"mb-4 text-lg font-semibold text-slate-800 dark:text-slate-100",children:"Конфигурация обучения"}),u.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[u.jsxs("div",{children:[u.jsx(Un,{label:"Метод",hint:"Определяет стратегию обучения: LoRA добавляет адаптеры, QLoRA сочетает их с 4-битной квантизацией, а Полное обучение обновляет все веса."}),u.jsxs("select",{value:i.method,onChange:mt,className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-500 focus:ring-2 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100",children:[u.jsx("option",{value:"lora",children:"LoRA"}),u.jsx("option",{value:"qlora",children:"QLoRA"}),u.jsx("option",{value:"full",children:"Полное обучение"})]})]}),u.jsxs("div",{children:[u.jsx(Un,{label:"Квантизация",hint:"Определяет разрядность весов при загрузке модели. Низкая разрядность экономит видеопамять, но может немного снижать качество."}),u.jsxs("select",{value:i.quantization,onChange:Ye,disabled:i.method==="full"||i.method==="qlora",className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-500 focus:ring-2 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100",children:[u.jsx("option",{value:"none",disabled:i.method==="qlora",children:"Без квантизации"}),u.jsx("option",{value:"8bit",disabled:i.method!=="lora",children:"8-bit"}),u.jsx("option",{value:"4bit",disabled:i.method==="full",children:"4-bit"})]}),i.method==="qlora"?u.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:"QLoRA использует фиксированную квантизацию 4-bit."}):i.method==="full"?u.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:"Полное обучение выполняется без квантизации."}):u.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:"Режимы 4-bit и 8-bit требуют GPU с поддержкой CUDA."})]}),u.jsxs("div",{children:[u.jsx(Un,{label:"LoRA Rank",hint:"Размер узкого слоя адаптера. Бóльший ранг повышает качество, но требует больше памяти и может переобучаться."}),u.jsx("input",{type:"number",value:i.loraRank,onChange:B=>a(ie=>({...ie,loraRank:parseInt(B.target.value)})),disabled:i.method==="full",className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-500 focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100"})]}),u.jsxs("div",{children:[u.jsx(Un,{label:"LoRA Alpha",hint:"Коэффициент масштабирования LoRA. Большие значения усиливают вклад адаптера, но могут сделать обучение менее стабильным."}),u.jsx("input",{type:"number",value:i.loraAlpha,onChange:B=>a(ie=>({...ie,loraAlpha:parseInt(B.target.value)})),disabled:i.method==="full",className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-500 focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100"})]}),u.jsxs("div",{className:"md:col-span-2",children:[u.jsx(Un,{label:"LoRA target modules",hint:"Слои модели, в которые вставляются LoRA-адаптеры. Оставьте поле пустым, чтобы использовать типичный набор для выбранной архитектуры."}),u.jsx("input",{type:"text",value:i.targetModules,onChange:B=>a(ie=>({...ie,targetModules:B.target.value})),placeholder:"q_proj,k_proj,v_proj,o_proj,gate_proj,up_proj,down_proj",className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-500 focus:ring-2 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100"}),u.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:"Оставьте поле пустым, чтобы система подобрала типовые модули автоматически (например, для Gemma и LLaMA)."})]}),u.jsxs("div",{children:[u.jsx(Un,{label:"Learning Rate",hint:"Скорость обучения. Чем выше, тем быстрее модель адаптируется, но возрастает риск нестабильности и переобучения."}),u.jsx("input",{type:"number",step:"0.0001",value:i.learningRate,onChange:B=>a(ie=>({...ie,learningRate:parseFloat(B.target.value)})),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-500 focus:ring-2 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100"})]}),u.jsxs("div",{children:[u.jsx(Un,{label:"Batch Size",hint:"Количество примеров, обрабатываемых за шаг. Большие значения улучшают стабильность градиента, но требуют больше памяти."}),u.jsx("input",{type:"number",value:i.batchSize,onChange:B=>a(ie=>({...ie,batchSize:parseInt(B.target.value)})),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-500 focus:ring-2 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100"})]}),u.jsxs("div",{children:[u.jsx(Un,{label:"Эпохи",hint:"Сколько раз модель проходит весь датасет. Больше эпох повышают качество, но увеличивают время и риск переобучения."}),u.jsx("input",{type:"number",value:i.epochs,onChange:B=>a(ie=>({...ie,epochs:parseInt(B.target.value)})),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-500 focus:ring-2 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100"})]}),u.jsxs("div",{children:[u.jsx(Un,{label:"Warmup steps",hint:"Количество шагов постепенного разгона learning rate. Помогает стабилизировать первые итерации и избежать резких скачков."}),u.jsx("input",{type:"number",min:0,value:i.warmupSteps,onChange:B=>a(ie=>({...ie,warmupSteps:parseInt(B.target.value)||0})),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-500 focus:ring-2 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100"})]}),u.jsxs("div",{children:[u.jsx(Un,{label:"Max Length",hint:"Максимальное количество токенов в обучающем примере. Большое значение даёт длинный контекст, но заметно увеличивает расход памяти."}),u.jsx("input",{type:"number",value:i.maxLength,onChange:B=>a(ie=>({...ie,maxLength:parseInt(B.target.value)})),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-500 focus:ring-2 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100"})]}),u.jsxs("div",{className:"md:col-span-2",children:[u.jsx(Un,{label:"Каталог вывода",hint:"Папка, куда будет сохранён результат обучения. Оставьте пустым, чтобы путь сформировался автоматически."}),u.jsx("input",{type:"text",value:i.outputDir,onChange:B=>a(ie=>({...ie,outputDir:B.target.value})),placeholder:"Models/finetune-my-model",className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-500 focus:ring-2 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100"}),u.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:"Если оставить поле пустым, директория будет создана автоматически внутри каталога Models."})]}),u.jsxs("div",{className:"md:col-span-2",children:[u.jsx(Un,{label:"Стартовый адаптер",hint:"Путь к каталогу с LoRA/QLoRA адаптером, от которого нужно продолжить обучение."}),u.jsx("input",{type:"text",value:i.initialAdapterPath,onChange:B=>a(ie=>({...ie,initialAdapterPath:B.target.value})),placeholder:"Models/finetune-2025-01-12",disabled:i.method==="full",className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-500 focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100"}),u.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:"Для повторного дообучения LoRA адаптера укажите его папку (содержит adapter_config.json и dataset.jsonl). Полное обучение игнорирует это поле."})]})]})]}),u.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm shadow-slate-900/10 dark:border-slate-800 dark:bg-slate-950/60",children:[u.jsxs("div",{className:"mb-4 flex flex-wrap items-center justify-between gap-3",children:[u.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"Управление обучением"}),u.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:[e.length>0?`${e.length} примеров в датасете`:"Датасет пуст",f&&u.jsxs("span",{className:`ml-3 font-medium ${f.status==="failed"?"text-rose-600 dark:text-rose-400":f.status==="paused"?"text-blue-600 dark:text-blue-300":"text-slate-500 dark:text-slate-400"}`,children:["Статус: ",O[f.status]]})]})]}),u.jsxs("div",{className:"mb-4 flex flex-wrap gap-3",children:[u.jsxs("button",{onClick:_t,disabled:o||e.length===0,className:"flex items-center gap-2 rounded-lg bg-blue-500 px-4 py-2 text-white shadow-sm transition-colors hover:bg-blue-600 disabled:cursor-not-allowed disabled:opacity-50",title:"Запустить процесс дообучения",children:[u.jsx(Ju,{className:"h-4 w-4"}),"Начать обучение"]}),u.jsxs("button",{onClick:Dr,disabled:!f||f.status!=="running"||K,className:"flex items-center gap-2 rounded-lg border border-slate-300 bg-white px-4 py-2 text-slate-700 shadow-sm transition-colors hover:border-blue-400 hover:text-blue-600 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200",title:"Поставить обучение на паузу",children:[u.jsx(JN,{className:"h-4 w-4"}),"Пауза"]}),u.jsxs("button",{onClick:()=>Ss(),disabled:!f||f.status!=="paused"||W,className:"flex items-center gap-2 rounded-lg border border-emerald-300 bg-white px-4 py-2 text-emerald-600 shadow-sm transition-colors hover:border-emerald-400 hover:text-emerald-700 disabled:cursor-not-allowed disabled:opacity-50 dark:border-emerald-500/40 dark:bg-slate-900 dark:text-emerald-300",title:"Возобновить приостановленную задачу",children:[u.jsx(Ju,{className:"h-4 w-4"}),"Продолжить"]}),u.jsxs("button",{onClick:Ct,disabled:!o,className:"flex items-center gap-2 rounded-lg bg-rose-500 px-4 py-2 text-white shadow-sm transition-colors hover:bg-rose-600 disabled:cursor-not-allowed disabled:opacity-50",title:"Остановить текущее обучение",children:[u.jsx(By,{className:"h-4 w-4"}),"Остановить"]})]}),(o||d>0)&&u.jsxs("div",{className:"mb-4",children:[u.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[u.jsx("span",{children:"Прогресс обучения"}),u.jsxs("span",{children:[Math.round(d),"%"]})]}),u.jsx("div",{className:"w-full bg-slate-800 rounded-full h-2",children:u.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${d}%`}})})]}),f&&u.jsxs("div",{className:"mb-4 text-sm text-slate-600 dark:text-slate-200",children:[u.jsx("div",{className:"font-medium text-slate-700 dark:text-slate-100",children:f.message}),u.jsxs("div",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:["Выходной каталог: ",u.jsx("span",{className:"font-mono break-all",children:f.outputDir})]}),(fo=(oa=f.config)==null?void 0:oa.target_modules)!=null&&fo.length?u.jsxs("div",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:["LoRA модули: ",u.jsx("span",{className:"font-mono",children:f.config.target_modules.join(", ")})]}):null]}),b&&u.jsx("div",{className:"mb-4 text-sm text-red-600 bg-red-50 border border-red-200 rounded-lg px-4 py-2",children:b})]}),(f==null?void 0:f.events)&&f.events.length>0&&u.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm shadow-slate-900/10 dark:border-slate-800 dark:bg-slate-950/60",children:[u.jsx("h3",{className:"mb-3 text-lg font-semibold text-slate-800 dark:text-slate-100",children:"Журнал обучения"}),u.jsx("div",{className:"max-h-60 space-y-2 overflow-y-auto",children:f.events.slice(-20).reverse().map((B,ie)=>u.jsxs("div",{className:"flex justify-between gap-4 text-xs",children:[u.jsx("span",{className:"w-28 shrink-0 text-slate-500 dark:text-slate-400",children:new Date(B.timestamp*1e3).toLocaleTimeString()}),u.jsx("span",{className:B.level==="error"?"text-rose-600 dark:text-rose-400":"text-slate-600 dark:text-slate-200",children:B.message})]},`${B.timestamp}-${ie}`))})]}),w.length>0&&u.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm shadow-slate-900/10 dark:border-slate-800 dark:bg-slate-950/60",children:[u.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[u.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"Задачи обучения"}),u.jsx("button",{type:"button",onClick:()=>void q(),className:"rounded-lg border border-slate-300 px-3 py-1.5 text-sm text-slate-700 transition-colors hover:border-blue-400 hover:text-blue-600 dark:border-slate-700 dark:text-slate-200",children:"Обновить"})]}),u.jsx("div",{className:"space-y-3",children:w.map(B=>u.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 p-4 shadow-sm dark:border-slate-700 dark:bg-slate-900/70",children:[u.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[u.jsxs("div",{children:[u.jsx("div",{className:"text-sm font-semibold text-slate-700 dark:text-slate-100",children:B.outputDir.split("/").pop()||B.id}),u.jsxs("div",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:["Статус: ",O[B.status]]}),u.jsxs("div",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:["Создано: ",new Date(B.createdAt).toLocaleString()]})]}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:[Math.round(B.progress),"%"]}),u.jsx("div",{className:"h-2 w-32 rounded-full bg-slate-200 dark:bg-slate-800",children:u.jsx("div",{className:"h-2 rounded-full bg-blue-500 transition-all",style:{width:`${Math.min(100,Math.max(3,Math.round(B.progress)))}%`}})})]})]}),u.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 text-xs text-slate-500 dark:text-slate-400",children:[u.jsxs("span",{children:["Метод: ",B.config.method]}),u.jsxs("span",{children:["Batch: ",B.config.batch_size]}),u.jsxs("span",{children:["Эпох: ",B.config.epochs]}),u.jsxs("span",{children:["Токенов: ",B.config.max_length]}),B.resumeCheckpoint&&u.jsxs("span",{children:["Чекпоинт: ",B.resumeCheckpoint.split("/").pop()]})]}),u.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[u.jsx("button",{type:"button",onClick:()=>Wl(B),className:"rounded-lg border border-slate-300 px-3 py-1.5 text-sm text-slate-700 transition-colors hover:border-blue-400 hover:text-blue-600 dark:border-slate-600 dark:text-slate-200",children:"Показать"}),B.status==="paused"&&u.jsx("button",{type:"button",onClick:()=>Ss(B.id),className:"rounded-lg border border-emerald-300 px-3 py-1.5 text-sm text-emerald-600 transition-colors hover:border-emerald-400 hover:text-emerald-700 disabled:cursor-not-allowed disabled:opacity-50 dark:border-emerald-400/40 dark:text-emerald-300",disabled:W&&(f==null?void 0:f.id)===B.id,children:"Продолжить"}),B.status==="running"&&(f==null?void 0:f.id)===B.id&&u.jsx("button",{type:"button",onClick:Dr,className:"rounded-lg border border-slate-300 px-3 py-1.5 text-sm text-slate-700 transition-colors hover:border-blue-400 hover:text-blue-600 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-600 dark:text-slate-200",disabled:K,children:"Пауза"})]})]},B.id))})]}),u.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm shadow-slate-900/10 dark:border-slate-800 dark:bg-slate-950/60",children:[u.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[u.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"Датасет"}),u.jsx("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:e.length>0?`${e.length} ${e.length===1?"пример":"примеров"}`:"Нет примеров"})]}),u.jsxs("div",{ref:de,onScroll:te,className:"max-h-96 space-y-3 overflow-y-auto pr-1",children:[G.map(B=>u.jsxs("div",{className:"flex gap-3 rounded-lg border border-slate-200 bg-slate-50 p-3 dark:border-slate-700 dark:bg-slate-900/70",children:[u.jsxs("div",{className:"flex-1",children:[u.jsx("div",{className:"mb-1 text-sm font-semibold text-slate-700 dark:text-slate-200",children:"Вход:"}),u.jsx("div",{className:"mb-2 text-sm text-slate-700 dark:text-slate-100 whitespace-pre-wrap",children:B.input}),u.jsx("div",{className:"mb-1 text-sm font-semibold text-slate-700 dark:text-slate-200",children:"Выход:"}),u.jsx("div",{className:"text-sm text-slate-700 dark:text-slate-100 whitespace-pre-wrap",children:B.output})]}),u.jsx("button",{onClick:()=>Bs(B.id),className:"self-start rounded-lg p-2 text-rose-600 transition-colors hover:bg-rose-50 dark:text-rose-300 dark:hover:bg-rose-500/20",title:"Удалить пример из датасета",children:u.jsx(jm,{className:"h-4 w-4"})})]},B.id)),ue&&u.jsx("div",{className:"flex justify-center py-2",children:u.jsx("button",{type:"button",onClick:Z,className:"rounded-lg border border-slate-300 px-4 py-1.5 text-sm text-slate-700 transition-colors hover:border-blue-400 hover:text-blue-600 dark:border-slate-600 dark:text-slate-200",children:"Показать ещё"})}),e.length===0&&u.jsx("div",{className:"py-8 text-center text-slate-500 dark:text-slate-400",children:"Датасет пуст. Добавьте примеры для обучения."})]})]})]})}),C&&u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:u.jsxs("div",{className:"w-full max-w-2xl rounded-2xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-900/20 dark:border-slate-800 dark:bg-slate-900",children:[u.jsx("h3",{className:"mb-4 text-lg font-semibold text-slate-800 dark:text-slate-100",children:"Добавить пример в датасет"}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"mb-2 block text-sm font-medium text-slate-700 dark:text-slate-200",children:"Входной текст"}),u.jsx("textarea",{value:M.input,onChange:B=>L(ie=>({...ie,input:B.target.value})),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-500 focus:ring-2 focus:ring-blue-500 h-24 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100",placeholder:"Введите входной текст..."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"mb-2 block text-sm font-medium text-slate-700 dark:text-slate-200",children:"Ожидаемый выход"}),u.jsx("textarea",{value:M.output,onChange:B=>L(ie=>({...ie,output:B.target.value})),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-500 focus:ring-2 focus:ring-blue-500 h-24 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100",placeholder:"Введите ожидаемый ответ..."})]})]}),u.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[u.jsx("button",{onClick:()=>P(!1),className:"rounded-lg border border-slate-300 px-4 py-2 text-slate-700 transition-colors hover:border-slate-400 hover:text-slate-900 dark:border-slate-600 dark:text-slate-300 dark:hover:border-slate-500",title:"Закрыть окно без сохранения",children:"Отмена"}),u.jsx("button",{onClick:()=>{hs(),P(!1)},disabled:!M.input.trim()||!M.output.trim(),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Добавить пример в датасет",children:"Добавить"})]})]})}),N&&u.jsx(CC,{history:ve,job:f,onClose:()=>I(!1)})]})};function np(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var H2={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(s,e){(function(t){s.exports=t()})(function(){return function t(n,r,i){function a(d,h){if(!r[d]){if(!n[d]){var f=typeof np=="function"&&np;if(!h&&f)return f(d,!0);if(o)return o(d,!0);var p=new Error("Cannot find module '"+d+"'");throw p.code="MODULE_NOT_FOUND",p}var m=r[d]={exports:{}};n[d][0].call(m.exports,function(b){var x=n[d][1][b];return a(x||b)},m,m.exports,t,n,r,i)}return r[d].exports}for(var o=typeof np=="function"&&np,l=0;l<i.length;l++)a(i[l]);return a}({1:[function(t,n,r){var i=t("./utils"),a=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(l){for(var d,h,f,p,m,b,x,v=[],g=0,y=l.length,w=y,k=i.getTypeOf(l)!=="string";g<l.length;)w=y-g,f=k?(d=l[g++],h=g<y?l[g++]:0,g<y?l[g++]:0):(d=l.charCodeAt(g++),h=g<y?l.charCodeAt(g++):0,g<y?l.charCodeAt(g++):0),p=d>>2,m=(3&d)<<4|h>>4,b=1<w?(15&h)<<2|f>>6:64,x=2<w?63&f:64,v.push(o.charAt(p)+o.charAt(m)+o.charAt(b)+o.charAt(x));return v.join("")},r.decode=function(l){var d,h,f,p,m,b,x=0,v=0,g="data:";if(l.substr(0,g.length)===g)throw new Error("Invalid base64 input, it looks like a data url.");var y,w=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&w--,l.charAt(l.length-2)===o.charAt(64)&&w--,w%1!=0)throw new Error("Invalid base64 input, bad content length.");for(y=a.uint8array?new Uint8Array(0|w):new Array(0|w);x<l.length;)d=o.indexOf(l.charAt(x++))<<2|(p=o.indexOf(l.charAt(x++)))>>4,h=(15&p)<<4|(m=o.indexOf(l.charAt(x++)))>>2,f=(3&m)<<6|(b=o.indexOf(l.charAt(x++))),y[v++]=d,m!==64&&(y[v++]=h),b!==64&&(y[v++]=f);return y}},{"./support":30,"./utils":32}],2:[function(t,n,r){var i=t("./external"),a=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function d(h,f,p,m,b){this.compressedSize=h,this.uncompressedSize=f,this.crc32=p,this.compression=m,this.compressedContent=b}d.prototype={getContentWorker:function(){var h=new a(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),f=this;return h.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new a(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(h,f,p){return h.pipe(new o).pipe(new l("uncompressedSize")).pipe(f.compressWorker(p)).pipe(new l("compressedSize")).withStreamInfo("compression",f)},n.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,n,r){var i=t("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},r.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,n,r){var i=t("./utils"),a=function(){for(var o,l=[],d=0;d<256;d++){o=d;for(var h=0;h<8;h++)o=1&o?3988292384^o>>>1:o>>>1;l[d]=o}return l}();n.exports=function(o,l){return o!==void 0&&o.length?i.getTypeOf(o)!=="string"?function(d,h,f,p){var m=a,b=p+f;d^=-1;for(var x=p;x<b;x++)d=d>>>8^m[255&(d^h[x])];return-1^d}(0|l,o,o.length,0):function(d,h,f,p){var m=a,b=p+f;d^=-1;for(var x=p;x<b;x++)d=d>>>8^m[255&(d^h.charCodeAt(x))];return-1^d}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(t,n,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(t,n,r){var i=null;i=typeof Promise<"u"?Promise:t("lie"),n.exports={Promise:i}},{lie:37}],7:[function(t,n,r){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=t("pako"),o=t("./utils"),l=t("./stream/GenericWorker"),d=i?"uint8array":"array";function h(f,p){l.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=p,this.meta={}}r.magic="\b\0",o.inherits(h,l),h.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(d,f.data),!1)},h.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(p){f.push({data:p,meta:f.meta})}},r.compressWorker=function(f){return new h("Deflate",f)},r.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,n,r){function i(m,b){var x,v="";for(x=0;x<b;x++)v+=String.fromCharCode(255&m),m>>>=8;return v}function a(m,b,x,v,g,y){var w,k,C=m.file,P=m.compression,N=y!==d.utf8encode,I=o.transformTo("string",y(C.name)),M=o.transformTo("string",d.utf8encode(C.name)),L=C.comment,$=o.transformTo("string",y(L)),E=o.transformTo("string",d.utf8encode(L)),D=M.length!==C.name.length,_=E.length!==L.length,K="",J="",W="",Q=C.dir,H=C.date,oe={crc32:0,compressedSize:0,uncompressedSize:0};b&&!x||(oe.crc32=m.crc32,oe.compressedSize=m.compressedSize,oe.uncompressedSize=m.uncompressedSize);var X=0;b&&(X|=8),N||!D&&!_||(X|=2048);var U=0,Y=0;Q&&(U|=16),g==="UNIX"?(Y=798,U|=function(ee,fe){var se=ee;return ee||(se=fe?16893:33204),(65535&se)<<16}(C.unixPermissions,Q)):(Y=20,U|=function(ee){return 63&(ee||0)}(C.dosPermissions)),w=H.getUTCHours(),w<<=6,w|=H.getUTCMinutes(),w<<=5,w|=H.getUTCSeconds()/2,k=H.getUTCFullYear()-1980,k<<=4,k|=H.getUTCMonth()+1,k<<=5,k|=H.getUTCDate(),D&&(J=i(1,1)+i(h(I),4)+M,K+="up"+i(J.length,2)+J),_&&(W=i(1,1)+i(h($),4)+E,K+="uc"+i(W.length,2)+W);var V="";return V+=`
\0`,V+=i(X,2),V+=P.magic,V+=i(w,2),V+=i(k,2),V+=i(oe.crc32,4),V+=i(oe.compressedSize,4),V+=i(oe.uncompressedSize,4),V+=i(I.length,2),V+=i(K.length,2),{fileRecord:f.LOCAL_FILE_HEADER+V+I+K,dirRecord:f.CENTRAL_FILE_HEADER+i(Y,2)+V+i($.length,2)+"\0\0\0\0"+i(U,4)+i(v,4)+I+K+$}}var o=t("../utils"),l=t("../stream/GenericWorker"),d=t("../utf8"),h=t("../crc32"),f=t("../signature");function p(m,b,x,v){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=x,this.encodeFileName=v,this.streamFiles=m,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(p,l),p.prototype.push=function(m){var b=m.meta.percent||0,x=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(m):(this.bytesWritten+=m.data.length,l.prototype.push.call(this,{data:m.data,meta:{currentFile:this.currentFile,percent:x?(b+100*(x-v-1))/x:100}}))},p.prototype.openedSource=function(m){this.currentSourceOffset=this.bytesWritten,this.currentFile=m.file.name;var b=this.streamFiles&&!m.file.dir;if(b){var x=a(m,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:x.fileRecord,meta:{percent:0}})}else this.accumulate=!0},p.prototype.closedSource=function(m){this.accumulate=!1;var b=this.streamFiles&&!m.file.dir,x=a(m,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(x.dirRecord),b)this.push({data:function(v){return f.DATA_DESCRIPTOR+i(v.crc32,4)+i(v.compressedSize,4)+i(v.uncompressedSize,4)}(m),meta:{percent:100}});else for(this.push({data:x.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},p.prototype.flush=function(){for(var m=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var x=this.bytesWritten-m,v=function(g,y,w,k,C){var P=o.transformTo("string",C(k));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(g,2)+i(g,2)+i(y,4)+i(w,4)+i(P.length,2)+P}(this.dirRecords.length,x,m,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},p.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},p.prototype.registerPrevious=function(m){this._sources.push(m);var b=this;return m.on("data",function(x){b.processChunk(x)}),m.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),m.on("error",function(x){b.error(x)}),this},p.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},p.prototype.error=function(m){var b=this._sources;if(!l.prototype.error.call(this,m))return!1;for(var x=0;x<b.length;x++)try{b[x].error(m)}catch{}return!0},p.prototype.lock=function(){l.prototype.lock.call(this);for(var m=this._sources,b=0;b<m.length;b++)m[b].lock()},n.exports=p},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,n,r){var i=t("../compressions"),a=t("./ZipFileWorker");r.generateWorker=function(o,l,d){var h=new a(l.streamFiles,d,l.platform,l.encodeFileName),f=0;try{o.forEach(function(p,m){f++;var b=function(y,w){var k=y||w,C=i[k];if(!C)throw new Error(k+" is not a valid compression method !");return C}(m.options.compression,l.compression),x=m.options.compressionOptions||l.compressionOptions||{},v=m.dir,g=m.date;m._compressWorker(b,x).withStreamInfo("file",{name:p,dir:v,date:g,comment:m.comment||"",unixPermissions:m.unixPermissions,dosPermissions:m.dosPermissions}).pipe(h)}),h.entriesCount=f}catch(p){h.error(p)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,n,r){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new i;for(var o in this)typeof this[o]!="function"&&(a[o]=this[o]);return a}}(i.prototype=t("./object")).loadAsync=t("./load"),i.support=t("./support"),i.defaults=t("./defaults"),i.version="3.10.1",i.loadAsync=function(a,o){return new i().loadAsync(a,o)},i.external=t("./external"),n.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,n,r){var i=t("./utils"),a=t("./external"),o=t("./utf8"),l=t("./zipEntries"),d=t("./stream/Crc32Probe"),h=t("./nodejsUtils");function f(p){return new a.Promise(function(m,b){var x=p.decompressed.getContentWorker().pipe(new d);x.on("error",function(v){b(v)}).on("end",function(){x.streamInfo.crc32!==p.decompressed.crc32?b(new Error("Corrupted zip : CRC32 mismatch")):m()}).resume()})}n.exports=function(p,m){var b=this;return m=i.extend(m||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),h.isNode&&h.isStream(p)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",p,!0,m.optimizedBinaryString,m.base64).then(function(x){var v=new l(m);return v.load(x),v}).then(function(x){var v=[a.Promise.resolve(x)],g=x.files;if(m.checkCRC32)for(var y=0;y<g.length;y++)v.push(f(g[y]));return a.Promise.all(v)}).then(function(x){for(var v=x.shift(),g=v.files,y=0;y<g.length;y++){var w=g[y],k=w.fileNameStr,C=i.resolve(w.fileNameStr);b.file(C,w.decompressed,{binary:!0,optimizedBinaryString:!0,date:w.date,dir:w.dir,comment:w.fileCommentStr.length?w.fileCommentStr:null,unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions,createFolders:m.createFolders}),w.dir||(b.file(C).unsafeOriginalName=k)}return v.zipComment.length&&(b.comment=v.zipComment),b})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,n,r){var i=t("../utils"),a=t("../stream/GenericWorker");function o(l,d){a.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(d)}i.inherits(o,a),o.prototype._bindStream=function(l){var d=this;(this._stream=l).pause(),l.on("data",function(h){d.push({data:h,meta:{percent:0}})}).on("error",function(h){d.isPaused?this.generatedError=h:d.error(h)}).on("end",function(){d.isPaused?d._upstreamEnded=!0:d.end()})},o.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,n,r){var i=t("readable-stream").Readable;function a(o,l,d){i.call(this,l),this._helper=o;var h=this;o.on("data",function(f,p){h.push(f)||h._helper.pause(),d&&d(p)}).on("error",function(f){h.emit("error",f)}).on("end",function(){h.push(null)})}t("../utils").inherits(a,i),a.prototype._read=function(){this._helper.resume()},n.exports=a},{"../utils":32,"readable-stream":16}],14:[function(t,n,r){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,a);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,a)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var a=new Buffer(i);return a.fill(0),a},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(t,n,r){function i(C,P,N){var I,M=o.getTypeOf(P),L=o.extend(N||{},h);L.date=L.date||new Date,L.compression!==null&&(L.compression=L.compression.toUpperCase()),typeof L.unixPermissions=="string"&&(L.unixPermissions=parseInt(L.unixPermissions,8)),L.unixPermissions&&16384&L.unixPermissions&&(L.dir=!0),L.dosPermissions&&16&L.dosPermissions&&(L.dir=!0),L.dir&&(C=g(C)),L.createFolders&&(I=v(C))&&y.call(this,I,!0);var $=M==="string"&&L.binary===!1&&L.base64===!1;N&&N.binary!==void 0||(L.binary=!$),(P instanceof f&&P.uncompressedSize===0||L.dir||!P||P.length===0)&&(L.base64=!1,L.binary=!0,P="",L.compression="STORE",M="string");var E=null;E=P instanceof f||P instanceof l?P:b.isNode&&b.isStream(P)?new x(C,P):o.prepareContent(C,P,L.binary,L.optimizedBinaryString,L.base64);var D=new p(C,E,L);this.files[C]=D}var a=t("./utf8"),o=t("./utils"),l=t("./stream/GenericWorker"),d=t("./stream/StreamHelper"),h=t("./defaults"),f=t("./compressedObject"),p=t("./zipObject"),m=t("./generate"),b=t("./nodejsUtils"),x=t("./nodejs/NodejsStreamInputAdapter"),v=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var P=C.lastIndexOf("/");return 0<P?C.substring(0,P):""},g=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},y=function(C,P){return P=P!==void 0?P:h.createFolders,C=g(C),this.files[C]||i.call(this,C,null,{dir:!0,createFolders:P}),this.files[C]};function w(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var k={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var P,N,I;for(P in this.files)I=this.files[P],(N=P.slice(this.root.length,P.length))&&P.slice(0,this.root.length)===this.root&&C(N,I)},filter:function(C){var P=[];return this.forEach(function(N,I){C(N,I)&&P.push(I)}),P},file:function(C,P,N){if(arguments.length!==1)return C=this.root+C,i.call(this,C,P,N),this;if(w(C)){var I=C;return this.filter(function(L,$){return!$.dir&&I.test(L)})}var M=this.files[this.root+C];return M&&!M.dir?M:null},folder:function(C){if(!C)return this;if(w(C))return this.filter(function(M,L){return L.dir&&C.test(M)});var P=this.root+C,N=y.call(this,P),I=this.clone();return I.root=N.name,I},remove:function(C){C=this.root+C;var P=this.files[C];if(P||(C.slice(-1)!=="/"&&(C+="/"),P=this.files[C]),P&&!P.dir)delete this.files[C];else for(var N=this.filter(function(M,L){return L.name.slice(0,C.length)===C}),I=0;I<N.length;I++)delete this.files[N[I].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var P,N={};try{if((N=o.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=N.type.toLowerCase(),N.compression=N.compression.toUpperCase(),N.type==="binarystring"&&(N.type="string"),!N.type)throw new Error("No output type specified.");o.checkSupport(N.type),N.platform!=="darwin"&&N.platform!=="freebsd"&&N.platform!=="linux"&&N.platform!=="sunos"||(N.platform="UNIX"),N.platform==="win32"&&(N.platform="DOS");var I=N.comment||this.comment||"";P=m.generateWorker(this,N,I)}catch(M){(P=new l("error")).error(M)}return new d(P,N.type||"string",N.mimeType)},generateAsync:function(C,P){return this.generateInternalStream(C).accumulate(P)},generateNodeStream:function(C,P){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(P)}};n.exports=k},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,n,r){n.exports=t("stream")},{stream:void 0}],17:[function(t,n,r){var i=t("./DataReader");function a(o){i.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}t("../utils").inherits(a,i),a.prototype.byteAt=function(o){return this.data[this.zero+o]},a.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),d=o.charCodeAt(1),h=o.charCodeAt(2),f=o.charCodeAt(3),p=this.length-4;0<=p;--p)if(this.data[p]===l&&this.data[p+1]===d&&this.data[p+2]===h&&this.data[p+3]===f)return p-this.zero;return-1},a.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),d=o.charCodeAt(1),h=o.charCodeAt(2),f=o.charCodeAt(3),p=this.readData(4);return l===p[0]&&d===p[1]&&h===p[2]&&f===p[3]},a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=a},{"../utils":32,"./DataReader":18}],18:[function(t,n,r){var i=t("../utils");function a(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,d=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)d=(d<<8)+this.byteAt(l);return this.index+=o,d},readString:function(o){return i.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},n.exports=a},{"../utils":32}],19:[function(t,n,r){var i=t("./Uint8ArrayReader");function a(o){i.call(this,o)}t("../utils").inherits(a,i),a.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,n,r){var i=t("./DataReader");function a(o){i.call(this,o)}t("../utils").inherits(a,i),a.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},a.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},a.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},a.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=a},{"../utils":32,"./DataReader":18}],21:[function(t,n,r){var i=t("./ArrayReader");function a(o){i.call(this,o)}t("../utils").inherits(a,i),a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(t,n,r){var i=t("../utils"),a=t("../support"),o=t("./ArrayReader"),l=t("./StringReader"),d=t("./NodeBufferReader"),h=t("./Uint8ArrayReader");n.exports=function(f){var p=i.getTypeOf(f);return i.checkSupport(p),p!=="string"||a.uint8array?p==="nodebuffer"?new d(f):a.uint8array?new h(i.transformTo("uint8array",f)):new o(i.transformTo("array",f)):new l(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,n,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,n,r){var i=t("./GenericWorker"),a=t("../utils");function o(l){i.call(this,"ConvertWorker to "+l),this.destType=l}a.inherits(o,i),o.prototype.processChunk=function(l){this.push({data:a.transformTo(this.destType,l.data),meta:l.meta})},n.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,n,r){var i=t("./GenericWorker"),a=t("../crc32");function o(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,i),o.prototype.processChunk=function(l){this.streamInfo.crc32=a(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,n,r){var i=t("../utils"),a=t("./GenericWorker");function o(l){a.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}i.inherits(o,a),o.prototype.processChunk=function(l){if(l){var d=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=d+l.data.length}a.prototype.processChunk.call(this,l)},n.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,n,r){var i=t("../utils"),a=t("./GenericWorker");function o(l){a.call(this,"DataWorker");var d=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(h){d.dataIsReady=!0,d.data=h,d.max=h&&h.length||0,d.type=i.getTypeOf(h),d.isPaused||d._tickAndRepeat()},function(h){d.error(h)})}i.inherits(o,a),o.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,d=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,d);break;case"uint8array":l=this.data.subarray(this.index,d);break;case"array":case"nodebuffer":l=this.data.slice(this.index,d)}return this.index=d,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,n,r){function i(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,o){return this._listeners[a].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,o){if(this._listeners[a])for(var l=0;l<this._listeners[a].length;l++)this._listeners[a][l].call(this,o)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var o=this;return a.on("data",function(l){o.processChunk(l)}),a.on("end",function(){o.end()}),a.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,o){return this.extraStreamInfo[a]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},n.exports=i},{}],29:[function(t,n,r){var i=t("../utils"),a=t("./ConvertWorker"),o=t("./GenericWorker"),l=t("../base64"),d=t("../support"),h=t("../external"),f=null;if(d.nodestream)try{f=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function p(b,x){return new h.Promise(function(v,g){var y=[],w=b._internalType,k=b._outputType,C=b._mimeType;b.on("data",function(P,N){y.push(P),x&&x(N)}).on("error",function(P){y=[],g(P)}).on("end",function(){try{var P=function(N,I,M){switch(N){case"blob":return i.newBlob(i.transformTo("arraybuffer",I),M);case"base64":return l.encode(I);default:return i.transformTo(N,I)}}(k,function(N,I){var M,L=0,$=null,E=0;for(M=0;M<I.length;M++)E+=I[M].length;switch(N){case"string":return I.join("");case"array":return Array.prototype.concat.apply([],I);case"uint8array":for($=new Uint8Array(E),M=0;M<I.length;M++)$.set(I[M],L),L+=I[M].length;return $;case"nodebuffer":return Buffer.concat(I);default:throw new Error("concat : unsupported type '"+N+"'")}}(w,y),C);v(P)}catch(N){g(N)}y=[]}).resume()})}function m(b,x,v){var g=x;switch(x){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string"}try{this._internalType=g,this._outputType=x,this._mimeType=v,i.checkSupport(g),this._worker=b.pipe(new a(g)),b.lock()}catch(y){this._worker=new o("error"),this._worker.error(y)}}m.prototype={accumulate:function(b){return p(this,b)},on:function(b,x){var v=this;return b==="data"?this._worker.on(b,function(g){x.call(v,g.data,g.meta)}):this._worker.on(b,function(){i.delay(x,arguments,v)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(b){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},b)}},n.exports=m},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,n,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var i=new ArrayBuffer(0);try{r.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(i),r.blob=a.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!t("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(t,n,r){for(var i=t("./utils"),a=t("./support"),o=t("./nodejsUtils"),l=t("./stream/GenericWorker"),d=new Array(256),h=0;h<256;h++)d[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;d[254]=d[254]=1;function f(){l.call(this,"utf-8 decode"),this.leftOver=null}function p(){l.call(this,"utf-8 encode")}r.utf8encode=function(m){return a.nodebuffer?o.newBufferFrom(m,"utf-8"):function(b){var x,v,g,y,w,k=b.length,C=0;for(y=0;y<k;y++)(64512&(v=b.charCodeAt(y)))==55296&&y+1<k&&(64512&(g=b.charCodeAt(y+1)))==56320&&(v=65536+(v-55296<<10)+(g-56320),y++),C+=v<128?1:v<2048?2:v<65536?3:4;for(x=a.uint8array?new Uint8Array(C):new Array(C),y=w=0;w<C;y++)(64512&(v=b.charCodeAt(y)))==55296&&y+1<k&&(64512&(g=b.charCodeAt(y+1)))==56320&&(v=65536+(v-55296<<10)+(g-56320),y++),v<128?x[w++]=v:(v<2048?x[w++]=192|v>>>6:(v<65536?x[w++]=224|v>>>12:(x[w++]=240|v>>>18,x[w++]=128|v>>>12&63),x[w++]=128|v>>>6&63),x[w++]=128|63&v);return x}(m)},r.utf8decode=function(m){return a.nodebuffer?i.transformTo("nodebuffer",m).toString("utf-8"):function(b){var x,v,g,y,w=b.length,k=new Array(2*w);for(x=v=0;x<w;)if((g=b[x++])<128)k[v++]=g;else if(4<(y=d[g]))k[v++]=65533,x+=y-1;else{for(g&=y===2?31:y===3?15:7;1<y&&x<w;)g=g<<6|63&b[x++],y--;1<y?k[v++]=65533:g<65536?k[v++]=g:(g-=65536,k[v++]=55296|g>>10&1023,k[v++]=56320|1023&g)}return k.length!==v&&(k.subarray?k=k.subarray(0,v):k.length=v),i.applyFromCharCode(k)}(m=i.transformTo(a.uint8array?"uint8array":"array",m))},i.inherits(f,l),f.prototype.processChunk=function(m){var b=i.transformTo(a.uint8array?"uint8array":"array",m.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var x=b;(b=new Uint8Array(x.length+this.leftOver.length)).set(this.leftOver,0),b.set(x,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var v=function(y,w){var k;for((w=w||y.length)>y.length&&(w=y.length),k=w-1;0<=k&&(192&y[k])==128;)k--;return k<0||k===0?w:k+d[y[k]]>w?k:w}(b),g=b;v!==b.length&&(a.uint8array?(g=b.subarray(0,v),this.leftOver=b.subarray(v,b.length)):(g=b.slice(0,v),this.leftOver=b.slice(v,b.length))),this.push({data:r.utf8decode(g),meta:m.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=f,i.inherits(p,l),p.prototype.processChunk=function(m){this.push({data:r.utf8encode(m.data),meta:m.meta})},r.Utf8EncodeWorker=p},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,n,r){var i=t("./support"),a=t("./base64"),o=t("./nodejsUtils"),l=t("./external");function d(x){return x}function h(x,v){for(var g=0;g<x.length;++g)v[g]=255&x.charCodeAt(g);return v}t("setimmediate"),r.newBlob=function(x,v){r.checkSupport("blob");try{return new Blob([x],{type:v})}catch{try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(x),g.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(x,v,g){var y=[],w=0,k=x.length;if(k<=g)return String.fromCharCode.apply(null,x);for(;w<k;)v==="array"||v==="nodebuffer"?y.push(String.fromCharCode.apply(null,x.slice(w,Math.min(w+g,k)))):y.push(String.fromCharCode.apply(null,x.subarray(w,Math.min(w+g,k)))),w+=g;return y.join("")},stringifyByChar:function(x){for(var v="",g=0;g<x.length;g++)v+=String.fromCharCode(x[g]);return v},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function p(x){var v=65536,g=r.getTypeOf(x),y=!0;if(g==="uint8array"?y=f.applyCanBeUsed.uint8array:g==="nodebuffer"&&(y=f.applyCanBeUsed.nodebuffer),y)for(;1<v;)try{return f.stringifyByChunk(x,g,v)}catch{v=Math.floor(v/2)}return f.stringifyByChar(x)}function m(x,v){for(var g=0;g<x.length;g++)v[g]=x[g];return v}r.applyFromCharCode=p;var b={};b.string={string:d,array:function(x){return h(x,new Array(x.length))},arraybuffer:function(x){return b.string.uint8array(x).buffer},uint8array:function(x){return h(x,new Uint8Array(x.length))},nodebuffer:function(x){return h(x,o.allocBuffer(x.length))}},b.array={string:p,array:d,arraybuffer:function(x){return new Uint8Array(x).buffer},uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return o.newBufferFrom(x)}},b.arraybuffer={string:function(x){return p(new Uint8Array(x))},array:function(x){return m(new Uint8Array(x),new Array(x.byteLength))},arraybuffer:d,uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return o.newBufferFrom(new Uint8Array(x))}},b.uint8array={string:p,array:function(x){return m(x,new Array(x.length))},arraybuffer:function(x){return x.buffer},uint8array:d,nodebuffer:function(x){return o.newBufferFrom(x)}},b.nodebuffer={string:p,array:function(x){return m(x,new Array(x.length))},arraybuffer:function(x){return b.nodebuffer.uint8array(x).buffer},uint8array:function(x){return m(x,new Uint8Array(x.length))},nodebuffer:d},r.transformTo=function(x,v){if(v=v||"",!x)return v;r.checkSupport(x);var g=r.getTypeOf(v);return b[g][x](v)},r.resolve=function(x){for(var v=x.split("/"),g=[],y=0;y<v.length;y++){var w=v[y];w==="."||w===""&&y!==0&&y!==v.length-1||(w===".."?g.pop():g.push(w))}return g.join("/")},r.getTypeOf=function(x){return typeof x=="string"?"string":Object.prototype.toString.call(x)==="[object Array]"?"array":i.nodebuffer&&o.isBuffer(x)?"nodebuffer":i.uint8array&&x instanceof Uint8Array?"uint8array":i.arraybuffer&&x instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(x){if(!i[x.toLowerCase()])throw new Error(x+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(x){var v,g,y="";for(g=0;g<(x||"").length;g++)y+="\\x"+((v=x.charCodeAt(g))<16?"0":"")+v.toString(16).toUpperCase();return y},r.delay=function(x,v,g){setImmediate(function(){x.apply(g||null,v||[])})},r.inherits=function(x,v){function g(){}g.prototype=v.prototype,x.prototype=new g},r.extend=function(){var x,v,g={};for(x=0;x<arguments.length;x++)for(v in arguments[x])Object.prototype.hasOwnProperty.call(arguments[x],v)&&g[v]===void 0&&(g[v]=arguments[x][v]);return g},r.prepareContent=function(x,v,g,y,w){return l.Promise.resolve(v).then(function(k){return i.blob&&(k instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(k))!==-1)&&typeof FileReader<"u"?new l.Promise(function(C,P){var N=new FileReader;N.onload=function(I){C(I.target.result)},N.onerror=function(I){P(I.target.error)},N.readAsArrayBuffer(k)}):k}).then(function(k){var C=r.getTypeOf(k);return C?(C==="arraybuffer"?k=r.transformTo("uint8array",k):C==="string"&&(w?k=a.decode(k):g&&y!==!0&&(k=function(P){return h(P,i.uint8array?new Uint8Array(P.length):new Array(P.length))}(k))),k):l.Promise.reject(new Error("Can't read the data of '"+x+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,n,r){var i=t("./reader/readerFor"),a=t("./utils"),o=t("./signature"),l=t("./zipEntry"),d=t("./support");function h(f){this.files=[],this.loadOptions=f}h.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var p=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(p)+", expected "+a.pretty(f)+")")}},isSignature:function(f,p){var m=this.reader.index;this.reader.setIndex(f);var b=this.reader.readString(4)===p;return this.reader.setIndex(m),b},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),p=d.uint8array?"uint8array":"array",m=a.transformTo(p,f);this.zipComment=this.loadOptions.decodeFileName(m)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,p,m,b=this.zip64EndOfCentralSize-44;0<b;)f=this.reader.readInt(2),p=this.reader.readInt(4),m=this.reader.readData(p),this.zip64ExtensibleData[f]={id:f,length:p,value:m}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,p;for(f=0;f<this.files.length;f++)p=this.files[f],this.reader.setIndex(p.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),p.readLocalPart(this.reader),p.handleUTF8(),p.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(f=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var p=f;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var m=this.centralDirOffset+this.centralDirSize;this.zip64&&(m+=20,m+=12+this.zip64EndOfCentralSize);var b=p-m;if(0<b)this.isSignature(p,o.CENTRAL_FILE_HEADER)||(this.reader.zero=b);else if(b<0)throw new Error("Corrupted zip: missing "+Math.abs(b)+" bytes.")},prepareReader:function(f){this.reader=i(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,n,r){var i=t("./reader/readerFor"),a=t("./utils"),o=t("./compressedObject"),l=t("./crc32"),d=t("./utf8"),h=t("./compressions"),f=t("./support");function p(m,b){this.options=m,this.loadOptions=b}p.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(m){var b,x;if(m.skip(22),this.fileNameLength=m.readInt(2),x=m.readInt(2),this.fileName=m.readData(this.fileNameLength),m.skip(x),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((b=function(v){for(var g in h)if(Object.prototype.hasOwnProperty.call(h,g)&&h[g].magic===v)return h[g];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,b,m.readData(this.compressedSize))},readCentralPart:function(m){this.versionMadeBy=m.readInt(2),m.skip(2),this.bitFlag=m.readInt(2),this.compressionMethod=m.readString(2),this.date=m.readDate(),this.crc32=m.readInt(4),this.compressedSize=m.readInt(4),this.uncompressedSize=m.readInt(4);var b=m.readInt(2);if(this.extraFieldsLength=m.readInt(2),this.fileCommentLength=m.readInt(2),this.diskNumberStart=m.readInt(2),this.internalFileAttributes=m.readInt(2),this.externalFileAttributes=m.readInt(4),this.localHeaderOffset=m.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");m.skip(b),this.readExtraFields(m),this.parseZIP64ExtraField(m),this.fileComment=m.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var m=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),m==0&&(this.dosPermissions=63&this.externalFileAttributes),m==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var m=i(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=m.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=m.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=m.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=m.readInt(4))}},readExtraFields:function(m){var b,x,v,g=m.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});m.index+4<g;)b=m.readInt(2),x=m.readInt(2),v=m.readData(x),this.extraFields[b]={id:b,length:x,value:v};m.setIndex(g)},handleUTF8:function(){var m=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=d.utf8decode(this.fileName),this.fileCommentStr=d.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(b!==null)this.fileNameStr=b;else{var x=a.transformTo(m,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(x)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var g=a.transformTo(m,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(g)}}},findExtraFieldUnicodePath:function(){var m=this.extraFields[28789];if(m){var b=i(m.value);return b.readInt(1)!==1||l(this.fileName)!==b.readInt(4)?null:d.utf8decode(b.readData(m.length-5))}return null},findExtraFieldUnicodeComment:function(){var m=this.extraFields[25461];if(m){var b=i(m.value);return b.readInt(1)!==1||l(this.fileComment)!==b.readInt(4)?null:d.utf8decode(b.readData(m.length-5))}return null}},n.exports=p},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,n,r){function i(b,x,v){this.name=b,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=x,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var a=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),l=t("./utf8"),d=t("./compressedObject"),h=t("./stream/GenericWorker");i.prototype={internalStream:function(b){var x=null,v="string";try{if(!b)throw new Error("No output type specified.");var g=(v=b.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),x=this._decompressWorker();var y=!this._dataBinary;y&&!g&&(x=x.pipe(new l.Utf8EncodeWorker)),!y&&g&&(x=x.pipe(new l.Utf8DecodeWorker))}catch(w){(x=new h("error")).error(w)}return new a(x,v,"")},async:function(b,x){return this.internalStream(b).accumulate(x)},nodeStream:function(b,x){return this.internalStream(b||"nodebuffer").toNodejsStream(x)},_compressWorker:function(b,x){if(this._data instanceof d&&this._data.compression.magic===b.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new l.Utf8EncodeWorker)),d.createWorkerFrom(v,b,x)},_decompressWorker:function(){return this._data instanceof d?this._data.getContentWorker():this._data instanceof h?this._data:new o(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],p=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},m=0;m<f.length;m++)i.prototype[f[m]]=p;n.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,n,r){(function(i){var a,o,l=i.MutationObserver||i.WebKitMutationObserver;if(l){var d=0,h=new l(b),f=i.document.createTextNode("");h.observe(f,{characterData:!0}),a=function(){f.data=d=++d%2}}else if(i.setImmediate||i.MessageChannel===void 0)a="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var x=i.document.createElement("script");x.onreadystatechange=function(){b(),x.onreadystatechange=null,x.parentNode.removeChild(x),x=null},i.document.documentElement.appendChild(x)}:function(){setTimeout(b,0)};else{var p=new i.MessageChannel;p.port1.onmessage=b,a=function(){p.port2.postMessage(0)}}var m=[];function b(){var x,v;o=!0;for(var g=m.length;g;){for(v=m,m=[],x=-1;++x<g;)v[x]();g=m.length}o=!1}n.exports=function(x){m.push(x)!==1||o||a()}}).call(this,typeof Of<"u"?Of:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,n,r){var i=t("immediate");function a(){}var o={},l=["REJECTED"],d=["FULFILLED"],h=["PENDING"];function f(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,g!==a&&x(this,g)}function p(g,y,w){this.promise=g,typeof y=="function"&&(this.onFulfilled=y,this.callFulfilled=this.otherCallFulfilled),typeof w=="function"&&(this.onRejected=w,this.callRejected=this.otherCallRejected)}function m(g,y,w){i(function(){var k;try{k=y(w)}catch(C){return o.reject(g,C)}k===g?o.reject(g,new TypeError("Cannot resolve promise with itself")):o.resolve(g,k)})}function b(g){var y=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof y=="function")return function(){y.apply(g,arguments)}}function x(g,y){var w=!1;function k(N){w||(w=!0,o.reject(g,N))}function C(N){w||(w=!0,o.resolve(g,N))}var P=v(function(){y(C,k)});P.status==="error"&&k(P.value)}function v(g,y){var w={};try{w.value=g(y),w.status="success"}catch(k){w.status="error",w.value=k}return w}(n.exports=f).prototype.finally=function(g){if(typeof g!="function")return this;var y=this.constructor;return this.then(function(w){return y.resolve(g()).then(function(){return w})},function(w){return y.resolve(g()).then(function(){throw w})})},f.prototype.catch=function(g){return this.then(null,g)},f.prototype.then=function(g,y){if(typeof g!="function"&&this.state===d||typeof y!="function"&&this.state===l)return this;var w=new this.constructor(a);return this.state!==h?m(w,this.state===d?g:y,this.outcome):this.queue.push(new p(w,g,y)),w},p.prototype.callFulfilled=function(g){o.resolve(this.promise,g)},p.prototype.otherCallFulfilled=function(g){m(this.promise,this.onFulfilled,g)},p.prototype.callRejected=function(g){o.reject(this.promise,g)},p.prototype.otherCallRejected=function(g){m(this.promise,this.onRejected,g)},o.resolve=function(g,y){var w=v(b,y);if(w.status==="error")return o.reject(g,w.value);var k=w.value;if(k)x(g,k);else{g.state=d,g.outcome=y;for(var C=-1,P=g.queue.length;++C<P;)g.queue[C].callFulfilled(y)}return g},o.reject=function(g,y){g.state=l,g.outcome=y;for(var w=-1,k=g.queue.length;++w<k;)g.queue[w].callRejected(y);return g},f.resolve=function(g){return g instanceof this?g:o.resolve(new this(a),g)},f.reject=function(g){var y=new this(a);return o.reject(y,g)},f.all=function(g){var y=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=g.length,k=!1;if(!w)return this.resolve([]);for(var C=new Array(w),P=0,N=-1,I=new this(a);++N<w;)M(g[N],N);return I;function M(L,$){y.resolve(L).then(function(E){C[$]=E,++P!==w||k||(k=!0,o.resolve(I,C))},function(E){k||(k=!0,o.reject(I,E))})}},f.race=function(g){var y=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=g.length,k=!1;if(!w)return this.resolve([]);for(var C=-1,P=new this(a);++C<w;)N=g[C],y.resolve(N).then(function(I){k||(k=!0,o.resolve(P,I))},function(I){k||(k=!0,o.reject(P,I))});var N;return P}},{immediate:36}],38:[function(t,n,r){var i={};(0,t("./lib/utils/common").assign)(i,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),n.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,n,r){var i=t("./zlib/deflate"),a=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/messages"),d=t("./zlib/zstream"),h=Object.prototype.toString,f=0,p=-1,m=0,b=8;function x(g){if(!(this instanceof x))return new x(g);this.options=a.assign({level:p,method:b,chunkSize:16384,windowBits:15,memLevel:8,strategy:m,to:""},g||{});var y=this.options;y.raw&&0<y.windowBits?y.windowBits=-y.windowBits:y.gzip&&0<y.windowBits&&y.windowBits<16&&(y.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var w=i.deflateInit2(this.strm,y.level,y.method,y.windowBits,y.memLevel,y.strategy);if(w!==f)throw new Error(l[w]);if(y.header&&i.deflateSetHeader(this.strm,y.header),y.dictionary){var k;if(k=typeof y.dictionary=="string"?o.string2buf(y.dictionary):h.call(y.dictionary)==="[object ArrayBuffer]"?new Uint8Array(y.dictionary):y.dictionary,(w=i.deflateSetDictionary(this.strm,k))!==f)throw new Error(l[w]);this._dict_set=!0}}function v(g,y){var w=new x(y);if(w.push(g,!0),w.err)throw w.msg||l[w.err];return w.result}x.prototype.push=function(g,y){var w,k,C=this.strm,P=this.options.chunkSize;if(this.ended)return!1;k=y===~~y?y:y===!0?4:0,typeof g=="string"?C.input=o.string2buf(g):h.call(g)==="[object ArrayBuffer]"?C.input=new Uint8Array(g):C.input=g,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new a.Buf8(P),C.next_out=0,C.avail_out=P),(w=i.deflate(C,k))!==1&&w!==f)return this.onEnd(w),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||k!==4&&k!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(a.shrinkBuf(C.output,C.next_out))):this.onData(a.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&w!==1);return k===4?(w=i.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===f):k!==2||(this.onEnd(f),!(C.avail_out=0))},x.prototype.onData=function(g){this.chunks.push(g)},x.prototype.onEnd=function(g){g===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},r.Deflate=x,r.deflate=v,r.deflateRaw=function(g,y){return(y=y||{}).raw=!0,v(g,y)},r.gzip=function(g,y){return(y=y||{}).gzip=!0,v(g,y)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,n,r){var i=t("./zlib/inflate"),a=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/constants"),d=t("./zlib/messages"),h=t("./zlib/zstream"),f=t("./zlib/gzheader"),p=Object.prototype.toString;function m(x){if(!(this instanceof m))return new m(x);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},x||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||x&&x.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&!(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var g=i.inflateInit2(this.strm,v.windowBits);if(g!==l.Z_OK)throw new Error(d[g]);this.header=new f,i.inflateGetHeader(this.strm,this.header)}function b(x,v){var g=new m(v);if(g.push(x,!0),g.err)throw g.msg||d[g.err];return g.result}m.prototype.push=function(x,v){var g,y,w,k,C,P,N=this.strm,I=this.options.chunkSize,M=this.options.dictionary,L=!1;if(this.ended)return!1;y=v===~~v?v:v===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof x=="string"?N.input=o.binstring2buf(x):p.call(x)==="[object ArrayBuffer]"?N.input=new Uint8Array(x):N.input=x,N.next_in=0,N.avail_in=N.input.length;do{if(N.avail_out===0&&(N.output=new a.Buf8(I),N.next_out=0,N.avail_out=I),(g=i.inflate(N,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&M&&(P=typeof M=="string"?o.string2buf(M):p.call(M)==="[object ArrayBuffer]"?new Uint8Array(M):M,g=i.inflateSetDictionary(this.strm,P)),g===l.Z_BUF_ERROR&&L===!0&&(g=l.Z_OK,L=!1),g!==l.Z_STREAM_END&&g!==l.Z_OK)return this.onEnd(g),!(this.ended=!0);N.next_out&&(N.avail_out!==0&&g!==l.Z_STREAM_END&&(N.avail_in!==0||y!==l.Z_FINISH&&y!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(w=o.utf8border(N.output,N.next_out),k=N.next_out-w,C=o.buf2string(N.output,w),N.next_out=k,N.avail_out=I-k,k&&a.arraySet(N.output,N.output,w,k,0),this.onData(C)):this.onData(a.shrinkBuf(N.output,N.next_out)))),N.avail_in===0&&N.avail_out===0&&(L=!0)}while((0<N.avail_in||N.avail_out===0)&&g!==l.Z_STREAM_END);return g===l.Z_STREAM_END&&(y=l.Z_FINISH),y===l.Z_FINISH?(g=i.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===l.Z_OK):y!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(N.avail_out=0))},m.prototype.onData=function(x){this.chunks.push(x)},m.prototype.onEnd=function(x){x===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},r.Inflate=m,r.inflate=b,r.inflateRaw=function(x,v){return(v=v||{}).raw=!0,b(x,v)},r.ungzip=b},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,n,r){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(l){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var h=d.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var f in h)h.hasOwnProperty(f)&&(l[f]=h[f])}}return l},r.shrinkBuf=function(l,d){return l.length===d?l:l.subarray?l.subarray(0,d):(l.length=d,l)};var a={arraySet:function(l,d,h,f,p){if(d.subarray&&l.subarray)l.set(d.subarray(h,h+f),p);else for(var m=0;m<f;m++)l[p+m]=d[h+m]},flattenChunks:function(l){var d,h,f,p,m,b;for(d=f=0,h=l.length;d<h;d++)f+=l[d].length;for(b=new Uint8Array(f),d=p=0,h=l.length;d<h;d++)m=l[d],b.set(m,p),p+=m.length;return b}},o={arraySet:function(l,d,h,f,p){for(var m=0;m<f;m++)l[p+m]=d[h+m]},flattenChunks:function(l){return[].concat.apply([],l)}};r.setTyped=function(l){l?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,a)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,o))},r.setTyped(i)},{}],42:[function(t,n,r){var i=t("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new i.Buf8(256),d=0;d<256;d++)l[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;function h(f,p){if(p<65537&&(f.subarray&&o||!f.subarray&&a))return String.fromCharCode.apply(null,i.shrinkBuf(f,p));for(var m="",b=0;b<p;b++)m+=String.fromCharCode(f[b]);return m}l[254]=l[254]=1,r.string2buf=function(f){var p,m,b,x,v,g=f.length,y=0;for(x=0;x<g;x++)(64512&(m=f.charCodeAt(x)))==55296&&x+1<g&&(64512&(b=f.charCodeAt(x+1)))==56320&&(m=65536+(m-55296<<10)+(b-56320),x++),y+=m<128?1:m<2048?2:m<65536?3:4;for(p=new i.Buf8(y),x=v=0;v<y;x++)(64512&(m=f.charCodeAt(x)))==55296&&x+1<g&&(64512&(b=f.charCodeAt(x+1)))==56320&&(m=65536+(m-55296<<10)+(b-56320),x++),m<128?p[v++]=m:(m<2048?p[v++]=192|m>>>6:(m<65536?p[v++]=224|m>>>12:(p[v++]=240|m>>>18,p[v++]=128|m>>>12&63),p[v++]=128|m>>>6&63),p[v++]=128|63&m);return p},r.buf2binstring=function(f){return h(f,f.length)},r.binstring2buf=function(f){for(var p=new i.Buf8(f.length),m=0,b=p.length;m<b;m++)p[m]=f.charCodeAt(m);return p},r.buf2string=function(f,p){var m,b,x,v,g=p||f.length,y=new Array(2*g);for(m=b=0;m<g;)if((x=f[m++])<128)y[b++]=x;else if(4<(v=l[x]))y[b++]=65533,m+=v-1;else{for(x&=v===2?31:v===3?15:7;1<v&&m<g;)x=x<<6|63&f[m++],v--;1<v?y[b++]=65533:x<65536?y[b++]=x:(x-=65536,y[b++]=55296|x>>10&1023,y[b++]=56320|1023&x)}return h(y,b)},r.utf8border=function(f,p){var m;for((p=p||f.length)>f.length&&(p=f.length),m=p-1;0<=m&&(192&f[m])==128;)m--;return m<0||m===0?p:m+l[f[m]]>p?m:p}},{"./common":41}],43:[function(t,n,r){n.exports=function(i,a,o,l){for(var d=65535&i|0,h=i>>>16&65535|0,f=0;o!==0;){for(o-=f=2e3<o?2e3:o;h=h+(d=d+a[l++]|0)|0,--f;);d%=65521,h%=65521}return d|h<<16|0}},{}],44:[function(t,n,r){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,n,r){var i=function(){for(var a,o=[],l=0;l<256;l++){a=l;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;o[l]=a}return o}();n.exports=function(a,o,l,d){var h=i,f=d+l;a^=-1;for(var p=d;p<f;p++)a=a>>>8^h[255&(a^o[p])];return-1^a}},{}],46:[function(t,n,r){var i,a=t("../utils/common"),o=t("./trees"),l=t("./adler32"),d=t("./crc32"),h=t("./messages"),f=0,p=4,m=0,b=-2,x=-1,v=4,g=2,y=8,w=9,k=286,C=30,P=19,N=2*k+1,I=15,M=3,L=258,$=L+M+1,E=42,D=113,_=1,K=2,J=3,W=4;function Q(A,le){return A.msg=h[le],le}function H(A){return(A<<1)-(4<A?9:0)}function oe(A){for(var le=A.length;0<=--le;)A[le]=0}function X(A){var le=A.state,ne=le.pending;ne>A.avail_out&&(ne=A.avail_out),ne!==0&&(a.arraySet(A.output,le.pending_buf,le.pending_out,ne,A.next_out),A.next_out+=ne,le.pending_out+=ne,A.total_out+=ne,A.avail_out-=ne,le.pending-=ne,le.pending===0&&(le.pending_out=0))}function U(A,le){o._tr_flush_block(A,0<=A.block_start?A.block_start:-1,A.strstart-A.block_start,le),A.block_start=A.strstart,X(A.strm)}function Y(A,le){A.pending_buf[A.pending++]=le}function V(A,le){A.pending_buf[A.pending++]=le>>>8&255,A.pending_buf[A.pending++]=255&le}function ee(A,le){var ne,O,R=A.max_chain_length,q=A.strstart,ae=A.prev_length,de=A.nice_match,te=A.strstart>A.w_size-$?A.strstart-(A.w_size-$):0,G=A.window,ue=A.w_mask,Z=A.prev,re=A.strstart+L,xe=G[q+ae-1],be=G[q+ae];A.prev_length>=A.good_match&&(R>>=2),de>A.lookahead&&(de=A.lookahead);do if(G[(ne=le)+ae]===be&&G[ne+ae-1]===xe&&G[ne]===G[q]&&G[++ne]===G[q+1]){q+=2,ne++;do;while(G[++q]===G[++ne]&&G[++q]===G[++ne]&&G[++q]===G[++ne]&&G[++q]===G[++ne]&&G[++q]===G[++ne]&&G[++q]===G[++ne]&&G[++q]===G[++ne]&&G[++q]===G[++ne]&&q<re);if(O=L-(re-q),q=re-L,ae<O){if(A.match_start=le,de<=(ae=O))break;xe=G[q+ae-1],be=G[q+ae]}}while((le=Z[le&ue])>te&&--R!=0);return ae<=A.lookahead?ae:A.lookahead}function fe(A){var le,ne,O,R,q,ae,de,te,G,ue,Z=A.w_size;do{if(R=A.window_size-A.lookahead-A.strstart,A.strstart>=Z+(Z-$)){for(a.arraySet(A.window,A.window,Z,Z,0),A.match_start-=Z,A.strstart-=Z,A.block_start-=Z,le=ne=A.hash_size;O=A.head[--le],A.head[le]=Z<=O?O-Z:0,--ne;);for(le=ne=Z;O=A.prev[--le],A.prev[le]=Z<=O?O-Z:0,--ne;);R+=Z}if(A.strm.avail_in===0)break;if(ae=A.strm,de=A.window,te=A.strstart+A.lookahead,G=R,ue=void 0,ue=ae.avail_in,G<ue&&(ue=G),ne=ue===0?0:(ae.avail_in-=ue,a.arraySet(de,ae.input,ae.next_in,ue,te),ae.state.wrap===1?ae.adler=l(ae.adler,de,ue,te):ae.state.wrap===2&&(ae.adler=d(ae.adler,de,ue,te)),ae.next_in+=ue,ae.total_in+=ue,ue),A.lookahead+=ne,A.lookahead+A.insert>=M)for(q=A.strstart-A.insert,A.ins_h=A.window[q],A.ins_h=(A.ins_h<<A.hash_shift^A.window[q+1])&A.hash_mask;A.insert&&(A.ins_h=(A.ins_h<<A.hash_shift^A.window[q+M-1])&A.hash_mask,A.prev[q&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=q,q++,A.insert--,!(A.lookahead+A.insert<M)););}while(A.lookahead<$&&A.strm.avail_in!==0)}function se(A,le){for(var ne,O;;){if(A.lookahead<$){if(fe(A),A.lookahead<$&&le===f)return _;if(A.lookahead===0)break}if(ne=0,A.lookahead>=M&&(A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+M-1])&A.hash_mask,ne=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart),ne!==0&&A.strstart-ne<=A.w_size-$&&(A.match_length=ee(A,ne)),A.match_length>=M)if(O=o._tr_tally(A,A.strstart-A.match_start,A.match_length-M),A.lookahead-=A.match_length,A.match_length<=A.max_lazy_match&&A.lookahead>=M){for(A.match_length--;A.strstart++,A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+M-1])&A.hash_mask,ne=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart,--A.match_length!=0;);A.strstart++}else A.strstart+=A.match_length,A.match_length=0,A.ins_h=A.window[A.strstart],A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+1])&A.hash_mask;else O=o._tr_tally(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++;if(O&&(U(A,!1),A.strm.avail_out===0))return _}return A.insert=A.strstart<M-1?A.strstart:M-1,le===p?(U(A,!0),A.strm.avail_out===0?J:W):A.last_lit&&(U(A,!1),A.strm.avail_out===0)?_:K}function ve(A,le){for(var ne,O,R;;){if(A.lookahead<$){if(fe(A),A.lookahead<$&&le===f)return _;if(A.lookahead===0)break}if(ne=0,A.lookahead>=M&&(A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+M-1])&A.hash_mask,ne=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart),A.prev_length=A.match_length,A.prev_match=A.match_start,A.match_length=M-1,ne!==0&&A.prev_length<A.max_lazy_match&&A.strstart-ne<=A.w_size-$&&(A.match_length=ee(A,ne),A.match_length<=5&&(A.strategy===1||A.match_length===M&&4096<A.strstart-A.match_start)&&(A.match_length=M-1)),A.prev_length>=M&&A.match_length<=A.prev_length){for(R=A.strstart+A.lookahead-M,O=o._tr_tally(A,A.strstart-1-A.prev_match,A.prev_length-M),A.lookahead-=A.prev_length-1,A.prev_length-=2;++A.strstart<=R&&(A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+M-1])&A.hash_mask,ne=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart),--A.prev_length!=0;);if(A.match_available=0,A.match_length=M-1,A.strstart++,O&&(U(A,!1),A.strm.avail_out===0))return _}else if(A.match_available){if((O=o._tr_tally(A,0,A.window[A.strstart-1]))&&U(A,!1),A.strstart++,A.lookahead--,A.strm.avail_out===0)return _}else A.match_available=1,A.strstart++,A.lookahead--}return A.match_available&&(O=o._tr_tally(A,0,A.window[A.strstart-1]),A.match_available=0),A.insert=A.strstart<M-1?A.strstart:M-1,le===p?(U(A,!0),A.strm.avail_out===0?J:W):A.last_lit&&(U(A,!1),A.strm.avail_out===0)?_:K}function ce(A,le,ne,O,R){this.good_length=A,this.max_lazy=le,this.nice_length=ne,this.max_chain=O,this.func=R}function Re(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*N),this.dyn_dtree=new a.Buf16(2*(2*C+1)),this.bl_tree=new a.Buf16(2*(2*P+1)),oe(this.dyn_ltree),oe(this.dyn_dtree),oe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(I+1),this.heap=new a.Buf16(2*k+1),oe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*k+1),oe(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ge(A){var le;return A&&A.state?(A.total_in=A.total_out=0,A.data_type=g,(le=A.state).pending=0,le.pending_out=0,le.wrap<0&&(le.wrap=-le.wrap),le.status=le.wrap?E:D,A.adler=le.wrap===2?0:1,le.last_flush=f,o._tr_init(le),m):Q(A,b)}function Ht(A){var le=Ge(A);return le===m&&function(ne){ne.window_size=2*ne.w_size,oe(ne.head),ne.max_lazy_match=i[ne.level].max_lazy,ne.good_match=i[ne.level].good_length,ne.nice_match=i[ne.level].nice_length,ne.max_chain_length=i[ne.level].max_chain,ne.strstart=0,ne.block_start=0,ne.lookahead=0,ne.insert=0,ne.match_length=ne.prev_length=M-1,ne.match_available=0,ne.ins_h=0}(A.state),le}function pt(A,le,ne,O,R,q){if(!A)return b;var ae=1;if(le===x&&(le=6),O<0?(ae=0,O=-O):15<O&&(ae=2,O-=16),R<1||w<R||ne!==y||O<8||15<O||le<0||9<le||q<0||v<q)return Q(A,b);O===8&&(O=9);var de=new Re;return(A.state=de).strm=A,de.wrap=ae,de.gzhead=null,de.w_bits=O,de.w_size=1<<de.w_bits,de.w_mask=de.w_size-1,de.hash_bits=R+7,de.hash_size=1<<de.hash_bits,de.hash_mask=de.hash_size-1,de.hash_shift=~~((de.hash_bits+M-1)/M),de.window=new a.Buf8(2*de.w_size),de.head=new a.Buf16(de.hash_size),de.prev=new a.Buf16(de.w_size),de.lit_bufsize=1<<R+6,de.pending_buf_size=4*de.lit_bufsize,de.pending_buf=new a.Buf8(de.pending_buf_size),de.d_buf=1*de.lit_bufsize,de.l_buf=3*de.lit_bufsize,de.level=le,de.strategy=q,de.method=ne,Ht(A)}i=[new ce(0,0,0,0,function(A,le){var ne=65535;for(ne>A.pending_buf_size-5&&(ne=A.pending_buf_size-5);;){if(A.lookahead<=1){if(fe(A),A.lookahead===0&&le===f)return _;if(A.lookahead===0)break}A.strstart+=A.lookahead,A.lookahead=0;var O=A.block_start+ne;if((A.strstart===0||A.strstart>=O)&&(A.lookahead=A.strstart-O,A.strstart=O,U(A,!1),A.strm.avail_out===0)||A.strstart-A.block_start>=A.w_size-$&&(U(A,!1),A.strm.avail_out===0))return _}return A.insert=0,le===p?(U(A,!0),A.strm.avail_out===0?J:W):(A.strstart>A.block_start&&(U(A,!1),A.strm.avail_out),_)}),new ce(4,4,8,4,se),new ce(4,5,16,8,se),new ce(4,6,32,32,se),new ce(4,4,16,16,ve),new ce(8,16,32,32,ve),new ce(8,16,128,128,ve),new ce(8,32,128,256,ve),new ce(32,128,258,1024,ve),new ce(32,258,258,4096,ve)],r.deflateInit=function(A,le){return pt(A,le,y,15,8,0)},r.deflateInit2=pt,r.deflateReset=Ht,r.deflateResetKeep=Ge,r.deflateSetHeader=function(A,le){return A&&A.state?A.state.wrap!==2?b:(A.state.gzhead=le,m):b},r.deflate=function(A,le){var ne,O,R,q;if(!A||!A.state||5<le||le<0)return A?Q(A,b):b;if(O=A.state,!A.output||!A.input&&A.avail_in!==0||O.status===666&&le!==p)return Q(A,A.avail_out===0?-5:b);if(O.strm=A,ne=O.last_flush,O.last_flush=le,O.status===E)if(O.wrap===2)A.adler=0,Y(O,31),Y(O,139),Y(O,8),O.gzhead?(Y(O,(O.gzhead.text?1:0)+(O.gzhead.hcrc?2:0)+(O.gzhead.extra?4:0)+(O.gzhead.name?8:0)+(O.gzhead.comment?16:0)),Y(O,255&O.gzhead.time),Y(O,O.gzhead.time>>8&255),Y(O,O.gzhead.time>>16&255),Y(O,O.gzhead.time>>24&255),Y(O,O.level===9?2:2<=O.strategy||O.level<2?4:0),Y(O,255&O.gzhead.os),O.gzhead.extra&&O.gzhead.extra.length&&(Y(O,255&O.gzhead.extra.length),Y(O,O.gzhead.extra.length>>8&255)),O.gzhead.hcrc&&(A.adler=d(A.adler,O.pending_buf,O.pending,0)),O.gzindex=0,O.status=69):(Y(O,0),Y(O,0),Y(O,0),Y(O,0),Y(O,0),Y(O,O.level===9?2:2<=O.strategy||O.level<2?4:0),Y(O,3),O.status=D);else{var ae=y+(O.w_bits-8<<4)<<8;ae|=(2<=O.strategy||O.level<2?0:O.level<6?1:O.level===6?2:3)<<6,O.strstart!==0&&(ae|=32),ae+=31-ae%31,O.status=D,V(O,ae),O.strstart!==0&&(V(O,A.adler>>>16),V(O,65535&A.adler)),A.adler=1}if(O.status===69)if(O.gzhead.extra){for(R=O.pending;O.gzindex<(65535&O.gzhead.extra.length)&&(O.pending!==O.pending_buf_size||(O.gzhead.hcrc&&O.pending>R&&(A.adler=d(A.adler,O.pending_buf,O.pending-R,R)),X(A),R=O.pending,O.pending!==O.pending_buf_size));)Y(O,255&O.gzhead.extra[O.gzindex]),O.gzindex++;O.gzhead.hcrc&&O.pending>R&&(A.adler=d(A.adler,O.pending_buf,O.pending-R,R)),O.gzindex===O.gzhead.extra.length&&(O.gzindex=0,O.status=73)}else O.status=73;if(O.status===73)if(O.gzhead.name){R=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>R&&(A.adler=d(A.adler,O.pending_buf,O.pending-R,R)),X(A),R=O.pending,O.pending===O.pending_buf_size)){q=1;break}q=O.gzindex<O.gzhead.name.length?255&O.gzhead.name.charCodeAt(O.gzindex++):0,Y(O,q)}while(q!==0);O.gzhead.hcrc&&O.pending>R&&(A.adler=d(A.adler,O.pending_buf,O.pending-R,R)),q===0&&(O.gzindex=0,O.status=91)}else O.status=91;if(O.status===91)if(O.gzhead.comment){R=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>R&&(A.adler=d(A.adler,O.pending_buf,O.pending-R,R)),X(A),R=O.pending,O.pending===O.pending_buf_size)){q=1;break}q=O.gzindex<O.gzhead.comment.length?255&O.gzhead.comment.charCodeAt(O.gzindex++):0,Y(O,q)}while(q!==0);O.gzhead.hcrc&&O.pending>R&&(A.adler=d(A.adler,O.pending_buf,O.pending-R,R)),q===0&&(O.status=103)}else O.status=103;if(O.status===103&&(O.gzhead.hcrc?(O.pending+2>O.pending_buf_size&&X(A),O.pending+2<=O.pending_buf_size&&(Y(O,255&A.adler),Y(O,A.adler>>8&255),A.adler=0,O.status=D)):O.status=D),O.pending!==0){if(X(A),A.avail_out===0)return O.last_flush=-1,m}else if(A.avail_in===0&&H(le)<=H(ne)&&le!==p)return Q(A,-5);if(O.status===666&&A.avail_in!==0)return Q(A,-5);if(A.avail_in!==0||O.lookahead!==0||le!==f&&O.status!==666){var de=O.strategy===2?function(te,G){for(var ue;;){if(te.lookahead===0&&(fe(te),te.lookahead===0)){if(G===f)return _;break}if(te.match_length=0,ue=o._tr_tally(te,0,te.window[te.strstart]),te.lookahead--,te.strstart++,ue&&(U(te,!1),te.strm.avail_out===0))return _}return te.insert=0,G===p?(U(te,!0),te.strm.avail_out===0?J:W):te.last_lit&&(U(te,!1),te.strm.avail_out===0)?_:K}(O,le):O.strategy===3?function(te,G){for(var ue,Z,re,xe,be=te.window;;){if(te.lookahead<=L){if(fe(te),te.lookahead<=L&&G===f)return _;if(te.lookahead===0)break}if(te.match_length=0,te.lookahead>=M&&0<te.strstart&&(Z=be[re=te.strstart-1])===be[++re]&&Z===be[++re]&&Z===be[++re]){xe=te.strstart+L;do;while(Z===be[++re]&&Z===be[++re]&&Z===be[++re]&&Z===be[++re]&&Z===be[++re]&&Z===be[++re]&&Z===be[++re]&&Z===be[++re]&&re<xe);te.match_length=L-(xe-re),te.match_length>te.lookahead&&(te.match_length=te.lookahead)}if(te.match_length>=M?(ue=o._tr_tally(te,1,te.match_length-M),te.lookahead-=te.match_length,te.strstart+=te.match_length,te.match_length=0):(ue=o._tr_tally(te,0,te.window[te.strstart]),te.lookahead--,te.strstart++),ue&&(U(te,!1),te.strm.avail_out===0))return _}return te.insert=0,G===p?(U(te,!0),te.strm.avail_out===0?J:W):te.last_lit&&(U(te,!1),te.strm.avail_out===0)?_:K}(O,le):i[O.level].func(O,le);if(de!==J&&de!==W||(O.status=666),de===_||de===J)return A.avail_out===0&&(O.last_flush=-1),m;if(de===K&&(le===1?o._tr_align(O):le!==5&&(o._tr_stored_block(O,0,0,!1),le===3&&(oe(O.head),O.lookahead===0&&(O.strstart=0,O.block_start=0,O.insert=0))),X(A),A.avail_out===0))return O.last_flush=-1,m}return le!==p?m:O.wrap<=0?1:(O.wrap===2?(Y(O,255&A.adler),Y(O,A.adler>>8&255),Y(O,A.adler>>16&255),Y(O,A.adler>>24&255),Y(O,255&A.total_in),Y(O,A.total_in>>8&255),Y(O,A.total_in>>16&255),Y(O,A.total_in>>24&255)):(V(O,A.adler>>>16),V(O,65535&A.adler)),X(A),0<O.wrap&&(O.wrap=-O.wrap),O.pending!==0?m:1)},r.deflateEnd=function(A){var le;return A&&A.state?(le=A.state.status)!==E&&le!==69&&le!==73&&le!==91&&le!==103&&le!==D&&le!==666?Q(A,b):(A.state=null,le===D?Q(A,-3):m):b},r.deflateSetDictionary=function(A,le){var ne,O,R,q,ae,de,te,G,ue=le.length;if(!A||!A.state||(q=(ne=A.state).wrap)===2||q===1&&ne.status!==E||ne.lookahead)return b;for(q===1&&(A.adler=l(A.adler,le,ue,0)),ne.wrap=0,ue>=ne.w_size&&(q===0&&(oe(ne.head),ne.strstart=0,ne.block_start=0,ne.insert=0),G=new a.Buf8(ne.w_size),a.arraySet(G,le,ue-ne.w_size,ne.w_size,0),le=G,ue=ne.w_size),ae=A.avail_in,de=A.next_in,te=A.input,A.avail_in=ue,A.next_in=0,A.input=le,fe(ne);ne.lookahead>=M;){for(O=ne.strstart,R=ne.lookahead-(M-1);ne.ins_h=(ne.ins_h<<ne.hash_shift^ne.window[O+M-1])&ne.hash_mask,ne.prev[O&ne.w_mask]=ne.head[ne.ins_h],ne.head[ne.ins_h]=O,O++,--R;);ne.strstart=O,ne.lookahead=M-1,fe(ne)}return ne.strstart+=ne.lookahead,ne.block_start=ne.strstart,ne.insert=ne.lookahead,ne.lookahead=0,ne.match_length=ne.prev_length=M-1,ne.match_available=0,A.next_in=de,A.input=te,A.avail_in=ae,ne.wrap=q,m},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,n,r){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,n,r){n.exports=function(i,a){var o,l,d,h,f,p,m,b,x,v,g,y,w,k,C,P,N,I,M,L,$,E,D,_,K;o=i.state,l=i.next_in,_=i.input,d=l+(i.avail_in-5),h=i.next_out,K=i.output,f=h-(a-i.avail_out),p=h+(i.avail_out-257),m=o.dmax,b=o.wsize,x=o.whave,v=o.wnext,g=o.window,y=o.hold,w=o.bits,k=o.lencode,C=o.distcode,P=(1<<o.lenbits)-1,N=(1<<o.distbits)-1;e:do{w<15&&(y+=_[l++]<<w,w+=8,y+=_[l++]<<w,w+=8),I=k[y&P];t:for(;;){if(y>>>=M=I>>>24,w-=M,(M=I>>>16&255)===0)K[h++]=65535&I;else{if(!(16&M)){if(!(64&M)){I=k[(65535&I)+(y&(1<<M)-1)];continue t}if(32&M){o.mode=12;break e}i.msg="invalid literal/length code",o.mode=30;break e}L=65535&I,(M&=15)&&(w<M&&(y+=_[l++]<<w,w+=8),L+=y&(1<<M)-1,y>>>=M,w-=M),w<15&&(y+=_[l++]<<w,w+=8,y+=_[l++]<<w,w+=8),I=C[y&N];s:for(;;){if(y>>>=M=I>>>24,w-=M,!(16&(M=I>>>16&255))){if(!(64&M)){I=C[(65535&I)+(y&(1<<M)-1)];continue s}i.msg="invalid distance code",o.mode=30;break e}if($=65535&I,w<(M&=15)&&(y+=_[l++]<<w,(w+=8)<M&&(y+=_[l++]<<w,w+=8)),m<($+=y&(1<<M)-1)){i.msg="invalid distance too far back",o.mode=30;break e}if(y>>>=M,w-=M,(M=h-f)<$){if(x<(M=$-M)&&o.sane){i.msg="invalid distance too far back",o.mode=30;break e}if(D=g,(E=0)===v){if(E+=b-M,M<L){for(L-=M;K[h++]=g[E++],--M;);E=h-$,D=K}}else if(v<M){if(E+=b+v-M,(M-=v)<L){for(L-=M;K[h++]=g[E++],--M;);if(E=0,v<L){for(L-=M=v;K[h++]=g[E++],--M;);E=h-$,D=K}}}else if(E+=v-M,M<L){for(L-=M;K[h++]=g[E++],--M;);E=h-$,D=K}for(;2<L;)K[h++]=D[E++],K[h++]=D[E++],K[h++]=D[E++],L-=3;L&&(K[h++]=D[E++],1<L&&(K[h++]=D[E++]))}else{for(E=h-$;K[h++]=K[E++],K[h++]=K[E++],K[h++]=K[E++],2<(L-=3););L&&(K[h++]=K[E++],1<L&&(K[h++]=K[E++]))}break}}break}}while(l<d&&h<p);l-=L=w>>3,y&=(1<<(w-=L<<3))-1,i.next_in=l,i.next_out=h,i.avail_in=l<d?d-l+5:5-(l-d),i.avail_out=h<p?p-h+257:257-(h-p),o.hold=y,o.bits=w}},{}],49:[function(t,n,r){var i=t("../utils/common"),a=t("./adler32"),o=t("./crc32"),l=t("./inffast"),d=t("./inftrees"),h=1,f=2,p=0,m=-2,b=1,x=852,v=592;function g(E){return(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24)}function y(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(E){var D;return E&&E.state?(D=E.state,E.total_in=E.total_out=D.total=0,E.msg="",D.wrap&&(E.adler=1&D.wrap),D.mode=b,D.last=0,D.havedict=0,D.dmax=32768,D.head=null,D.hold=0,D.bits=0,D.lencode=D.lendyn=new i.Buf32(x),D.distcode=D.distdyn=new i.Buf32(v),D.sane=1,D.back=-1,p):m}function k(E){var D;return E&&E.state?((D=E.state).wsize=0,D.whave=0,D.wnext=0,w(E)):m}function C(E,D){var _,K;return E&&E.state?(K=E.state,D<0?(_=0,D=-D):(_=1+(D>>4),D<48&&(D&=15)),D&&(D<8||15<D)?m:(K.window!==null&&K.wbits!==D&&(K.window=null),K.wrap=_,K.wbits=D,k(E))):m}function P(E,D){var _,K;return E?(K=new y,(E.state=K).window=null,(_=C(E,D))!==p&&(E.state=null),_):m}var N,I,M=!0;function L(E){if(M){var D;for(N=new i.Buf32(512),I=new i.Buf32(32),D=0;D<144;)E.lens[D++]=8;for(;D<256;)E.lens[D++]=9;for(;D<280;)E.lens[D++]=7;for(;D<288;)E.lens[D++]=8;for(d(h,E.lens,0,288,N,0,E.work,{bits:9}),D=0;D<32;)E.lens[D++]=5;d(f,E.lens,0,32,I,0,E.work,{bits:5}),M=!1}E.lencode=N,E.lenbits=9,E.distcode=I,E.distbits=5}function $(E,D,_,K){var J,W=E.state;return W.window===null&&(W.wsize=1<<W.wbits,W.wnext=0,W.whave=0,W.window=new i.Buf8(W.wsize)),K>=W.wsize?(i.arraySet(W.window,D,_-W.wsize,W.wsize,0),W.wnext=0,W.whave=W.wsize):(K<(J=W.wsize-W.wnext)&&(J=K),i.arraySet(W.window,D,_-K,J,W.wnext),(K-=J)?(i.arraySet(W.window,D,_-K,K,0),W.wnext=K,W.whave=W.wsize):(W.wnext+=J,W.wnext===W.wsize&&(W.wnext=0),W.whave<W.wsize&&(W.whave+=J))),0}r.inflateReset=k,r.inflateReset2=C,r.inflateResetKeep=w,r.inflateInit=function(E){return P(E,15)},r.inflateInit2=P,r.inflate=function(E,D){var _,K,J,W,Q,H,oe,X,U,Y,V,ee,fe,se,ve,ce,Re,Ge,Ht,pt,A,le,ne,O,R=0,q=new i.Buf8(4),ae=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!E||!E.state||!E.output||!E.input&&E.avail_in!==0)return m;(_=E.state).mode===12&&(_.mode=13),Q=E.next_out,J=E.output,oe=E.avail_out,W=E.next_in,K=E.input,H=E.avail_in,X=_.hold,U=_.bits,Y=H,V=oe,le=p;e:for(;;)switch(_.mode){case b:if(_.wrap===0){_.mode=13;break}for(;U<16;){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}if(2&_.wrap&&X===35615){q[_.check=0]=255&X,q[1]=X>>>8&255,_.check=o(_.check,q,2,0),U=X=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&X)<<8)+(X>>8))%31){E.msg="incorrect header check",_.mode=30;break}if((15&X)!=8){E.msg="unknown compression method",_.mode=30;break}if(U-=4,A=8+(15&(X>>>=4)),_.wbits===0)_.wbits=A;else if(A>_.wbits){E.msg="invalid window size",_.mode=30;break}_.dmax=1<<A,E.adler=_.check=1,_.mode=512&X?10:12,U=X=0;break;case 2:for(;U<16;){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}if(_.flags=X,(255&_.flags)!=8){E.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){E.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=X>>8&1),512&_.flags&&(q[0]=255&X,q[1]=X>>>8&255,_.check=o(_.check,q,2,0)),U=X=0,_.mode=3;case 3:for(;U<32;){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}_.head&&(_.head.time=X),512&_.flags&&(q[0]=255&X,q[1]=X>>>8&255,q[2]=X>>>16&255,q[3]=X>>>24&255,_.check=o(_.check,q,4,0)),U=X=0,_.mode=4;case 4:for(;U<16;){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}_.head&&(_.head.xflags=255&X,_.head.os=X>>8),512&_.flags&&(q[0]=255&X,q[1]=X>>>8&255,_.check=o(_.check,q,2,0)),U=X=0,_.mode=5;case 5:if(1024&_.flags){for(;U<16;){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}_.length=X,_.head&&(_.head.extra_len=X),512&_.flags&&(q[0]=255&X,q[1]=X>>>8&255,_.check=o(_.check,q,2,0)),U=X=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(H<(ee=_.length)&&(ee=H),ee&&(_.head&&(A=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),i.arraySet(_.head.extra,K,W,ee,A)),512&_.flags&&(_.check=o(_.check,K,ee,W)),H-=ee,W+=ee,_.length-=ee),_.length))break e;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(H===0)break e;for(ee=0;A=K[W+ee++],_.head&&A&&_.length<65536&&(_.head.name+=String.fromCharCode(A)),A&&ee<H;);if(512&_.flags&&(_.check=o(_.check,K,ee,W)),H-=ee,W+=ee,A)break e}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(H===0)break e;for(ee=0;A=K[W+ee++],_.head&&A&&_.length<65536&&(_.head.comment+=String.fromCharCode(A)),A&&ee<H;);if(512&_.flags&&(_.check=o(_.check,K,ee,W)),H-=ee,W+=ee,A)break e}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;U<16;){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}if(X!==(65535&_.check)){E.msg="header crc mismatch",_.mode=30;break}U=X=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),E.adler=_.check=0,_.mode=12;break;case 10:for(;U<32;){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}E.adler=_.check=g(X),U=X=0,_.mode=11;case 11:if(_.havedict===0)return E.next_out=Q,E.avail_out=oe,E.next_in=W,E.avail_in=H,_.hold=X,_.bits=U,2;E.adler=_.check=1,_.mode=12;case 12:if(D===5||D===6)break e;case 13:if(_.last){X>>>=7&U,U-=7&U,_.mode=27;break}for(;U<3;){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}switch(_.last=1&X,U-=1,3&(X>>>=1)){case 0:_.mode=14;break;case 1:if(L(_),_.mode=20,D!==6)break;X>>>=2,U-=2;break e;case 2:_.mode=17;break;case 3:E.msg="invalid block type",_.mode=30}X>>>=2,U-=2;break;case 14:for(X>>>=7&U,U-=7&U;U<32;){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}if((65535&X)!=(X>>>16^65535)){E.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&X,U=X=0,_.mode=15,D===6)break e;case 15:_.mode=16;case 16:if(ee=_.length){if(H<ee&&(ee=H),oe<ee&&(ee=oe),ee===0)break e;i.arraySet(J,K,W,ee,Q),H-=ee,W+=ee,oe-=ee,Q+=ee,_.length-=ee;break}_.mode=12;break;case 17:for(;U<14;){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}if(_.nlen=257+(31&X),X>>>=5,U-=5,_.ndist=1+(31&X),X>>>=5,U-=5,_.ncode=4+(15&X),X>>>=4,U-=4,286<_.nlen||30<_.ndist){E.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;U<3;){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}_.lens[ae[_.have++]]=7&X,X>>>=3,U-=3}for(;_.have<19;)_.lens[ae[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,ne={bits:_.lenbits},le=d(0,_.lens,0,19,_.lencode,0,_.work,ne),_.lenbits=ne.bits,le){E.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;ce=(R=_.lencode[X&(1<<_.lenbits)-1])>>>16&255,Re=65535&R,!((ve=R>>>24)<=U);){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}if(Re<16)X>>>=ve,U-=ve,_.lens[_.have++]=Re;else{if(Re===16){for(O=ve+2;U<O;){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}if(X>>>=ve,U-=ve,_.have===0){E.msg="invalid bit length repeat",_.mode=30;break}A=_.lens[_.have-1],ee=3+(3&X),X>>>=2,U-=2}else if(Re===17){for(O=ve+3;U<O;){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}U-=ve,A=0,ee=3+(7&(X>>>=ve)),X>>>=3,U-=3}else{for(O=ve+7;U<O;){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}U-=ve,A=0,ee=11+(127&(X>>>=ve)),X>>>=7,U-=7}if(_.have+ee>_.nlen+_.ndist){E.msg="invalid bit length repeat",_.mode=30;break}for(;ee--;)_.lens[_.have++]=A}}if(_.mode===30)break;if(_.lens[256]===0){E.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,ne={bits:_.lenbits},le=d(h,_.lens,0,_.nlen,_.lencode,0,_.work,ne),_.lenbits=ne.bits,le){E.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,ne={bits:_.distbits},le=d(f,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,ne),_.distbits=ne.bits,le){E.msg="invalid distances set",_.mode=30;break}if(_.mode=20,D===6)break e;case 20:_.mode=21;case 21:if(6<=H&&258<=oe){E.next_out=Q,E.avail_out=oe,E.next_in=W,E.avail_in=H,_.hold=X,_.bits=U,l(E,V),Q=E.next_out,J=E.output,oe=E.avail_out,W=E.next_in,K=E.input,H=E.avail_in,X=_.hold,U=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;ce=(R=_.lencode[X&(1<<_.lenbits)-1])>>>16&255,Re=65535&R,!((ve=R>>>24)<=U);){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}if(ce&&!(240&ce)){for(Ge=ve,Ht=ce,pt=Re;ce=(R=_.lencode[pt+((X&(1<<Ge+Ht)-1)>>Ge)])>>>16&255,Re=65535&R,!(Ge+(ve=R>>>24)<=U);){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}X>>>=Ge,U-=Ge,_.back+=Ge}if(X>>>=ve,U-=ve,_.back+=ve,_.length=Re,ce===0){_.mode=26;break}if(32&ce){_.back=-1,_.mode=12;break}if(64&ce){E.msg="invalid literal/length code",_.mode=30;break}_.extra=15&ce,_.mode=22;case 22:if(_.extra){for(O=_.extra;U<O;){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}_.length+=X&(1<<_.extra)-1,X>>>=_.extra,U-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;ce=(R=_.distcode[X&(1<<_.distbits)-1])>>>16&255,Re=65535&R,!((ve=R>>>24)<=U);){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}if(!(240&ce)){for(Ge=ve,Ht=ce,pt=Re;ce=(R=_.distcode[pt+((X&(1<<Ge+Ht)-1)>>Ge)])>>>16&255,Re=65535&R,!(Ge+(ve=R>>>24)<=U);){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}X>>>=Ge,U-=Ge,_.back+=Ge}if(X>>>=ve,U-=ve,_.back+=ve,64&ce){E.msg="invalid distance code",_.mode=30;break}_.offset=Re,_.extra=15&ce,_.mode=24;case 24:if(_.extra){for(O=_.extra;U<O;){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}_.offset+=X&(1<<_.extra)-1,X>>>=_.extra,U-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){E.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(oe===0)break e;if(ee=V-oe,_.offset>ee){if((ee=_.offset-ee)>_.whave&&_.sane){E.msg="invalid distance too far back",_.mode=30;break}fe=ee>_.wnext?(ee-=_.wnext,_.wsize-ee):_.wnext-ee,ee>_.length&&(ee=_.length),se=_.window}else se=J,fe=Q-_.offset,ee=_.length;for(oe<ee&&(ee=oe),oe-=ee,_.length-=ee;J[Q++]=se[fe++],--ee;);_.length===0&&(_.mode=21);break;case 26:if(oe===0)break e;J[Q++]=_.length,oe--,_.mode=21;break;case 27:if(_.wrap){for(;U<32;){if(H===0)break e;H--,X|=K[W++]<<U,U+=8}if(V-=oe,E.total_out+=V,_.total+=V,V&&(E.adler=_.check=_.flags?o(_.check,J,V,Q-V):a(_.check,J,V,Q-V)),V=oe,(_.flags?X:g(X))!==_.check){E.msg="incorrect data check",_.mode=30;break}U=X=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;U<32;){if(H===0)break e;H--,X+=K[W++]<<U,U+=8}if(X!==(4294967295&_.total)){E.msg="incorrect length check",_.mode=30;break}U=X=0}_.mode=29;case 29:le=1;break e;case 30:le=-3;break e;case 31:return-4;case 32:default:return m}return E.next_out=Q,E.avail_out=oe,E.next_in=W,E.avail_in=H,_.hold=X,_.bits=U,(_.wsize||V!==E.avail_out&&_.mode<30&&(_.mode<27||D!==4))&&$(E,E.output,E.next_out,V-E.avail_out)?(_.mode=31,-4):(Y-=E.avail_in,V-=E.avail_out,E.total_in+=Y,E.total_out+=V,_.total+=V,_.wrap&&V&&(E.adler=_.check=_.flags?o(_.check,J,V,E.next_out-V):a(_.check,J,V,E.next_out-V)),E.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(Y==0&&V===0||D===4)&&le===p&&(le=-5),le)},r.inflateEnd=function(E){if(!E||!E.state)return m;var D=E.state;return D.window&&(D.window=null),E.state=null,p},r.inflateGetHeader=function(E,D){var _;return E&&E.state&&2&(_=E.state).wrap?((_.head=D).done=!1,p):m},r.inflateSetDictionary=function(E,D){var _,K=D.length;return E&&E.state?(_=E.state).wrap!==0&&_.mode!==11?m:_.mode===11&&a(1,D,K,0)!==_.check?-3:$(E,D,K,K)?(_.mode=31,-4):(_.havedict=1,p):m},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,n,r){var i=t("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(h,f,p,m,b,x,v,g){var y,w,k,C,P,N,I,M,L,$=g.bits,E=0,D=0,_=0,K=0,J=0,W=0,Q=0,H=0,oe=0,X=0,U=null,Y=0,V=new i.Buf16(16),ee=new i.Buf16(16),fe=null,se=0;for(E=0;E<=15;E++)V[E]=0;for(D=0;D<m;D++)V[f[p+D]]++;for(J=$,K=15;1<=K&&V[K]===0;K--);if(K<J&&(J=K),K===0)return b[x++]=20971520,b[x++]=20971520,g.bits=1,0;for(_=1;_<K&&V[_]===0;_++);for(J<_&&(J=_),E=H=1;E<=15;E++)if(H<<=1,(H-=V[E])<0)return-1;if(0<H&&(h===0||K!==1))return-1;for(ee[1]=0,E=1;E<15;E++)ee[E+1]=ee[E]+V[E];for(D=0;D<m;D++)f[p+D]!==0&&(v[ee[f[p+D]]++]=D);if(N=h===0?(U=fe=v,19):h===1?(U=a,Y-=257,fe=o,se-=257,256):(U=l,fe=d,-1),E=_,P=x,Q=D=X=0,k=-1,C=(oe=1<<(W=J))-1,h===1&&852<oe||h===2&&592<oe)return 1;for(;;){for(I=E-Q,L=v[D]<N?(M=0,v[D]):v[D]>N?(M=fe[se+v[D]],U[Y+v[D]]):(M=96,0),y=1<<E-Q,_=w=1<<W;b[P+(X>>Q)+(w-=y)]=I<<24|M<<16|L|0,w!==0;);for(y=1<<E-1;X&y;)y>>=1;if(y!==0?(X&=y-1,X+=y):X=0,D++,--V[E]==0){if(E===K)break;E=f[p+v[D]]}if(J<E&&(X&C)!==k){for(Q===0&&(Q=J),P+=_,H=1<<(W=E-Q);W+Q<K&&!((H-=V[W+Q])<=0);)W++,H<<=1;if(oe+=1<<W,h===1&&852<oe||h===2&&592<oe)return 1;b[k=X&C]=J<<24|W<<16|P-x|0}}return X!==0&&(b[P+X]=E-Q<<24|64<<16|0),g.bits=J,0}},{"../utils/common":41}],51:[function(t,n,r){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,n,r){var i=t("../utils/common"),a=0,o=1;function l(R){for(var q=R.length;0<=--q;)R[q]=0}var d=0,h=29,f=256,p=f+1+h,m=30,b=19,x=2*p+1,v=15,g=16,y=7,w=256,k=16,C=17,P=18,N=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],I=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=new Array(2*(p+2));l($);var E=new Array(2*m);l(E);var D=new Array(512);l(D);var _=new Array(256);l(_);var K=new Array(h);l(K);var J,W,Q,H=new Array(m);function oe(R,q,ae,de,te){this.static_tree=R,this.extra_bits=q,this.extra_base=ae,this.elems=de,this.max_length=te,this.has_stree=R&&R.length}function X(R,q){this.dyn_tree=R,this.max_code=0,this.stat_desc=q}function U(R){return R<256?D[R]:D[256+(R>>>7)]}function Y(R,q){R.pending_buf[R.pending++]=255&q,R.pending_buf[R.pending++]=q>>>8&255}function V(R,q,ae){R.bi_valid>g-ae?(R.bi_buf|=q<<R.bi_valid&65535,Y(R,R.bi_buf),R.bi_buf=q>>g-R.bi_valid,R.bi_valid+=ae-g):(R.bi_buf|=q<<R.bi_valid&65535,R.bi_valid+=ae)}function ee(R,q,ae){V(R,ae[2*q],ae[2*q+1])}function fe(R,q){for(var ae=0;ae|=1&R,R>>>=1,ae<<=1,0<--q;);return ae>>>1}function se(R,q,ae){var de,te,G=new Array(v+1),ue=0;for(de=1;de<=v;de++)G[de]=ue=ue+ae[de-1]<<1;for(te=0;te<=q;te++){var Z=R[2*te+1];Z!==0&&(R[2*te]=fe(G[Z]++,Z))}}function ve(R){var q;for(q=0;q<p;q++)R.dyn_ltree[2*q]=0;for(q=0;q<m;q++)R.dyn_dtree[2*q]=0;for(q=0;q<b;q++)R.bl_tree[2*q]=0;R.dyn_ltree[2*w]=1,R.opt_len=R.static_len=0,R.last_lit=R.matches=0}function ce(R){8<R.bi_valid?Y(R,R.bi_buf):0<R.bi_valid&&(R.pending_buf[R.pending++]=R.bi_buf),R.bi_buf=0,R.bi_valid=0}function Re(R,q,ae,de){var te=2*q,G=2*ae;return R[te]<R[G]||R[te]===R[G]&&de[q]<=de[ae]}function Ge(R,q,ae){for(var de=R.heap[ae],te=ae<<1;te<=R.heap_len&&(te<R.heap_len&&Re(q,R.heap[te+1],R.heap[te],R.depth)&&te++,!Re(q,de,R.heap[te],R.depth));)R.heap[ae]=R.heap[te],ae=te,te<<=1;R.heap[ae]=de}function Ht(R,q,ae){var de,te,G,ue,Z=0;if(R.last_lit!==0)for(;de=R.pending_buf[R.d_buf+2*Z]<<8|R.pending_buf[R.d_buf+2*Z+1],te=R.pending_buf[R.l_buf+Z],Z++,de===0?ee(R,te,q):(ee(R,(G=_[te])+f+1,q),(ue=N[G])!==0&&V(R,te-=K[G],ue),ee(R,G=U(--de),ae),(ue=I[G])!==0&&V(R,de-=H[G],ue)),Z<R.last_lit;);ee(R,w,q)}function pt(R,q){var ae,de,te,G=q.dyn_tree,ue=q.stat_desc.static_tree,Z=q.stat_desc.has_stree,re=q.stat_desc.elems,xe=-1;for(R.heap_len=0,R.heap_max=x,ae=0;ae<re;ae++)G[2*ae]!==0?(R.heap[++R.heap_len]=xe=ae,R.depth[ae]=0):G[2*ae+1]=0;for(;R.heap_len<2;)G[2*(te=R.heap[++R.heap_len]=xe<2?++xe:0)]=1,R.depth[te]=0,R.opt_len--,Z&&(R.static_len-=ue[2*te+1]);for(q.max_code=xe,ae=R.heap_len>>1;1<=ae;ae--)Ge(R,G,ae);for(te=re;ae=R.heap[1],R.heap[1]=R.heap[R.heap_len--],Ge(R,G,1),de=R.heap[1],R.heap[--R.heap_max]=ae,R.heap[--R.heap_max]=de,G[2*te]=G[2*ae]+G[2*de],R.depth[te]=(R.depth[ae]>=R.depth[de]?R.depth[ae]:R.depth[de])+1,G[2*ae+1]=G[2*de+1]=te,R.heap[1]=te++,Ge(R,G,1),2<=R.heap_len;);R.heap[--R.heap_max]=R.heap[1],function(be,Ze){var $s,Ft,us,Oe,nt,lr,hs=Ze.dyn_tree,Bs=Ze.max_code,ho=Ze.stat_desc.static_tree,cr=Ze.stat_desc.has_stree,mt=Ze.stat_desc.extra_bits,Ye=Ze.stat_desc.extra_base,_t=Ze.stat_desc.max_length,Ct=0;for(Oe=0;Oe<=v;Oe++)be.bl_count[Oe]=0;for(hs[2*be.heap[be.heap_max]+1]=0,$s=be.heap_max+1;$s<x;$s++)_t<(Oe=hs[2*hs[2*(Ft=be.heap[$s])+1]+1]+1)&&(Oe=_t,Ct++),hs[2*Ft+1]=Oe,Bs<Ft||(be.bl_count[Oe]++,nt=0,Ye<=Ft&&(nt=mt[Ft-Ye]),lr=hs[2*Ft],be.opt_len+=lr*(Oe+nt),cr&&(be.static_len+=lr*(ho[2*Ft+1]+nt)));if(Ct!==0){do{for(Oe=_t-1;be.bl_count[Oe]===0;)Oe--;be.bl_count[Oe]--,be.bl_count[Oe+1]+=2,be.bl_count[_t]--,Ct-=2}while(0<Ct);for(Oe=_t;Oe!==0;Oe--)for(Ft=be.bl_count[Oe];Ft!==0;)Bs<(us=be.heap[--$s])||(hs[2*us+1]!==Oe&&(be.opt_len+=(Oe-hs[2*us+1])*hs[2*us],hs[2*us+1]=Oe),Ft--)}}(R,q),se(G,xe,R.bl_count)}function A(R,q,ae){var de,te,G=-1,ue=q[1],Z=0,re=7,xe=4;for(ue===0&&(re=138,xe=3),q[2*(ae+1)+1]=65535,de=0;de<=ae;de++)te=ue,ue=q[2*(de+1)+1],++Z<re&&te===ue||(Z<xe?R.bl_tree[2*te]+=Z:te!==0?(te!==G&&R.bl_tree[2*te]++,R.bl_tree[2*k]++):Z<=10?R.bl_tree[2*C]++:R.bl_tree[2*P]++,G=te,xe=(Z=0)===ue?(re=138,3):te===ue?(re=6,3):(re=7,4))}function le(R,q,ae){var de,te,G=-1,ue=q[1],Z=0,re=7,xe=4;for(ue===0&&(re=138,xe=3),de=0;de<=ae;de++)if(te=ue,ue=q[2*(de+1)+1],!(++Z<re&&te===ue)){if(Z<xe)for(;ee(R,te,R.bl_tree),--Z!=0;);else te!==0?(te!==G&&(ee(R,te,R.bl_tree),Z--),ee(R,k,R.bl_tree),V(R,Z-3,2)):Z<=10?(ee(R,C,R.bl_tree),V(R,Z-3,3)):(ee(R,P,R.bl_tree),V(R,Z-11,7));G=te,xe=(Z=0)===ue?(re=138,3):te===ue?(re=6,3):(re=7,4)}}l(H);var ne=!1;function O(R,q,ae,de){V(R,(d<<1)+(de?1:0),3),function(te,G,ue,Z){ce(te),Y(te,ue),Y(te,~ue),i.arraySet(te.pending_buf,te.window,G,ue,te.pending),te.pending+=ue}(R,q,ae)}r._tr_init=function(R){ne||(function(){var q,ae,de,te,G,ue=new Array(v+1);for(te=de=0;te<h-1;te++)for(K[te]=de,q=0;q<1<<N[te];q++)_[de++]=te;for(_[de-1]=te,te=G=0;te<16;te++)for(H[te]=G,q=0;q<1<<I[te];q++)D[G++]=te;for(G>>=7;te<m;te++)for(H[te]=G<<7,q=0;q<1<<I[te]-7;q++)D[256+G++]=te;for(ae=0;ae<=v;ae++)ue[ae]=0;for(q=0;q<=143;)$[2*q+1]=8,q++,ue[8]++;for(;q<=255;)$[2*q+1]=9,q++,ue[9]++;for(;q<=279;)$[2*q+1]=7,q++,ue[7]++;for(;q<=287;)$[2*q+1]=8,q++,ue[8]++;for(se($,p+1,ue),q=0;q<m;q++)E[2*q+1]=5,E[2*q]=fe(q,5);J=new oe($,N,f+1,p,v),W=new oe(E,I,0,m,v),Q=new oe(new Array(0),M,0,b,y)}(),ne=!0),R.l_desc=new X(R.dyn_ltree,J),R.d_desc=new X(R.dyn_dtree,W),R.bl_desc=new X(R.bl_tree,Q),R.bi_buf=0,R.bi_valid=0,ve(R)},r._tr_stored_block=O,r._tr_flush_block=function(R,q,ae,de){var te,G,ue=0;0<R.level?(R.strm.data_type===2&&(R.strm.data_type=function(Z){var re,xe=4093624447;for(re=0;re<=31;re++,xe>>>=1)if(1&xe&&Z.dyn_ltree[2*re]!==0)return a;if(Z.dyn_ltree[18]!==0||Z.dyn_ltree[20]!==0||Z.dyn_ltree[26]!==0)return o;for(re=32;re<f;re++)if(Z.dyn_ltree[2*re]!==0)return o;return a}(R)),pt(R,R.l_desc),pt(R,R.d_desc),ue=function(Z){var re;for(A(Z,Z.dyn_ltree,Z.l_desc.max_code),A(Z,Z.dyn_dtree,Z.d_desc.max_code),pt(Z,Z.bl_desc),re=b-1;3<=re&&Z.bl_tree[2*L[re]+1]===0;re--);return Z.opt_len+=3*(re+1)+5+5+4,re}(R),te=R.opt_len+3+7>>>3,(G=R.static_len+3+7>>>3)<=te&&(te=G)):te=G=ae+5,ae+4<=te&&q!==-1?O(R,q,ae,de):R.strategy===4||G===te?(V(R,2+(de?1:0),3),Ht(R,$,E)):(V(R,4+(de?1:0),3),function(Z,re,xe,be){var Ze;for(V(Z,re-257,5),V(Z,xe-1,5),V(Z,be-4,4),Ze=0;Ze<be;Ze++)V(Z,Z.bl_tree[2*L[Ze]+1],3);le(Z,Z.dyn_ltree,re-1),le(Z,Z.dyn_dtree,xe-1)}(R,R.l_desc.max_code+1,R.d_desc.max_code+1,ue+1),Ht(R,R.dyn_ltree,R.dyn_dtree)),ve(R),de&&ce(R)},r._tr_tally=function(R,q,ae){return R.pending_buf[R.d_buf+2*R.last_lit]=q>>>8&255,R.pending_buf[R.d_buf+2*R.last_lit+1]=255&q,R.pending_buf[R.l_buf+R.last_lit]=255&ae,R.last_lit++,q===0?R.dyn_ltree[2*ae]++:(R.matches++,q--,R.dyn_ltree[2*(_[ae]+f+1)]++,R.dyn_dtree[2*U(q)]++),R.last_lit===R.lit_bufsize-1},r._tr_align=function(R){V(R,2,3),ee(R,w,$),function(q){q.bi_valid===16?(Y(q,q.bi_buf),q.bi_buf=0,q.bi_valid=0):8<=q.bi_valid&&(q.pending_buf[q.pending++]=255&q.bi_buf,q.bi_buf>>=8,q.bi_valid-=8)}(R)}},{"../utils/common":41}],53:[function(t,n,r){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,n,r){(function(i){(function(a,o){if(!a.setImmediate){var l,d,h,f,p=1,m={},b=!1,x=a.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(a);v=v&&v.setTimeout?v:a,l={}.toString.call(a.process)==="[object process]"?function(k){process.nextTick(function(){y(k)})}:function(){if(a.postMessage&&!a.importScripts){var k=!0,C=a.onmessage;return a.onmessage=function(){k=!1},a.postMessage("","*"),a.onmessage=C,k}}()?(f="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",w,!1):a.attachEvent("onmessage",w),function(k){a.postMessage(f+k,"*")}):a.MessageChannel?((h=new MessageChannel).port1.onmessage=function(k){y(k.data)},function(k){h.port2.postMessage(k)}):x&&"onreadystatechange"in x.createElement("script")?(d=x.documentElement,function(k){var C=x.createElement("script");C.onreadystatechange=function(){y(k),C.onreadystatechange=null,d.removeChild(C),C=null},d.appendChild(C)}):function(k){setTimeout(y,0,k)},v.setImmediate=function(k){typeof k!="function"&&(k=new Function(""+k));for(var C=new Array(arguments.length-1),P=0;P<C.length;P++)C[P]=arguments[P+1];var N={callback:k,args:C};return m[p]=N,l(p),p++},v.clearImmediate=g}function g(k){delete m[k]}function y(k){if(b)setTimeout(y,0,k);else{var C=m[k];if(C){b=!0;try{(function(P){var N=P.callback,I=P.args;switch(I.length){case 0:N();break;case 1:N(I[0]);break;case 2:N(I[0],I[1]);break;case 3:N(I[0],I[1],I[2]);break;default:N.apply(o,I)}})(C)}finally{g(k),b=!1}}}}function w(k){k.source===a&&typeof k.data=="string"&&k.data.indexOf(f)===0&&y(+k.data.slice(f.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof Of<"u"?Of:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(H2);var VC=H2.exports;const WC=sA(VC);var Iu={};Iu.d=(s,e)=>{for(var t in e)Iu.o(e,t)&&!Iu.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:e[t]})};Iu.o=(s,e)=>Object.prototype.hasOwnProperty.call(s,e);var Fe=globalThis.pdfjsLib={};Iu.d(Fe,{AbortException:()=>ro,AnnotationEditorLayer:()=>Ib,AnnotationEditorParamsType:()=>Ke,AnnotationEditorType:()=>Be,AnnotationEditorUIManager:()=>Fl,AnnotationLayer:()=>Bj,AnnotationMode:()=>pa,ColorPicker:()=>zm,DOMSVGFactory:()=>Jy,DrawLayer:()=>Fb,FeatureTest:()=>Qs,GlobalWorkerOptions:()=>qi,ImageKind:()=>Ep,InvalidPDFException:()=>Nx,MissingPDFException:()=>eh,OPS:()=>fr,OutputScale:()=>Tx,PDFDataRangeTransport:()=>V_,PDFDateString:()=>Ky,PDFWorker:()=>Nc,PasswordResponses:()=>YC,PermissionFlag:()=>KC,PixelsPerInch:()=>io,RenderingCancelledException:()=>qy,TextLayer:()=>th,TouchManager:()=>Fm,UnexpectedResponseException:()=>Im,Util:()=>Ce,VerbosityLevel:()=>A0,XfaLayer:()=>q_,build:()=>wj,createValidAbsoluteUrl:()=>eT,fetchData:()=>T0,getDocument:()=>hj,getFilenameFromUrl:()=>cT,getPdfFilenameFromUrl:()=>dT,getXfaPageViewport:()=>uT,isDataScheme:()=>j0,isPdfFile:()=>Xy,noContextMenu:()=>Ir,normalizeUnicode:()=>aT,setLayerDimensions:()=>Dl,shadow:()=>qe,stopEvent:()=>Ln,version:()=>vj});const Os=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),G2=[1,0,0,1,0,0],Ex=[.001,0,0,.001,0,0],qC=1e7,gg=1.35,Mn={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},pa={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},XC="pdfjs_internal_editor_",Be={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},Ke={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},KC={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Ts={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Ep={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Kt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Jd={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},A0={ERRORS:0,WARNINGS:1,INFOS:5},fr={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},YC={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let E0=A0.WARNINGS;function QC(s){Number.isInteger(s)&&(E0=s)}function ZC(){return E0}function N0(s){E0>=A0.INFOS&&console.log(`Info: ${s}`)}function Ue(s){E0>=A0.WARNINGS&&console.log(`Warning: ${s}`)}function gt(s){throw new Error(s)}function qt(s,e){s||gt(e)}function JC(s){switch(s==null?void 0:s.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function eT(s,e=null,t=null){if(!s)return null;try{if(t&&typeof s=="string"){if(t.addDefaultProtocol&&s.startsWith("www.")){const r=s.match(/\./g);(r==null?void 0:r.length)>=2&&(s=`http://${s}`)}if(t.tryConvertEncoding)try{s=iT(s)}catch{}}const n=e?new URL(s,e):new URL(s);if(JC(n))return n}catch{}return null}function qe(s,e,t,n=!1){return Object.defineProperty(s,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}const uo=function(){function e(t,n){this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e}();class M1 extends uo{constructor(e,t){super(e,"PasswordException"),this.code=t}}class xg extends uo{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class Nx extends uo{constructor(e){super(e,"InvalidPDFException")}}class eh extends uo{constructor(e){super(e,"MissingPDFException")}}class Im extends uo{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}}class tT extends uo{constructor(e){super(e,"FormatError")}}class ro extends uo{constructor(e){super(e,"AbortException")}}function V2(s){(typeof s!="object"||(s==null?void 0:s.length)===void 0)&&gt("Invalid argument for bytesToString");const e=s.length,t=8192;if(e<t)return String.fromCharCode.apply(null,s);const n=[];for(let r=0;r<e;r+=t){const i=Math.min(r+t,e),a=s.subarray(r,i);n.push(String.fromCharCode.apply(null,a))}return n.join("")}function C0(s){typeof s!="string"&&gt("Invalid argument for stringToBytes");const e=s.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=s.charCodeAt(n)&255;return t}function sT(s){return String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,s&255)}function Vy(s){const e=Object.create(null);for(const[t,n]of s)e[t]=n;return e}function nT(){const s=new Uint8Array(4);return s[0]=1,new Uint32Array(s.buffer,0,1)[0]===1}function rT(){try{return new Function(""),!0}catch{return!1}}class Qs{static get isLittleEndian(){return qe(this,"isLittleEndian",nT())}static get isEvalSupported(){return qe(this,"isEvalSupported",rT())}static get isOffscreenCanvasSupported(){return qe(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return qe(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.platform)=="string"?qe(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):qe(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var e,t;return qe(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const bg=Array.from(Array(256).keys(),s=>s.toString(16).padStart(2,"0"));var Qi,Np,Cx;class Ce{static makeHexColor(e,t,n){return`#${bg[e]}${bg[t]}${bg[n]}`}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){const n=e[0]*t[0]+e[1]*t[2]+t[4],r=e[0]*t[1]+e[1]*t[3]+t[5];return[n,r]}static applyInverseTransform(e,t){const n=t[0]*t[3]-t[1]*t[2],r=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,i=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[r,i]}static getAxialAlignedBoundingBox(e,t){const n=this.applyTransform(e,t),r=this.applyTransform(e.slice(2,4),t),i=this.applyTransform([e[0],e[3]],t),a=this.applyTransform([e[2],e[1]],t);return[Math.min(n[0],r[0],i[0],a[0]),Math.min(n[1],r[1],i[1],a[1]),Math.max(n[0],r[0],i[0],a[0]),Math.max(n[1],r[1],i[1],a[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],r=e[0]*t[1]+e[1]*t[3],i=e[2]*t[0]+e[3]*t[2],a=e[2]*t[1]+e[3]*t[3],o=(n+a)/2,l=Math.sqrt((n+a)**2-4*(n*a-i*r))/2,d=o+l||1,h=o-l||1;return[Math.sqrt(d),Math.sqrt(h)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),r=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>r)return null;const i=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return i>a?null:[n,i,r,a]}static bezierBoundingBox(e,t,n,r,i,a,o,l,d){return d?(d[0]=Math.min(d[0],e,o),d[1]=Math.min(d[1],t,l),d[2]=Math.max(d[2],e,o),d[3]=Math.max(d[3],t,l)):d=[Math.min(e,o),Math.min(t,l),Math.max(e,o),Math.max(t,l)],j(this,Qi,Cx).call(this,e,n,i,o,t,r,a,l,3*(-e+3*(n-i)+o),6*(e-2*n+i),3*(n-e),d),j(this,Qi,Cx).call(this,e,n,i,o,t,r,a,l,3*(-t+3*(r-a)+l),6*(t-2*r+a),3*(r-t),d),d}}Qi=new WeakSet,Np=function(e,t,n,r,i,a,o,l,d,h){if(d<=0||d>=1)return;const f=1-d,p=d*d,m=p*d,b=f*(f*(f*e+3*d*t)+3*p*n)+m*r,x=f*(f*(f*i+3*d*a)+3*p*o)+m*l;h[0]=Math.min(h[0],b),h[1]=Math.min(h[1],x),h[2]=Math.max(h[2],b),h[3]=Math.max(h[3],x)},Cx=function(e,t,n,r,i,a,o,l,d,h,f,p){if(Math.abs(d)<1e-12){Math.abs(h)>=1e-12&&j(this,Qi,Np).call(this,e,t,n,r,i,a,o,l,-f/h,p);return}const m=h**2-4*f*d;if(m<0)return;const b=Math.sqrt(m),x=2*d;j(this,Qi,Np).call(this,e,t,n,r,i,a,o,l,(-h+b)/x,p),j(this,Qi,Np).call(this,e,t,n,r,i,a,o,l,(-h-b)/x,p)},T(Ce,Qi);function iT(s){return decodeURIComponent(escape(s))}let yg=null,R1=null;function aT(s){return yg||(yg=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,R1=new Map([["ﬅ","ſt"]])),s.replaceAll(yg,(e,t,n)=>t?t.normalize("NFKC"):R1.get(n))}function oT(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const s=new Uint8Array(32);return crypto.getRandomValues(s),V2(s)}const Wy="pdfjs_internal_id_";function lT(s){return Uint8Array.prototype.toBase64?s.toBase64():btoa(V2(s))}typeof Promise.try!="function"&&(Promise.try=function(s,...e){return new Promise(t=>{t(s(...e))})});const pi="http://www.w3.org/2000/svg",vo=class vo{};Pe(vo,"CSS",96),Pe(vo,"PDF",72),Pe(vo,"PDF_TO_CSS_UNITS",vo.CSS/vo.PDF);let io=vo;async function T0(s,e="text"){if(ou(s,document.baseURI)){const t=await fetch(s);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{const r=new XMLHttpRequest;r.open("GET",s,!0),r.responseType=e,r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){if(r.status===200||r.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(r.response);return}t(r.responseText);return}n(new Error(r.statusText))}},r.send(null)})}class Lf{constructor({viewBox:e,userUnit:t,scale:n,rotation:r,offsetX:i=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=r,this.offsetX=i,this.offsetY=a,n*=t;const l=(e[2]+e[0])/2,d=(e[3]+e[1])/2;let h,f,p,m;switch(r%=360,r<0&&(r+=360),r){case 180:h=-1,f=0,p=0,m=1;break;case 90:h=0,f=1,p=1,m=0;break;case 270:h=0,f=-1,p=-1,m=0;break;case 0:h=1,f=0,p=0,m=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(p=-p,m=-m);let b,x,v,g;h===0?(b=Math.abs(d-e[1])*n+i,x=Math.abs(l-e[0])*n+a,v=(e[3]-e[1])*n,g=(e[2]-e[0])*n):(b=Math.abs(l-e[0])*n+i,x=Math.abs(d-e[1])*n+a,v=(e[2]-e[0])*n,g=(e[3]-e[1])*n),this.transform=[h*n,f*n,p*n,m*n,b-h*n*l-p*n*d,x-f*n*l-m*n*d],this.width=v,this.height=g}get rawDims(){const{userUnit:e,viewBox:t}=this,n=t.map(r=>r*e);return qe(this,"rawDims",{pageWidth:n[2]-n[0],pageHeight:n[3]-n[1],pageX:n[0],pageY:n[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:r=this.offsetY,dontFlip:i=!1}={}){return new Lf({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:i})}convertToViewportPoint(e,t){return Ce.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=Ce.applyTransform([e[0],e[1]],this.transform),n=Ce.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){return Ce.applyInverseTransform([e,t],this.transform)}}class qy extends uo{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function j0(s){const e=s.length;let t=0;for(;t<e&&s[t].trim()==="";)t++;return s.substring(t,t+5).toLowerCase()==="data:"}function Xy(s){return typeof s=="string"&&/\.pdf$/i.test(s)}function cT(s){return[s]=s.split(/[#?]/,1),s.substring(s.lastIndexOf("/")+1)}function dT(s,e="document.pdf"){if(typeof s!="string")return e;if(j0(s))return Ue('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,r=t.exec(s);let i=n.exec(r[1])||n.exec(r[2])||n.exec(r[3]);if(i&&(i=i[0],i.includes("%")))try{i=n.exec(decodeURIComponent(i))[0]}catch{}return i||e}class I1{constructor(){Pe(this,"started",Object.create(null));Pe(this,"times",[])}time(e){e in this.started&&Ue(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Ue(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:n}of this.times)t=Math.max(n.length,t);for(const{name:n,start:r,end:i}of this.times)e.push(`${n.padEnd(t)} ${i-r}ms
`);return e.join("")}}function ou(s,e){try{const{protocol:t}=e?new URL(s,e):new URL(s);return t==="http:"||t==="https:"}catch{return!1}}function Ir(s){s.preventDefault()}function Ln(s){s.preventDefault(),s.stopPropagation()}var nh;class Ky{static toDateObject(e){if(!e||typeof e!="string")return null;c(this,nh)||S(this,nh,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=c(this,nh).exec(e);if(!t)return null;const n=parseInt(t[1],10);let r=parseInt(t[2],10);r=r>=1&&r<=12?r-1:0;let i=parseInt(t[3],10);i=i>=1&&i<=31?i:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const d=t[7]||"Z";let h=parseInt(t[8],10);h=h>=0&&h<=23?h:0;let f=parseInt(t[9],10)||0;return f=f>=0&&f<=59?f:0,d==="-"?(a+=h,o+=f):d==="+"&&(a-=h,o-=f),new Date(Date.UTC(n,r,i,a,o,l))}}nh=new WeakMap,T(Ky,nh);function uT(s,{scale:e=1,rotation:t=0}){const{width:n,height:r}=s.attributes.style,i=[0,0,parseInt(n),parseInt(r)];return new Lf({viewBox:i,userUnit:1,scale:e,rotation:t})}function Yy(s){if(s.startsWith("#")){const e=parseInt(s.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return s.startsWith("rgb(")?s.slice(4,-1).split(",").map(e=>parseInt(e)):s.startsWith("rgba(")?s.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Ue(`Not a valid color format: "${s}"`),[0,0,0])}function hT(s){const e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(const t of s.keys()){e.style.color=t;const n=window.getComputedStyle(e).color;s.set(t,Yy(n))}e.remove()}function At(s){const{a:e,b:t,c:n,d:r,e:i,f:a}=s.getTransform();return[e,t,n,r,i,a]}function zr(s){const{a:e,b:t,c:n,d:r,e:i,f:a}=s.getTransform().invertSelf();return[e,t,n,r,i,a]}function Dl(s,e,t=!1,n=!0){if(e instanceof Lf){const{pageWidth:r,pageHeight:i}=e.rawDims,{style:a}=s,o=Qs.isCSSRoundSupported,l=`var(--scale-factor) * ${r}px`,d=`var(--scale-factor) * ${i}px`,h=o?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,f=o?`round(down, ${d}, var(--scale-round-y, 1px))`:`calc(${d})`;!t||e.rotation%180===0?(a.width=h,a.height=f):(a.width=f,a.height=h)}n&&s.setAttribute("data-main-rotation",e.rotation)}class Tx{constructor(){const e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}}var ma,Ao,pr,Eo,rh,ih,Um,W2,Zs,q2,X2,Cp,K2,Px;const yi=class yi{constructor(e){T(this,Zs);T(this,ma,null);T(this,Ao,null);T(this,pr);T(this,Eo,null);T(this,rh,null);S(this,pr,e),c(yi,ih)||S(yi,ih,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){const e=S(this,ma,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=c(this,pr)._uiManager._signal;e.addEventListener("contextmenu",Ir,{signal:t}),e.addEventListener("pointerdown",j(yi,Um,W2),{signal:t});const n=S(this,Eo,document.createElement("div"));n.className="buttons",e.append(n);const r=c(this,pr).toolbarPosition;if(r){const{style:i}=e,a=c(this,pr)._uiManager.direction==="ltr"?1-r[0]:r[0];i.insetInlineEnd=`${100*a}%`,i.top=`calc(${100*r[1]}% + var(--editor-toolbar-vert-offset))`}return j(this,Zs,K2).call(this),e}get div(){return c(this,ma)}hide(){var e;c(this,ma).classList.add("hidden"),(e=c(this,Ao))==null||e.hideDropdown()}show(){var e;c(this,ma).classList.remove("hidden"),(e=c(this,rh))==null||e.shown()}async addAltText(e){const t=await e.render();j(this,Zs,Cp).call(this,t),c(this,Eo).prepend(t,c(this,Zs,Px)),S(this,rh,e)}addColorPicker(e){S(this,Ao,e);const t=e.renderButton();j(this,Zs,Cp).call(this,t),c(this,Eo).prepend(t,c(this,Zs,Px))}remove(){var e;c(this,ma).remove(),(e=c(this,Ao))==null||e.destroy(),S(this,Ao,null)}};ma=new WeakMap,Ao=new WeakMap,pr=new WeakMap,Eo=new WeakMap,rh=new WeakMap,ih=new WeakMap,Um=new WeakSet,W2=function(e){e.stopPropagation()},Zs=new WeakSet,q2=function(e){c(this,pr)._focusEventsAllowed=!1,Ln(e)},X2=function(e){c(this,pr)._focusEventsAllowed=!0,Ln(e)},Cp=function(e){const t=c(this,pr)._uiManager._signal;e.addEventListener("focusin",j(this,Zs,q2).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",j(this,Zs,X2).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Ir,{signal:t})},K2=function(){const{editorType:e,_uiManager:t}=c(this,pr),n=document.createElement("button");n.className="delete",n.tabIndex=0,n.setAttribute("data-l10n-id",c(yi,ih)[e]),j(this,Zs,Cp).call(this,n),n.addEventListener("click",r=>{t.delete()},{signal:t._signal}),c(this,Eo).append(n)},Px=function(){const e=document.createElement("div");return e.className="divider",e},T(yi,Um),T(yi,ih,null);let jx=yi;var ah,No,Co,ao,Y2,Q2,Z2;class fT{constructor(e){T(this,ao);T(this,ah,null);T(this,No,null);T(this,Co);S(this,Co,e)}show(e,t,n){const[r,i]=j(this,ao,Q2).call(this,t,n),{style:a}=c(this,No)||S(this,No,j(this,ao,Y2).call(this));e.append(c(this,No)),a.insetInlineEnd=`${100*r}%`,a.top=`calc(${100*i}% + var(--editor-toolbar-vert-offset))`}hide(){c(this,No).remove()}}ah=new WeakMap,No=new WeakMap,Co=new WeakMap,ao=new WeakSet,Y2=function(){const e=S(this,No,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",Ir,{signal:c(this,Co)._signal});const t=S(this,ah,document.createElement("div"));return t.className="buttons",e.append(t),j(this,ao,Z2).call(this),e},Q2=function(e,t){let n=0,r=0;for(const i of e){const a=i.y+i.height;if(a<n)continue;const o=i.x+(t?i.width:0);if(a>n){r=o,n=a;continue}t?o>r&&(r=o):o<r&&(r=o)}return[t?1-r:r,n]},Z2=function(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const n=c(this,Co)._signal;e.addEventListener("contextmenu",Ir,{signal:n}),e.addEventListener("click",()=>{c(this,Co).highlightSelection("floating_button")},{signal:n}),c(this,ah).append(e)};function Lm(s,e,t){for(const n of t)e.addEventListener(n,s[n].bind(s))}var Hm;class pT{constructor(){T(this,Hm,0)}get id(){return`${XC}${Us(this,Hm)._++}`}}Hm=new WeakMap;var Cc,oh,Ms,Tc,Tp;const tv=class tv{constructor(){T(this,Tc);T(this,Cc,oT());T(this,oh,0);T(this,Ms,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),r=new Image;r.src=e;const i=r.decode().then(()=>(n.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return qe(this,"_isSVGFittingCanvas",i)}async getFromFile(e){const{lastModified:t,name:n,size:r,type:i}=e;return j(this,Tc,Tp).call(this,`${t}_${n}_${r}_${i}`,e)}async getFromUrl(e){return j(this,Tc,Tp).call(this,e,e)}async getFromBlob(e,t){const n=await t;return j(this,Tc,Tp).call(this,e,n)}async getFromId(e){c(this,Ms)||S(this,Ms,new Map);const t=c(this,Ms).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:n}=t;return delete t.blobPromise,this.getFromBlob(t.id,n)}return this.getFromUrl(t.url)}getFromCanvas(e,t){c(this,Ms)||S(this,Ms,new Map);let n=c(this,Ms).get(e);if(n!=null&&n.bitmap)return n.refCounter+=1,n;const r=new OffscreenCanvas(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),n={bitmap:r.transferToImageBitmap(),id:`image_${c(this,Cc)}_${Us(this,oh)._++}`,refCounter:1,isSvg:!1},c(this,Ms).set(e,n),c(this,Ms).set(n.id,n),n}getSvgUrl(e){const t=c(this,Ms).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var r;c(this,Ms)||S(this,Ms,new Map);const t=c(this,Ms).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:n}=t;if(!t.url&&!t.file){const i=new OffscreenCanvas(n.width,n.height);i.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=i.convertToBlob()}(r=n.close)==null||r.call(n),t.bitmap=null}isValidId(e){return e.startsWith(`image_${c(this,Cc)}_`)}};Cc=new WeakMap,oh=new WeakMap,Ms=new WeakMap,Tc=new WeakSet,Tp=async function(e,t){c(this,Ms)||S(this,Ms,new Map);let n=c(this,Ms).get(e);if(n===null)return null;if(n!=null&&n.bitmap)return n.refCounter+=1,n;try{n||(n={bitmap:null,id:`image_${c(this,Cc)}_${Us(this,oh)._++}`,refCounter:0,isSvg:!1});let r;if(typeof t=="string"?(n.url=t,r=await T0(t,"blob")):t instanceof File?r=n.file=t:t instanceof Blob&&(r=t),r.type==="image/svg+xml"){const i=tv._isSVGFittingCanvas,a=new FileReader,o=new Image,l=new Promise((d,h)=>{o.onload=()=>{n.bitmap=o,n.isSvg=!0,d()},a.onload=async()=>{const f=n.svgUrl=a.result;o.src=await i?`${f}#svgView(preserveAspectRatio(none))`:f},o.onerror=a.onerror=h});a.readAsDataURL(r),await l}else n.bitmap=await createImageBitmap(r);n.refCounter=1}catch(r){Ue(r),n=null}return c(this,Ms).set(e,n),n&&c(this,Ms).set(n.id,n),n};let Mx=tv;var zt,ga,lh,Tt;class mT{constructor(e=128){T(this,zt,[]);T(this,ga,!1);T(this,lh);T(this,Tt,-1);S(this,lh,e)}add({cmd:e,undo:t,post:n,mustExec:r,type:i=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(r&&e(),c(this,ga))return;const l={cmd:e,undo:t,post:n,type:i};if(c(this,Tt)===-1){c(this,zt).length>0&&(c(this,zt).length=0),S(this,Tt,0),c(this,zt).push(l);return}if(a&&c(this,zt)[c(this,Tt)].type===i){o&&(l.undo=c(this,zt)[c(this,Tt)].undo),c(this,zt)[c(this,Tt)]=l;return}const d=c(this,Tt)+1;d===c(this,lh)?c(this,zt).splice(0,1):(S(this,Tt,d),d<c(this,zt).length&&c(this,zt).splice(d)),c(this,zt).push(l)}undo(){if(c(this,Tt)===-1)return;S(this,ga,!0);const{undo:e,post:t}=c(this,zt)[c(this,Tt)];e(),t==null||t(),S(this,ga,!1),S(this,Tt,c(this,Tt)-1)}redo(){if(c(this,Tt)<c(this,zt).length-1){S(this,Tt,c(this,Tt)+1),S(this,ga,!0);const{cmd:e,post:t}=c(this,zt)[c(this,Tt)];e(),t==null||t(),S(this,ga,!1)}}hasSomethingToUndo(){return c(this,Tt)!==-1}hasSomethingToRedo(){return c(this,Tt)<c(this,zt).length-1}cleanType(e){if(c(this,Tt)!==-1){for(let t=c(this,Tt);t>=0;t--)if(c(this,zt)[t].type!==e){c(this,zt).splice(t+1,c(this,Tt)-t),S(this,Tt,t);return}c(this,zt).length=0,S(this,Tt,-1)}}destroy(){S(this,zt,null)}}zt=new WeakMap,ga=new WeakMap,lh=new WeakMap,Tt=new WeakMap;var Gm,J2;class Df{constructor(e){T(this,Gm);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Qs.platform;for(const[n,r,i={}]of e)for(const a of n){const o=a.startsWith("mac+");t&&o?(this.callbacks.set(a.slice(4),{callback:r,options:i}),this.allKeys.add(a.split("+").at(-1))):!t&&!o&&(this.callbacks.set(a,{callback:r,options:i}),this.allKeys.add(a.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const n=this.callbacks.get(j(this,Gm,J2).call(this,t));if(!n)return;const{callback:r,options:{bubbles:i=!1,args:a=[],checker:o=null}}=n;o&&!o(e,t)||(r.bind(e,...a,t)(),i||Ln(t))}}Gm=new WeakSet,J2=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const Vm=class Vm{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return hT(e),qe(this,"_colors",e)}convert(e){const t=Yy(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[n,r]of this._colors)if(r.every((i,a)=>i===t[a]))return Vm._colorsMapping.get(n);return t}getHexCode(e){const t=this._colors.get(e);return t?Ce.makeHexColor(...t):e}};Pe(Vm,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let Rx=Vm;var jc,vn,Qt,ms,Pc,ki,Mc,Vn,xa,To,Rc,jo,Hr,mr,Po,ch,dh,Ic,uh,Gr,ba,Lc,ya,Vr,Wm,va,hh,wa,Mo,fh,ph,ns,ot,_i,Ro,mh,gh,ka,Wr,Si,xh,Wn,ye,jp,Ix,e_,t_,Pp,s_,n_,r_,Lx,i_,Dx,Fx,a_,Gs,mi,o_,l_,Ox,c_,lu,zx;const bc=class bc{constructor(e,t,n,r,i,a,o,l,d,h,f,p,m){T(this,ye);T(this,jc,new AbortController);T(this,vn,null);T(this,Qt,new Map);T(this,ms,new Map);T(this,Pc,null);T(this,ki,null);T(this,Mc,null);T(this,Vn,new mT);T(this,xa,null);T(this,To,null);T(this,Rc,0);T(this,jo,new Set);T(this,Hr,null);T(this,mr,null);T(this,Po,new Set);Pe(this,"_editorUndoBar",null);T(this,ch,!1);T(this,dh,!1);T(this,Ic,!1);T(this,uh,null);T(this,Gr,null);T(this,ba,null);T(this,Lc,null);T(this,ya,!1);T(this,Vr,null);T(this,Wm,new pT);T(this,va,!1);T(this,hh,!1);T(this,wa,null);T(this,Mo,null);T(this,fh,null);T(this,ph,null);T(this,ns,Be.NONE);T(this,ot,new Set);T(this,_i,null);T(this,Ro,null);T(this,mh,null);T(this,gh,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});T(this,ka,[0,0]);T(this,Wr,null);T(this,Si,null);T(this,xh,null);T(this,Wn,null);const b=this._signal=c(this,jc).signal;S(this,Si,e),S(this,xh,t),S(this,Pc,n),this._eventBus=r,r._on("editingaction",this.onEditingAction.bind(this),{signal:b}),r._on("pagechanging",this.onPageChanging.bind(this),{signal:b}),r._on("scalechanging",this.onScaleChanging.bind(this),{signal:b}),r._on("rotationchanging",this.onRotationChanging.bind(this),{signal:b}),r._on("setpreference",this.onSetPreference.bind(this),{signal:b}),r._on("switchannotationeditorparams",x=>this.updateParams(x.type,x.value),{signal:b}),j(this,ye,s_).call(this),j(this,ye,a_).call(this),j(this,ye,Lx).call(this),S(this,ki,i.annotationStorage),S(this,uh,i.filterFactory),S(this,Ro,a),S(this,Lc,o||null),S(this,ch,l),S(this,dh,d),S(this,Ic,h),S(this,ph,f||null),this.viewParameters={realScale:io.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=p||null,this._supportsPinchToZoom=m!==!1}static get _keyboardManager(){const e=bc.prototype,t=a=>c(a,Si).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),n=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},r=this.TRANSLATE_SMALL,i=this.TRANSLATE_BIG;return qe(this,"_keyboardManager",new Df([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&c(a,Si).contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&c(a,Si).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}]]))}destroy(){var e,t,n,r,i;(e=c(this,Wn))==null||e.resolve(),S(this,Wn,null),(t=c(this,jc))==null||t.abort(),S(this,jc,null),this._signal=null;for(const a of c(this,ms).values())a.destroy();c(this,ms).clear(),c(this,Qt).clear(),c(this,Po).clear(),S(this,vn,null),c(this,ot).clear(),c(this,Vn).destroy(),(n=c(this,Pc))==null||n.destroy(),(r=c(this,Vr))==null||r.hide(),S(this,Vr,null),c(this,Gr)&&(clearTimeout(c(this,Gr)),S(this,Gr,null)),c(this,Wr)&&(clearTimeout(c(this,Wr)),S(this,Wr,null)),(i=this._editorUndoBar)==null||i.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return c(this,ph)}get useNewAltTextFlow(){return c(this,dh)}get useNewAltTextWhenAddingImage(){return c(this,Ic)}get hcmFilter(){return qe(this,"hcmFilter",c(this,Ro)?c(this,uh).addHCMFilter(c(this,Ro).foreground,c(this,Ro).background):"none")}get direction(){return qe(this,"direction",getComputedStyle(c(this,Si)).direction)}get highlightColors(){return qe(this,"highlightColors",c(this,Lc)?new Map(c(this,Lc).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return qe(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),S(this,To,e)}setMainHighlightColorPicker(e){S(this,fh,e)}editAltText(e,t=!1){var n;(n=c(this,Pc))==null||n.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":S(this,Ic,t);break}}onPageChanging({pageNumber:e}){S(this,Rc,e-1)}focusMainContainer(){c(this,Si).focus()}findParent(e,t){for(const n of c(this,ms).values()){const{x:r,y:i,width:a,height:o}=n.div.getBoundingClientRect();if(e>=r&&e<=r+a&&t>=i&&t<=i+o)return n}return null}disableUserSelect(e=!1){c(this,xh).classList.toggle("noUserSelect",e)}addShouldRescale(e){c(this,Po).add(e)}removeShouldRescale(e){c(this,Po).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*io.PDF_TO_CSS_UNITS;for(const n of c(this,Po))n.onScaleChanging();(t=c(this,To))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:a}=t,o=t.toString(),d=j(this,ye,jp).call(this,t).closest(".textLayer"),h=this.getSelectionBoxes(d);if(!h)return;t.empty();const f=j(this,ye,Ix).call(this,d),p=c(this,ns)===Be.NONE,m=()=>{f==null||f.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:h,anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:a,text:o}),p&&this.showAllEditors("highlight",!0,!0)};if(p){this.switchToMode(Be.HIGHLIGHT,m);return}m()}addToAnnotationStorage(e){!e.isEmpty()&&c(this,ki)&&!c(this,ki).has(e.id)&&c(this,ki).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,c(this,ya)&&(S(this,ya,!1),j(this,ye,Pp).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of c(this,ot))if(t.div.contains(e)){S(this,Mo,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!c(this,Mo))return;const[e,t]=c(this,Mo);S(this,Mo,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){j(this,ye,Lx).call(this),j(this,ye,Dx).call(this)}removeEditListeners(){j(this,ye,i_).call(this),j(this,ye,Fx).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const n of c(this,mr))if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const n of c(this,mr))if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var n;if(e.preventDefault(),(n=c(this,vn))==null||n.commitOrRemove(),!this.hasSelection)return;const t=[];for(const r of c(this,ot)){const i=r.serialize(!0);i&&t.push(i)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const i of t.items)for(const a of c(this,mr))if(a.isHandlingMimeForPasting(i.type)){a.paste(i,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(i){Ue(`paste: "${i.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const r=this.currentLayer;try{const i=[];for(const l of n){const d=await r.deserialize(l);if(!d)return;i.push(d)}const a=()=>{for(const l of i)j(this,ye,Ox).call(this,l);j(this,ye,zx).call(this,i)},o=()=>{for(const l of i)l.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(i){Ue(`paste: "${i.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),c(this,ns)!==Be.NONE&&!this.isEditorHandlingKeyboard&&bc._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,c(this,ya)&&(S(this,ya,!1),j(this,ye,Pp).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(j(this,ye,n_).call(this),j(this,ye,Dx).call(this),j(this,ye,Gs).call(this,{isEditing:c(this,ns)!==Be.NONE,isEmpty:j(this,ye,lu).call(this),hasSomethingToUndo:c(this,Vn).hasSomethingToUndo(),hasSomethingToRedo:c(this,Vn).hasSomethingToRedo(),hasSelectedEditor:!1})):(j(this,ye,r_).call(this),j(this,ye,Fx).call(this),j(this,ye,Gs).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!c(this,mr)){S(this,mr,e);for(const t of c(this,mr))j(this,ye,mi).call(this,t.defaultPropertiesToUpdate)}}getId(){return c(this,Wm).id}get currentLayer(){return c(this,ms).get(c(this,Rc))}getLayer(e){return c(this,ms).get(e)}get currentPageIndex(){return c(this,Rc)}addLayer(e){c(this,ms).set(e.pageIndex,e),c(this,va)?e.enable():e.disable()}removeLayer(e){c(this,ms).delete(e.pageIndex)}async updateMode(e,t=null,n=!1){var r;if(c(this,ns)!==e&&!(c(this,Wn)&&(await c(this,Wn).promise,!c(this,Wn)))){if(S(this,Wn,Promise.withResolvers()),S(this,ns,e),e===Be.NONE){this.setEditingState(!1),j(this,ye,l_).call(this),(r=this._editorUndoBar)==null||r.hide(),c(this,Wn).resolve();return}this.setEditingState(!0),await j(this,ye,o_).call(this),this.unselectAll();for(const i of c(this,ms).values())i.updateMode(e);if(!t){n&&this.addNewEditorFromKeyboard(),c(this,Wn).resolve();return}for(const i of c(this,Qt).values())i.annotationElementId===t?(this.setSelected(i),i.enterInEditMode()):i.unselect();c(this,Wn).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==c(this,ns)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){var n;if(c(this,mr)){switch(e){case Ke.CREATE:this.currentLayer.addNewEditor();return;case Ke.HIGHLIGHT_DEFAULT_COLOR:(n=c(this,fh))==null||n.updateColor(t);break;case Ke.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(c(this,mh)||S(this,mh,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(const r of c(this,ot))r.updateParams(e,t);for(const r of c(this,mr))r.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){var i;for(const a of c(this,Qt).values())a.editorType===e&&a.show(t);(((i=c(this,mh))==null?void 0:i.get(Ke.HIGHLIGHT_SHOW_ALL))??!0)!==t&&j(this,ye,mi).call(this,[[Ke.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(c(this,hh)!==e){S(this,hh,e);for(const t of c(this,ms).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const n of c(this,Qt).values())n.pageIndex===e&&t.push(n);return t}getEditor(e){return c(this,Qt).get(e)}addEditor(e){c(this,Qt).set(e.id,e)}removeEditor(e){var t;e.div.contains(document.activeElement)&&(c(this,Gr)&&clearTimeout(c(this,Gr)),S(this,Gr,setTimeout(()=>{this.focusMainContainer(),S(this,Gr,null)},0))),c(this,Qt).delete(e.id),this.unselect(e),(!e.annotationElementId||!c(this,jo).has(e.annotationElementId))&&((t=c(this,ki))==null||t.remove(e.id))}addDeletedAnnotationElement(e){c(this,jo).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return c(this,jo).has(e)}removeDeletedAnnotationElement(e){c(this,jo).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){c(this,vn)!==e&&(S(this,vn,e),e&&j(this,ye,mi).call(this,e.propertiesToUpdate))}updateUI(e){c(this,ye,c_)===e&&j(this,ye,mi).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){j(this,ye,mi).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(c(this,ot).has(e)){c(this,ot).delete(e),e.unselect(),j(this,ye,Gs).call(this,{hasSelectedEditor:this.hasSelection});return}c(this,ot).add(e),e.select(),j(this,ye,mi).call(this,e.propertiesToUpdate),j(this,ye,Gs).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;(t=c(this,To))==null||t.commitOrRemove();for(const n of c(this,ot))n!==e&&n.unselect();c(this,ot).clear(),c(this,ot).add(e),e.select(),j(this,ye,mi).call(this,e.propertiesToUpdate),j(this,ye,Gs).call(this,{hasSelectedEditor:!0})}isSelected(e){return c(this,ot).has(e)}get firstSelectedEditor(){return c(this,ot).values().next().value}unselect(e){e.unselect(),c(this,ot).delete(e),j(this,ye,Gs).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return c(this,ot).size!==0}get isEnterHandled(){return c(this,ot).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;c(this,Vn).undo(),j(this,ye,Gs).call(this,{hasSomethingToUndo:c(this,Vn).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:j(this,ye,lu).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){c(this,Vn).redo(),j(this,ye,Gs).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:c(this,Vn).hasSomethingToRedo(),isEmpty:j(this,ye,lu).call(this)})}addCommands(e){c(this,Vn).add(e),j(this,ye,Gs).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:j(this,ye,lu).call(this)})}cleanUndoStack(e){c(this,Vn).cleanType(e)}delete(){var i;this.commitOrRemove();const e=(i=this.currentLayer)==null?void 0:i.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...c(this,ot)],n=()=>{var a;(a=this._editorUndoBar)==null||a.show(r,t.length===1?t[0].editorType:t.length);for(const o of t)o.remove()},r=()=>{for(const a of t)j(this,ye,Ox).call(this,a)};this.addCommands({cmd:n,undo:r,mustExec:!0})}commitOrRemove(){var e;(e=c(this,vn))==null||e.commitOrRemove()}hasSomethingToControl(){return c(this,vn)||this.hasSelection}selectAll(){for(const e of c(this,ot))e.commit();j(this,ye,zx).call(this,c(this,Qt).values())}unselectAll(){var e;if(!(c(this,vn)&&(c(this,vn).commitOrRemove(),c(this,ns)!==Be.NONE))&&!((e=c(this,To))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of c(this,ot))t.unselect();c(this,ot).clear(),j(this,ye,Gs).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;c(this,ka)[0]+=e,c(this,ka)[1]+=t;const[r,i]=c(this,ka),a=[...c(this,ot)],o=1e3;c(this,Wr)&&clearTimeout(c(this,Wr)),S(this,Wr,setTimeout(()=>{S(this,Wr,null),c(this,ka)[0]=c(this,ka)[1]=0,this.addCommands({cmd:()=>{for(const l of a)c(this,Qt).has(l.id)&&l.translateInPage(r,i)},undo:()=>{for(const l of a)c(this,Qt).has(l.id)&&l.translateInPage(-r,-i)},mustExec:!1})},o));for(const l of a)l.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),S(this,Hr,new Map);for(const e of c(this,ot))c(this,Hr).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!c(this,Hr))return!1;this.disableUserSelect(!1);const e=c(this,Hr);S(this,Hr,null);let t=!1;for(const[{x:r,y:i,pageIndex:a},o]of e)o.newX=r,o.newY=i,o.newPageIndex=a,t||(t=r!==o.savedX||i!==o.savedY||a!==o.savedPageIndex);if(!t)return!1;const n=(r,i,a,o)=>{if(c(this,Qt).has(r.id)){const l=c(this,ms).get(o);l?r._setParentAndPosition(l,i,a):(r.pageIndex=o,r.x=i,r.y=a)}};return this.addCommands({cmd:()=>{for(const[r,{newX:i,newY:a,newPageIndex:o}]of e)n(r,i,a,o)},undo:()=>{for(const[r,{savedX:i,savedY:a,savedPageIndex:o}]of e)n(r,i,a,o)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(c(this,Hr))for(const n of c(this,Hr).keys())n.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||c(this,ot).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return c(this,vn)===e}getActive(){return c(this,vn)}getMode(){return c(this,ns)}get imageManager(){return qe(this,"imageManager",new Mx)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let d=0,h=t.rangeCount;d<h;d++)if(!e.contains(t.getRangeAt(d).commonAncestorContainer))return null;const{x:n,y:r,width:i,height:a}=e.getBoundingClientRect();let o;switch(e.getAttribute("data-main-rotation")){case"90":o=(d,h,f,p)=>({x:(h-r)/a,y:1-(d+f-n)/i,width:p/a,height:f/i});break;case"180":o=(d,h,f,p)=>({x:1-(d+f-n)/i,y:1-(h+p-r)/a,width:f/i,height:p/a});break;case"270":o=(d,h,f,p)=>({x:1-(h+p-r)/a,y:(d-n)/i,width:p/a,height:f/i});break;default:o=(d,h,f,p)=>({x:(d-n)/i,y:(h-r)/a,width:f/i,height:p/a});break}const l=[];for(let d=0,h=t.rangeCount;d<h;d++){const f=t.getRangeAt(d);if(!f.collapsed)for(const{x:p,y:m,width:b,height:x}of f.getClientRects())b===0||x===0||l.push(o(p,m,b,x))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(c(this,Mc)||S(this,Mc,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=c(this,Mc))==null||t.delete(e)}renderAnnotationElement(e){var r;const t=(r=c(this,Mc))==null?void 0:r.get(e.data.id);if(!t)return;const n=c(this,ki).getRawValue(t);n&&(c(this,ns)===Be.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}};jc=new WeakMap,vn=new WeakMap,Qt=new WeakMap,ms=new WeakMap,Pc=new WeakMap,ki=new WeakMap,Mc=new WeakMap,Vn=new WeakMap,xa=new WeakMap,To=new WeakMap,Rc=new WeakMap,jo=new WeakMap,Hr=new WeakMap,mr=new WeakMap,Po=new WeakMap,ch=new WeakMap,dh=new WeakMap,Ic=new WeakMap,uh=new WeakMap,Gr=new WeakMap,ba=new WeakMap,Lc=new WeakMap,ya=new WeakMap,Vr=new WeakMap,Wm=new WeakMap,va=new WeakMap,hh=new WeakMap,wa=new WeakMap,Mo=new WeakMap,fh=new WeakMap,ph=new WeakMap,ns=new WeakMap,ot=new WeakMap,_i=new WeakMap,Ro=new WeakMap,mh=new WeakMap,gh=new WeakMap,ka=new WeakMap,Wr=new WeakMap,Si=new WeakMap,xh=new WeakMap,Wn=new WeakMap,ye=new WeakSet,jp=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},Ix=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const n of c(this,ms).values())if(n.hasTextLayer(e))return n;return null},e_=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const n=j(this,ye,jp).call(this,e).closest(".textLayer"),r=this.getSelectionBoxes(n);r&&(c(this,Vr)||S(this,Vr,new fT(this)),c(this,Vr).show(n,r,this.direction==="ltr"))},t_=function(){var i,a,o;const e=document.getSelection();if(!e||e.isCollapsed){c(this,_i)&&((i=c(this,Vr))==null||i.hide(),S(this,_i,null),j(this,ye,Gs).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===c(this,_i))return;const r=j(this,ye,jp).call(this,e).closest(".textLayer");if(!r){c(this,_i)&&((a=c(this,Vr))==null||a.hide(),S(this,_i,null),j(this,ye,Gs).call(this,{hasSelectedText:!1}));return}if((o=c(this,Vr))==null||o.hide(),S(this,_i,t),j(this,ye,Gs).call(this,{hasSelectedText:!0}),!(c(this,ns)!==Be.HIGHLIGHT&&c(this,ns)!==Be.NONE)&&(c(this,ns)===Be.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),S(this,ya,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=c(this,ns)===Be.HIGHLIGHT?j(this,ye,Ix).call(this,r):null;l==null||l.toggleDrawing();const d=new AbortController,h=this.combinedSignal(d),f=p=>{p.type==="pointerup"&&p.button!==0||(d.abort(),l==null||l.toggleDrawing(!0),p.type==="pointerup"&&j(this,ye,Pp).call(this,"main_toolbar"))};window.addEventListener("pointerup",f,{signal:h}),window.addEventListener("blur",f,{signal:h})}},Pp=function(e=""){c(this,ns)===Be.HIGHLIGHT?this.highlightSelection(e):c(this,ch)&&j(this,ye,e_).call(this)},s_=function(){document.addEventListener("selectionchange",j(this,ye,t_).bind(this),{signal:this._signal})},n_=function(){if(c(this,ba))return;S(this,ba,new AbortController);const e=this.combinedSignal(c(this,ba));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},r_=function(){var e;(e=c(this,ba))==null||e.abort(),S(this,ba,null)},Lx=function(){if(c(this,wa))return;S(this,wa,new AbortController);const e=this.combinedSignal(c(this,wa));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},i_=function(){var e;(e=c(this,wa))==null||e.abort(),S(this,wa,null)},Dx=function(){if(c(this,xa))return;S(this,xa,new AbortController);const e=this.combinedSignal(c(this,xa));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},Fx=function(){var e;(e=c(this,xa))==null||e.abort(),S(this,xa,null)},a_=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Gs=function(e){Object.entries(e).some(([n,r])=>c(this,gh)[n]!==r)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(c(this,gh),e)}),c(this,ns)===Be.HIGHLIGHT&&e.hasSelectedEditor===!1&&j(this,ye,mi).call(this,[[Ke.HIGHLIGHT_FREE,!0]]))},mi=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},o_=async function(){if(!c(this,va)){S(this,va,!0);const e=[];for(const t of c(this,ms).values())e.push(t.enable());await Promise.all(e);for(const t of c(this,Qt).values())t.enable()}},l_=function(){if(this.unselectAll(),c(this,va)){S(this,va,!1);for(const e of c(this,ms).values())e.disable();for(const e of c(this,Qt).values())e.disable()}},Ox=function(e){const t=c(this,ms).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},c_=function(){let e=null;for(e of c(this,ot));return e},lu=function(){if(c(this,Qt).size===0)return!0;if(c(this,Qt).size===1)for(const e of c(this,Qt).values())return e.isEmpty();return!1},zx=function(e){for(const t of c(this,ot))t.unselect();c(this,ot).clear();for(const t of e)t.isEmpty()||(c(this,ot).add(t),t.select());j(this,ye,Gs).call(this,{hasSelectedEditor:this.hasSelection})},Pe(bc,"TRANSLATE_SMALL",1),Pe(bc,"TRANSLATE_BIG",10);let Fl=bc;var rs,qr,gr,Dc,Xr,wn,Fc,Kr,ln,Ai,Io,Yr,_a,jr,cu,Mp;const Vs=class Vs{constructor(e){T(this,jr);T(this,rs,null);T(this,qr,!1);T(this,gr,null);T(this,Dc,null);T(this,Xr,null);T(this,wn,null);T(this,Fc,!1);T(this,Kr,null);T(this,ln,null);T(this,Ai,null);T(this,Io,null);T(this,Yr,!1);S(this,ln,e),S(this,Yr,e._uiManager.useNewAltTextFlow),c(Vs,_a)||S(Vs,_a,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){Vs._l10n??(Vs._l10n=e)}async render(){const e=S(this,gr,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=S(this,Dc,document.createElement("span"));e.append(t),c(this,Yr)?(e.classList.add("new"),e.setAttribute("data-l10n-id",c(Vs,_a).missing),t.setAttribute("data-l10n-id",c(Vs,_a)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=c(this,ln)._uiManager._signal;e.addEventListener("contextmenu",Ir,{signal:n}),e.addEventListener("pointerdown",i=>i.stopPropagation(),{signal:n});const r=i=>{i.preventDefault(),c(this,ln)._uiManager.editAltText(c(this,ln)),c(this,Yr)&&c(this,ln)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:c(this,jr,cu)}})};return e.addEventListener("click",r,{capture:!0,signal:n}),e.addEventListener("keydown",i=>{i.target===e&&i.key==="Enter"&&(S(this,Fc,!0),r(i))},{signal:n}),await j(this,jr,Mp).call(this),e}finish(){c(this,gr)&&(c(this,gr).focus({focusVisible:c(this,Fc)}),S(this,Fc,!1))}isEmpty(){return c(this,Yr)?c(this,rs)===null:!c(this,rs)&&!c(this,qr)}hasData(){return c(this,Yr)?c(this,rs)!==null||!!c(this,Ai):this.isEmpty()}get guessedText(){return c(this,Ai)}async setGuessedText(e){c(this,rs)===null&&(S(this,Ai,e),S(this,Io,await Vs._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),j(this,jr,Mp).call(this))}toggleAltTextBadge(e=!1){var t;if(!c(this,Yr)||c(this,rs)){(t=c(this,Kr))==null||t.remove(),S(this,Kr,null);return}if(!c(this,Kr)){const n=S(this,Kr,document.createElement("div"));n.className="noAltTextBadge",c(this,ln).div.append(n)}c(this,Kr).classList.toggle("hidden",!e)}serialize(e){let t=c(this,rs);return!e&&c(this,Ai)===t&&(t=c(this,Io)),{altText:t,decorative:c(this,qr),guessedText:c(this,Ai),textWithDisclaimer:c(this,Io)}}get data(){return{altText:c(this,rs),decorative:c(this,qr)}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:r,cancel:i=!1}){n&&(S(this,Ai,n),S(this,Io,r)),!(c(this,rs)===e&&c(this,qr)===t)&&(i||(S(this,rs,e),S(this,qr,t)),j(this,jr,Mp).call(this))}toggle(e=!1){c(this,gr)&&(!e&&c(this,wn)&&(clearTimeout(c(this,wn)),S(this,wn,null)),c(this,gr).disabled=!e)}shown(){c(this,ln)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:c(this,jr,cu)}})}destroy(){var e,t;(e=c(this,gr))==null||e.remove(),S(this,gr,null),S(this,Dc,null),S(this,Xr,null),(t=c(this,Kr))==null||t.remove(),S(this,Kr,null)}};rs=new WeakMap,qr=new WeakMap,gr=new WeakMap,Dc=new WeakMap,Xr=new WeakMap,wn=new WeakMap,Fc=new WeakMap,Kr=new WeakMap,ln=new WeakMap,Ai=new WeakMap,Io=new WeakMap,Yr=new WeakMap,_a=new WeakMap,jr=new WeakSet,cu=function(){return c(this,rs)&&"added"||c(this,rs)===null&&this.guessedText&&"review"||"missing"},Mp=async function(){var r,i,a;const e=c(this,gr);if(!e)return;if(c(this,Yr)){if(e.classList.toggle("done",!!c(this,rs)),e.setAttribute("data-l10n-id",c(Vs,_a)[c(this,jr,cu)]),(r=c(this,Dc))==null||r.setAttribute("data-l10n-id",c(Vs,_a)[`${c(this,jr,cu)}-label`]),!c(this,rs)){(i=c(this,Xr))==null||i.remove();return}}else{if(!c(this,rs)&&!c(this,qr)){e.classList.remove("done"),(a=c(this,Xr))==null||a.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=c(this,Xr);if(!t){S(this,Xr,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${c(this,ln).id}`;const o=100,l=c(this,ln)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(c(this,wn)),S(this,wn,null)},{once:!0}),e.addEventListener("mouseenter",()=>{S(this,wn,setTimeout(()=>{S(this,wn,null),c(this,Xr).classList.add("show"),c(this,ln)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:l}),e.addEventListener("mouseleave",()=>{var d;c(this,wn)&&(clearTimeout(c(this,wn)),S(this,wn,null)),(d=c(this,Xr))==null||d.classList.remove("show")},{signal:l})}c(this,qr)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=c(this,rs)),t.parentNode||e.append(t);const n=c(this,ln).getImageForAltText();n==null||n.setAttribute("aria-describedby",t.id)},T(Vs,_a,null),Pe(Vs,"_l10n",null);let Dm=Vs;var bh,Lo,yh,vh,wh,kh,_h,Oc,Ei,Do,Sa,na,d_,u_,$x;const sv=class sv{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:r=null,onPinching:i=null,onPinchEnd:a=null,signal:o}){T(this,na);T(this,bh);T(this,Lo,!1);T(this,yh,null);T(this,vh);T(this,wh);T(this,kh);T(this,_h);T(this,Oc);T(this,Ei,null);T(this,Do);T(this,Sa,null);S(this,bh,e),S(this,yh,n),S(this,vh,t),S(this,wh,r),S(this,kh,i),S(this,_h,a),S(this,Do,new AbortController),S(this,Oc,AbortSignal.any([o,c(this,Do).signal])),e.addEventListener("touchstart",j(this,na,d_).bind(this),{passive:!1,signal:c(this,Oc)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return qe(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){var e;(e=c(this,Do))==null||e.abort(),S(this,Do,null)}};bh=new WeakMap,Lo=new WeakMap,yh=new WeakMap,vh=new WeakMap,wh=new WeakMap,kh=new WeakMap,_h=new WeakMap,Oc=new WeakMap,Ei=new WeakMap,Do=new WeakMap,Sa=new WeakMap,na=new WeakSet,d_=function(e){var r,i,a;if((r=c(this,vh))!=null&&r.call(this)||e.touches.length<2)return;if(!c(this,Sa)){S(this,Sa,new AbortController);const o=AbortSignal.any([c(this,Oc),c(this,Sa).signal]),l=c(this,bh),d={signal:o,passive:!1};l.addEventListener("touchmove",j(this,na,u_).bind(this),d),l.addEventListener("touchend",j(this,na,$x).bind(this),d),l.addEventListener("touchcancel",j(this,na,$x).bind(this),d),(i=c(this,wh))==null||i.call(this)}if(Ln(e),e.touches.length!==2||(a=c(this,yh))!=null&&a.call(this)){S(this,Ei,null);return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),S(this,Ei,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY})},u_=function(e){var k;if(!c(this,Ei)||e.touches.length!==2)return;let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);const{screenX:r,screenY:i}=t,{screenX:a,screenY:o}=n,l=c(this,Ei),{touch0X:d,touch0Y:h,touch1X:f,touch1Y:p}=l,m=f-d,b=p-h,x=a-r,v=o-i,g=Math.hypot(x,v)||1,y=Math.hypot(m,b)||1;if(!c(this,Lo)&&Math.abs(y-g)<=sv.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=r,l.touch0Y=i,l.touch1X=a,l.touch1Y=o,e.preventDefault(),!c(this,Lo)){S(this,Lo,!0);return}const w=[(r+a)/2,(i+o)/2];(k=c(this,kh))==null||k.call(this,w,y,g)},$x=function(e){var t;c(this,Sa).abort(),S(this,Sa,null),(t=c(this,_h))==null||t.call(this),c(this,Ei)&&(e.preventDefault(),S(this,Ei,null),S(this,Lo,!1))};let Fm=sv;var Fo,xr,wt,zc,Aa,Sh,Oo,gs,zo,Ni,Ea,Ah,$o,kn,Eh,Bo,Ci,Qr,$c,Bc,qn,Uo,Nh,qm,Me,Bx,Ch,Ux,Rp,h_,f_,Hx,Ip,Gx,p_,m_,g_,Vx,x_,Wx,b_,y_,v_,qx,du;const He=class He{constructor(e){T(this,Me);T(this,Fo,null);T(this,xr,null);T(this,wt,null);T(this,zc,!1);T(this,Aa,null);T(this,Sh,"");T(this,Oo,!1);T(this,gs,null);T(this,zo,null);T(this,Ni,null);T(this,Ea,null);T(this,Ah,"");T(this,$o,!1);T(this,kn,null);T(this,Eh,!1);T(this,Bo,!1);T(this,Ci,!1);T(this,Qr,null);T(this,$c,0);T(this,Bc,0);T(this,qn,null);T(this,Uo,null);Pe(this,"_editToolbar",null);Pe(this,"_initialOptions",Object.create(null));Pe(this,"_initialData",null);Pe(this,"_isVisible",!0);Pe(this,"_uiManager",null);Pe(this,"_focusEventsAllowed",!0);T(this,Nh,!1);T(this,qm,He._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:n,pageHeight:r,pageX:i,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,r],this.pageTranslation=[i,a];const[o,l]=this.parentDimensions;this.x=e.x/o,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=He.prototype._resizeWithKeyboard,t=Fl.TRANSLATE_SMALL,n=Fl.TRANSLATE_BIG;return qe(this,"_resizerKeyboardManager",new Df([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],He.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return qe(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new gT({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(He._l10n??(He._l10n=e),He._l10nResizer||(He._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),He._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);He._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){gt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return c(this,Nh)}set _isDraggable(e){var t;S(this,Nh,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=c(this,qm)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):j(this,Me,du).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(c(this,$o)?S(this,$o,!1):this.parent.setSelected(this))}focusout(e){var n;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(n=this.parent)!=null&&n.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,r){const[i,a]=this.parentDimensions;[n,r]=this.screenToPageTranslation(n,r),this.x=(e+n)/i,this.y=(t+r)/a,this.fixAndSetPosition()}translate(e,t){j(this,Me,Bx).call(this,this.parentDimensions,e,t)}translateInPage(e,t){c(this,kn)||S(this,kn,[this.x,this.y,this.width,this.height]),j(this,Me,Bx).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){c(this,kn)||S(this,kn,[this.x,this.y,this.width,this.height]);const{div:n,parentDimensions:[r,i]}=this;if(this.x+=e/r,this.y+=t/i,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:f,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,f,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this;const[l,d]=this.getBaseTranslation();a+=l,o+=d;const{style:h}=n;h.left=`${(100*a).toFixed(2)}%`,h.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!c(this,kn)&&(c(this,kn)[0]!==this.x||c(this,kn)[1]!==this.y)}get _hasBeenResized(){return!!c(this,kn)&&(c(this,kn)[2]!==this.width||c(this,kn)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:n}=He,r=n/e,i=n/t;switch(this.rotation){case 90:return[-r,i];case 180:return[r,i];case 270:return[r,-i];default:return[-r,-i]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[n,r]}=this;let{x:i,y:a,width:o,height:l}=this;if(o*=n,l*=r,i*=n,a*=r,this._mustFixPosition)switch(e){case 0:i=Math.max(0,Math.min(n-o,i)),a=Math.max(0,Math.min(r-l,a));break;case 90:i=Math.max(0,Math.min(n-l,i)),a=Math.min(r,Math.max(o,a));break;case 180:i=Math.min(n,Math.max(o,i)),a=Math.min(r,Math.max(l,a));break;case 270:i=Math.min(n,Math.max(l,i)),a=Math.max(0,Math.min(r-o,a));break}this.x=i/=n,this.y=a/=r;const[d,h]=this.getBaseTranslation();i+=d,a+=h,t.left=`${(100*i).toFixed(2)}%`,t.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var n;return j(n=He,Ch,Ux).call(n,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var n;return j(n=He,Ch,Ux).call(n,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(e,t){const[n,r]=this.parentDimensions,{style:i}=this.div;i.width=`${(100*e/n).toFixed(2)}%`,c(this,Oo)||(i.height=`${(100*t/r).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:n}=e,r=n.endsWith("%"),i=!c(this,Oo)&&t.endsWith("%");if(r&&i)return;const[a,o]=this.parentDimensions;r||(e.width=`${(100*parseFloat(n)/a).toFixed(2)}%`),!c(this,Oo)&&!i&&(e.height=`${(100*parseFloat(t)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=c(this,wt))==null||e.finish()}async addEditToolbar(){return this._editToolbar||c(this,Bo)?this._editToolbar:(this._editToolbar=new jx(this),this.div.append(this._editToolbar.render()),c(this,wt)&&await this._editToolbar.addAltText(c(this,wt)),this._editToolbar)}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=c(this,wt))==null||e.destroy())}addContainer(e){var n;const t=(n=this._editToolbar)==null?void 0:n.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){c(this,wt)||(Dm.initialize(He._l10n),S(this,wt,new Dm(this)),c(this,Fo)&&(c(this,wt).data=c(this,Fo),S(this,Fo,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=c(this,wt))==null?void 0:e.data}set altTextData(e){c(this,wt)&&(c(this,wt).data=e)}get guessedAltText(){var e;return(e=c(this,wt))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=c(this,wt))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=c(this,wt))==null?void 0:t.serialize(e)}hasAltText(){return!!c(this,wt)&&!c(this,wt).isEmpty()}hasAltTextData(){var e;return((e=c(this,wt))==null?void 0:e.hasData())??!1}render(){var i;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=c(this,zc)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),j(this,Me,Wx).call(this);const[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);const[n,r]=this.getInitialTranslation();return this.translate(n,r),Lm(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(c(this,Uo)||S(this,Uo,new Fm({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:j(this,Me,p_).bind(this),onPinching:j(this,Me,m_).bind(this),onPinchEnd:j(this,Me,g_).bind(this),signal:this._uiManager._signal}))),(i=this._uiManager._editorUndoBar)==null||i.hide(),this.div}pointerdown(e){const{isMac:t}=Qs.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(S(this,$o,!0),this._isDraggable){j(this,Me,x_).call(this,e);return}j(this,Me,Vx).call(this,e)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){c(this,Qr)&&clearTimeout(c(this,Qr)),S(this,Qr,setTimeout(()=>{var e;S(this,Qr,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){const r=this.parentScale,[i,a]=this.pageDimensions,[o,l]=this.pageTranslation,d=e/r,h=t/r,f=this.x*i,p=this.y*a,m=this.width*i,b=this.height*a;switch(n){case 0:return[f+d+o,a-p-h-b+l,f+d+m+o,a-p-h+l];case 90:return[f+h+o,a-p+d+l,f+h+b+o,a-p+d+m+l];case 180:return[f-d-m+o,a-p+h+l,f-d+o,a-p+h+b+l];case 270:return[f-h-b+o,a-p-d-m+l,f-h+o,a-p-d+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[n,r,i,a]=e,o=i-n,l=a-r;switch(this.rotation){case 0:return[n,t-a,o,l];case 90:return[n,t-r,l,o];case 180:return[i,t-r,o,l];case 270:return[i,t-a,l,o];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){S(this,Bo,!0)}disableEditMode(){S(this,Bo,!1)}isInEditMode(){return c(this,Bo)}shouldGetKeyboardEvents(){return c(this,Ci)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:n,right:r}=this.getClientDimensions(),{innerHeight:i,innerWidth:a}=window;return t<a&&r>0&&e<i&&n>0}rebuild(){j(this,Me,Wx).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){gt("An editor must be serializable")}static async deserialize(e,t,n){const r=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n});r.rotation=e.rotation,S(r,Fo,e.accessibilityData);const[i,a]=r.pageDimensions,[o,l,d,h]=r.getRectInCurrentCoords(e.rect,a);return r.x=o/i,r.y=l/a,r.width=d/i,r.height=h/a,r}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=c(this,Ea))==null||e.abort(),S(this,Ea,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),c(this,Qr)&&(clearTimeout(c(this,Qr)),S(this,Qr,null)),j(this,Me,du).call(this),this.removeEditToolbar(),c(this,qn)){for(const n of c(this,qn).values())clearTimeout(n);S(this,qn,null)}this.parent=null,(t=c(this,Uo))==null||t.destroy(),S(this,Uo,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(j(this,Me,h_).call(this),c(this,gs).classList.remove("hidden"),Lm(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),S(this,Ni,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=c(this,gs).children;if(!c(this,xr)){S(this,xr,Array.from(t));const a=j(this,Me,b_).bind(this),o=j(this,Me,y_).bind(this),l=this._uiManager._signal;for(const d of c(this,xr)){const h=d.getAttribute("data-resizer-name");d.setAttribute("role","spinbutton"),d.addEventListener("keydown",a,{signal:l}),d.addEventListener("blur",o,{signal:l}),d.addEventListener("focus",j(this,Me,v_).bind(this,h),{signal:l}),d.setAttribute("data-l10n-id",He._l10nResizer[h])}}const n=c(this,xr)[0];let r=0;for(const a of t){if(a===n)break;r++}const i=(360-this.rotation+this.parentRotation)%360/90*(c(this,xr).length/4);if(i!==r){if(i<r)for(let o=0;o<r-i;o++)c(this,gs).append(c(this,gs).firstChild);else if(i>r)for(let o=0;o<i-r;o++)c(this,gs).firstChild.before(c(this,gs).lastChild);let a=0;for(const o of t){const d=c(this,xr)[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",He._l10nResizer[d])}}j(this,Me,qx).call(this,0),S(this,Ci,!0),c(this,gs).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){c(this,Ci)&&j(this,Me,Gx).call(this,c(this,Ah),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){j(this,Me,du).call(this),this.div.focus()}select(){var e,t,n;if(this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var r,i;(r=this.div)!=null&&r.classList.contains("selectedEditor")&&((i=this._editToolbar)==null||i.show())});return}(t=this._editToolbar)==null||t.show(),(n=c(this,wt))==null||n.toggleAltTextBadge(!1)}unselect(){var e,t,n,r,i;(e=c(this,gs))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(n=this.div)!=null&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(r=this._editToolbar)==null||r.hide(),(i=c(this,wt))==null||i.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return c(this,Eh)}set isEditing(e){S(this,Eh,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){S(this,Oo,!0);const n=e/t,{style:r}=this.div;r.aspectRatio=n,r.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){c(this,qn)||S(this,qn,new Map);const{action:n}=e;let r=c(this,qn).get(n);r&&clearTimeout(r),r=setTimeout(()=>{this._reportTelemetry(e),c(this,qn).delete(n),c(this,qn).size===0&&S(this,qn,null)},He._telemetryTimeout),c(this,qn).set(n,r);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),S(this,zc,!1)}disable(){this.div&&(this.div.tabIndex=-1),S(this,zc,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};Fo=new WeakMap,xr=new WeakMap,wt=new WeakMap,zc=new WeakMap,Aa=new WeakMap,Sh=new WeakMap,Oo=new WeakMap,gs=new WeakMap,zo=new WeakMap,Ni=new WeakMap,Ea=new WeakMap,Ah=new WeakMap,$o=new WeakMap,kn=new WeakMap,Eh=new WeakMap,Bo=new WeakMap,Ci=new WeakMap,Qr=new WeakMap,$c=new WeakMap,Bc=new WeakMap,qn=new WeakMap,Uo=new WeakMap,Nh=new WeakMap,qm=new WeakMap,Me=new WeakSet,Bx=function([e,t],n,r){[n,r]=this.screenToPageTranslation(n,r),this.x+=n/e,this.y+=r/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},Ch=new WeakSet,Ux=function(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},Rp=function(e){switch(e){case 90:{const[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}},h_=function(){if(c(this,gs))return;S(this,gs,document.createElement("div")),c(this,gs).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const n of e){const r=document.createElement("div");c(this,gs).append(r),r.classList.add("resizer",n),r.setAttribute("data-resizer-name",n),r.addEventListener("pointerdown",j(this,Me,f_).bind(this,n),{signal:t}),r.addEventListener("contextmenu",Ir,{signal:t}),r.tabIndex=-1}this.div.prepend(c(this,gs))},f_=function(e,t){var h;t.preventDefault();const{isMac:n}=Qs.platform;if(t.button!==0||t.ctrlKey&&n)return;(h=c(this,wt))==null||h.toggle(!1);const r=this._isDraggable;this._isDraggable=!1,S(this,zo,[t.screenX,t.screenY]);const i=new AbortController,a=this._uiManager.combinedSignal(i);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",j(this,Me,Gx).bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",Ln,{passive:!1,signal:a}),window.addEventListener("contextmenu",Ir,{signal:a}),S(this,Ni,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const d=()=>{var f;i.abort(),this.parent.togglePointerEvents(!0),(f=c(this,wt))==null||f.toggle(!0),this._isDraggable=r,this.parent.div.style.cursor=o,this.div.style.cursor=l,j(this,Me,Ip).call(this)};window.addEventListener("pointerup",d,{signal:a}),window.addEventListener("blur",d,{signal:a})},Hx=function(e,t,n,r){this.width=n,this.height=r,this.x=e,this.y=t;const[i,a]=this.parentDimensions;this.setDims(i*n,a*r),this.fixAndSetPosition(),this._onResized()},Ip=function(){if(!c(this,Ni))return;const{savedX:e,savedY:t,savedWidth:n,savedHeight:r}=c(this,Ni);S(this,Ni,null);const i=this.x,a=this.y,o=this.width,l=this.height;i===e&&a===t&&o===n&&l===r||this.addCommands({cmd:j(this,Me,Hx).bind(this,i,a,o,l),undo:j(this,Me,Hx).bind(this,e,t,n,r),mustExec:!0})},Gx=function(e,t){const[n,r]=this.parentDimensions,i=this.x,a=this.y,o=this.width,l=this.height,d=He.MIN_SIZE/n,h=He.MIN_SIZE/r,f=j(this,Me,Rp).call(this,this.rotation),p=(J,W)=>[f[0]*J+f[2]*W,f[1]*J+f[3]*W],m=j(this,Me,Rp).call(this,360-this.rotation),b=(J,W)=>[m[0]*J+m[2]*W,m[1]*J+m[3]*W];let x,v,g=!1,y=!1;switch(e){case"topLeft":g=!0,x=(J,W)=>[0,0],v=(J,W)=>[J,W];break;case"topMiddle":x=(J,W)=>[J/2,0],v=(J,W)=>[J/2,W];break;case"topRight":g=!0,x=(J,W)=>[J,0],v=(J,W)=>[0,W];break;case"middleRight":y=!0,x=(J,W)=>[J,W/2],v=(J,W)=>[0,W/2];break;case"bottomRight":g=!0,x=(J,W)=>[J,W],v=(J,W)=>[0,0];break;case"bottomMiddle":x=(J,W)=>[J/2,W],v=(J,W)=>[J/2,0];break;case"bottomLeft":g=!0,x=(J,W)=>[0,W],v=(J,W)=>[J,0];break;case"middleLeft":y=!0,x=(J,W)=>[0,W/2],v=(J,W)=>[J,W/2];break}const w=x(o,l),k=v(o,l);let C=p(...k);const P=He._round(i+C[0]),N=He._round(a+C[1]);let I=1,M=1,L,$;if(t.fromKeyboard)({deltaX:L,deltaY:$}=t);else{const{screenX:J,screenY:W}=t,[Q,H]=c(this,zo);[L,$]=this.screenToPageTranslation(J-Q,W-H),c(this,zo)[0]=J,c(this,zo)[1]=W}if([L,$]=b(L/n,$/r),g){const J=Math.hypot(o,l);I=M=Math.max(Math.min(Math.hypot(k[0]-w[0]-L,k[1]-w[1]-$)/J,1/o,1/l),d/o,h/l)}else y?I=Math.max(d,Math.min(1,Math.abs(k[0]-w[0]-L)))/o:M=Math.max(h,Math.min(1,Math.abs(k[1]-w[1]-$)))/l;const E=He._round(o*I),D=He._round(l*M);C=p(...v(E,D));const _=P-C[0],K=N-C[1];c(this,kn)||S(this,kn,[this.x,this.y,this.width,this.height]),this.width=E,this.height=D,this.x=_,this.y=K,this.setDims(n*E,r*D),this.fixAndSetPosition(),this._onResizing()},p_=function(){var e;S(this,Ni,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=c(this,wt))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},m_=function(e,t,n){let i=.7*(n/t)+1-.7;if(i===1)return;const a=j(this,Me,Rp).call(this,this.rotation),o=(P,N)=>[a[0]*P+a[2]*N,a[1]*P+a[3]*N],[l,d]=this.parentDimensions,h=this.x,f=this.y,p=this.width,m=this.height,b=He.MIN_SIZE/l,x=He.MIN_SIZE/d;i=Math.max(Math.min(i,1/p,1/m),b/p,x/m);const v=He._round(p*i),g=He._round(m*i);if(v===p&&g===m)return;c(this,kn)||S(this,kn,[h,f,p,m]);const y=o(p/2,m/2),w=He._round(h+y[0]),k=He._round(f+y[1]),C=o(v/2,g/2);this.x=w-C[0],this.y=k-C[1],this.width=v,this.height=g,this.setDims(l*v,d*g),this.fixAndSetPosition(),this._onResizing()},g_=function(){var e;(e=c(this,wt))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),j(this,Me,Ip).call(this)},Vx=function(e){const{isMac:t}=Qs.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},x_=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1;const r=new AbortController,i=this._uiManager.combinedSignal(r),a={capture:!0,passive:!1,signal:i},o=d=>{r.abort(),S(this,Aa,null),S(this,$o,!1),this._uiManager.endDragSession()||j(this,Me,Vx).call(this,d),n&&this._onStopDragging()};t&&(S(this,$c,e.clientX),S(this,Bc,e.clientY),S(this,Aa,e.pointerId),S(this,Sh,e.pointerType),window.addEventListener("pointermove",d=>{n||(n=!0,this._onStartDragging());const{clientX:h,clientY:f,pointerId:p}=d;if(p!==c(this,Aa)){Ln(d);return}const[m,b]=this.screenToPageTranslation(h-c(this,$c),f-c(this,Bc));S(this,$c,h),S(this,Bc,f),this._uiManager.dragSelectedEditors(m,b)},a),window.addEventListener("touchmove",Ln,a),window.addEventListener("pointerdown",d=>{d.pointerType===c(this,Sh)&&(c(this,Uo)||d.isPrimary)&&o(d),Ln(d)},a));const l=d=>{if(!c(this,Aa)||c(this,Aa)===d.pointerId){o(d);return}Ln(d)};window.addEventListener("pointerup",l,{signal:i}),window.addEventListener("blur",l,{signal:i})},Wx=function(){if(c(this,Ea)||!this.div)return;S(this,Ea,new AbortController);const e=this._uiManager.combinedSignal(c(this,Ea));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},b_=function(e){He._resizerKeyboardManager.exec(this,e)},y_=function(e){var t;c(this,Ci)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==c(this,gs)&&j(this,Me,du).call(this)},v_=function(e){S(this,Ah,c(this,Ci)?e:"")},qx=function(e){if(c(this,xr))for(const t of c(this,xr))t.tabIndex=e},du=function(){S(this,Ci,!1),j(this,Me,qx).call(this,-1),j(this,Me,Ip).call(this)},T(He,Ch),Pe(He,"_l10n",null),Pe(He,"_l10nResizer",null),Pe(He,"_borderLineWidth",-1),Pe(He,"_colorManager",new Rx),Pe(He,"_zIndex",1),Pe(He,"_telemetryTimeout",1e3);let Mt=He;class gT extends Mt{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const L1=3285377520,Hn=4294901760,$r=65535;class w_{constructor(e){this.h1=e?e&4294967295:L1,this.h2=e?e&4294967295:L1}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let x=0,v=e.length;x<v;x++){const g=e.charCodeAt(x);g<=255?t[n++]=g:(t[n++]=g>>>8,t[n++]=g&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const r=n>>2,i=n-r*4,a=new Uint32Array(t.buffer,0,r);let o=0,l=0,d=this.h1,h=this.h2;const f=3432918353,p=461845907,m=f&$r,b=p&$r;for(let x=0;x<r;x++)x&1?(o=a[x],o=o*f&Hn|o*m&$r,o=o<<15|o>>>17,o=o*p&Hn|o*b&$r,d^=o,d=d<<13|d>>>19,d=d*5+3864292196):(l=a[x],l=l*f&Hn|l*m&$r,l=l<<15|l>>>17,l=l*p&Hn|l*b&$r,h^=l,h=h<<13|h>>>19,h=h*5+3864292196);switch(o=0,i){case 3:o^=t[r*4+2]<<16;case 2:o^=t[r*4+1]<<8;case 1:o^=t[r*4],o=o*f&Hn|o*m&$r,o=o<<15|o>>>17,o=o*p&Hn|o*b&$r,r&1?d^=o:h^=o}this.h1=d,this.h2=h}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Hn|e*36045&$r,t=t*4283543511&Hn|((t<<16|e>>>16)*2950163797&Hn)>>>16,e^=t>>>1,e=e*444984403&Hn|e*60499&$r,t=t*3301882366&Hn|((t<<16|e>>>16)*3120437893&Hn)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const Xx=Object.freeze({map:null,hash:"",transfer:void 0});var Ho,Go,is,Xm,k_;class Qy{constructor(){T(this,Xm);T(this,Ho,!1);T(this,Go,null);T(this,is,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const n=c(this,is).get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return c(this,is).get(e)}remove(e){if(c(this,is).delete(e),c(this,is).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of c(this,is).values())if(t instanceof Mt)return;this.onAnnotationEditor(null)}}setValue(e,t){const n=c(this,is).get(e);let r=!1;if(n!==void 0)for(const[i,a]of Object.entries(t))n[i]!==a&&(r=!0,n[i]=a);else r=!0,c(this,is).set(e,t);r&&j(this,Xm,k_).call(this),t instanceof Mt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return c(this,is).has(e)}getAll(){return c(this,is).size>0?Vy(c(this,is)):null}setAll(e){for(const[t,n]of Object.entries(e))this.setValue(t,n)}get size(){return c(this,is).size}resetModified(){c(this,Ho)&&(S(this,Ho,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new __(this)}get serializable(){if(c(this,is).size===0)return Xx;const e=new Map,t=new w_,n=[],r=Object.create(null);let i=!1;for(const[a,o]of c(this,is)){const l=o instanceof Mt?o.serialize(!1,r):o;l&&(e.set(a,l),t.update(`${a}:${JSON.stringify(l)}`),i||(i=!!l.bitmap))}if(i)for(const a of e.values())a.bitmap&&n.push(a.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:Xx}get editorStats(){let e=null;const t=new Map;for(const n of c(this,is).values()){if(!(n instanceof Mt))continue;const r=n.telemetryFinalData;if(!r)continue;const{type:i}=r;t.has(i)||t.set(i,Object.getPrototypeOf(n).constructor),e||(e=Object.create(null));const a=e[i]||(e[i]=new Map);for(const[o,l]of Object.entries(r)){if(o==="type")continue;let d=a.get(o);d||(d=new Map,a.set(o,d));const h=d.get(l)??0;d.set(l,h+1)}}for(const[n,r]of t)e[n]=r.computeTelemetryFinalData(e[n]);return e}resetModifiedIds(){S(this,Go,null)}get modifiedIds(){if(c(this,Go))return c(this,Go);const e=[];for(const t of c(this,is).values())!(t instanceof Mt)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return S(this,Go,{ids:new Set(e),hash:e.join(",")})}}Ho=new WeakMap,Go=new WeakMap,is=new WeakMap,Xm=new WeakSet,k_=function(){c(this,Ho)||(S(this,Ho,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var Th;class __ extends Qy{constructor(t){super();T(this,Th);const{map:n,hash:r,transfer:i}=t.serializable,a=structuredClone(n,i?{transfer:i}:null);S(this,Th,{map:a,hash:r,transfer:i})}get print(){gt("Should not call PrintAnnotationStorage.print")}get serializable(){return c(this,Th)}get modifiedIds(){return qe(this,"modifiedIds",{ids:new Set,hash:""})}}Th=new WeakMap;var Uc;class xT{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){T(this,Uc,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),c(this,Uc).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||c(this,Uc).has(e.loadedName))){if(qt(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:n,src:r,style:i}=e,a=new FontFace(n,r,i);this.addNativeFontFace(a);try{await a.load(),c(this,Uc).add(n),t==null||t(e)}catch{Ue(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}gt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(r){throw Ue(`Failed to load font '${n.family}': '${r}'.`),e.disableFontFace=!0,r}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const r=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,r)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return qe(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(Os||typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),qe(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(qt(!r.done,"completeRequest() cannot be called twice."),r.done=!0;n.length>0&&n[0].done;){const i=n.shift();setTimeout(i.callback,0)}}const{loadingRequests:n}=this,r={done:!1,complete:t,callback:e};return n.push(r),r}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return qe(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(k,C){return k.charCodeAt(C)<<24|k.charCodeAt(C+1)<<16|k.charCodeAt(C+2)<<8|k.charCodeAt(C+3)&255}function r(k,C,P,N){const I=k.substring(0,C),M=k.substring(C+P);return I+N+M}let i,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let d=0;function h(k,C){if(++d>30){Ue("Load test font never loaded."),C();return}if(l.font="30px "+k,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){C();return}setTimeout(h.bind(null,k,C))}const f=`lt${Date.now()}${this.loadTestFontId++}`;let p=this._loadTestFont;p=r(p,976,f.length,f);const b=16,x=1482184792;let v=n(p,b);for(i=0,a=f.length-3;i<a;i+=4)v=v-x+n(f,i)|0;i<f.length&&(v=v-x+n(f+"XXX",i)|0),p=r(p,b,4,sT(v));const g=`url(data:font/opentype;base64,${btoa(p)});`,y=`@font-face {font-family:"${f}";src:${g}}`;this.insertRule(y);const w=this._document.createElement("div");w.style.visibility="hidden",w.style.width=w.style.height="10px",w.style.position="absolute",w.style.top=w.style.left="0px";for(const k of[e.loadedName,f]){const C=this._document.createElement("span");C.textContent="Hi",C.style.fontFamily=k,w.append(C)}this._document.body.append(w),h(f,()=>{w.remove(),t.complete()})}}Uc=new WeakMap;class bT{constructor(e,{disableFontFace:t=!1,fontExtraProperties:n=!1,inspectFont:r=null}){this.compiledGlyphs=Object.create(null);for(const i in e)this[i]=e[i];this.disableFontFace=t===!0,this.fontExtraProperties=n===!0,this._inspectFont=r}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var n;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${lT(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let r=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(r+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${r}src:${e}}`}return(n=this._inspectFont)==null||n.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const n=this.loadedName+"_path_"+t;let r;try{r=e.get(n)}catch(a){Ue(`getPathGenerator - ignoring character: "${a}".`)}const i=new Path2D(r||"");return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=i}}const rp={DATA:1,ERROR:2},Vt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function D1(){}function an(s){if(s instanceof ro||s instanceof Nx||s instanceof eh||s instanceof M1||s instanceof Im||s instanceof xg)return s;switch(s instanceof Error||typeof s=="object"&&s!==null||gt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),s.name){case"AbortException":return new ro(s.message);case"InvalidPDFException":return new Nx(s.message);case"MissingPDFException":return new eh(s.message);case"PasswordException":return new M1(s.message,s.code);case"UnexpectedResponseException":return new Im(s.message,s.status);case"UnknownErrorException":return new xg(s.message,s.details)}return new xg(s.message,s.toString())}var Hc,ir,S_,A_,E_,Lp;class uu{constructor(e,t,n){T(this,ir);T(this,Hc,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",j(this,ir,S_).bind(this),{signal:c(this,Hc).signal})}on(e,t){const n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){const r=this.callbackId++,i=Promise.withResolvers();this.callbackCapabilities[r]=i;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},n)}catch(a){i.reject(a)}return i.promise}sendWithStream(e,t,n,r){const i=this.streamId++,a=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:d=>{const h=Promise.withResolvers();return this.streamControllers[i]={controller:d,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:a,targetName:o,action:e,streamId:i,data:t,desiredSize:d.desiredSize},r),h.promise},pull:d=>{const h=Promise.withResolvers();return this.streamControllers[i].pullCall=h,l.postMessage({sourceName:a,targetName:o,stream:Vt.PULL,streamId:i,desiredSize:d.desiredSize}),h.promise},cancel:d=>{qt(d instanceof Error,"cancel must have a valid reason");const h=Promise.withResolvers();return this.streamControllers[i].cancelCall=h,this.streamControllers[i].isClosed=!0,l.postMessage({sourceName:a,targetName:o,stream:Vt.CANCEL,streamId:i,reason:an(d)}),h.promise}},n)}destroy(){var e;(e=c(this,Hc))==null||e.abort(),S(this,Hc,null)}}Hc=new WeakMap,ir=new WeakSet,S_=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){j(this,ir,E_).call(this,e);return}if(e.callback){const n=e.callbackId,r=this.callbackCapabilities[n];if(!r)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],e.callback===rp.DATA)r.resolve(e.data);else if(e.callback===rp.ERROR)r.reject(an(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const n=this.sourceName,r=e.sourceName,i=this.comObj;Promise.try(t,e.data).then(function(a){i.postMessage({sourceName:n,targetName:r,callback:rp.DATA,callbackId:e.callbackId,data:a})},function(a){i.postMessage({sourceName:n,targetName:r,callback:rp.ERROR,callbackId:e.callbackId,reason:an(a)})});return}if(e.streamId){j(this,ir,A_).call(this,e);return}t(e.data)},A_=function(e){const t=e.streamId,n=this.sourceName,r=e.sourceName,i=this.comObj,a=this,o=this.actionHandler[e.action],l={enqueue(d,h=1,f){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=h,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),i.postMessage({sourceName:n,targetName:r,stream:Vt.ENQUEUE,streamId:t,chunk:d},f)},close(){this.isCancelled||(this.isCancelled=!0,i.postMessage({sourceName:n,targetName:r,stream:Vt.CLOSE,streamId:t}),delete a.streamSinks[t])},error(d){qt(d instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,i.postMessage({sourceName:n,targetName:r,stream:Vt.ERROR,streamId:t,reason:an(d)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(o,e.data,l).then(function(){i.postMessage({sourceName:n,targetName:r,stream:Vt.START_COMPLETE,streamId:t,success:!0})},function(d){i.postMessage({sourceName:n,targetName:r,stream:Vt.START_COMPLETE,streamId:t,reason:an(d)})})},E_=function(e){const t=e.streamId,n=this.sourceName,r=e.sourceName,i=this.comObj,a=this.streamControllers[t],o=this.streamSinks[t];switch(e.stream){case Vt.START_COMPLETE:e.success?a.startCall.resolve():a.startCall.reject(an(e.reason));break;case Vt.PULL_COMPLETE:e.success?a.pullCall.resolve():a.pullCall.reject(an(e.reason));break;case Vt.PULL:if(!o){i.postMessage({sourceName:n,targetName:r,stream:Vt.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,Promise.try(o.onPull||D1).then(function(){i.postMessage({sourceName:n,targetName:r,stream:Vt.PULL_COMPLETE,streamId:t,success:!0})},function(d){i.postMessage({sourceName:n,targetName:r,stream:Vt.PULL_COMPLETE,streamId:t,reason:an(d)})});break;case Vt.ENQUEUE:if(qt(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case Vt.CLOSE:if(qt(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),j(this,ir,Lp).call(this,a,t);break;case Vt.ERROR:qt(a,"error should have stream controller"),a.controller.error(an(e.reason)),j(this,ir,Lp).call(this,a,t);break;case Vt.CANCEL_COMPLETE:e.success?a.cancelCall.resolve():a.cancelCall.reject(an(e.reason)),j(this,ir,Lp).call(this,a,t);break;case Vt.CANCEL:if(!o)break;const l=an(e.reason);Promise.try(o.onCancel||D1,l).then(function(){i.postMessage({sourceName:n,targetName:r,stream:Vt.CANCEL_COMPLETE,streamId:t,success:!0})},function(d){i.postMessage({sourceName:n,targetName:r,stream:Vt.CANCEL_COMPLETE,streamId:t,reason:an(d)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},Lp=async function(e,t){var n,r,i;await Promise.allSettled([(n=e.startCall)==null?void 0:n.promise,(r=e.pullCall)==null?void 0:r.promise,(i=e.cancelCall)==null?void 0:i.promise]),delete this.streamControllers[t]};var jh;class N_{constructor({enableHWA:e=!1}){T(this,jh,!1);S(this,jh,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!c(this,jh)})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){gt("Abstract method `_createCanvas` called.")}}jh=new WeakMap;class yT extends N_{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const n=this._document.createElement("canvas");return n.width=e,n.height=t,n}}class C_{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){gt("Abstract method `_fetch` called.")}}class T_ extends C_{async _fetch(e){const t=await T0(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):C0(t)}}class j_{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,r,i){return"none"}destroy(e=!1){}}var Vo,Gc,Ti,ji,Rs,Wo,qo,ke,js,hu,Ql,Dp,Zl,P_,Kx,Jl,fu,pu,Yx,mu;class vT extends j_{constructor({docId:t,ownerDocument:n=globalThis.document}){super();T(this,ke);T(this,Vo);T(this,Gc);T(this,Ti);T(this,ji);T(this,Rs);T(this,Wo);T(this,qo,0);S(this,ji,t),S(this,Rs,n)}addFilter(t){if(!t)return"none";let n=c(this,ke,js).get(t);if(n)return n;const[r,i,a]=j(this,ke,Dp).call(this,t),o=t.length===1?r:`${r}${i}${a}`;if(n=c(this,ke,js).get(o),n)return c(this,ke,js).set(t,n),n;const l=`g_${c(this,ji)}_transfer_map_${Us(this,qo)._++}`,d=j(this,ke,Zl).call(this,l);c(this,ke,js).set(t,d),c(this,ke,js).set(o,d);const h=j(this,ke,Jl).call(this,l);return j(this,ke,pu).call(this,r,i,a,h),d}addHCMFilter(t,n){var b;const r=`${t}-${n}`,i="base";let a=c(this,ke,hu).get(i);if((a==null?void 0:a.key)===r||(a?((b=a.filter)==null||b.remove(),a.key=r,a.url="none",a.filter=null):(a={key:r,url:"none",filter:null},c(this,ke,hu).set(i,a)),!t||!n))return a.url;const o=j(this,ke,mu).call(this,t);t=Ce.makeHexColor(...o);const l=j(this,ke,mu).call(this,n);if(n=Ce.makeHexColor(...l),c(this,ke,Ql).style.color="",t==="#000000"&&n==="#ffffff"||t===n)return a.url;const d=new Array(256);for(let x=0;x<=255;x++){const v=x/255;d[x]=v<=.03928?v/12.92:((v+.055)/1.055)**2.4}const h=d.join(","),f=`g_${c(this,ji)}_hcm_filter`,p=a.filter=j(this,ke,Jl).call(this,f);j(this,ke,pu).call(this,h,h,h,p),j(this,ke,Kx).call(this,p);const m=(x,v)=>{const g=o[x]/255,y=l[x]/255,w=new Array(v+1);for(let k=0;k<=v;k++)w[k]=g+k/v*(y-g);return w.join(",")};return j(this,ke,pu).call(this,m(0,5),m(1,5),m(2,5),p),a.url=j(this,ke,Zl).call(this,f),a.url}addAlphaFilter(t){let n=c(this,ke,js).get(t);if(n)return n;const[r]=j(this,ke,Dp).call(this,[t]),i=`alpha_${r}`;if(n=c(this,ke,js).get(i),n)return c(this,ke,js).set(t,n),n;const a=`g_${c(this,ji)}_alpha_map_${Us(this,qo)._++}`,o=j(this,ke,Zl).call(this,a);c(this,ke,js).set(t,o),c(this,ke,js).set(i,o);const l=j(this,ke,Jl).call(this,a);return j(this,ke,Yx).call(this,r,l),o}addLuminosityFilter(t){let n=c(this,ke,js).get(t||"luminosity");if(n)return n;let r,i;if(t?([r]=j(this,ke,Dp).call(this,[t]),i=`luminosity_${r}`):i="luminosity",n=c(this,ke,js).get(i),n)return c(this,ke,js).set(t,n),n;const a=`g_${c(this,ji)}_luminosity_map_${Us(this,qo)._++}`,o=j(this,ke,Zl).call(this,a);c(this,ke,js).set(t,o),c(this,ke,js).set(i,o);const l=j(this,ke,Jl).call(this,a);return j(this,ke,P_).call(this,l),t&&j(this,ke,Yx).call(this,r,l),o}addHighlightHCMFilter(t,n,r,i,a){var y;const o=`${n}-${r}-${i}-${a}`;let l=c(this,ke,hu).get(t);if((l==null?void 0:l.key)===o||(l?((y=l.filter)==null||y.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},c(this,ke,hu).set(t,l)),!n||!r))return l.url;const[d,h]=[n,r].map(j(this,ke,mu).bind(this));let f=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),p=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[m,b]=[i,a].map(j(this,ke,mu).bind(this));p<f&&([f,p,m,b]=[p,f,b,m]),c(this,ke,Ql).style.color="";const x=(w,k,C)=>{const P=new Array(256),N=(p-f)/C,I=w/255,M=(k-w)/(255*C);let L=0;for(let $=0;$<=C;$++){const E=Math.round(f+$*N),D=I+$*M;for(let _=L;_<=E;_++)P[_]=D;L=E+1}for(let $=L;$<256;$++)P[$]=P[L-1];return P.join(",")},v=`g_${c(this,ji)}_hcm_${t}_filter`,g=l.filter=j(this,ke,Jl).call(this,v);return j(this,ke,Kx).call(this,g),j(this,ke,pu).call(this,x(m[0],b[0],5),x(m[1],b[1],5),x(m[2],b[2],5),g),l.url=j(this,ke,Zl).call(this,v),l.url}destroy(t=!1){var n,r,i,a;t&&((n=c(this,Wo))!=null&&n.size)||((r=c(this,Ti))==null||r.parentNode.parentNode.remove(),S(this,Ti,null),(i=c(this,Gc))==null||i.clear(),S(this,Gc,null),(a=c(this,Wo))==null||a.clear(),S(this,Wo,null),S(this,qo,0))}}Vo=new WeakMap,Gc=new WeakMap,Ti=new WeakMap,ji=new WeakMap,Rs=new WeakMap,Wo=new WeakMap,qo=new WeakMap,ke=new WeakSet,js=function(){return c(this,Gc)||S(this,Gc,new Map)},hu=function(){return c(this,Wo)||S(this,Wo,new Map)},Ql=function(){if(!c(this,Ti)){const t=c(this,Rs).createElement("div"),{style:n}=t;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;const r=c(this,Rs).createElementNS(pi,"svg");r.setAttribute("width",0),r.setAttribute("height",0),S(this,Ti,c(this,Rs).createElementNS(pi,"defs")),t.append(r),r.append(c(this,Ti)),c(this,Rs).body.append(t)}return c(this,Ti)},Dp=function(t){if(t.length===1){const d=t[0],h=new Array(256);for(let p=0;p<256;p++)h[p]=d[p]/255;const f=h.join(",");return[f,f,f]}const[n,r,i]=t,a=new Array(256),o=new Array(256),l=new Array(256);for(let d=0;d<256;d++)a[d]=n[d]/255,o[d]=r[d]/255,l[d]=i[d]/255;return[a.join(","),o.join(","),l.join(",")]},Zl=function(t){if(c(this,Vo)===void 0){S(this,Vo,"");const n=c(this,Rs).URL;n!==c(this,Rs).baseURI&&(j0(n)?Ue('#createUrl: ignore "data:"-URL for performance reasons.'):S(this,Vo,n.split("#",1)[0]))}return`url(${c(this,Vo)}#${t})`},P_=function(t){const n=c(this,Rs).createElementNS(pi,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(n)},Kx=function(t){const n=c(this,Rs).createElementNS(pi,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(n)},Jl=function(t){const n=c(this,Rs).createElementNS(pi,"filter");return n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("id",t),c(this,ke,Ql).append(n),n},fu=function(t,n,r){const i=c(this,Rs).createElementNS(pi,n);i.setAttribute("type","discrete"),i.setAttribute("tableValues",r),t.append(i)},pu=function(t,n,r,i){const a=c(this,Rs).createElementNS(pi,"feComponentTransfer");i.append(a),j(this,ke,fu).call(this,a,"feFuncR",t),j(this,ke,fu).call(this,a,"feFuncG",n),j(this,ke,fu).call(this,a,"feFuncB",r)},Yx=function(t,n){const r=c(this,Rs).createElementNS(pi,"feComponentTransfer");n.append(r),j(this,ke,fu).call(this,r,"feFuncA",t)},mu=function(t){return c(this,ke,Ql).style.color=t,Yy(getComputedStyle(c(this,ke,Ql)).getPropertyValue("color"))};class M_{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){gt("Abstract method `_fetch` called.")}}class R_ extends M_{async _fetch(e){const t=await T0(e,"arraybuffer");return new Uint8Array(t)}}Os&&Ue("Please use the `legacy` build in Node.js environments.");async function I_(s){const t=await process.getBuiltinModule("fs").promises.readFile(s);return new Uint8Array(t)}class wT extends j_{}class kT extends N_{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class _T extends C_{async _fetch(e){return I_(e)}}class ST extends M_{async _fetch(e){return I_(e)}}const Ds={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Qx(s,e){if(!e)return;const t=e[2]-e[0],n=e[3]-e[1],r=new Path2D;r.rect(e[0],e[1],t,n),s.clip(r)}class Zy{getPattern(){gt("Abstract method `getPattern` called.")}}class AT extends Zy{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,r){let i;if(r===Ds.STROKE||r===Ds.FILL){const a=t.current.getClippedPathBoundingBox(r,At(e))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,l=Math.ceil(a[3]-a[1])||1,d=t.cachedCanvases.getCanvas("pattern",o,l),h=d.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-a[0],-a[1]),n=Ce.transform(n,[1,0,0,1,a[0],a[1]]),h.transform(...t.baseTransform),this.matrix&&h.transform(...this.matrix),Qx(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),i=e.createPattern(d.canvas,"no-repeat");const f=new DOMMatrix(n);i.setTransform(f)}else Qx(e,this._bbox),i=this._createGradient(e);return i}}function vg(s,e,t,n,r,i,a,o){const l=e.coords,d=e.colors,h=s.data,f=s.width*4;let p;l[t+1]>l[n+1]&&(p=t,t=n,n=p,p=i,i=a,a=p),l[n+1]>l[r+1]&&(p=n,n=r,r=p,p=a,a=o,o=p),l[t+1]>l[n+1]&&(p=t,t=n,n=p,p=i,i=a,a=p);const m=(l[t]+e.offsetX)*e.scaleX,b=(l[t+1]+e.offsetY)*e.scaleY,x=(l[n]+e.offsetX)*e.scaleX,v=(l[n+1]+e.offsetY)*e.scaleY,g=(l[r]+e.offsetX)*e.scaleX,y=(l[r+1]+e.offsetY)*e.scaleY;if(b>=y)return;const w=d[i],k=d[i+1],C=d[i+2],P=d[a],N=d[a+1],I=d[a+2],M=d[o],L=d[o+1],$=d[o+2],E=Math.round(b),D=Math.round(y);let _,K,J,W,Q,H,oe,X;for(let U=E;U<=D;U++){if(U<v){const se=U<b?0:(b-U)/(b-v);_=m-(m-x)*se,K=w-(w-P)*se,J=k-(k-N)*se,W=C-(C-I)*se}else{let se;U>y?se=1:v===y?se=0:se=(v-U)/(v-y),_=x-(x-g)*se,K=P-(P-M)*se,J=N-(N-L)*se,W=I-(I-$)*se}let Y;U<b?Y=0:U>y?Y=1:Y=(b-U)/(b-y),Q=m-(m-g)*Y,H=w-(w-M)*Y,oe=k-(k-L)*Y,X=C-(C-$)*Y;const V=Math.round(Math.min(_,Q)),ee=Math.round(Math.max(_,Q));let fe=f*U+V*4;for(let se=V;se<=ee;se++)Y=(_-se)/(_-Q),Y<0?Y=0:Y>1&&(Y=1),h[fe++]=K-(K-H)*Y|0,h[fe++]=J-(J-oe)*Y|0,h[fe++]=W-(W-X)*Y|0,h[fe++]=255}}function ET(s,e,t){const n=e.coords,r=e.colors;let i,a;switch(e.type){case"lattice":const o=e.verticesPerRow,l=Math.floor(n.length/o)-1,d=o-1;for(i=0;i<l;i++){let h=i*o;for(let f=0;f<d;f++,h++)vg(s,t,n[h],n[h+1],n[h+o],r[h],r[h+1],r[h+o]),vg(s,t,n[h+o+1],n[h+1],n[h+o],r[h+o+1],r[h+1],r[h+o])}break;case"triangles":for(i=0,a=n.length;i<a;i+=3)vg(s,t,n[i],n[i+1],n[i+2],r[i],r[i+1],r[i+2]);break;default:throw new Error("illegal figure")}}class NT extends Zy{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,n){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),d=Math.ceil(this._bounds[2])-o,h=Math.ceil(this._bounds[3])-l,f=Math.min(Math.ceil(Math.abs(d*e[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(h*e[1]*1.1)),3e3),m=d/f,b=h/p,x={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/m,scaleY:1/b},v=f+2*2,g=p+2*2,y=n.getCanvas("mesh",v,g),w=y.context,k=w.createImageData(f,p);if(t){const P=k.data;for(let N=0,I=P.length;N<I;N+=4)P[N]=t[0],P[N+1]=t[1],P[N+2]=t[2],P[N+3]=255}for(const P of this._figures)ET(k,P,x);return w.putImageData(k,2,2),{canvas:y.canvas,offsetX:o-2*m,offsetY:l-2*b,scaleX:m,scaleY:b}}getPattern(e,t,n,r){Qx(e,this._bbox);let i;if(r===Ds.SHADING)i=Ce.singularValueDecompose2dScale(At(e));else if(i=Ce.singularValueDecompose2dScale(t.baseTransform),this.matrix){const o=Ce.singularValueDecompose2dScale(this.matrix);i=[i[0]*o[0],i[1]*o[1]]}const a=this._createMeshCanvas(i,r===Ds.SHADING?null:this._background,t.cachedCanvases);return r!==Ds.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,"no-repeat")}}class CT extends Zy{getPattern(){return"hotpink"}}function TT(s){switch(s[0]){case"RadialAxial":return new AT(s);case"Mesh":return new NT(s);case"Dummy":return new CT}throw new Error(`Unknown IR type: ${s[0]}`)}const F1={COLORED:1,UNCOLORED:2},Km=class Km{constructor(e,t,n,r,i){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=n,this.canvasGraphicsFactory=r,this.baseTransform=i}createPatternCanvas(e){const{bbox:t,operatorList:n,paintType:r,tilingType:i,color:a,canvasGraphicsFactory:o}=this;let{xstep:l,ystep:d}=this;l=Math.abs(l),d=Math.abs(d),N0("TilingType: "+i);const h=t[0],f=t[1],p=t[2],m=t[3],b=p-h,x=m-f,v=Ce.singularValueDecompose2dScale(this.matrix),g=Ce.singularValueDecompose2dScale(this.baseTransform),y=v[0]*g[0],w=v[1]*g[1];let k=b,C=x,P=!1,N=!1;const I=Math.ceil(l*y),M=Math.ceil(d*w),L=Math.ceil(b*y),$=Math.ceil(x*w);I>=L?k=l:P=!0,M>=$?C=d:N=!0;const E=this.getSizeAndScale(k,this.ctx.canvas.width,y),D=this.getSizeAndScale(C,this.ctx.canvas.height,w),_=e.cachedCanvases.getCanvas("pattern",E.size,D.size),K=_.context,J=o.createCanvasGraphics(K);if(J.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(J,r,a),K.translate(-E.scale*h,-D.scale*f),J.transform(E.scale,0,0,D.scale,0,0),K.save(),this.clipBbox(J,h,f,p,m),J.baseTransform=At(J.ctx),J.executeOperatorList(n),J.endDrawing(),K.restore(),P||N){const W=_.canvas;P&&(k=l),N&&(C=d);const Q=this.getSizeAndScale(k,this.ctx.canvas.width,y),H=this.getSizeAndScale(C,this.ctx.canvas.height,w),oe=Q.size,X=H.size,U=e.cachedCanvases.getCanvas("pattern-workaround",oe,X),Y=U.context,V=P?Math.floor(b/l):0,ee=N?Math.floor(x/d):0;for(let fe=0;fe<=V;fe++)for(let se=0;se<=ee;se++)Y.drawImage(W,oe*fe,X*se,oe,X,0,0,oe,X);return{canvas:U.canvas,scaleX:Q.scale,scaleY:H.scale,offsetX:h,offsetY:f}}return{canvas:_.canvas,scaleX:E.scale,scaleY:D.scale,offsetX:h,offsetY:f}}getSizeAndScale(e,t,n){const r=Math.max(Km.MAX_PATTERN_SIZE,t);let i=Math.ceil(e*n);return i>=r?i=r:n=i/e,{scale:n,size:i}}clipBbox(e,t,n,r,i){const a=r-t,o=i-n;e.ctx.rect(t,n,a,o),e.current.updateRectMinMax(At(e.ctx),[t,n,r,i]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){const r=e.ctx,i=e.current;switch(t){case F1.COLORED:const a=this.ctx;r.fillStyle=a.fillStyle,r.strokeStyle=a.strokeStyle,i.fillColor=a.fillStyle,i.strokeColor=a.strokeStyle;break;case F1.UNCOLORED:const o=Ce.makeHexColor(n[0],n[1],n[2]);r.fillStyle=o,r.strokeStyle=o,i.fillColor=o,i.strokeColor=o;break;default:throw new tT(`Unsupported paint type: ${t}`)}}getPattern(e,t,n,r){let i=n;r!==Ds.SHADING&&(i=Ce.transform(i,t.baseTransform),this.matrix&&(i=Ce.transform(i,this.matrix)));const a=this.createPatternCanvas(t);let o=new DOMMatrix(i);o=o.translate(a.offsetX,a.offsetY),o=o.scale(1/a.scaleX,1/a.scaleY);const l=e.createPattern(a.canvas,"repeat");return l.setTransform(o),l}};Pe(Km,"MAX_PATTERN_SIZE",3e3);let Zx=Km;function jT({src:s,srcPos:e=0,dest:t,width:n,height:r,nonBlackColor:i=4294967295,inverseDecode:a=!1}){const o=Qs.isLittleEndian?4278190080:255,[l,d]=a?[i,o]:[o,i],h=n>>3,f=n&7,p=s.length;t=new Uint32Array(t.buffer);let m=0;for(let b=0;b<r;b++){for(const v=e+h;e<v;e++){const g=e<p?s[e]:255;t[m++]=g&128?d:l,t[m++]=g&64?d:l,t[m++]=g&32?d:l,t[m++]=g&16?d:l,t[m++]=g&8?d:l,t[m++]=g&4?d:l,t[m++]=g&2?d:l,t[m++]=g&1?d:l}if(f===0)continue;const x=e<p?s[e++]:255;for(let v=0;v<f;v++)t[m++]=x&1<<7-v?d:l}return{srcPos:e,destPos:m}}const O1=16,z1=100,PT=15,$1=10,B1=1e3,un=16;function MT(s,e){if(s._removeMirroring)throw new Error("Context is already forwarding operations.");s.__originalSave=s.save,s.__originalRestore=s.restore,s.__originalRotate=s.rotate,s.__originalScale=s.scale,s.__originalTranslate=s.translate,s.__originalTransform=s.transform,s.__originalSetTransform=s.setTransform,s.__originalResetTransform=s.resetTransform,s.__originalClip=s.clip,s.__originalMoveTo=s.moveTo,s.__originalLineTo=s.lineTo,s.__originalBezierCurveTo=s.bezierCurveTo,s.__originalRect=s.rect,s.__originalClosePath=s.closePath,s.__originalBeginPath=s.beginPath,s._removeMirroring=()=>{s.save=s.__originalSave,s.restore=s.__originalRestore,s.rotate=s.__originalRotate,s.scale=s.__originalScale,s.translate=s.__originalTranslate,s.transform=s.__originalTransform,s.setTransform=s.__originalSetTransform,s.resetTransform=s.__originalResetTransform,s.clip=s.__originalClip,s.moveTo=s.__originalMoveTo,s.lineTo=s.__originalLineTo,s.bezierCurveTo=s.__originalBezierCurveTo,s.rect=s.__originalRect,s.closePath=s.__originalClosePath,s.beginPath=s.__originalBeginPath,delete s._removeMirroring},s.save=function(){e.save(),this.__originalSave()},s.restore=function(){e.restore(),this.__originalRestore()},s.translate=function(n,r){e.translate(n,r),this.__originalTranslate(n,r)},s.scale=function(n,r){e.scale(n,r),this.__originalScale(n,r)},s.transform=function(n,r,i,a,o,l){e.transform(n,r,i,a,o,l),this.__originalTransform(n,r,i,a,o,l)},s.setTransform=function(n,r,i,a,o,l){e.setTransform(n,r,i,a,o,l),this.__originalSetTransform(n,r,i,a,o,l)},s.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},s.rotate=function(n){e.rotate(n),this.__originalRotate(n)},s.clip=function(n){e.clip(n),this.__originalClip(n)},s.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},s.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},s.bezierCurveTo=function(t,n,r,i,a,o){e.bezierCurveTo(t,n,r,i,a,o),this.__originalBezierCurveTo(t,n,r,i,a,o)},s.rect=function(t,n,r,i){e.rect(t,n,r,i),this.__originalRect(t,n,r,i)},s.closePath=function(){e.closePath(),this.__originalClosePath()},s.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class RT{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let r;return this.cache[e]!==void 0?(r=this.cache[e],this.canvasFactory.reset(r,t,n)):(r=this.canvasFactory.create(t,n),this.cache[e]=r),r}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function ip(s,e,t,n,r,i,a,o,l,d){const[h,f,p,m,b,x]=At(s);if(f===0&&p===0){const y=a*h+b,w=Math.round(y),k=o*m+x,C=Math.round(k),P=(a+l)*h+b,N=Math.abs(Math.round(P)-w)||1,I=(o+d)*m+x,M=Math.abs(Math.round(I)-C)||1;return s.setTransform(Math.sign(h),0,0,Math.sign(m),w,C),s.drawImage(e,t,n,r,i,0,0,N,M),s.setTransform(h,f,p,m,b,x),[N,M]}if(h===0&&m===0){const y=o*p+b,w=Math.round(y),k=a*f+x,C=Math.round(k),P=(o+d)*p+b,N=Math.abs(Math.round(P)-w)||1,I=(a+l)*f+x,M=Math.abs(Math.round(I)-C)||1;return s.setTransform(0,Math.sign(f),Math.sign(p),0,w,C),s.drawImage(e,t,n,r,i,0,0,M,N),s.setTransform(h,f,p,m,b,x),[M,N]}s.drawImage(e,t,n,r,i,a,o,l,d);const v=Math.hypot(h,f),g=Math.hypot(p,m);return[v*l,g*d]}function IT(s){const{width:e,height:t}=s;if(e>B1||t>B1)return null;const n=1e3,r=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),i=e+1;let a=new Uint8Array(i*(t+1)),o,l,d;const h=e+7&-8;let f=new Uint8Array(h*t),p=0;for(const g of s.data){let y=128;for(;y>0;)f[p++]=g&y?0:255,y>>=1}let m=0;for(p=0,f[p]!==0&&(a[0]=1,++m),l=1;l<e;l++)f[p]!==f[p+1]&&(a[l]=f[p]?2:1,++m),p++;for(f[p]!==0&&(a[l]=2,++m),o=1;o<t;o++){p=o*h,d=o*i,f[p-h]!==f[p]&&(a[d]=f[p]?1:8,++m);let g=(f[p]?4:0)+(f[p-h]?8:0);for(l=1;l<e;l++)g=(g>>2)+(f[p+1]?4:0)+(f[p-h+1]?8:0),r[g]&&(a[d+l]=r[g],++m),p++;if(f[p-h]!==f[p]&&(a[d+l]=f[p]?2:4,++m),m>n)return null}for(p=h*(t-1),d=o*i,f[p]!==0&&(a[d]=8,++m),l=1;l<e;l++)f[p]!==f[p+1]&&(a[d+l]=f[p]?4:8,++m),p++;if(f[p]!==0&&(a[d+l]=4,++m),m>n)return null;const b=new Int32Array([0,i,-1,0,-i,0,0,0,1]),x=new Path2D;for(o=0;m&&o<=t;o++){let g=o*i;const y=g+e;for(;g<y&&!a[g];)g++;if(g===y)continue;x.moveTo(g%i,o);const w=g;let k=a[g];do{const C=b[k];do g+=C;while(!a[g]);const P=a[g];P!==5&&P!==10?(k=P,a[g]=0):(k=P&51*k>>4,a[g]&=k>>2|k<<2),x.lineTo(g%i,g/i|0),a[g]||--m}while(w!==g);--o}return f=null,a=null,function(g){g.save(),g.scale(1/e,-1/t),g.translate(0,-t),g.fill(x),g.beginPath(),g.restore()}}class U1{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=G2,this.textMatrixScale=1,this.fontMatrix=Ex,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=Ts.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,n){[t,n]=Ce.applyTransform([t,n],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,n)}updateRectMinMax(e,t){const n=Ce.applyTransform(t,e),r=Ce.applyTransform(t.slice(2),e),i=Ce.applyTransform([t[0],t[3]],e),a=Ce.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,n[0],r[0],i[0],a[0]),this.minY=Math.min(this.minY,n[1],r[1],i[1],a[1]),this.maxX=Math.max(this.maxX,n[0],r[0],i[0],a[0]),this.maxY=Math.max(this.maxY,n[1],r[1],i[1],a[1])}updateScalingPathMinMax(e,t){Ce.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,n,r,i,a,o,l,d,h){const f=Ce.bezierBoundingBox(t,n,r,i,a,o,l,d,h);h||this.updateRectMinMax(e,f)}getPathBoundingBox(e=Ds.FILL,t=null){const n=[this.minX,this.minY,this.maxX,this.maxY];if(e===Ds.STROKE){t||gt("Stroke bounding box must include transform.");const r=Ce.singularValueDecompose2dScale(t),i=r[0]*this.lineWidth/2,a=r[1]*this.lineWidth/2;n[0]-=i,n[1]-=a,n[2]+=i,n[3]+=a}return n}updateClipFromPath(){const e=Ce.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=Ds.FILL,t=null){return Ce.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function H1(s,e){if(e instanceof ImageData){s.putImageData(e,0,0);return}const t=e.height,n=e.width,r=t%un,i=(t-r)/un,a=r===0?i:i+1,o=s.createImageData(n,un);let l=0,d;const h=e.data,f=o.data;let p,m,b,x;if(e.kind===Ep.GRAYSCALE_1BPP){const v=h.byteLength,g=new Uint32Array(f.buffer,0,f.byteLength>>2),y=g.length,w=n+7>>3,k=4294967295,C=Qs.isLittleEndian?4278190080:255;for(p=0;p<a;p++){for(b=p<i?un:r,d=0,m=0;m<b;m++){const P=v-l;let N=0;const I=P>w?n:P*8-7,M=I&-8;let L=0,$=0;for(;N<M;N+=8)$=h[l++],g[d++]=$&128?k:C,g[d++]=$&64?k:C,g[d++]=$&32?k:C,g[d++]=$&16?k:C,g[d++]=$&8?k:C,g[d++]=$&4?k:C,g[d++]=$&2?k:C,g[d++]=$&1?k:C;for(;N<I;N++)L===0&&($=h[l++],L=128),g[d++]=$&L?k:C,L>>=1}for(;d<y;)g[d++]=0;s.putImageData(o,0,p*un)}}else if(e.kind===Ep.RGBA_32BPP){for(m=0,x=n*un*4,p=0;p<i;p++)f.set(h.subarray(l,l+x)),l+=x,s.putImageData(o,0,m),m+=un;p<a&&(x=n*r*4,f.set(h.subarray(l,l+x)),s.putImageData(o,0,m))}else if(e.kind===Ep.RGB_24BPP)for(b=un,x=n*b,p=0;p<a;p++){for(p>=i&&(b=r,x=n*b),d=0,m=x;m--;)f[d++]=h[l++],f[d++]=h[l++],f[d++]=h[l++],f[d++]=255;s.putImageData(o,0,p*un)}else throw new Error(`bad image kind: ${e.kind}`)}function G1(s,e){if(e.bitmap){s.drawImage(e.bitmap,0,0);return}const t=e.height,n=e.width,r=t%un,i=(t-r)/un,a=r===0?i:i+1,o=s.createImageData(n,un);let l=0;const d=e.data,h=o.data;for(let f=0;f<a;f++){const p=f<i?un:r;({srcPos:l}=jT({src:d,srcPos:l,dest:h,width:n,height:p,nonBlackColor:0})),s.putImageData(o,0,f*un)}}function eu(s,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of t)s[n]!==void 0&&(e[n]=s[n]);s.setLineDash!==void 0&&(e.setLineDash(s.getLineDash()),e.lineDashOffset=s.lineDashOffset)}function ap(s){if(s.strokeStyle=s.fillStyle="#000000",s.fillRule="nonzero",s.globalAlpha=1,s.lineWidth=1,s.lineCap="butt",s.lineJoin="miter",s.miterLimit=10,s.globalCompositeOperation="source-over",s.font="10px sans-serif",s.setLineDash!==void 0&&(s.setLineDash([]),s.lineDashOffset=0),!Os){const{filter:e}=s;e!=="none"&&e!==""&&(s.filter="none")}}function V1(s,e){if(e)return!0;const t=Ce.singularValueDecompose2dScale(s);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);const n=Math.fround((globalThis.devicePixelRatio||1)*io.PDF_TO_CSS_UNITS);return t[0]<=n&&t[1]<=n}const LT=["butt","round","square"],DT=["miter","round","bevel"],FT={},W1={};var Lr,Jx,eb,tb;const nv=class nv{constructor(e,t,n,r,i,{optionalContentConfig:a,markedContentStack:o=null},l,d){T(this,Lr);this.ctx=e,this.current=new U1(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=r,this.filterFactory=i,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new RT(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=d,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:r=null}){const i=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=r||"#ffffff",this.ctx.fillRect(0,0,i,a),this.ctx.fillStyle=o,n){const l=this.cachedCanvases.getCanvas("transparent",i,a);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...At(this.compositeCtx))}this.ctx.save(),ap(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=At(this.ctx)}executeOperatorList(e,t,n,r){const i=e.argsArray,a=e.fnArray;let o=t||0;const l=i.length;if(l===o)return o;const d=l-o>$1&&typeof n=="function",h=d?Date.now()+PT:0;let f=0;const p=this.commonObjs,m=this.objs;let b;for(;;){if(r!==void 0&&o===r.nextBreakPoint)return r.breakIt(o,n),o;if(b=a[o],b!==fr.dependency)this[b].apply(this,i[o]);else for(const x of i[o]){const v=x.startsWith("g_")?p:m;if(!v.has(x))return v.get(x,n),o}if(o++,o===l)return o;if(d&&++f>$1){if(Date.now()>h)return n(),o;f=0}}}endDrawing(){j(this,Lr,Jx).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),j(this,Lr,eb).call(this)}_scaleImage(e,t){const n=e.width??e.displayWidth,r=e.height??e.displayHeight;let i=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),o=n,l=r,d="prescale1",h,f;for(;i>2&&o>1||a>2&&l>1;){let p=o,m=l;i>2&&o>1&&(p=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),i/=o/p),a>2&&l>1&&(m=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,a/=l/m),h=this.cachedCanvases.getCanvas(d,p,m),f=h.context,f.clearRect(0,0,p,m),f.drawImage(e,0,0,o,l,0,0,p,m),e=h.canvas,o=p,l=m,d=d==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:o,paintHeight:l}}_createMaskCanvas(e){const t=this.ctx,{width:n,height:r}=e,i=this.current.fillColor,a=this.current.patternFill,o=At(t);let l,d,h,f;if((e.bitmap||e.data)&&e.count>1){const I=e.bitmap||e.data.buffer;d=JSON.stringify(a?o:[o.slice(0,4),i]),l=this._cachedBitmapsMap.get(I),l||(l=new Map,this._cachedBitmapsMap.set(I,l));const M=l.get(d);if(M&&!a){const L=Math.round(Math.min(o[0],o[2])+o[4]),$=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:M,offsetX:L,offsetY:$}}h=M}h||(f=this.cachedCanvases.getCanvas("maskCanvas",n,r),G1(f.context,e));let p=Ce.transform(o,[1/n,0,0,-1/r,0,0]);p=Ce.transform(p,[1,0,0,1,0,-r]);const[m,b,x,v]=Ce.getAxialAlignedBoundingBox([0,0,n,r],p),g=Math.round(x-m)||1,y=Math.round(v-b)||1,w=this.cachedCanvases.getCanvas("fillCanvas",g,y),k=w.context,C=m,P=b;k.translate(-C,-P),k.transform(...p),h||(h=this._scaleImage(f.canvas,zr(k)),h=h.img,l&&a&&l.set(d,h)),k.imageSmoothingEnabled=V1(At(k),e.interpolate),ip(k,h,0,0,h.width,h.height,0,0,n,r),k.globalCompositeOperation="source-in";const N=Ce.transform(zr(k),[1,0,0,1,-C,-P]);return k.fillStyle=a?i.getPattern(t,this,N,Ds.FILL):i,k.fillRect(0,0,n,r),l&&!a&&(this.cachedCanvases.delete("fillCanvas"),l.set(d,w.canvas)),{canvas:w.canvas,offsetX:Math.round(C),offsetY:Math.round(P)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=LT[e]}setLineJoin(e){this.ctx.lineJoin=DT[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const n=this.ctx;n.setLineDash!==void 0&&(n.setLineDash(e),n.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,n]of e)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.current.fillAlpha=n,this.ctx.globalAlpha=n;break;case"BM":this.ctx.globalCompositeOperation=n;break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(n,e,t);this.suspendedCtx=this.ctx,this.ctx=r.context;const i=this.ctx;i.setTransform(...At(this.suspendedCtx)),eu(this.suspendedCtx,i),MT(i,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),eu(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,r){const i=r[0],a=r[1],o=r[2]-i,l=r[3]-a;o===0||l===0||(this.genericComposeSMask(t.context,n,o,l,t.subtype,t.backdrop,t.transferMap,i,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,r,i,a,o,l,d,h,f){let p=e.canvas,m=l-h,b=d-f;if(a){const v=Ce.makeHexColor(...a);if(m<0||b<0||m+n>p.width||b+r>p.height){const g=this.cachedCanvases.getCanvas("maskExtension",n,r),y=g.context;y.drawImage(p,-m,-b),y.globalCompositeOperation="destination-atop",y.fillStyle=v,y.fillRect(0,0,n,r),y.globalCompositeOperation="source-over",p=g.canvas,m=b=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const g=new Path2D;g.rect(m,b,n,r),e.clip(g),e.globalCompositeOperation="destination-atop",e.fillStyle=v,e.fillRect(m,b,n,r),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),i==="Alpha"&&o?t.filter=this.filterFactory.addAlphaFilter(o):i==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(o));const x=new Path2D;x.rect(l,d,n,r),t.clip(x),t.globalCompositeOperation="destination-in",t.drawImage(p,m,b,n,r,l,d,n,r),t.restore()}save(){this.inSMaskMode?(eu(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),eu(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,n,r,i,a){this.ctx.transform(e,t,n,r,i,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n){const r=this.ctx,i=this.current;let a=i.x,o=i.y,l,d;const h=At(r),f=h[0]===0&&h[3]===0||h[1]===0&&h[2]===0,p=f?n.slice(0):null;for(let m=0,b=0,x=e.length;m<x;m++)switch(e[m]|0){case fr.rectangle:a=t[b++],o=t[b++];const v=t[b++],g=t[b++],y=a+v,w=o+g;r.moveTo(a,o),v===0||g===0?r.lineTo(y,w):(r.lineTo(y,o),r.lineTo(y,w),r.lineTo(a,w)),f||i.updateRectMinMax(h,[a,o,y,w]),r.closePath();break;case fr.moveTo:a=t[b++],o=t[b++],r.moveTo(a,o),f||i.updatePathMinMax(h,a,o);break;case fr.lineTo:a=t[b++],o=t[b++],r.lineTo(a,o),f||i.updatePathMinMax(h,a,o);break;case fr.curveTo:l=a,d=o,a=t[b+4],o=t[b+5],r.bezierCurveTo(t[b],t[b+1],t[b+2],t[b+3],a,o),i.updateCurvePathMinMax(h,l,d,t[b],t[b+1],t[b+2],t[b+3],a,o,p),b+=6;break;case fr.curveTo2:l=a,d=o,r.bezierCurveTo(a,o,t[b],t[b+1],t[b+2],t[b+3]),i.updateCurvePathMinMax(h,l,d,a,o,t[b],t[b+1],t[b+2],t[b+3],p),a=t[b+2],o=t[b+3],b+=4;break;case fr.curveTo3:l=a,d=o,a=t[b+2],o=t[b+3],r.bezierCurveTo(t[b],t[b+1],a,o,a,o),i.updateCurvePathMinMax(h,l,d,t[b],t[b+1],a,o,a,o,p),b+=4;break;case fr.closePath:r.closePath();break}f&&i.updateScalingPathMinMax(h,p),i.setCurrentPoint(a,o)}closePath(){this.ctx.closePath()}stroke(e=!0){const t=this.ctx,n=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof n=="object"&&(n!=null&&n.getPattern)?(t.save(),t.strokeStyle=n.getPattern(t,this,zr(t),Ds.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){const t=this.ctx,n=this.current.fillColor,r=this.current.patternFill;let i=!1;r&&(t.save(),t.fillStyle=n.getPattern(t,this,zr(t),Ds.FILL),i=!0);const a=this.current.getClippedPathBoundingBox();this.contentVisible&&a!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),i&&t.restore(),e&&this.consumePath(a)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=FT}eoClip(){this.pendingClip=W1}beginText(){this.current.textMatrix=G2,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}const n=new Path2D,r=t.getTransform().invertSelf();for(const{transform:i,x:a,y:o,fontSize:l,path:d}of e)n.addPath(d,new DOMMatrix(i).preMultiplySelf(r).translate(a,o).scale(l,-l));t.clip(n),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var h;const n=this.commonObjs.get(e),r=this.current;if(!n)throw new Error(`Can't find font for ${e}`);if(r.fontMatrix=n.fontMatrix||Ex,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&Ue("Invalid font matrix for font "+e),t<0?(t=-t,r.fontDirection=-1):r.fontDirection=1,this.current.font=n,this.current.fontSize=t,n.isType3Font)return;const i=n.loadedName||"sans-serif",a=((h=n.systemFontInfo)==null?void 0:h.css)||`"${i}", ${n.fallbackName}`;let o="normal";n.black?o="900":n.bold&&(o="bold");const l=n.italic?"italic":"normal";let d=t;t<O1?d=O1:t>z1&&(d=z1),this.current.fontSizeScale=t/d,this.ctx.font=`${l} ${o} ${d}px ${a}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,n,r,i,a){this.current.textMatrix=[e,t,n,r,i,a],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,n,r,i){const a=this.ctx,o=this.current,l=o.font,d=o.textRenderingMode,h=o.fontSize/o.fontSizeScale,f=d&Ts.FILL_STROKE_MASK,p=!!(d&Ts.ADD_TO_PATH_FLAG),m=o.patternFill&&!l.missingFile,b=o.patternStroke&&!l.missingFile;let x;if((l.disableFontFace||p||m||b)&&(x=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||m||b){if(a.save(),a.translate(t,n),a.scale(h,-h),f===Ts.FILL||f===Ts.FILL_STROKE)if(r){const v=a.getTransform();a.setTransform(...r),a.fill(j(this,Lr,tb).call(this,x,v,r))}else a.fill(x);if(f===Ts.STROKE||f===Ts.FILL_STROKE)if(i){const v=a.getTransform();a.setTransform(...i),a.stroke(j(this,Lr,tb).call(this,x,v,i))}else a.lineWidth/=h,a.stroke(x);a.restore()}else(f===Ts.FILL||f===Ts.FILL_STROKE)&&a.fillText(e,t,n),(f===Ts.STROKE||f===Ts.FILL_STROKE)&&a.strokeText(e,t,n);p&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:At(a),x:t,y:n,fontSize:h,path:x})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let n=!1;for(let r=3;r<t.length;r+=4)if(t[r]>0&&t[r]<255){n=!0;break}return qe(this,"isFontSubpixelAAEnabled",n)}showText(e){const t=this.current,n=t.font;if(n.isType3Font)return this.showType3Text(e);const r=t.fontSize;if(r===0)return;const i=this.ctx,a=t.fontSizeScale,o=t.charSpacing,l=t.wordSpacing,d=t.fontDirection,h=t.textHScale*d,f=e.length,p=n.vertical,m=p?1:-1,b=n.defaultVMetrics,x=r*t.fontMatrix[0],v=t.textRenderingMode===Ts.FILL&&!n.disableFontFace&&!t.patternFill;i.save(),i.transform(...t.textMatrix),i.translate(t.x,t.y+t.textRise),d>0?i.scale(h,-1):i.scale(h,1);let g,y;if(t.patternFill){i.save();const N=t.fillColor.getPattern(i,this,zr(i),Ds.FILL);g=At(i),i.restore(),i.fillStyle=N}if(t.patternStroke){i.save();const N=t.strokeColor.getPattern(i,this,zr(i),Ds.STROKE);y=At(i),i.restore(),i.strokeStyle=N}let w=t.lineWidth;const k=t.textMatrixScale;if(k===0||w===0){const N=t.textRenderingMode&Ts.FILL_STROKE_MASK;(N===Ts.STROKE||N===Ts.FILL_STROKE)&&(w=this.getSinglePixelWidth())}else w/=k;if(a!==1&&(i.scale(a,a),w/=a),i.lineWidth=w,n.isInvalidPDFjsFont){const N=[];let I=0;for(const M of e)N.push(M.unicode),I+=M.width;i.fillText(N.join(""),0,0),t.x+=I*x*h,i.restore(),this.compose();return}let C=0,P;for(P=0;P<f;++P){const N=e[P];if(typeof N=="number"){C+=m*N*r/1e3;continue}let I=!1;const M=(N.isSpace?l:0)+o,L=N.fontChar,$=N.accent;let E,D,_=N.width;if(p){const J=N.vmetric||b,W=-(N.vmetric?J[1]:_*.5)*x,Q=J[2]*x;_=J?-J[0]:_,E=W/a,D=(C+Q)/a}else E=C/a,D=0;if(n.remeasure&&_>0){const J=i.measureText(L).width*1e3/r*a;if(_<J&&this.isFontSubpixelAAEnabled){const W=_/J;I=!0,i.save(),i.scale(W,1),E/=W}else _!==J&&(E+=(_-J)/2e3*r/a)}if(this.contentVisible&&(N.isInFont||n.missingFile)){if(v&&!$)i.fillText(L,E,D);else if(this.paintChar(L,E,D,g,y),$){const J=E+r*$.offset.x/a,W=D-r*$.offset.y/a;this.paintChar($.fontChar,J,W,g,y)}}const K=p?_*x-M*d:_*x+M*d;C+=K,I&&i.restore()}p?t.y-=C:t.x+=C*h,i.restore(),this.compose()}showType3Text(e){const t=this.ctx,n=this.current,r=n.font,i=n.fontSize,a=n.fontDirection,o=r.vertical?1:-1,l=n.charSpacing,d=n.wordSpacing,h=n.textHScale*a,f=n.fontMatrix||Ex,p=e.length,m=n.textRenderingMode===Ts.INVISIBLE;let b,x,v,g;if(!(m||i===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...n.textMatrix),t.translate(n.x,n.y),t.scale(h,a),b=0;b<p;++b){if(x=e[b],typeof x=="number"){g=o*x*i/1e3,this.ctx.translate(g,0),n.x+=g*h;continue}const y=(x.isSpace?d:0)+l,w=r.charProcOperatorList[x.operatorListId];if(!w){Ue(`Type3 character "${x.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=x,this.save(),t.scale(i,i),t.transform(...f),this.executeOperatorList(w),this.restore()),v=Ce.applyTransform([x.width,0],f)[0]*i+y,t.translate(v,0),n.x+=v*h}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,n,r,i,a){this.ctx.rect(n,r,i-n,a-r),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const n=e[1],r=this.baseTransform||At(this.ctx),i={createCanvasGraphics:a=>new nv(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new Zx(e,n,this.ctx,i,r)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,n){this.ctx.strokeStyle=this.current.strokeColor=Ce.makeHexColor(e,t,n),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,n){this.ctx.fillStyle=this.current.fillColor=Ce.makeHexColor(e,t,n),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let n;return this.cachedPatterns.has(e)?n=this.cachedPatterns.get(e):(n=TT(this.getObject(e)),this.cachedPatterns.set(e,n)),t&&(n.matrix=t),n}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const n=this._getPattern(e);t.fillStyle=n.getPattern(t,this,zr(t),Ds.SHADING);const r=zr(t);if(r){const{width:i,height:a}=t.canvas,[o,l,d,h]=Ce.getAxialAlignedBoundingBox([0,0,i,a],r);this.ctx.fillRect(o,l,d-o,h-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){gt("Should not call beginInlineImage")}beginImageData(){gt("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=At(this.ctx),t)){const n=t[2]-t[0],r=t[3]-t[1];this.ctx.rect(t[0],t[1],n,r),this.current.updateRectMinMax(At(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||N0("TODO: Support non-isolated groups."),e.knockout&&Ue("Knockout groups not supported.");const n=At(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let r=Ce.getAxialAlignedBoundingBox(e.bbox,At(t));const i=[0,0,t.canvas.width,t.canvas.height];r=Ce.intersect(r,i)||[0,0,0,0];const a=Math.floor(r[0]),o=Math.floor(r[1]),l=Math.max(Math.ceil(r[2])-a,1),d=Math.max(Math.ceil(r[3])-o,1);this.current.startNewPathAndClipBox([0,0,l,d]);let h="groupAt"+this.groupLevel;e.smask&&(h+="_smask_"+this.smaskCounter++%2);const f=this.cachedCanvases.getCanvas(h,l,d),p=f.context;p.translate(-a,-o),p.transform(...n),e.smask?this.smaskStack.push({canvas:f.canvas,context:p,offsetX:a,offsetY:o,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(a,o),t.save()),eu(t,p),this.ctx=p,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const r=At(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...r);const i=Ce.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],r);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(i)}}beginAnnotation(e,t,n,r,i){if(j(this,Lr,Jx).call(this),ap(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const a=t[2]-t[0],o=t[3]-t[1];if(i&&this.annotationCanvasMap){n=n.slice(),n[4]-=t[0],n[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=a,t[3]=o;const[l,d]=Ce.singularValueDecompose2dScale(At(this.ctx)),{viewportScale:h}=this,f=Math.ceil(a*this.outputScaleX*h),p=Math.ceil(o*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(f,p);const{canvas:m,context:b}=this.annotationCanvas;this.annotationCanvasMap.set(e,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=b,this.ctx.save(),this.ctx.setTransform(l,0,0,-d,0,o*d),ap(this.ctx)}else ap(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],a,o),this.ctx.clip(),this.ctx.beginPath()}this.current=new U1(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...n),this.transform(...r)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),j(this,Lr,eb).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const n=this.ctx,r=this.processingType3;if(r&&(r.compiled===void 0&&(r.compiled=IT(e)),r.compiled)){r.compiled(n);return}const i=this._createMaskCanvas(e),a=i.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(a,i.offsetX,i.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n=0,r=0,i,a){if(!this.contentVisible)return;e=this.getObject(e.data,e);const o=this.ctx;o.save();const l=At(o);o.transform(t,n,r,i,0,0);const d=this._createMaskCanvas(e);o.setTransform(1,0,0,1,d.offsetX-l[4],d.offsetY-l[5]);for(let h=0,f=a.length;h<f;h+=2){const p=Ce.transform(l,[t,n,r,i,a[h],a[h+1]]),[m,b]=Ce.applyTransform([0,0],p);o.drawImage(d.canvas,m,b)}o.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,n=this.current.fillColor,r=this.current.patternFill;for(const i of e){const{data:a,width:o,height:l,transform:d}=i,h=this.cachedCanvases.getCanvas("maskCanvas",o,l),f=h.context;f.save();const p=this.getObject(a,i);G1(f,p),f.globalCompositeOperation="source-in",f.fillStyle=r?n.getPattern(f,this,zr(t),Ds.FILL):n,f.fillRect(0,0,o,l),f.restore(),t.save(),t.transform(...d),t.scale(1,-1),ip(t,h.canvas,0,0,o,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){Ue("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,n,r){if(!this.contentVisible)return;const i=this.getObject(e);if(!i){Ue("Dependent image isn't ready yet");return}const a=i.width,o=i.height,l=[];for(let d=0,h=r.length;d<h;d+=2)l.push({transform:[t,0,0,n,r[d],r[d+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(i,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:n,height:r}=e,i=this.cachedCanvases.getCanvas("inlineImage",n,r),a=i.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",i.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,n=e.height,r=this.ctx;if(this.save(),!Os){const{filter:o}=r;o!=="none"&&o!==""&&(r.filter="none")}r.scale(1/t,-1/n);let i;if(e.bitmap)i=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)i=e;else{const l=this.cachedCanvases.getCanvas("inlineImage",t,n).context;H1(l,e),i=this.applyTransferMapsToCanvas(l)}const a=this._scaleImage(i,zr(r));r.imageSmoothingEnabled=V1(At(r),e.interpolate),ip(r,a.img,0,0,a.paintWidth,a.paintHeight,0,-n,t,n),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const n=this.ctx;let r;if(e.bitmap)r=e.bitmap;else{const i=e.width,a=e.height,l=this.cachedCanvases.getCanvas("inlineImage",i,a).context;H1(l,e),r=this.applyTransferMapsToCanvas(l)}for(const i of t)n.save(),n.transform(...i.transform),n.scale(1,-1),ip(n,r,i.x,i.y,i.w,i.h,0,-1,1,1),n.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const n=this.ctx;this.pendingClip&&(t||(this.pendingClip===W1?n.clip("evenodd"):n.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),n.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=At(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),r=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,r)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:n,c:r,d:i}=this.ctx.getTransform();let a,o;if(n===0&&r===0){const l=Math.abs(t),d=Math.abs(i);if(l===d)if(e===0)a=o=1/l;else{const h=l*e;a=o=h<1?1/h:1}else if(e===0)a=1/l,o=1/d;else{const h=l*e,f=d*e;a=h<1?1/h:1,o=f<1?1/f:1}}else{const l=Math.abs(t*i-n*r),d=Math.hypot(t,n),h=Math.hypot(r,i);if(e===0)a=h/l,o=d/l;else{const f=e*l;a=h>f?h/f:1,o=d>f?d/f:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:n}=this.current,[r,i]=this.getScaleForStroking();if(t.lineWidth=n||1,r===1&&i===1){t.stroke();return}const a=t.getLineDash();if(e&&t.save(),t.scale(r,i),a.length>0){const o=Math.max(r,i);t.setLineDash(a.map(l=>l/o)),t.lineDashOffset/=o}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};Lr=new WeakSet,Jx=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},eb=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},tb=function(e,t,n){const r=new Path2D;return r.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),r};let Ec=nv;for(const s in fr)Ec.prototype[s]!==void 0&&(Ec.prototype[fr[s]]=Ec.prototype[s]);var Ph,Mh;class qi{static get workerPort(){return c(this,Ph)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");S(this,Ph,e)}static get workerSrc(){return c(this,Mh)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");S(this,Mh,e)}}Ph=new WeakMap,Mh=new WeakMap,T(qi,Ph,null),T(qi,Mh,"");var Xo,Rh;class OT{constructor({parsedData:e,rawData:t}){T(this,Xo);T(this,Rh);S(this,Xo,e),S(this,Rh,t)}getRaw(){return c(this,Rh)}get(e){return c(this,Xo).get(e)??null}getAll(){return Vy(c(this,Xo))}has(e){return c(this,Xo).has(e)}}Xo=new WeakMap,Rh=new WeakMap;const ec=Symbol("INTERNAL");var Ih,Lh,Dh,Vc;class zT{constructor(e,{name:t,intent:n,usage:r,rbGroups:i}){T(this,Ih,!1);T(this,Lh,!1);T(this,Dh,!1);T(this,Vc,!0);S(this,Ih,!!(e&Mn.DISPLAY)),S(this,Lh,!!(e&Mn.PRINT)),this.name=t,this.intent=n,this.usage=r,this.rbGroups=i}get visible(){if(c(this,Dh))return c(this,Vc);if(!c(this,Vc))return!1;const{print:e,view:t}=this.usage;return c(this,Ih)?(t==null?void 0:t.viewState)!=="OFF":c(this,Lh)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,n=!1){e!==ec&&gt("Internal method `_setVisible` called."),S(this,Dh,n),S(this,Vc,t)}}Ih=new WeakMap,Lh=new WeakMap,Dh=new WeakMap,Vc=new WeakMap;var Na,lt,Wc,qc,Fh,sb;class $T{constructor(e,t=Mn.DISPLAY){T(this,Fh);T(this,Na,null);T(this,lt,new Map);T(this,Wc,null);T(this,qc,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,S(this,qc,e.order);for(const n of e.groups)c(this,lt).set(n.id,new zT(t,n));if(e.baseState==="OFF")for(const n of c(this,lt).values())n._setVisible(ec,!1);for(const n of e.on)c(this,lt).get(n)._setVisible(ec,!0);for(const n of e.off)c(this,lt).get(n)._setVisible(ec,!1);S(this,Wc,this.getHash())}}isVisible(e){if(c(this,lt).size===0)return!0;if(!e)return N0("Optional content group not defined."),!0;if(e.type==="OCG")return c(this,lt).has(e.id)?c(this,lt).get(e.id).visible:(Ue(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return j(this,Fh,sb).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!c(this,lt).has(t))return Ue(`Optional content group not found: ${t}`),!0;if(c(this,lt).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!c(this,lt).has(t))return Ue(`Optional content group not found: ${t}`),!0;if(!c(this,lt).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!c(this,lt).has(t))return Ue(`Optional content group not found: ${t}`),!0;if(!c(this,lt).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!c(this,lt).has(t))return Ue(`Optional content group not found: ${t}`),!0;if(c(this,lt).get(t).visible)return!1}return!0}return Ue(`Unknown optional content policy ${e.policy}.`),!0}return Ue(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){var i;const r=c(this,lt).get(e);if(!r){Ue(`Optional content group not found: ${e}`);return}if(n&&t&&r.rbGroups.length)for(const a of r.rbGroups)for(const o of a)o!==e&&((i=c(this,lt).get(o))==null||i._setVisible(ec,!1,!0));r._setVisible(ec,!!t,!0),S(this,Na,null)}setOCGState({state:e,preserveRB:t}){let n;for(const r of e){switch(r){case"ON":case"OFF":case"Toggle":n=r;continue}const i=c(this,lt).get(r);if(i)switch(n){case"ON":this.setVisibility(r,!0,t);break;case"OFF":this.setVisibility(r,!1,t);break;case"Toggle":this.setVisibility(r,!i.visible,t);break}}S(this,Na,null)}get hasInitialVisibility(){return c(this,Wc)===null||this.getHash()===c(this,Wc)}getOrder(){return c(this,lt).size?c(this,qc)?c(this,qc).slice():[...c(this,lt).keys()]:null}getGroups(){return c(this,lt).size>0?Vy(c(this,lt)):null}getGroup(e){return c(this,lt).get(e)||null}getHash(){if(c(this,Na)!==null)return c(this,Na);const e=new w_;for(const[t,n]of c(this,lt))e.update(`${t}:${n.visible}`);return S(this,Na,e.hexdigest())}}Na=new WeakMap,lt=new WeakMap,Wc=new WeakMap,qc=new WeakMap,Fh=new WeakSet,sb=function(e){const t=e.length;if(t<2)return!0;const n=e[0];for(let r=1;r<t;r++){const i=e[r];let a;if(Array.isArray(i))a=j(this,Fh,sb).call(this,i);else if(c(this,lt).has(i))a=c(this,lt).get(i).visible;else return Ue(`Optional content group not found: ${i}`),!0;switch(n){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return n==="And"};class BT{constructor(e,{disableRange:t=!1,disableStream:n=!1}){qt(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:r,initialData:i,progressiveDone:a,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,(i==null?void 0:i.length)>0){const l=i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=r,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,d)=>{this._onReceiveData({begin:l,chunk:d})}),e.addProgressListener((l,d)=>{this._onProgress({loaded:l,total:d})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const r=this._rangeReaders.some(function(i){return i._begin!==e?!1:(i._enqueue(n),!0)});qt(r,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,n,r,i;e.total===void 0?(n=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||n.call(t,{loaded:e.loaded}):(i=(r=this._fullRequestReader)==null?void 0:r.onProgress)==null||i.call(r,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){qt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new UT(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new HT(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeReaders.slice(0))n.cancel(e);this._pdfDataRangeTransport.abort()}}class UT{constructor(e,t,n=!1,r=null){this._stream=e,this._done=n||!1,this._filename=Xy(r)?r:null,this._queuedChunks=t||[],this._loaded=0;for(const i of this._queuedChunks)this._loaded+=i.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class HT{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function GT(s){let e=!0,t=n("filename\\*","i").exec(s);if(t){t=t[1];let h=o(t);return h=unescape(h),h=l(h),h=d(h),i(h)}if(t=a(s),t){const h=d(t);return i(h)}if(t=n("filename","i").exec(s),t){t=t[1];let h=o(t);return h=d(h),i(h)}function n(h,f){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',f)}function r(h,f){if(h){if(!/^[\x00-\xFF]+$/.test(f))return f;try{const p=new TextDecoder(h,{fatal:!0}),m=C0(f);f=p.decode(m),e=!1}catch{}}return f}function i(h){return e&&/[\x80-\xff]/.test(h)&&(h=r("utf-8",h),e&&(h=r("iso-8859-1",h))),h}function a(h){const f=[];let p;const m=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(p=m.exec(h))!==null;){let[,x,v,g]=p;if(x=parseInt(x,10),x in f){if(x===0)break;continue}f[x]=[v,g]}const b=[];for(let x=0;x<f.length&&x in f;++x){let[v,g]=f[x];g=o(g),v&&(g=unescape(g),x===0&&(g=l(g))),b.push(g)}return b.join("")}function o(h){if(h.startsWith('"')){const f=h.slice(1).split('\\"');for(let p=0;p<f.length;++p){const m=f[p].indexOf('"');m!==-1&&(f[p]=f[p].slice(0,m),f.length=p+1),f[p]=f[p].replaceAll(/\\(.)/g,"$1")}h=f.join('"')}return h}function l(h){const f=h.indexOf("'");if(f===-1)return h;const p=h.slice(0,f),b=h.slice(f+1).replace(/^[^']*'/,"");return r(p,b)}function d(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(f,p,m,b){if(m==="q"||m==="Q")return b=b.replaceAll("_"," "),b=b.replaceAll(/=([0-9a-fA-F]{2})/g,function(x,v){return String.fromCharCode(parseInt(v,16))}),r(p,b);try{b=atob(b)}catch{}return r(p,b)})}return""}function L_(s,e){const t=new Headers;if(!s||!e||typeof e!="object")return t;for(const n in e){const r=e[n];r!==void 0&&t.append(n,r)}return t}function P0(s){try{return new URL(s).origin}catch{}return null}function D_({responseHeaders:s,isHttp:e,rangeChunkSize:t,disableRange:n}){const r={allowRangeRequests:!1,suggestedLength:void 0},i=parseInt(s.get("Content-Length"),10);return!Number.isInteger(i)||(r.suggestedLength=i,i<=2*t)||n||!e||s.get("Accept-Ranges")!=="bytes"||(s.get("Content-Encoding")||"identity")!=="identity"||(r.allowRangeRequests=!0),r}function F_(s){const e=s.get("Content-Disposition");if(e){let t=GT(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Xy(t))return t}return null}function M0(s,e){return s===404||s===0&&e.startsWith("file:")?new eh('Missing PDF "'+e+'".'):new Im(`Unexpected server response (${s}) while retrieving PDF "${e}".`,s)}function O_(s){return s===200||s===206}function z_(s,e,t){return{method:"GET",headers:s,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function $_(s){return s instanceof Uint8Array?s.buffer:s instanceof ArrayBuffer?s:(Ue(`getArrayBuffer - unexpected data format: ${s}`),new Uint8Array(s).buffer)}class q1{constructor(e){Pe(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=L_(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return qt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new VT(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new WT(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class VT{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const n=new Headers(e.headers),r=t.url;fetch(r,z_(n,this._withCredentials,this._abortController)).then(i=>{if(e._responseOrigin=P0(i.url),!O_(i.status))throw M0(i.status,r);this._reader=i.body.getReader(),this._headersCapability.resolve();const a=i.headers,{allowRangeRequests:o,suggestedLength:l}=D_({responseHeaders:a,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=F_(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new ro("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:$_(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class WT{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;const r=e.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController;const i=new Headers(e.headers);i.append("Range",`bytes=${t}-${n-1}`);const a=r.url;fetch(a,z_(i,this._withCredentials,this._abortController)).then(o=>{const l=P0(o.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!O_(o.status))throw M0(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:$_(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const wg=200,kg=206;function qT(s){const e=s.response;return typeof e!="string"?e:C0(e).buffer}class XT{constructor({url:e,httpHeaders:t,withCredentials:n}){Pe(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=L_(this.isHttp,t),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,n=this.currXhrId++,r=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[i,a]of this.headers)t.setRequestHeader(i,a);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),r.expectedStatus=kg):r.expectedStatus=wg,t.responseType="arraybuffer",qt(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),r.onHeadersReceived=e.onHeadersReceived,r.onDone=e.onDone,r.onError=e.onError,r.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){var r;const n=this.pendingRequests[e];n&&((r=n.onProgress)==null||r.call(n,t))}onStateChange(e,t){const n=this.pendingRequests[e];if(!n)return;const r=n.xhr;if(r.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),r.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],r.status===0&&this.isHttp){n.onError(r.status);return}const i=r.status||wg;if(!(i===wg&&n.expectedStatus===kg)&&i!==n.expectedStatus){n.onError(r.status);return}const o=qT(r);if(i===kg){const l=r.getResponseHeader("Content-Range"),d=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);d?n.onDone({begin:parseInt(d[1],10),chunk:o}):(Ue('Missing or invalid "Content-Range" header.'),n.onError(0))}else o?n.onDone({begin:0,chunk:o}):n.onError(r.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class KT{constructor(e){this._source=e,this._manager=new XT(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return qt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new YT(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const n=new QT(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class YT{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=P0(t.responseURL);const n=t.getAllResponseHeaders(),r=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[l,...d]=o.split(": ");return[l,d.join(": ")]}):[]),{allowRangeRequests:i,suggestedLength:a}=D_({responseHeaders:r,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});i&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=F_(r),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=M0(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class QT{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=P0((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=M0(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const ZT=/^[a-z][a-z0-9\-+.]+:/i;function JT(s){if(ZT.test(s))return new URL(s);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(s))}class ej{constructor(e){this.source=e,this.url=JT(e.url),qt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return qt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new tj(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new sj(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class tj{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(r=>{this._contentLength=r.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},r=>{r.code==="ENOENT"&&(r=new eh(`Missing PDF "${this._url}".`)),this._storedError=r,this._headersCapability.reject(r)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new ro("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class sj{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const r=e.source;this._isStreamingSupported=!r.disableStream;const i=process.getBuiltinModule("fs");this._setReadableStream(i.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const nj=1e5,rn=30,rj=.8;var fw,Ca,cn,Oh,zh,Ko,Pi,$h,Bh,Yo,Xc,Kc,Ta,Yc,Uh,Qc,Qo,Hh,Gh,Zo,Jo,Vh,ja,Zc,ra,B_,U_,nb,On,Fp,rb,H_,G_;const Yt=class Yt{constructor({textContentSource:e,container:t,viewport:n}){T(this,ra);T(this,Ca,Promise.withResolvers());T(this,cn,null);T(this,Oh,!1);T(this,zh,!!((fw=globalThis.FontInspector)!=null&&fw.enabled));T(this,Ko,null);T(this,Pi,null);T(this,$h,0);T(this,Bh,0);T(this,Yo,null);T(this,Xc,null);T(this,Kc,0);T(this,Ta,0);T(this,Yc,Object.create(null));T(this,Uh,[]);T(this,Qc,null);T(this,Qo,[]);T(this,Hh,new WeakMap);T(this,Gh,null);var l;if(e instanceof ReadableStream)S(this,Qc,e);else if(typeof e=="object")S(this,Qc,new ReadableStream({start(d){d.enqueue(e),d.close()}}));else throw new Error('No "textContentSource" parameter specified.');S(this,cn,S(this,Xc,t)),S(this,Ta,n.scale*(globalThis.devicePixelRatio||1)),S(this,Kc,n.rotation),S(this,Pi,{div:null,properties:null,ctx:null});const{pageWidth:r,pageHeight:i,pageX:a,pageY:o}=n.rawDims;S(this,Gh,[1,0,0,-1,-a,o+i]),S(this,Bh,r),S(this,$h,i),j(l=Yt,On,H_).call(l),Dl(t,n),c(this,Ca).promise.finally(()=>{c(Yt,Zc).delete(this),S(this,Pi,null),S(this,Yc,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Qs.platform;return qe(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{c(this,Yo).read().then(({value:t,done:n})=>{if(n){c(this,Ca).resolve();return}c(this,Ko)??S(this,Ko,t.lang),Object.assign(c(this,Yc),t.styles),j(this,ra,B_).call(this,t.items),e()},c(this,Ca).reject)};return S(this,Yo,c(this,Qc).getReader()),c(Yt,Zc).add(this),e(),c(this,Ca).promise}update({viewport:e,onBefore:t=null}){var i;const n=e.scale*(globalThis.devicePixelRatio||1),r=e.rotation;if(r!==c(this,Kc)&&(t==null||t(),S(this,Kc,r),Dl(c(this,Xc),{rotation:r})),n!==c(this,Ta)){t==null||t(),S(this,Ta,n);const a={div:null,properties:null,ctx:j(i=Yt,On,Fp).call(i,c(this,Ko))};for(const o of c(this,Qo))a.properties=c(this,Hh).get(o),a.div=o,j(this,ra,nb).call(this,a)}}cancel(){var t;const e=new ro("TextLayer task cancelled.");(t=c(this,Yo))==null||t.cancel(e).catch(()=>{}),S(this,Yo,null),c(this,Ca).reject(e)}get textDivs(){return c(this,Qo)}get textContentItemsStr(){return c(this,Uh)}static cleanup(){if(!(c(this,Zc).size>0)){c(this,Zo).clear();for(const{canvas:e}of c(this,Jo).values())e.remove();c(this,Jo).clear()}}};Ca=new WeakMap,cn=new WeakMap,Oh=new WeakMap,zh=new WeakMap,Ko=new WeakMap,Pi=new WeakMap,$h=new WeakMap,Bh=new WeakMap,Yo=new WeakMap,Xc=new WeakMap,Kc=new WeakMap,Ta=new WeakMap,Yc=new WeakMap,Uh=new WeakMap,Qc=new WeakMap,Qo=new WeakMap,Hh=new WeakMap,Gh=new WeakMap,Zo=new WeakMap,Jo=new WeakMap,Vh=new WeakMap,ja=new WeakMap,Zc=new WeakMap,ra=new WeakSet,B_=function(e){var r,i;if(c(this,Oh))return;(i=c(this,Pi)).ctx??(i.ctx=j(r=Yt,On,Fp).call(r,c(this,Ko)));const t=c(this,Qo),n=c(this,Uh);for(const a of e){if(t.length>nj){Ue("Ignoring additional textDivs for performance reasons."),S(this,Oh,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=c(this,cn);S(this,cn,document.createElement("span")),c(this,cn).classList.add("markedContent"),a.id!==null&&c(this,cn).setAttribute("id",`${a.id}`),o.append(c(this,cn))}else a.type==="endMarkedContent"&&S(this,cn,c(this,cn).parentNode);continue}n.push(a.str),j(this,ra,U_).call(this,a)}},U_=function(e){var x;const t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};c(this,Qo).push(t);const r=Ce.transform(c(this,Gh),e.transform);let i=Math.atan2(r[1],r[0]);const a=c(this,Yc)[e.fontName];a.vertical&&(i+=Math.PI/2);let o=c(this,zh)&&a.fontSubstitution||a.fontFamily;o=Yt.fontFamilyMap.get(o)||o;const l=Math.hypot(r[2],r[3]),d=l*j(x=Yt,On,G_).call(x,o,c(this,Ko));let h,f;i===0?(h=r[4],f=r[5]-d):(h=r[4]+d*Math.sin(i),f=r[5]-d*Math.cos(i));const p="calc(var(--scale-factor)*",m=t.style;c(this,cn)===c(this,Xc)?(m.left=`${(100*h/c(this,Bh)).toFixed(2)}%`,m.top=`${(100*f/c(this,$h)).toFixed(2)}%`):(m.left=`${p}${h.toFixed(2)}px)`,m.top=`${p}${f.toFixed(2)}px)`),m.fontSize=`${p}${(c(Yt,ja)*l).toFixed(2)}px)`,m.fontFamily=o,n.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,c(this,zh)&&(t.dataset.fontName=a.fontSubstitutionLoadedName||e.fontName),i!==0&&(n.angle=i*(180/Math.PI));let b=!1;if(e.str.length>1)b=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const v=Math.abs(e.transform[0]),g=Math.abs(e.transform[3]);v!==g&&Math.max(v,g)/Math.min(v,g)>1.5&&(b=!0)}if(b&&(n.canvasWidth=a.vertical?e.height:e.width),c(this,Hh).set(t,n),c(this,Pi).div=t,c(this,Pi).properties=n,j(this,ra,nb).call(this,c(this,Pi)),n.hasText&&c(this,cn).append(t),n.hasEOL){const v=document.createElement("br");v.setAttribute("role","presentation"),c(this,cn).append(v)}},nb=function(e){var o;const{div:t,properties:n,ctx:r}=e,{style:i}=t;let a="";if(c(Yt,ja)>1&&(a=`scale(${1/c(Yt,ja)})`),n.canvasWidth!==0&&n.hasText){const{fontFamily:l}=i,{canvasWidth:d,fontSize:h}=n;j(o=Yt,On,rb).call(o,r,h*c(this,Ta),l);const{width:f}=r.measureText(t.textContent);f>0&&(a=`scaleX(${d*c(this,Ta)/f}) ${a}`)}n.angle!==0&&(a=`rotate(${n.angle}deg) ${a}`),a.length>0&&(i.transform=a)},On=new WeakSet,Fp=function(e=null){let t=c(this,Jo).get(e||(e=""));if(!t){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),c(this,Jo).set(e,t),c(this,Vh).set(t,{size:0,family:""})}return t},rb=function(e,t,n){const r=c(this,Vh).get(e);t===r.size&&n===r.family||(e.font=`${t}px ${n}`,r.size=t,r.family=n)},H_=function(){if(c(this,ja)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),S(this,ja,e.getBoundingClientRect().height),e.remove()},G_=function(e,t){const n=c(this,Zo).get(e);if(n)return n;const r=j(this,On,Fp).call(this,t);r.canvas.width=r.canvas.height=rn,j(this,On,rb).call(this,r,rn,e);const i=r.measureText("");let a=i.fontBoundingBoxAscent,o=Math.abs(i.fontBoundingBoxDescent);if(a){const h=a/(a+o);return c(this,Zo).set(e,h),r.canvas.width=r.canvas.height=0,h}r.strokeStyle="red",r.clearRect(0,0,rn,rn),r.strokeText("g",0,0);let l=r.getImageData(0,0,rn,rn).data;o=0;for(let h=l.length-1-3;h>=0;h-=4)if(l[h]>0){o=Math.ceil(h/4/rn);break}r.clearRect(0,0,rn,rn),r.strokeText("A",0,rn),l=r.getImageData(0,0,rn,rn).data,a=0;for(let h=0,f=l.length;h<f;h+=4)if(l[h]>0){a=rn-Math.floor(h/4/rn);break}r.canvas.width=r.canvas.height=0;const d=a?a/(a+o):rj;return c(this,Zo).set(e,d),d},T(Yt,On),T(Yt,Zo,new Map),T(Yt,Jo,new Map),T(Yt,Vh,new WeakMap),T(Yt,ja,null),T(Yt,Zc,new Set);let th=Yt;class sh{static textContent(e){const t=[],n={items:t,styles:Object.create(null)};function r(i){var l;if(!i)return;let a=null;const o=i.name;if(o==="#text")a=i.value;else if(sh.shouldBuildText(o))(l=i==null?void 0:i.attributes)!=null&&l.textContent?a=i.attributes.textContent:i.value&&(a=i.value);else return;if(a!==null&&t.push({str:a}),!!i.children)for(const d of i.children)r(d)}return r(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const ij=65536,aj=100,oj=5e3,lj=Os?kT:yT,cj=Os?_T:T_,dj=Os?wT:vT,uj=Os?ST:R_;function hj(s={}){typeof s=="string"||s instanceof URL?s={url:s}:(s instanceof ArrayBuffer||ArrayBuffer.isView(s))&&(s={data:s});const e=new ib,{docId:t}=e,n=s.url?fj(s.url):null,r=s.data?pj(s.data):null,i=s.httpHeaders||null,a=s.withCredentials===!0,o=s.password??null,l=s.range instanceof V_?s.range:null,d=Number.isInteger(s.rangeChunkSize)&&s.rangeChunkSize>0?s.rangeChunkSize:ij;let h=s.worker instanceof Nc?s.worker:null;const f=s.verbosity,p=typeof s.docBaseUrl=="string"&&!j0(s.docBaseUrl)?s.docBaseUrl:null,m=typeof s.cMapUrl=="string"?s.cMapUrl:null,b=s.cMapPacked!==!1,x=s.CMapReaderFactory||cj,v=typeof s.standardFontDataUrl=="string"?s.standardFontDataUrl:null,g=s.StandardFontDataFactory||uj,y=s.stopAtErrors!==!0,w=Number.isInteger(s.maxImageSize)&&s.maxImageSize>-1?s.maxImageSize:-1,k=s.isEvalSupported!==!1,C=typeof s.isOffscreenCanvasSupported=="boolean"?s.isOffscreenCanvasSupported:!Os,P=typeof s.isImageDecoderSupported=="boolean"?s.isImageDecoderSupported:!Os&&(Qs.platform.isFirefox||!globalThis.chrome),N=Number.isInteger(s.canvasMaxAreaInBytes)?s.canvasMaxAreaInBytes:-1,I=typeof s.disableFontFace=="boolean"?s.disableFontFace:Os,M=s.fontExtraProperties===!0,L=s.enableXfa===!0,$=s.ownerDocument||globalThis.document,E=s.disableRange===!0,D=s.disableStream===!0,_=s.disableAutoFetch===!0,K=s.pdfBug===!0,J=s.CanvasFactory||lj,W=s.FilterFactory||dj,Q=s.enableHWA===!0,H=l?l.length:s.length??NaN,oe=typeof s.useSystemFonts=="boolean"?s.useSystemFonts:!Os&&!I,X=typeof s.useWorkerFetch=="boolean"?s.useWorkerFetch:x===T_&&g===R_&&m&&v&&ou(m,document.baseURI)&&ou(v,document.baseURI),U=null;QC(f);const Y={canvasFactory:new J({ownerDocument:$,enableHWA:Q}),filterFactory:new W({docId:t,ownerDocument:$}),cMapReaderFactory:X?null:new x({baseUrl:m,isCompressed:b}),standardFontDataFactory:X?null:new g({baseUrl:v})};if(!h){const fe={verbosity:f,port:qi.workerPort};h=fe.port?Nc.fromPort(fe):new Nc(fe),e._worker=h}const V={docId:t,apiVersion:"4.10.38",data:r,password:o,disableAutoFetch:_,rangeChunkSize:d,length:H,docBaseUrl:p,enableXfa:L,evaluatorOptions:{maxImageSize:w,disableFontFace:I,ignoreErrors:y,isEvalSupported:k,isOffscreenCanvasSupported:C,isImageDecoderSupported:P,canvasMaxAreaInBytes:N,fontExtraProperties:M,useSystemFonts:oe,cMapUrl:X?m:null,standardFontDataUrl:X?v:null}},ee={disableFontFace:I,fontExtraProperties:M,ownerDocument:$,pdfBug:K,styleElement:U,loadingParams:{disableAutoFetch:_,enableXfa:L}};return h.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const fe=h.messageHandler.sendWithPromise("GetDocRequest",V,r?[r.buffer]:null);let se;if(l)se=new BT(l,{disableRange:E,disableStream:D});else if(!r){if(!n)throw new Error("getDocument - no `url` parameter provided.");let ve;if(Os)if(ou(n)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");ve=q1}else ve=ej;else ve=ou(n)?q1:KT;se=new ve({url:n,length:H,httpHeaders:i,withCredentials:a,rangeChunkSize:d,disableRange:E,disableStream:D})}return fe.then(ve=>{if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const ce=new uu(t,ve,h.port),Re=new bj(ce,e,se,ee,Y);e._transport=Re,ce.send("Ready",null)})}).catch(e._capability.reject),e}function fj(s){if(s instanceof URL)return s.href;try{return new URL(s,window.location).href}catch{if(Os&&typeof s=="string")return s}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function pj(s){if(Os&&typeof Buffer<"u"&&s instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength)return s;if(typeof s=="string")return C0(s);if(s instanceof ArrayBuffer||ArrayBuffer.isView(s)||typeof s=="object"&&!isNaN(s==null?void 0:s.length))return new Uint8Array(s);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function X1(s){return typeof s=="object"&&Number.isInteger(s==null?void 0:s.num)&&s.num>=0&&Number.isInteger(s==null?void 0:s.gen)&&s.gen>=0}var Ym;const Qm=class Qm{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${Us(Qm,Ym)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var e,t,n,r;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(i){throw(n=this._worker)!=null&&n.port&&delete this._worker._pendingDestroy,i}this._transport=null,(r=this._worker)==null||r.destroy(),this._worker=null}};Ym=new WeakMap,T(Qm,Ym,0);let ib=Qm;class V_{constructor(e,t,n=!1,r=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=r,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const n of this._rangeListeners)n(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const n of this._progressListeners)n(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){gt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class mj{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return qe(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var Pa,Mi,tr,tc,Op;class gj{constructor(e,t,n,r=!1){T(this,tr);T(this,Pa,null);T(this,Mi,!1);this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=r?new I1:null,this._pdfBug=r,this.commonObjs=n.commonObjs,this.objs=new W_,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:r=0,dontFlip:i=!1}={}){return new Lf({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:i})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return qe(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:n="display",annotationMode:r=pa.ENABLE,transform:i=null,background:a=null,optionalContentConfigPromise:o=null,annotationCanvasMap:l=null,pageColors:d=null,printAnnotationStorage:h=null,isEditing:f=!1}){var k,C;(k=this._stats)==null||k.time("Overall");const p=this._transport.getRenderingIntent(n,r,h,f),{renderingIntent:m,cacheKey:b}=p;S(this,Mi,!1),j(this,tr,Op).call(this),o||(o=this._transport.getOptionalContentConfig(m));let x=this._intentStates.get(b);x||(x=Object.create(null),this._intentStates.set(b,x)),x.streamReaderCancelTimeout&&(clearTimeout(x.streamReaderCancelTimeout),x.streamReaderCancelTimeout=null);const v=!!(m&Mn.PRINT);x.displayReadyCapability||(x.displayReadyCapability=Promise.withResolvers(),x.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(C=this._stats)==null||C.time("Page Request"),this._pumpOperatorList(p));const g=P=>{var N;x.renderTasks.delete(y),(this._maybeCleanupAfterRender||v)&&S(this,Mi,!0),j(this,tr,tc).call(this,!v),P?(y.capability.reject(P),this._abortOperatorList({intentState:x,reason:P instanceof Error?P:new Error(P)})):y.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(N=globalThis.Stats)!=null&&N.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},y=new ob({callback:g,params:{canvasContext:e,viewport:t,transform:i,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:x.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!v,pdfBug:this._pdfBug,pageColors:d});(x.renderTasks||(x.renderTasks=new Set)).add(y);const w=y.task;return Promise.all([x.displayReadyCapability.promise,o]).then(([P,N])=>{var I;if(this.destroyed){g();return}if((I=this._stats)==null||I.time("Rendering"),!(N.renderingIntent&m))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");y.initializeGraphics({transparency:P,optionalContentConfig:N}),y.operatorListChanged()}).catch(g),w}getOperatorList({intent:e="display",annotationMode:t=pa.ENABLE,printAnnotationStorage:n=null,isEditing:r=!1}={}){var d;function i(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const a=this._transport.getRenderingIntent(e,t,n,r,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=i,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(d=this._stats)==null||d.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>sh.textContent(n));const t=this.streamTextContent(e);return new Promise(function(n,r){function i(){a.read().then(function({value:l,done:d}){if(d){n(o);return}o.lang??(o.lang=l.lang),Object.assign(o.styles,l.styles),o.items.push(...l.items),i()},r)}const a=t.getReader(),o={items:[],styles:Object.create(null),lang:null};i()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),S(this,Mi,!1),j(this,tr,Op).call(this),Promise.all(e)}cleanup(e=!1){S(this,Mi,!0);const t=j(this,tr,tc).call(this,!1);return e&&t&&this._stats&&(this._stats=new I1),t}_startRenderPage(e,t){var r,i;const n=this._intentStates.get(t);n&&((r=this._stats)==null||r.timeEnd("Page Request"),(i=n.displayReadyCapability)==null||i.resolve(e))}_renderPageChunk(e,t){for(let n=0,r=e.length;n<r;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const n of t.renderTasks)n.operatorListChanged();e.lastChunk&&j(this,tr,tc).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:r}){const{map:i,transfer:a}=n,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:i,modifiedIds:r},a).getReader(),d=this._intentStates.get(t);d.streamReader=l;const h=()=>{l.read().then(({value:f,done:p})=>{if(p){d.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(f,d),h())},f=>{if(d.streamReader=null,!this._transport.destroyed){if(d.operatorList){d.operatorList.lastChunk=!0;for(const p of d.renderTasks)p.operatorListChanged();j(this,tr,tc).call(this,!0)}if(d.displayReadyCapability)d.displayReadyCapability.reject(f);else if(d.opListReadCapability)d.opListReadCapability.reject(f);else throw f}})};h()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof qy){let r=aj;t.extraDelay>0&&t.extraDelay<1e3&&(r+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},r);return}}if(e.streamReader.cancel(new ro(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[r,i]of this._intentStates)if(i===e){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}Pa=new WeakMap,Mi=new WeakMap,tr=new WeakSet,tc=function(e=!1){if(j(this,tr,Op).call(this),!c(this,Mi)||this.destroyed)return!1;if(e)return S(this,Pa,setTimeout(()=>{S(this,Pa,null),j(this,tr,tc).call(this,!1)},oj)),!1;for(const{renderTasks:t,operatorList:n}of this._intentStates.values())if(t.size>0||!n.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),S(this,Mi,!1),!0},Op=function(){c(this,Pa)&&(clearTimeout(c(this,Pa)),S(this,Pa,null))};var Ri,Zm;class xj{constructor(){T(this,Ri,new Map);T(this,Zm,Promise.resolve())}postMessage(e,t){const n={data:structuredClone(e,t?{transfer:t}:null)};c(this,Zm).then(()=>{for(const[r]of c(this,Ri))r.call(this,n)})}addEventListener(e,t,n=null){let r=null;if((n==null?void 0:n.signal)instanceof AbortSignal){const{signal:i}=n;if(i.aborted){Ue("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(e,t);r=()=>i.removeEventListener("abort",a),i.addEventListener("abort",a)}c(this,Ri).set(t,r)}removeEventListener(e,t){const n=c(this,Ri).get(t);n==null||n(),c(this,Ri).delete(t)}terminate(){for(const[,e]of c(this,Ri))e==null||e();c(this,Ri).clear()}}Ri=new WeakMap,Zm=new WeakMap;var Jm,el,tl,Jc,zp,ed,$p;const St=class St{constructor({name:e=null,port:t=null,verbosity:n=ZC()}={}){T(this,Jc);var r;if(this.name=e,this.destroyed=!1,this.verbosity=n,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if((r=c(St,tl))!=null&&r.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(c(St,tl)||S(St,tl,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new uu("main","worker",e),this._messageHandler.on("ready",function(){}),j(this,Jc,zp).call(this)}_initialize(){if(c(St,el)||c(St,ed,$p)){this._setupFakeWorker();return}let{workerSrc:e}=St;try{St._isSameOrigin(window.location.href,e)||(e=St._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),n=new uu("main","worker",t),r=()=>{i.abort(),n.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},i=new AbortController;t.addEventListener("error",()=>{this._webWorker||r()},{signal:i.signal}),n.on("test",o=>{if(i.abort(),this.destroyed||!o){r();return}this._messageHandler=n,this._port=t,this._webWorker=t,j(this,Jc,zp).call(this)}),n.on("ready",o=>{if(i.abort(),this.destroyed){r();return}try{a()}catch{this._setupFakeWorker()}});const a=()=>{const o=new Uint8Array;n.send("test",o,[o.buffer])};a();return}catch{N0("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){c(St,el)||(Ue("Setting up fake worker."),S(St,el,!0)),St._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const t=new xj;this._port=t;const n=`fake${Us(St,Jm)._++}`,r=new uu(n+"_worker",n,t);e.setup(r,t),this._messageHandler=new uu(n,n+"_worker",t),j(this,Jc,zp).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){var e,t,n;this.destroyed=!0,(e=this._webWorker)==null||e.terminate(),this._webWorker=null,(t=c(St,tl))==null||t.delete(this._port),this._port=null,(n=this._messageHandler)==null||n.destroy(),this._messageHandler=null}static fromPort(e){var n;if(!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const t=(n=c(this,tl))==null?void 0:n.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new St(e)}static get workerSrc(){if(qi.workerSrc)return qi.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return qe(this,"_setupFakeWorkerGlobal",(async()=>c(this,ed,$p)?c(this,ed,$p):(await import(this.workerSrc)).WorkerMessageHandler)())}};Jm=new WeakMap,el=new WeakMap,tl=new WeakMap,Jc=new WeakSet,zp=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},ed=new WeakSet,$p=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},T(St,ed),T(St,Jm,0),T(St,el,!1),T(St,tl),Os&&(S(St,el,!0),qi.workerSrc||(qi.workerSrc="./pdf.worker.mjs")),St._isSameOrigin=(e,t)=>{let n;try{if(n=new URL(e),!n.origin||n.origin==="null")return!1}catch{return!1}const r=new URL(t,n);return n.origin===r.origin},St._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};let Nc=St;var Ii,Zr,td,sd,Li,sl,gu;class bj{constructor(e,t,n,r,i){T(this,sl);T(this,Ii,new Map);T(this,Zr,new Map);T(this,td,new Map);T(this,sd,new Map);T(this,Li,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new W_,this.fontLoader=new xT({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this.loadingParams=r.loadingParams,this._params=r,this.canvasFactory=i.canvasFactory,this.filterFactory=i.filterFactory,this.cMapReaderFactory=i.cMapReaderFactory,this.standardFontDataFactory=i.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return qe(this,"annotationStorage",new Qy)}getRenderingIntent(e,t=pa.ENABLE,n=null,r=!1,i=!1){let a=Mn.DISPLAY,o=Xx;switch(e){case"any":a=Mn.ANY;break;case"display":break;case"print":a=Mn.PRINT;break;default:Ue(`getRenderingIntent - invalid intent: ${e}`)}const l=a&Mn.PRINT&&n instanceof __?n:this.annotationStorage;switch(t){case pa.DISABLE:a+=Mn.ANNOTATIONS_DISABLE;break;case pa.ENABLE:break;case pa.ENABLE_FORMS:a+=Mn.ANNOTATIONS_FORMS;break;case pa.ENABLE_STORAGE:a+=Mn.ANNOTATIONS_STORAGE,o=l.serializable;break;default:Ue(`getRenderingIntent - invalid annotationMode: ${t}`)}r&&(a+=Mn.IS_EDITING),i&&(a+=Mn.OPLIST);const{ids:d,hash:h}=l.modifiedIds,f=[a,o.hash,h];return{renderingIntent:a,cacheKey:f.join("_"),annotationStorageSerializable:o,modifiedIds:d}}destroy(){var n;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(n=c(this,Li))==null||n.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const r of c(this,Zr).values())e.push(r._destroy());c(this,Zr).clear(),c(this,td).clear(),c(this,sd).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var r,i;this.commonObjs.clear(),this.fontLoader.clear(),c(this,Ii).clear(),this.filterFactory.destroy(),th.cleanup(),(r=this._networkStream)==null||r.cancelAllRequests(new ro("Worker was terminated.")),(i=this.messageHandler)==null||i.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,r)=>{qt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=i=>{this._lastProgress={loaded:i.loaded,total:i.total}},r.onPull=()=>{this._fullReader.read().then(function({value:i,done:a}){if(a){r.close();return}qt(i instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(i),1,[i])}).catch(i=>{r.error(i)})},r.onCancel=i=>{this._fullReader.cancel(i),r.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("ReaderHeadersReady",async n=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:r,isRangeSupported:i,contentLength:a}=this._fullReader;return(!r||!i)&&(this._lastProgress&&((o=t.onProgress)==null||o.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var d;(d=t.onProgress)==null||d.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:r,isRangeSupported:i,contentLength:a}}),e.on("GetRangeReader",(n,r)=>{qt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const i=this._networkStream.getRangeReader(n.begin,n.end);if(!i){r.close();return}r.onPull=()=>{i.read().then(function({value:a,done:o}){if(o){r.close();return}qt(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{r.error(a)})},r.onCancel=a=>{i.cancel(a),r.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new mj(n,this))}),e.on("DocException",n=>{t._capability.reject(an(n))}),e.on("PasswordRequest",n=>{S(this,Li,Promise.withResolvers());try{if(!t.onPassword)throw an(n);const r=i=>{i instanceof Error?c(this,Li).reject(i):c(this,Li).resolve({password:i})};t.onPassword(r,n.code)}catch(r){c(this,Li).reject(r)}return c(this,Li).promise}),e.on("DataLoaded",n=>{var r;(r=t.onProgress)==null||r.call(t,{loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;c(this,Zr).get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,r,i])=>{var a;if(this.destroyed||this.commonObjs.has(n))return null;switch(r){case"Font":const{disableFontFace:o,fontExtraProperties:l,pdfBug:d}=this._params;if("error"in i){const m=i.error;Ue(`Error during font loading: ${m}`),this.commonObjs.resolve(n,m);break}const h=d&&((a=globalThis.FontInspector)!=null&&a.enabled)?(m,b)=>globalThis.FontInspector.fontAdded(m,b):null,f=new bT(i,{disableFontFace:o,fontExtraProperties:l,inspectFont:h});this.fontLoader.bind(f).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!l&&f.data&&(f.data=null),this.commonObjs.resolve(n,f)});break;case"CopyLocalImage":const{imageRef:p}=i;qt(p,"The imageRef must be defined.");for(const m of c(this,Zr).values())for(const[,b]of m.objs)if((b==null?void 0:b.ref)===p)return b.dataLen?(this.commonObjs.resolve(n,structuredClone(b)),b.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,i);break;default:throw new Error(`Got unknown common object type ${r}`)}return null}),e.on("obj",([n,r,i,a])=>{var l;if(this.destroyed)return;const o=c(this,Zr).get(r);if(!o.objs.has(n)){if(o._intentStates.size===0){(l=a==null?void 0:a.bitmap)==null||l.close();return}switch(i){case"Image":o.objs.resolve(n,a),(a==null?void 0:a.dataLen)>qC&&(o._maybeCleanupAfterRender=!0);break;case"Pattern":o.objs.resolve(n,a);break;default:throw new Error(`Got unknown object type ${i}`)}}}),e.on("DocProgress",n=>{var r;this.destroyed||(r=t.onProgress)==null||r.call(t,{loaded:n.loaded,total:n.total})}),e.on("FetchBuiltInCMap",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(n)}),e.on("FetchStandardFontData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var n;this.annotationStorage.size<=0&&Ue("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((n=this._fullReader)==null?void 0:n.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=c(this,td).get(t);if(n)return n;const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(i=>{if(this.destroyed)throw new Error("Transport destroyed");i.refStr&&c(this,sd).set(i.refStr,e);const a=new gj(t,i,this,this._params.pdfBug);return c(this,Zr).set(t,a),a});return c(this,td).set(t,r),r}getPageIndex(e){return X1(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return j(this,sl,gu).call(this,"GetFieldObjects")}hasJSActions(){return j(this,sl,gu).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return j(this,sl,gu).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return j(this,sl,gu).call(this,"GetOptionalContentConfig").then(t=>new $T(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=c(this,Ii).get(e);if(t)return t;const n=this.messageHandler.sendWithPromise(e,null).then(r=>{var i,a;return{info:r[0],metadata:r[1]?new OT(r[1]):null,contentDispositionFilename:((i=this._fullReader)==null?void 0:i.filename)??null,contentLength:((a=this._fullReader)==null?void 0:a.contentLength)??null}});return c(this,Ii).set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of c(this,Zr).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),c(this,Ii).clear(),this.filterFactory.destroy(!0),th.cleanup()}}cachedPageNumber(e){if(!X1(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return c(this,sd).get(t)??null}}Ii=new WeakMap,Zr=new WeakMap,td=new WeakMap,sd=new WeakMap,Li=new WeakMap,sl=new WeakSet,gu=function(e,t=null){const n=c(this,Ii).get(e);if(n)return n;const r=this.messageHandler.sendWithPromise(e,t);return c(this,Ii).set(e,r),r};const tu=Symbol("INITIAL_DATA");var _n,Wh,ab;class W_{constructor(){T(this,Wh);T(this,_n,Object.create(null))}get(e,t=null){if(t){const r=j(this,Wh,ab).call(this,e);return r.promise.then(()=>t(r.data)),null}const n=c(this,_n)[e];if(!n||n.data===tu)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){const t=c(this,_n)[e];return!!t&&t.data!==tu}delete(e){const t=c(this,_n)[e];return!t||t.data===tu?!1:(delete c(this,_n)[e],!0)}resolve(e,t=null){const n=j(this,Wh,ab).call(this,e);n.data=t,n.resolve()}clear(){var e;for(const t in c(this,_n)){const{data:n}=c(this,_n)[t];(e=n==null?void 0:n.bitmap)==null||e.close()}S(this,_n,Object.create(null))}*[Symbol.iterator](){for(const e in c(this,_n)){const{data:t}=c(this,_n)[e];t!==tu&&(yield[e,t])}}}_n=new WeakMap,Wh=new WeakSet,ab=function(e){var t;return(t=c(this,_n))[e]||(t[e]={...Promise.withResolvers(),data:tu})};var Ma;class yj{constructor(e){T(this,Ma,null);S(this,Ma,e),this.onContinue=null}get promise(){return c(this,Ma).capability.promise}cancel(e=0){c(this,Ma).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=c(this,Ma).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=c(this,Ma);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}Ma=new WeakMap;var Ra,nl;const wo=class wo{constructor({callback:e,params:t,objs:n,commonObjs:r,annotationCanvasMap:i,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:d,useRequestAnimationFrame:h=!1,pdfBug:f=!1,pageColors:p=null}){T(this,Ra,null);this.callback=e,this.params=t,this.objs=n,this.commonObjs=r,this.annotationCanvasMap=i,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=d,this._pdfBug=f,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=h===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new yj(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var o,l;if(this.cancelled)return;if(this._canvas){if(c(wo,nl).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");c(wo,nl).add(this._canvas)}this._pdfBug&&((o=globalThis.StepperManager)!=null&&o.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:n,viewport:r,transform:i,background:a}=this.params;this.gfx=new Ec(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:i,viewport:r,transparency:e,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(e=null,t=0){var n;this.running=!1,this.cancelled=!0,(n=this.gfx)==null||n.endDrawing(),c(this,Ra)&&(window.cancelAnimationFrame(c(this,Ra)),S(this,Ra,null)),c(wo,nl).delete(this._canvas),this.callback(e||new qy(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?S(this,Ra,window.requestAnimationFrame(()=>{S(this,Ra,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),c(wo,nl).delete(this._canvas),this.callback())))}};Ra=new WeakMap,nl=new WeakMap,T(wo,nl,new WeakSet);let ob=wo;const vj="4.10.38",wj="f9bea397f";function K1(s){return Math.floor(Math.max(0,Math.min(1,s))*255).toString(16).padStart(2,"0")}function su(s){return Math.max(0,Math.min(255,255*s))}class Y1{static CMYK_G([e,t,n,r]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+r)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=su(e),[e,e,e]}static G_HTML([e]){const t=K1(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(su)}static RGB_HTML(e){return`#${e.map(K1).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,r]){return["RGB",1-Math.min(1,e+r),1-Math.min(1,n+r),1-Math.min(1,t+r)]}static CMYK_rgb([e,t,n,r]){return[su(1-Math.min(1,e+r)),su(1-Math.min(1,n+r)),su(1-Math.min(1,t+r))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){const r=1-e,i=1-t,a=1-n,o=Math.min(r,i,a);return["CMYK",r,i,a,o]}}class kj{create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const r=this._createSVG("svg:svg");return r.setAttribute("version","1.1"),n||(r.setAttribute("width",`${e}px`),r.setAttribute("height",`${t}px`)),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox",`0 0 ${e} ${t}`),r}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){gt("Abstract method `_createSVG` called.")}}class Jy extends kj{_createSVG(e){return document.createElementNS(pi,e)}}class q_{static setupStorage(e,t,n,r,i){const a=r.getValue(t,{value:null});switch(n.name){case"textarea":if(a.value!==null&&(e.textContent=a.value),i==="print")break;e.addEventListener("input",o=>{r.setValue(t,{value:o.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(a.value===n.attributes.xfaOn?e.setAttribute("checked",!0):a.value===n.attributes.xfaOff&&e.removeAttribute("checked"),i==="print")break;e.addEventListener("change",o=>{r.setValue(t,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&e.setAttribute("value",a.value),i==="print")break;e.addEventListener("input",o=>{r.setValue(t,{value:o.target.value})})}break;case"select":if(a.value!==null){e.setAttribute("value",a.value);for(const o of n.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}e.addEventListener("input",o=>{const l=o.target.options,d=l.selectedIndex===-1?"":l[l.selectedIndex].value;r.setValue(t,{value:d})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:r,linkService:i}){const{attributes:a}=t,o=e instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${r}`);for(const[l,d]of Object.entries(a))if(d!=null)switch(l){case"class":d.length&&e.setAttribute(l,d.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",d);break;case"style":Object.assign(e.style,d);break;case"textContent":e.textContent=d;break;default:(!o||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,d)}o&&i.addLinkAttributes(e,a.href,a.newWindow),n&&a.dataId&&this.setupStorage(e,a.dataId,t,n)}static render(e){var f,p;const t=e.annotationStorage,n=e.linkService,r=e.xfaHtml,i=e.intent||"display",a=document.createElement(r.name);r.attributes&&this.setAttributes({html:a,element:r,intent:i,linkService:n});const o=i!=="richText",l=e.div;if(l.append(a),e.viewport){const m=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=m}o&&l.setAttribute("class","xfaLayer xfaFont");const d=[];if(r.children.length===0){if(r.value){const m=document.createTextNode(r.value);a.append(m),o&&sh.shouldBuildText(r.name)&&d.push(m)}return{textDivs:d}}const h=[[r,-1,a]];for(;h.length>0;){const[m,b,x]=h.at(-1);if(b+1===m.children.length){h.pop();continue}const v=m.children[++h.at(-1)[1]];if(v===null)continue;const{name:g}=v;if(g==="#text"){const w=document.createTextNode(v.value);d.push(w),x.append(w);continue}const y=(f=v==null?void 0:v.attributes)!=null&&f.xmlns?document.createElementNS(v.attributes.xmlns,g):document.createElement(g);if(x.append(y),v.attributes&&this.setAttributes({html:y,element:v,storage:t,intent:i,linkService:n}),((p=v.children)==null?void 0:p.length)>0)h.push([v,-1,y]);else if(v.value){const w=document.createTextNode(v.value);o&&sh.shouldBuildText(g)&&d.push(w),y.append(w)}}for(const m of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:d}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Ff=1e3,_j=9,Ol=new WeakSet;function to(s){return{width:s[2]-s[0],height:s[3]-s[1]}}class Sj{static create(e){switch(e.data.annotationType){case Kt.LINK:return new X_(e);case Kt.TEXT:return new Aj(e);case Kt.WIDGET:switch(e.data.fieldType){case"Tx":return new Ej(e);case"Btn":return e.data.radioButton?new Q_(e):e.data.checkBox?new Cj(e):new Tj(e);case"Ch":return new jj(e);case"Sig":return new Nj(e)}return new Vl(e);case Kt.POPUP:return new cb(e);case Kt.FREETEXT:return new sS(e);case Kt.LINE:return new Mj(e);case Kt.SQUARE:return new Rj(e);case Kt.CIRCLE:return new Ij(e);case Kt.POLYLINE:return new nS(e);case Kt.CARET:return new Dj(e);case Kt.INK:return new ev(e);case Kt.POLYGON:return new Lj(e);case Kt.HIGHLIGHT:return new rS(e);case Kt.UNDERLINE:return new Fj(e);case Kt.SQUIGGLY:return new Oj(e);case Kt.STRIKEOUT:return new zj(e);case Kt.STAMP:return new iS(e);case Kt.FILEATTACHMENT:return new $j(e);default:return new Ut(e)}}}var rl,nd,rd,qh,lb;const rv=class rv{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:r=!1}={}){T(this,qh);T(this,rl,null);T(this,nd,!1);T(this,rd,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(n)),r&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:n}){return!!(e!=null&&e.str||t!=null&&t.str||n!=null&&n.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return rv._hasPopupData(this.data)}updateEdited(e){var n;if(!this.container)return;c(this,rl)||S(this,rl,{rect:this.data.rect.slice(0)});const{rect:t}=e;t&&j(this,qh,lb).call(this,t),(n=c(this,rd))==null||n.popup.updateEdited(e)}resetEdited(){var e;c(this,rl)&&(j(this,qh,lb).call(this,c(this,rl).rect),(e=c(this,rd))==null||e.popup.resetEdited(),S(this,rl,null))}_createContainer(e){const{data:t,parent:{page:n,viewport:r}}=this,i=document.createElement("section");i.setAttribute("data-annotation-id",t.id),this instanceof Vl||(i.tabIndex=Ff);const{style:a}=i;if(a.zIndex=this.parent.zIndex++,t.alternativeText&&(i.title=t.alternativeText),t.noRotate&&i.classList.add("norotate"),!t.rect||this instanceof cb){const{rotation:x}=t;return!t.hasOwnCanvas&&x!==0&&this.setRotation(x,i),i}const{width:o,height:l}=to(t.rect);if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;const x=t.borderStyle.horizontalCornerRadius,v=t.borderStyle.verticalCornerRadius;if(x>0||v>0){const y=`calc(${x}px * var(--scale-factor)) / calc(${v}px * var(--scale-factor))`;a.borderRadius=y}else if(this instanceof Q_){const y=`calc(${o}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;a.borderRadius=y}switch(t.borderStyle.style){case Jd.SOLID:a.borderStyle="solid";break;case Jd.DASHED:a.borderStyle="dashed";break;case Jd.BEVELED:Ue("Unimplemented border style: beveled");break;case Jd.INSET:Ue("Unimplemented border style: inset");break;case Jd.UNDERLINE:a.borderBottomStyle="solid";break}const g=t.borderColor||null;g?(S(this,nd,!0),a.borderColor=Ce.makeHexColor(g[0]|0,g[1]|0,g[2]|0)):a.borderWidth=0}const d=Ce.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:h,pageHeight:f,pageX:p,pageY:m}=r.rawDims;a.left=`${100*(d[0]-p)/h}%`,a.top=`${100*(d[1]-m)/f}%`;const{rotation:b}=t;return t.hasOwnCanvas||b===0?(a.width=`${100*o/h}%`,a.height=`${100*l/f}%`):this.setRotation(b,i),i}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:r}=this.parent.viewport.rawDims,{width:i,height:a}=to(this.data.rect);let o,l;e%180===0?(o=100*i/n,l=100*a/r):(o=100*a/n,l=100*i/r),t.style.width=`${o}%`,t.style.height=`${l}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,n,r)=>{const i=r.detail[t],a=i[0],o=i.slice(1);r.target.style[n]=Y1[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[n]:Y1[`${a}_rgb`](o)})};return qe(this,"_commonActions",{display:t=>{const{display:n}=t.detail,r=n%2===1;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:r,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){const n=this._commonActions;for(const r of Object.keys(t.detail)){const i=e[r]||n[r];i==null||i(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const n=this._commonActions;for(const[r,i]of Object.entries(t)){const a=n[r];if(a){const o={detail:{[r]:i},target:e};a(o),delete t[r]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,n,r,i]=this.data.rect.map(x=>Math.fround(x));if(e.length===8){const[x,v,g,y]=e.subarray(2,6);if(r===x&&i===v&&t===g&&n===y)return}const{style:a}=this.container;let o;if(c(this,nd)){const{borderColor:x,borderWidth:v}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${x}" stroke-width="${v}">`],this.container.classList.add("hasBorder")}const l=r-t,d=i-n,{svgFactory:h}=this,f=h.createElement("svg");f.classList.add("quadrilateralsContainer"),f.setAttribute("width",0),f.setAttribute("height",0);const p=h.createElement("defs");f.append(p);const m=h.createElement("clipPath"),b=`clippath_${this.data.id}`;m.setAttribute("id",b),m.setAttribute("clipPathUnits","objectBoundingBox"),p.append(m);for(let x=2,v=e.length;x<v;x+=8){const g=e[x],y=e[x+1],w=e[x+2],k=e[x+3],C=h.createElement("rect"),P=(w-t)/l,N=(i-y)/d,I=(g-w)/l,M=(y-k)/d;C.setAttribute("x",P),C.setAttribute("y",N),C.setAttribute("width",I),C.setAttribute("height",M),m.append(C),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${P}" y="${N}" width="${I}" height="${M}"/>`)}c(this,nd)&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(f),this.container.style.clipPath=`url(#${b})`}_createPopup(){const{data:e}=this,t=S(this,rd,new cb({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){gt("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const n=[];if(this._fieldObjects){const r=this._fieldObjects[e];if(r)for(const{page:i,id:a,exportValues:o}of r){if(i===-1||a===t)continue;const l=typeof o=="string"?o:null,d=document.querySelector(`[data-element-id="${a}"]`);if(d&&!Ol.has(d)){Ue(`_getElementsByName - element not allowed: ${a}`);continue}n.push({id:a,exportValue:l,domElement:d})}return n}for(const r of document.getElementsByName(e)){const{exportValue:i}=r,a=r.getAttribute("data-element-id");a!==t&&Ol.has(r)&&n.push({id:a,exportValue:i,domElement:r})}return n}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var n;(n=this.linkService.eventBus)==null||n.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}};rl=new WeakMap,nd=new WeakMap,rd=new WeakMap,qh=new WeakSet,lb=function(e){const{container:{style:t},data:{rect:n,rotation:r},parent:{viewport:{rawDims:{pageWidth:i,pageHeight:a,pageX:o,pageY:l}}}}=this;n==null||n.splice(0,4,...e);const{width:d,height:h}=to(e);t.left=`${100*(e[0]-o)/i}%`,t.top=`${100*(a-e[3]+l)/a}%`,r===0?(t.width=`${100*d/i}%`,t.height=`${100*h/a}%`):this.setRotation(r)};let Ut=rv;var In,xo,K_,Y_;class X_ extends Ut{constructor(t,n=null){super(t,{isRenderable:!0,ignoreBorder:!!(n!=null&&n.ignoreBorder),createQuadrilaterals:!0});T(this,In);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:n}=this,r=document.createElement("a");r.setAttribute("data-element-id",t.id);let i=!1;return t.url?(n.addLinkAttributes(r,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(r,t.action),i=!0):t.attachment?(j(this,In,K_).call(this,r,t.attachment,t.attachmentDest),i=!0):t.setOCGState?(j(this,In,Y_).call(this,r,t.setOCGState),i=!0):t.dest?(this._bindLink(r,t.dest),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(r,t),i=!0),t.resetForm?(this._bindResetFormAction(r,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(r,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(r),this.container}_bindLink(t,n){t.href=this.linkService.getDestinationHash(n),t.onclick=()=>(n&&this.linkService.goToDestination(n),!1),(n||n==="")&&j(this,In,xo).call(this)}_bindNamedAction(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(n),!1),j(this,In,xo).call(this)}_bindJSAction(t,n){t.href=this.linkService.getAnchorUrl("");const r=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(n.actions)){const a=r.get(i);a&&(t[a]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:n.id,name:i}}),!1})}t.onclick||(t.onclick=()=>!1),j(this,In,xo).call(this)}_bindResetFormAction(t,n){const r=t.onclick;if(r||(t.href=this.linkService.getAnchorUrl("")),j(this,In,xo).call(this),!this._fieldObjects){Ue('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),r||(t.onclick=()=>!1);return}t.onclick=()=>{var f;r==null||r();const{fields:i,refs:a,include:o}=n,l=[];if(i.length!==0||a.length!==0){const p=new Set(a);for(const m of i){const b=this._fieldObjects[m]||[];for(const{id:x}of b)p.add(x)}for(const m of Object.values(this._fieldObjects))for(const b of m)p.has(b.id)===o&&l.push(b)}else for(const p of Object.values(this._fieldObjects))l.push(...p);const d=this.annotationStorage,h=[];for(const p of l){const{id:m}=p;switch(h.push(m),p.type){case"text":{const x=p.defaultValue||"";d.setValue(m,{value:x});break}case"checkbox":case"radiobutton":{const x=p.defaultValue===p.exportValues;d.setValue(m,{value:x});break}case"combobox":case"listbox":{const x=p.defaultValue||"";d.setValue(m,{value:x});break}default:continue}const b=document.querySelector(`[data-element-id="${m}"]`);if(b){if(!Ol.has(b)){Ue(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;b.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((f=this.linkService.eventBus)==null||f.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}})),!1}}}In=new WeakSet,xo=function(){this.container.setAttribute("data-internal-link","")},K_=function(t,n,r=null){t.href=this.linkService.getAnchorUrl(""),n.description&&(t.title=n.description),t.onclick=()=>{var i;return(i=this.downloadManager)==null||i.openOrDownloadData(n.content,n.filename,r),!1},j(this,In,xo).call(this)},Y_=function(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(n),!1),j(this,In,xo).call(this)};class Aj extends Ut{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class Vl extends Ut{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Qs.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,r,i){n.includes("mouse")?e.addEventListener(n,a=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:i(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):e.addEventListener(n,a=>{var o;if(n==="blur"){if(!t.focused||!a.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}i&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:i(a)}}))})}_setEventListeners(e,t,n,r){var i,a,o;for(const[l,d]of n)(d==="Action"||(i=this.data.actions)!=null&&i[d])&&((d==="Focus"||d==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,d,r),d==="Focus"&&!((a=this.data.actions)!=null&&a.Blur)?this._setEventListener(e,t,"blur","Blur",null):d==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":Ce.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||_j,i=e.style;let a;const o=2,l=d=>Math.round(10*d)/10;if(this.data.multiLine){const d=Math.abs(this.data.rect[3]-this.data.rect[1]-o),h=Math.round(d/(gg*r))||1,f=d/h;a=Math.min(r,l(f/gg))}else{const d=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(r,l(d/gg))}i.fontSize=`calc(${a}px * var(--scale-factor))`,i.color=Ce.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(i.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class Ej extends Vl{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,r){const i=this.annotationStorage;for(const a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=n),i.setValue(a.id,{[r]:n})}render(){var r,i;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const a=e.getValue(t,{value:this.data.fieldValue});let o=a.value||"";const l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&o.length>l&&(o=o.slice(0,l));let d=a.formattedValue||((r=this.data.textContent)==null?void 0:r.join(`
`))||null;d&&this.data.comb&&(d=d.replaceAll(/\s+/g,""));const h={userValue:o,formattedValue:d,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=d??o,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type="text",n.setAttribute("value",d??o),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Ol.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=Ff,this._setRequired(n,this.data.required),l&&(n.maxLength=l),n.addEventListener("input",p=>{e.setValue(t,{value:p.target.value}),this.setPropertyOnSiblings(n,"value",p.target.value,"value"),h.formattedValue=null}),n.addEventListener("resetform",p=>{const m=this.data.defaultFieldValue??"";n.value=h.userValue=m,h.formattedValue=null});let f=p=>{const{formattedValue:m}=h;m!=null&&(p.target.value=m),p.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",m=>{var x;if(h.focused)return;const{target:b}=m;h.userValue&&(b.value=h.userValue),h.lastCommittedValue=b.value,h.commitKey=1,(x=this.data.actions)!=null&&x.Focus||(h.focused=!0)}),n.addEventListener("updatefromsandbox",m=>{this.showElementAndHideCanvas(m.target);const b={value(x){h.userValue=x.detail.value??"",e.setValue(t,{value:h.userValue.toString()}),x.target.value=h.userValue},formattedValue(x){const{formattedValue:v}=x.detail;h.formattedValue=v,v!=null&&x.target!==document.activeElement&&(x.target.value=v),e.setValue(t,{formattedValue:v})},selRange(x){x.target.setSelectionRange(...x.detail.selRange)},charLimit:x=>{var w;const{charLimit:v}=x.detail,{target:g}=x;if(v===0){g.removeAttribute("maxLength");return}g.setAttribute("maxLength",v);let y=h.userValue;!y||y.length<=v||(y=y.slice(0,v),g.value=h.userValue=y,e.setValue(t,{value:y}),(w=this.linkService.eventBus)==null||w.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:1,selStart:g.selectionStart,selEnd:g.selectionEnd}}))}};this._dispatchEventFromSandbox(b,m)}),n.addEventListener("keydown",m=>{var v;h.commitKey=1;let b=-1;if(m.key==="Escape"?b=0:m.key==="Enter"&&!this.data.multiLine?b=2:m.key==="Tab"&&(h.commitKey=3),b===-1)return;const{value:x}=m.target;h.lastCommittedValue!==x&&(h.lastCommittedValue=x,h.userValue=x,(v=this.linkService.eventBus)==null||v.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:x,willCommit:!0,commitKey:b,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}))});const p=f;f=null,n.addEventListener("blur",m=>{var x,v;if(!h.focused||!m.relatedTarget)return;(x=this.data.actions)!=null&&x.Blur||(h.focused=!1);const{value:b}=m.target;h.userValue=b,h.lastCommittedValue!==b&&((v=this.linkService.eventBus)==null||v.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:b,willCommit:!0,commitKey:h.commitKey,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}})),p(m)}),(i=this.data.actions)!=null&&i.Keystroke&&n.addEventListener("beforeinput",m=>{var C;h.lastCommittedValue=null;const{data:b,target:x}=m,{value:v,selectionStart:g,selectionEnd:y}=x;let w=g,k=y;switch(m.inputType){case"deleteWordBackward":{const P=v.substring(0,g).match(/\w*[^\w]*$/);P&&(w-=P[0].length);break}case"deleteWordForward":{const P=v.substring(g).match(/^[^\w]*\w*/);P&&(k+=P[0].length);break}case"deleteContentBackward":g===y&&(w-=1);break;case"deleteContentForward":g===y&&(k+=1);break}m.preventDefault(),(C=this.linkService.eventBus)==null||C.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:v,change:b||"",willCommit:!1,selStart:w,selEnd:k}})}),this._setEventListeners(n,h,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],m=>m.target.value)}if(f&&n.addEventListener("blur",f),this.data.comb){const m=(this.data.rect[2]-this.data.rect[0])/l;n.classList.add("comb"),n.style.letterSpacing=`calc(${m}px * var(--scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Nj extends Vl{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class Cj extends Vl{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof r=="string"&&(r=r!=="Off",e.setValue(n,{value:r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const i=document.createElement("input");return Ol.add(i),i.setAttribute("data-element-id",n),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="checkbox",i.name=t.fieldName,r&&i.setAttribute("checked",!0),i.setAttribute("exportValue",t.exportValue),i.tabIndex=Ff,i.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const d of this._getElementsByName(o,n)){const h=l&&d.exportValue===t.exportValue;d.domElement&&(d.domElement.checked=h),e.setValue(d.id,{value:h})}e.setValue(n,{value:l})}),i.addEventListener("resetform",a=>{const o=t.defaultFieldValue||"Off";a.target.checked=o===t.exportValue}),this.enableScripting&&this.hasJSActions&&(i.addEventListener("updatefromsandbox",a=>{const o={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(n,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Q_ extends Vl{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof r=="string"&&(r=r!==t.buttonValue,e.setValue(n,{value:r})),r)for(const a of this._getElementsByName(t.fieldName,n))e.setValue(a.id,{value:!1});const i=document.createElement("input");if(Ol.add(i),i.setAttribute("data-element-id",n),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="radio",i.name=t.fieldName,r&&i.setAttribute("checked",!0),i.tabIndex=Ff,i.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const d of this._getElementsByName(o,n))e.setValue(d.id,{value:!1});e.setValue(n,{value:l})}),i.addEventListener("resetform",a=>{const o=t.defaultFieldValue;a.target.checked=o!=null&&o===t.buttonValue}),this.enableScripting&&this.hasJSActions){const a=t.buttonValue;i.addEventListener("updatefromsandbox",o=>{const l={value:d=>{const h=a===d.detail.value;for(const f of this._getElementsByName(d.target.name)){const p=h&&f.id===n;f.domElement&&(f.domElement.checked=p),e.setValue(f.id,{value:p})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Tj extends X_{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}}class jj extends Vl{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),r=document.createElement("select");Ol.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=Ff;let i=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener("resetform",h=>{const f=this.data.defaultFieldValue;for(const p of r.options)p.selected=p.value===f});for(const h of this.data.options){const f=document.createElement("option");f.textContent=h.displayValue,f.value=h.exportValue,n.value.includes(h.exportValue)&&(f.setAttribute("selected",!0),i=!1),r.append(f)}let a=null;if(i){const h=document.createElement("option");h.value=" ",h.setAttribute("hidden",!0),h.setAttribute("selected",!0),r.prepend(h),a=()=>{h.remove(),r.removeEventListener("input",a),a=null},r.addEventListener("input",a)}const o=h=>{const f=h?"value":"textContent",{options:p,multiple:m}=r;return m?Array.prototype.filter.call(p,b=>b.selected).map(b=>b[f]):p.selectedIndex===-1?null:p[p.selectedIndex][f]};let l=o(!1);const d=h=>{const f=h.target.options;return Array.prototype.map.call(f,p=>({displayValue:p.textContent,exportValue:p.value}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener("updatefromsandbox",h=>{const f={value(p){a==null||a();const m=p.detail.value,b=new Set(Array.isArray(m)?m:[m]);for(const x of r.options)x.selected=b.has(x.value);e.setValue(t,{value:o(!0)}),l=o(!1)},multipleSelection(p){r.multiple=!0},remove(p){const m=r.options,b=p.detail.remove;m[b].selected=!1,r.remove(b),m.length>0&&Array.prototype.findIndex.call(m,v=>v.selected)===-1&&(m[0].selected=!0),e.setValue(t,{value:o(!0),items:d(p)}),l=o(!1)},clear(p){for(;r.length!==0;)r.remove(0);e.setValue(t,{value:null,items:[]}),l=o(!1)},insert(p){const{index:m,displayValue:b,exportValue:x}=p.detail.insert,v=r.children[m],g=document.createElement("option");g.textContent=b,g.value=x,v?v.before(g):r.append(g),e.setValue(t,{value:o(!0),items:d(p)}),l=o(!1)},items(p){const{items:m}=p.detail;for(;r.length!==0;)r.remove(0);for(const b of m){const{displayValue:x,exportValue:v}=b,g=document.createElement("option");g.textContent=x,g.value=v,r.append(g)}r.options.length>0&&(r.options[0].selected=!0),e.setValue(t,{value:o(!0),items:d(p)}),l=o(!1)},indices(p){const m=new Set(p.detail.indices);for(const b of p.target.options)b.selected=m.has(b.index);e.setValue(t,{value:o(!0)}),l=o(!1)},editable(p){p.target.disabled=!p.detail.editable}};this._dispatchEventFromSandbox(f,h)}),r.addEventListener("input",h=>{var m;const f=o(!0),p=o(!1);e.setValue(t,{value:f}),h.preventDefault(),(m=this.linkService.eventBus)==null||m.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:p,changeEx:f,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],h=>h.target.value)):r.addEventListener("input",function(h){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class cb extends Ut{constructor(e){const{data:t,elements:n}=e;super(e,{isRenderable:Ut._hasPopupData(t)}),this.elements=n,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new Pj({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const n of this.elements)n.popup=e,n.container.ariaHasPopup="dialog",t.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(n=>`${Wy}${n}`).join(",")),this.container}}var id,e0,t0,ad,il,Lt,Di,od,Xh,Kh,ld,Fi,br,Oi,Yh,zi,Qh,al,ol,ft,Bp,db,Z_,J_,eS,tS,Up,Hp,ub;class Pj{constructor({container:e,color:t,elements:n,titleObj:r,modificationDate:i,contentsObj:a,richText:o,parent:l,rect:d,parentRect:h,open:f}){T(this,ft);T(this,id,j(this,ft,eS).bind(this));T(this,e0,j(this,ft,ub).bind(this));T(this,t0,j(this,ft,Hp).bind(this));T(this,ad,j(this,ft,Up).bind(this));T(this,il,null);T(this,Lt,null);T(this,Di,null);T(this,od,null);T(this,Xh,null);T(this,Kh,null);T(this,ld,null);T(this,Fi,!1);T(this,br,null);T(this,Oi,null);T(this,Yh,null);T(this,zi,null);T(this,Qh,null);T(this,al,null);T(this,ol,!1);var p;S(this,Lt,e),S(this,Qh,r),S(this,Di,a),S(this,zi,o),S(this,Kh,l),S(this,il,t),S(this,Yh,d),S(this,ld,h),S(this,Xh,n),S(this,od,Ky.toDateObject(i)),this.trigger=n.flatMap(m=>m.getElementsToTriggerPopup());for(const m of this.trigger)m.addEventListener("click",c(this,ad)),m.addEventListener("mouseenter",c(this,t0)),m.addEventListener("mouseleave",c(this,e0)),m.classList.add("popupTriggerArea");for(const m of n)(p=m.container)==null||p.addEventListener("keydown",c(this,id));c(this,Lt).hidden=!0,f&&j(this,ft,Up).call(this)}render(){if(c(this,br))return;const e=S(this,br,document.createElement("div"));if(e.className="popup",c(this,il)){const i=e.style.outlineColor=Ce.makeHexColor(...c(this,il));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${i} 30%, white)`:e.style.backgroundColor=Ce.makeHexColor(...c(this,il).map(o=>Math.floor(.7*(255-o)+o)))}const t=document.createElement("span");t.className="header";const n=document.createElement("h1");if(t.append(n),{dir:n.dir,str:n.textContent}=c(this,Qh),e.append(t),c(this,od)){const i=document.createElement("span");i.classList.add("popupDate"),i.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),i.setAttribute("data-l10n-args",JSON.stringify({dateObj:c(this,od).valueOf()})),t.append(i)}const r=c(this,ft,Bp);if(r)q_.render({xfaHtml:r,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const i=this._formatContents(c(this,Di));e.append(i)}c(this,Lt).append(e)}_formatContents({str:e,dir:t}){const n=document.createElement("p");n.classList.add("popupContent"),n.dir=t;const r=e.split(/(?:\r\n?|\n)/);for(let i=0,a=r.length;i<a;++i){const o=r[i];n.append(document.createTextNode(o)),i<a-1&&n.append(document.createElement("br"))}return n}updateEdited({rect:e,popupContent:t}){var n;c(this,al)||S(this,al,{contentsObj:c(this,Di),richText:c(this,zi)}),e&&S(this,Oi,null),t&&(S(this,zi,j(this,ft,J_).call(this,t)),S(this,Di,null)),(n=c(this,br))==null||n.remove(),S(this,br,null)}resetEdited(){var e;c(this,al)&&({contentsObj:Us(this,Di)._,richText:Us(this,zi)._}=c(this,al),S(this,al,null),(e=c(this,br))==null||e.remove(),S(this,br,null),S(this,Oi,null))}forceHide(){S(this,ol,this.isVisible),c(this,ol)&&(c(this,Lt).hidden=!0)}maybeShow(){c(this,ol)&&(c(this,br)||j(this,ft,Hp).call(this),S(this,ol,!1),c(this,Lt).hidden=!1)}get isVisible(){return c(this,Lt).hidden===!1}}id=new WeakMap,e0=new WeakMap,t0=new WeakMap,ad=new WeakMap,il=new WeakMap,Lt=new WeakMap,Di=new WeakMap,od=new WeakMap,Xh=new WeakMap,Kh=new WeakMap,ld=new WeakMap,Fi=new WeakMap,br=new WeakMap,Oi=new WeakMap,Yh=new WeakMap,zi=new WeakMap,Qh=new WeakMap,al=new WeakMap,ol=new WeakMap,ft=new WeakSet,Bp=function(){const e=c(this,zi),t=c(this,Di);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&c(this,zi).html||null},db=function(){var e,t,n;return((n=(t=(e=c(this,ft,Bp))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.fontSize)||0},Z_=function(){var e,t,n;return((n=(t=(e=c(this,ft,Bp))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.color)||null},J_=function(e){const t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},r={style:{color:c(this,ft,Z_),fontSize:c(this,ft,db)?`calc(${c(this,ft,db)}px * var(--scale-factor))`:""}};for(const i of e.split(`
`))t.push({name:"span",value:i,attributes:r});return n},eS=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&c(this,Fi))&&j(this,ft,Up).call(this)},tS=function(){if(c(this,Oi)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:r,pageY:i}}}=c(this,Kh);let a=!!c(this,ld),o=a?c(this,ld):c(this,Yh);for(const b of c(this,Xh))if(!o||Ce.intersect(b.data.rect,o)!==null){o=b.data.rect,a=!0;break}const l=Ce.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),h=a?o[2]-o[0]+5:0,f=l[0]+h,p=l[1];S(this,Oi,[100*(f-r)/t,100*(p-i)/n]);const{style:m}=c(this,Lt);m.left=`${c(this,Oi)[0]}%`,m.top=`${c(this,Oi)[1]}%`},Up=function(){S(this,Fi,!c(this,Fi)),c(this,Fi)?(j(this,ft,Hp).call(this),c(this,Lt).addEventListener("click",c(this,ad)),c(this,Lt).addEventListener("keydown",c(this,id))):(j(this,ft,ub).call(this),c(this,Lt).removeEventListener("click",c(this,ad)),c(this,Lt).removeEventListener("keydown",c(this,id)))},Hp=function(){c(this,br)||this.render(),this.isVisible?c(this,Fi)&&c(this,Lt).classList.add("focused"):(j(this,ft,tS).call(this),c(this,Lt).hidden=!1,c(this,Lt).style.zIndex=parseInt(c(this,Lt).style.zIndex)+1e3)},ub=function(){c(this,Lt).classList.remove("focused"),!(c(this,Fi)||!this.isVisible)&&(c(this,Lt).hidden=!0,c(this,Lt).style.zIndex=parseInt(c(this,Lt).style.zIndex)-1e3)};class sS extends Ut{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Be.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Zh;class Mj extends Ut{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});T(this,Zh,null)}render(){this.container.classList.add("lineAnnotation");const t=this.data,{width:n,height:r}=to(t.rect),i=this.svgFactory.create(n,r,!0),a=S(this,Zh,this.svgFactory.createElement("svg:line"));return a.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),a.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),a.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),a.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),a.setAttribute("stroke-width",t.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),i.append(a),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return c(this,Zh)}addHighlightArea(){this.container.classList.add("highlightArea")}}Zh=new WeakMap;var Jh;class Rj extends Ut{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});T(this,Jh,null)}render(){this.container.classList.add("squareAnnotation");const t=this.data,{width:n,height:r}=to(t.rect),i=this.svgFactory.create(n,r,!0),a=t.borderStyle.width,o=S(this,Jh,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",n-a),o.setAttribute("height",r-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return c(this,Jh)}addHighlightArea(){this.container.classList.add("highlightArea")}}Jh=new WeakMap;var ef;class Ij extends Ut{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});T(this,ef,null)}render(){this.container.classList.add("circleAnnotation");const t=this.data,{width:n,height:r}=to(t.rect),i=this.svgFactory.create(n,r,!0),a=t.borderStyle.width,o=S(this,ef,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",n/2),o.setAttribute("cy",r/2),o.setAttribute("rx",n/2-a/2),o.setAttribute("ry",r/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return c(this,ef)}addHighlightArea(){this.container.classList.add("highlightArea")}}ef=new WeakMap;var tf;class nS extends Ut{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});T(this,tf,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:n,borderStyle:r,popupRef:i}}=this;if(!n)return this.container;const{width:a,height:o}=to(t),l=this.svgFactory.create(a,o,!0);let d=[];for(let f=0,p=n.length;f<p;f+=2){const m=n[f]-t[0],b=t[3]-n[f+1];d.push(`${m},${b}`)}d=d.join(" ");const h=S(this,tf,this.svgFactory.createElement(this.svgElementName));return h.setAttribute("points",d),h.setAttribute("stroke-width",r.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),l.append(h),this.container.append(l),!i&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return c(this,tf)}addHighlightArea(){this.container.classList.add("highlightArea")}}tf=new WeakMap;class Lj extends nS{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Dj extends Ut{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var sf,ll,nf,hb;class ev extends Ut{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});T(this,nf);T(this,sf,null);T(this,ll,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Be.HIGHLIGHT:Be.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:n,inkLists:r,borderStyle:i,popupRef:a}}=this,{transform:o,width:l,height:d}=j(this,nf,hb).call(this,n,t),h=this.svgFactory.create(l,d,!0),f=S(this,sf,this.svgFactory.createElement("svg:g"));h.append(f),f.setAttribute("stroke-width",i.width||1),f.setAttribute("stroke-linecap","round"),f.setAttribute("stroke-linejoin","round"),f.setAttribute("stroke-miterlimit",10),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),f.setAttribute("transform",o);for(let p=0,m=r.length;p<m;p++){const b=this.svgFactory.createElement(this.svgElementName);c(this,ll).push(b),b.setAttribute("points",r[p].join(",")),f.append(b)}return!a&&this.hasPopupData&&this._createPopup(),this.container.append(h),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:n,points:r,rect:i}=t,a=c(this,sf);if(n>=0&&a.setAttribute("stroke-width",n||1),r)for(let o=0,l=c(this,ll).length;o<l;o++)c(this,ll)[o].setAttribute("points",r[o].join(","));if(i){const{transform:o,width:l,height:d}=j(this,nf,hb).call(this,this.data.rotation,i);a.parentElement.setAttribute("viewBox",`0 0 ${l} ${d}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return c(this,ll)}addHighlightArea(){this.container.classList.add("highlightArea")}}sf=new WeakMap,ll=new WeakMap,nf=new WeakSet,hb=function(t,n){switch(t){case 90:return{transform:`rotate(90) translate(${-n[0]},${n[1]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};case 180:return{transform:`rotate(180) translate(${-n[2]},${n[1]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]};case 270:return{transform:`rotate(270) translate(${-n[2]},${n[3]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};default:return{transform:`translate(${-n[0]},${n[3]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]}}};class rS extends Ut{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Be.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class Fj extends Ut{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Oj extends Ut{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class zj extends Ut{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class iS extends Ut{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Be.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var rf,af,fb;class $j extends Ut{constructor(t){var r;super(t,{isRenderable:!0});T(this,af);T(this,rf,null);const{file:n}=this.data;this.filename=n.filename,this.content=n.content,(r=this.linkService.eventBus)==null||r.dispatch("fileattachmentannotation",{source:this,...n})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:n}=this;let r;n.hasAppearance||n.fillAlpha===0?r=document.createElement("div"):(r=document.createElement("img"),r.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(n.name)?"paperclip":"pushpin"}.svg`,n.fillAlpha&&n.fillAlpha<1&&(r.style=`filter: opacity(${Math.round(n.fillAlpha*100)}%);`)),r.addEventListener("dblclick",j(this,af,fb).bind(this)),S(this,rf,r);const{isMac:i}=Qs.platform;return t.addEventListener("keydown",a=>{a.key==="Enter"&&(i?a.metaKey:a.ctrlKey)&&j(this,af,fb).call(this)}),!n.popupRef&&this.hasPopupData?this._createPopup():r.classList.add("popupTriggerArea"),t.append(r),t}getElementsToTriggerPopup(){return c(this,rf)}addHighlightArea(){this.container.classList.add("highlightArea")}}rf=new WeakMap,af=new WeakSet,fb=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var of,cl,dl,lf,zl,aS,pb;class Bj{constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:r,page:i,viewport:a,structTreeLayer:o}){T(this,zl);T(this,of,null);T(this,cl,null);T(this,dl,new Map);T(this,lf,null);this.div=e,S(this,of,t),S(this,cl,n),S(this,lf,o||null),this.page=i,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=r}hasEditableAnnotations(){return c(this,dl).size>0}async render(e){var a;const{annotations:t}=e,n=this.div;Dl(n,this.viewport);const r=new Map,i={data:null,layer:n,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new Jy,annotationStorage:e.annotationStorage||new Qy,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const o of t){if(o.noHTML)continue;const l=o.annotationType===Kt.POPUP;if(l){const f=r.get(o.id);if(!f)continue;i.elements=f}else{const{width:f,height:p}=to(o.rect);if(f<=0||p<=0)continue}i.data=o;const d=Sj.create(i);if(!d.isRenderable)continue;if(!l&&o.popupRef){const f=r.get(o.popupRef);f?f.push(d):r.set(o.popupRef,[d])}const h=d.render();o.hidden&&(h.style.visibility="hidden"),await j(this,zl,aS).call(this,h,o.id),d._isEditable&&(c(this,dl).set(d.data.id,d),(a=this._annotationEditorUIManager)==null||a.renderAnnotationElement(d))}j(this,zl,pb).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,Dl(t,{rotation:e.rotation}),j(this,zl,pb).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(c(this,dl).values())}getEditableAnnotation(e){return c(this,dl).get(e)}}of=new WeakMap,cl=new WeakMap,dl=new WeakMap,lf=new WeakMap,zl=new WeakSet,aS=async function(e,t){var a,o;const n=e.firstChild||e,r=n.id=`${Wy}${t}`,i=await((a=c(this,lf))==null?void 0:a.getAriaAttributes(r));if(i)for(const[l,d]of i)n.setAttribute(l,d);this.div.append(e),(o=c(this,of))==null||o.moveElementInDOM(this.div,e,n,!1)},pb=function(){if(!c(this,cl))return;const e=this.div;for(const[t,n]of c(this,cl)){const r=e.querySelector(`[data-annotation-id="${t}"]`);if(!r)continue;n.className="annotationContent";const{firstChild:i}=r;i?i.nodeName==="CANVAS"?i.replaceWith(n):i.classList.contains("annotationContent")?i.after(n):i.before(n):r.append(n)}c(this,cl).clear()};const op=/\r\n?|\n/g;var yr,Sn,cf,ul,An,Xt,oS,lS,cS,Gp,Zi,Vp,Wp,dS,gb,uS;const bt=class bt extends Mt{constructor(t){super({...t,name:"freeTextEditor"});T(this,Xt);T(this,yr);T(this,Sn,"");T(this,cf,`${this.id}-editor`);T(this,ul,null);T(this,An);S(this,yr,t.color||bt._defaultColor||Mt._defaultLineColor),S(this,An,t.fontSize||bt._defaultFontSize)}static get _keyboardManager(){const t=bt.prototype,n=a=>a.isEmpty(),r=Fl.TRANSLATE_SMALL,i=Fl.TRANSLATE_BIG;return qe(this,"_keyboardManager",new Df([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:n}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[r,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:n}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:n}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,r],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:n}]]))}static initialize(t,n){Mt.initialize(t,n);const r=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(r.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,n){switch(t){case Ke.FREETEXT_SIZE:bt._defaultFontSize=n;break;case Ke.FREETEXT_COLOR:bt._defaultColor=n;break}}updateParams(t,n){switch(t){case Ke.FREETEXT_SIZE:j(this,Xt,oS).call(this,n);break;case Ke.FREETEXT_COLOR:j(this,Xt,lS).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[Ke.FREETEXT_SIZE,bt._defaultFontSize],[Ke.FREETEXT_COLOR,bt._defaultColor||Mt._defaultLineColor]]}get propertiesToUpdate(){return[[Ke.FREETEXT_SIZE,c(this,An)],[Ke.FREETEXT_COLOR,c(this,yr)]]}_translateEmpty(t,n){this._uiManager.translateSelectedEditors(t,n,!0)}getInitialTranslation(){const t=this.parentScale;return[-bt._internalPadding*t,-(bt._internalPadding+c(this,An))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(Be.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),S(this,ul,new AbortController);const t=this._uiManager.combinedSignal(c(this,ul));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){var t;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",c(this,cf)),this._isDraggable=!0,(t=c(this,ul))==null||t.abort(),S(this,ul,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var n;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(n=this._initialOptions)!=null&&n.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=c(this,Sn),n=S(this,Sn,j(this,Xt,cS).call(this).trimEnd());if(t===n)return;const r=i=>{if(S(this,Sn,i),!i){this.remove();return}j(this,Xt,Wp).call(this),this._uiManager.rebuild(this),j(this,Xt,Gp).call(this)};this.addCommands({cmd:()=>{r(n)},undo:()=>{r(t)},mustExec:!1}),j(this,Xt,Gp).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){bt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,n;this.width&&(t=this.x,n=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",c(this,cf)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:r}=this.editorDiv;if(r.fontSize=`calc(${c(this,An)}px * var(--scale-factor))`,r.color=c(this,yr),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Lm(this,this.div,["dblclick","keydown"]),this.width){const[i,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[l,d]=this.getInitialTranslation();[l,d]=this.pageTranslationToScreen(l,d);const[h,f]=this.pageDimensions,[p,m]=this.pageTranslation;let b,x;switch(this.rotation){case 0:b=t+(o[0]-p)/h,x=n+this.height-(o[1]-m)/f;break;case 90:b=t+(o[0]-p)/h,x=n-(o[1]-m)/f,[l,d]=[d,-l];break;case 180:b=t-this.width+(o[0]-p)/h,x=n-(o[1]-m)/f,[l,d]=[-l,-d];break;case 270:b=t+(o[0]-p-this.height*f)/h,x=n+(o[1]-m-this.width*h)/f,[l,d]=[-d,l];break}this.setAt(b*i,x*a,l,d)}else this.setAt(t*i,n*a,this.width*i,this.height*a);j(this,Xt,Wp).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var b,x,v;const n=t.clipboardData||window.clipboardData,{types:r}=n;if(r.length===1&&r[0]==="text/plain")return;t.preventDefault();const i=j(b=bt,Zi,gb).call(b,n.getData("text")||"").replaceAll(op,`
`);if(!i)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!i.includes(`
`)){o.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:l,startOffset:d}=o,h=[],f=[];if(l.nodeType===Node.TEXT_NODE){const g=l.parentElement;if(f.push(l.nodeValue.slice(d).replaceAll(op,"")),g!==this.editorDiv){let y=h;for(const w of this.editorDiv.childNodes){if(w===g){y=f;continue}y.push(j(x=bt,Zi,Vp).call(x,w))}}h.push(l.nodeValue.slice(0,d).replaceAll(op,""))}else if(l===this.editorDiv){let g=h,y=0;for(const w of this.editorDiv.childNodes)y++===d&&(g=f),g.push(j(v=bt,Zi,Vp).call(v,w))}S(this,Sn,`${h.join(`
`)}${i}${f.join(`
`)}`),j(this,Xt,Wp).call(this);const p=new Range;let m=h.reduce((g,y)=>g+y.length,0);for(const{firstChild:g}of this.editorDiv.childNodes)if(g.nodeType===Node.TEXT_NODE){const y=g.nodeValue.length;if(m<=y){p.setStart(g,m),p.setEnd(g,m);break}m-=y}a.removeAllRanges(),a.addRange(p)}get contentDiv(){return this.editorDiv}static async deserialize(t,n,r){var o;let i=null;if(t instanceof sS){const{data:{defaultAppearanceData:{fontSize:l,fontColor:d},rect:h,rotation:f,id:p,popupRef:m},textContent:b,textPosition:x,parent:{page:{pageNumber:v}}}=t;if(!b||b.length===0)return null;i=t={annotationType:Be.FREETEXT,color:Array.from(d),fontSize:l,value:b.join(`
`),position:x,pageIndex:v-1,rect:h.slice(0),rotation:f,id:p,deleted:!1,popupRef:m}}const a=await super.deserialize(t,n,r);return S(a,An,t.fontSize),S(a,yr,Ce.makeHexColor(...t.color)),S(a,Sn,j(o=bt,Zi,gb).call(o,t.value)),a.annotationElementId=t.id||null,a._initialData=i,a}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n=bt._internalPadding*this.parentScale,r=this.getRect(n,n),i=Mt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:c(this,yr)),a={annotationType:Be.FREETEXT,color:i,fontSize:c(this,An),value:j(this,Xt,dS).call(this),pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?a:this.annotationElementId&&!j(this,Xt,uS).call(this,a)?null:(a.id=this.annotationElementId,a)}renderAnnotationElement(t){const n=super.renderAnnotationElement(t);if(this.deleted)return n;const{style:r}=n;r.fontSize=`calc(${c(this,An)}px * var(--scale-factor))`,r.color=c(this,yr),n.replaceChildren();for(const a of c(this,Sn).split(`
`)){const o=document.createElement("div");o.append(a?document.createTextNode(a):document.createElement("br")),n.append(o)}const i=bt._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(i,i),popupContent:c(this,Sn)}),n}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};yr=new WeakMap,Sn=new WeakMap,cf=new WeakMap,ul=new WeakMap,An=new WeakMap,Xt=new WeakSet,oS=function(t){const n=i=>{this.editorDiv.style.fontSize=`calc(${i}px * var(--scale-factor))`,this.translate(0,-(i-c(this,An))*this.parentScale),S(this,An,i),j(this,Xt,Gp).call(this)},r=c(this,An);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ke.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},lS=function(t){const n=i=>{S(this,yr,this.editorDiv.style.color=i)},r=c(this,yr);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ke.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},cS=function(){var r;const t=[];this.editorDiv.normalize();let n=null;for(const i of this.editorDiv.childNodes)(n==null?void 0:n.nodeType)===Node.TEXT_NODE&&i.nodeName==="BR"||(t.push(j(r=bt,Zi,Vp).call(r,i)),n=i);return t.join(`
`)},Gp=function(){const[t,n]=this.parentDimensions;let r;if(this.isAttachedToDOM)r=this.div.getBoundingClientRect();else{const{currentLayer:i,div:a}=this,o=a.style.display,l=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",i.div.append(this.div),r=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=r.width/t,this.height=r.height/n):(this.width=r.height/t,this.height=r.width/n),this.fixAndSetPosition()},Zi=new WeakSet,Vp=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(op,"")},Wp=function(){if(this.editorDiv.replaceChildren(),!!c(this,Sn))for(const t of c(this,Sn).split(`
`)){const n=document.createElement("div");n.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(n)}},dS=function(){return c(this,Sn).replaceAll(" "," ")},gb=function(t){return t.replaceAll(" "," ")},uS=function(t){const{value:n,fontSize:r,color:i,pageIndex:a}=this._initialData;return this._hasBeenMoved||t.value!==n||t.fontSize!==r||t.color.some((o,l)=>o!==i[l])||t.pageIndex!==a},T(bt,Zi),Pe(bt,"_freeTextDefaultContent",""),Pe(bt,"_internalPadding",0),Pe(bt,"_defaultColor",null),Pe(bt,"_defaultFontSize",10),Pe(bt,"_type","freetext"),Pe(bt,"_editorType",Be.FREETEXT);let mb=bt;class Se{toSVGPath(){gt("Abstract method `toSVGPath` must be implemented.")}get box(){gt("Abstract getter `box` must be implemented.")}serialize(e,t){gt("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,r,i,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o]*r,a[o+1]=n+e[o+1]*i;return a}static _rescaleAndSwap(e,t,n,r,i,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o+1]*r,a[o+1]=n+e[o]*i;return a}static _translate(e,t,n,r){r||(r=new Float32Array(e.length));for(let i=0,a=e.length;i<a;i+=2)r[i]=t+e[i],r[i+1]=n+e[i+1];return r}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,r,i){switch(i){case 90:return[1-t/n,e/r];case 180:return[1-e/n,1-t/r];case 270:return[t/n,1-e/r];default:return[e/n,t/r]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,r,i,a){return[(e+5*n)/6,(t+5*r)/6,(5*n+i)/6,(5*r+a)/6,(n+i)/2,(r+a)/2]}}Pe(Se,"PRECISION",1e-4);var En,vr,cd,dd,Jr,We,hl,fl,df,uf,ud,hd,Ia,hf,s0,n0,ts,xu,hS,fS,pS,mS,gS,xS;const vi=class vi{constructor({x:e,y:t},n,r,i,a,o=0){T(this,ts);T(this,En);T(this,vr,[]);T(this,cd);T(this,dd);T(this,Jr,[]);T(this,We,new Float32Array(18));T(this,hl);T(this,fl);T(this,df);T(this,uf);T(this,ud);T(this,hd);T(this,Ia,[]);S(this,En,n),S(this,hd,i*r),S(this,dd,a),c(this,We).set([NaN,NaN,NaN,NaN,e,t],6),S(this,cd,o),S(this,uf,c(vi,hf)*r),S(this,df,c(vi,n0)*r),S(this,ud,r),c(this,Ia).push(e,t)}isEmpty(){return isNaN(c(this,We)[8])}add({x:e,y:t}){var M;S(this,hl,e),S(this,fl,t);const[n,r,i,a]=c(this,En);let[o,l,d,h]=c(this,We).subarray(8,12);const f=e-d,p=t-h,m=Math.hypot(f,p);if(m<c(this,df))return!1;const b=m-c(this,uf),x=b/m,v=x*f,g=x*p;let y=o,w=l;o=d,l=h,d+=v,h+=g,(M=c(this,Ia))==null||M.push(e,t);const k=-g/b,C=v/b,P=k*c(this,hd),N=C*c(this,hd);return c(this,We).set(c(this,We).subarray(2,8),0),c(this,We).set([d+P,h+N],4),c(this,We).set(c(this,We).subarray(14,18),12),c(this,We).set([d-P,h-N],16),isNaN(c(this,We)[6])?(c(this,Jr).length===0&&(c(this,We).set([o+P,l+N],2),c(this,Jr).push(NaN,NaN,NaN,NaN,(o+P-n)/i,(l+N-r)/a),c(this,We).set([o-P,l-N],14),c(this,vr).push(NaN,NaN,NaN,NaN,(o-P-n)/i,(l-N-r)/a)),c(this,We).set([y,w,o,l,d,h],6),!this.isEmpty()):(c(this,We).set([y,w,o,l,d,h],6),Math.abs(Math.atan2(w-l,y-o)-Math.atan2(g,v))<Math.PI/2?([o,l,d,h]=c(this,We).subarray(2,6),c(this,Jr).push(NaN,NaN,NaN,NaN,((o+d)/2-n)/i,((l+h)/2-r)/a),[o,l,y,w]=c(this,We).subarray(14,18),c(this,vr).push(NaN,NaN,NaN,NaN,((y+o)/2-n)/i,((w+l)/2-r)/a),!0):([y,w,o,l,d,h]=c(this,We).subarray(0,6),c(this,Jr).push(((y+5*o)/6-n)/i,((w+5*l)/6-r)/a,((5*o+d)/6-n)/i,((5*l+h)/6-r)/a,((o+d)/2-n)/i,((l+h)/2-r)/a),[d,h,o,l,y,w]=c(this,We).subarray(12,18),c(this,vr).push(((y+5*o)/6-n)/i,((w+5*l)/6-r)/a,((5*o+d)/6-n)/i,((5*l+h)/6-r)/a,((o+d)/2-n)/i,((l+h)/2-r)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const e=c(this,Jr),t=c(this,vr);if(isNaN(c(this,We)[6])&&!this.isEmpty())return j(this,ts,hS).call(this);const n=[];n.push(`M${e[4]} ${e[5]}`);for(let r=6;r<e.length;r+=6)isNaN(e[r])?n.push(`L${e[r+4]} ${e[r+5]}`):n.push(`C${e[r]} ${e[r+1]} ${e[r+2]} ${e[r+3]} ${e[r+4]} ${e[r+5]}`);j(this,ts,pS).call(this,n);for(let r=t.length-6;r>=6;r-=6)isNaN(t[r])?n.push(`L${t[r+4]} ${t[r+5]}`):n.push(`C${t[r]} ${t[r+1]} ${t[r+2]} ${t[r+3]} ${t[r+4]} ${t[r+5]}`);return j(this,ts,fS).call(this,n),n.join(" ")}newFreeDrawOutline(e,t,n,r,i,a){return new bS(e,t,n,r,i,a)}getOutlines(){var f;const e=c(this,Jr),t=c(this,vr),n=c(this,We),[r,i,a,o]=c(this,En),l=new Float32Array((((f=c(this,Ia))==null?void 0:f.length)??0)+2);for(let p=0,m=l.length-2;p<m;p+=2)l[p]=(c(this,Ia)[p]-r)/a,l[p+1]=(c(this,Ia)[p+1]-i)/o;if(l[l.length-2]=(c(this,hl)-r)/a,l[l.length-1]=(c(this,fl)-i)/o,isNaN(n[6])&&!this.isEmpty())return j(this,ts,mS).call(this,l);const d=new Float32Array(c(this,Jr).length+24+c(this,vr).length);let h=e.length;for(let p=0;p<h;p+=2){if(isNaN(e[p])){d[p]=d[p+1]=NaN;continue}d[p]=e[p],d[p+1]=e[p+1]}h=j(this,ts,xS).call(this,d,h);for(let p=t.length-6;p>=6;p-=6)for(let m=0;m<6;m+=2){if(isNaN(t[p+m])){d[h]=d[h+1]=NaN,h+=2;continue}d[h]=t[p+m],d[h+1]=t[p+m+1],h+=2}return j(this,ts,gS).call(this,d,h),this.newFreeDrawOutline(d,l,c(this,En),c(this,ud),c(this,cd),c(this,dd))}};En=new WeakMap,vr=new WeakMap,cd=new WeakMap,dd=new WeakMap,Jr=new WeakMap,We=new WeakMap,hl=new WeakMap,fl=new WeakMap,df=new WeakMap,uf=new WeakMap,ud=new WeakMap,hd=new WeakMap,Ia=new WeakMap,hf=new WeakMap,s0=new WeakMap,n0=new WeakMap,ts=new WeakSet,xu=function(){const e=c(this,We).subarray(4,6),t=c(this,We).subarray(16,18),[n,r,i,a]=c(this,En);return[(c(this,hl)+(e[0]-t[0])/2-n)/i,(c(this,fl)+(e[1]-t[1])/2-r)/a,(c(this,hl)+(t[0]-e[0])/2-n)/i,(c(this,fl)+(t[1]-e[1])/2-r)/a]},hS=function(){const[e,t,n,r]=c(this,En),[i,a,o,l]=j(this,ts,xu).call(this);return`M${(c(this,We)[2]-e)/n} ${(c(this,We)[3]-t)/r} L${(c(this,We)[4]-e)/n} ${(c(this,We)[5]-t)/r} L${i} ${a} L${o} ${l} L${(c(this,We)[16]-e)/n} ${(c(this,We)[17]-t)/r} L${(c(this,We)[14]-e)/n} ${(c(this,We)[15]-t)/r} Z`},fS=function(e){const t=c(this,vr);e.push(`L${t[4]} ${t[5]} Z`)},pS=function(e){const[t,n,r,i]=c(this,En),a=c(this,We).subarray(4,6),o=c(this,We).subarray(16,18),[l,d,h,f]=j(this,ts,xu).call(this);e.push(`L${(a[0]-t)/r} ${(a[1]-n)/i} L${l} ${d} L${h} ${f} L${(o[0]-t)/r} ${(o[1]-n)/i}`)},mS=function(e){const t=c(this,We),[n,r,i,a]=c(this,En),[o,l,d,h]=j(this,ts,xu).call(this),f=new Float32Array(36);return f.set([NaN,NaN,NaN,NaN,(t[2]-n)/i,(t[3]-r)/a,NaN,NaN,NaN,NaN,(t[4]-n)/i,(t[5]-r)/a,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,d,h,NaN,NaN,NaN,NaN,(t[16]-n)/i,(t[17]-r)/a,NaN,NaN,NaN,NaN,(t[14]-n)/i,(t[15]-r)/a],0),this.newFreeDrawOutline(f,e,c(this,En),c(this,ud),c(this,cd),c(this,dd))},gS=function(e,t){const n=c(this,vr);return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6},xS=function(e,t){const n=c(this,We).subarray(4,6),r=c(this,We).subarray(16,18),[i,a,o,l]=c(this,En),[d,h,f,p]=j(this,ts,xu).call(this);return e.set([NaN,NaN,NaN,NaN,(n[0]-i)/o,(n[1]-a)/l,NaN,NaN,NaN,NaN,d,h,NaN,NaN,NaN,NaN,f,p,NaN,NaN,NaN,NaN,(r[0]-i)/o,(r[1]-a)/l],t),t+=24},T(vi,hf,8),T(vi,s0,2),T(vi,n0,c(vi,hf)+c(vi,s0));let Om=vi;var fd,pl,$i,ff,Nn,pf,$t,r0,yS;class bS extends Se{constructor(t,n,r,i,a,o){super();T(this,r0);T(this,fd);T(this,pl,new Float32Array(4));T(this,$i);T(this,ff);T(this,Nn);T(this,pf);T(this,$t);S(this,$t,t),S(this,Nn,n),S(this,fd,r),S(this,pf,i),S(this,$i,a),S(this,ff,o),this.lastPoint=[NaN,NaN],j(this,r0,yS).call(this,o);const[l,d,h,f]=c(this,pl);for(let p=0,m=t.length;p<m;p+=2)t[p]=(t[p]-l)/h,t[p+1]=(t[p+1]-d)/f;for(let p=0,m=n.length;p<m;p+=2)n[p]=(n[p]-l)/h,n[p+1]=(n[p+1]-d)/f}toSVGPath(){const t=[`M${c(this,$t)[4]} ${c(this,$t)[5]}`];for(let n=6,r=c(this,$t).length;n<r;n+=6){if(isNaN(c(this,$t)[n])){t.push(`L${c(this,$t)[n+4]} ${c(this,$t)[n+5]}`);continue}t.push(`C${c(this,$t)[n]} ${c(this,$t)[n+1]} ${c(this,$t)[n+2]} ${c(this,$t)[n+3]} ${c(this,$t)[n+4]} ${c(this,$t)[n+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,n,r,i],a){const o=r-t,l=i-n;let d,h;switch(a){case 0:d=Se._rescale(c(this,$t),t,i,o,-l),h=Se._rescale(c(this,Nn),t,i,o,-l);break;case 90:d=Se._rescaleAndSwap(c(this,$t),t,n,o,l),h=Se._rescaleAndSwap(c(this,Nn),t,n,o,l);break;case 180:d=Se._rescale(c(this,$t),r,n,-o,l),h=Se._rescale(c(this,Nn),r,n,-o,l);break;case 270:d=Se._rescaleAndSwap(c(this,$t),r,i,-o,-l),h=Se._rescaleAndSwap(c(this,Nn),r,i,-o,-l);break}return{outline:Array.from(d),points:[Array.from(h)]}}get box(){return c(this,pl)}newOutliner(t,n,r,i,a,o=0){return new Om(t,n,r,i,a,o)}getNewOutline(t,n){const[r,i,a,o]=c(this,pl),[l,d,h,f]=c(this,fd),p=a*h,m=o*f,b=r*h+l,x=i*f+d,v=this.newOutliner({x:c(this,Nn)[0]*p+b,y:c(this,Nn)[1]*m+x},c(this,fd),c(this,pf),t,c(this,ff),n??c(this,$i));for(let g=2;g<c(this,Nn).length;g+=2)v.add({x:c(this,Nn)[g]*p+b,y:c(this,Nn)[g+1]*m+x});return v.getOutlines()}}fd=new WeakMap,pl=new WeakMap,$i=new WeakMap,ff=new WeakMap,Nn=new WeakMap,pf=new WeakMap,$t=new WeakMap,r0=new WeakSet,yS=function(t){const n=c(this,$t);let r=n[4],i=n[5],a=r,o=i,l=r,d=i,h=r,f=i;const p=t?Math.max:Math.min;for(let b=6,x=n.length;b<x;b+=6){if(isNaN(n[b]))a=Math.min(a,n[b+4]),o=Math.min(o,n[b+5]),l=Math.max(l,n[b+4]),d=Math.max(d,n[b+5]),f<n[b+5]?(h=n[b+4],f=n[b+5]):f===n[b+5]&&(h=p(h,n[b+4]));else{const v=Ce.bezierBoundingBox(r,i,...n.slice(b,b+6));a=Math.min(a,v[0]),o=Math.min(o,v[1]),l=Math.max(l,v[2]),d=Math.max(d,v[3]),f<v[3]?(h=v[2],f=v[3]):f===v[3]&&(h=p(h,v[2]))}r=n[b+4],i=n[b+5]}const m=c(this,pl);m[0]=a-c(this,$i),m[1]=o-c(this,$i),m[2]=l-a+2*c(this,$i),m[3]=d-o+2*c(this,$i),this.lastPoint=[h,f]};var mf,gf,La,wr,Js,vS,qp,wS,kS,bb;class xb{constructor(e,t=0,n=0,r=!0){T(this,Js);T(this,mf);T(this,gf);T(this,La,[]);T(this,wr,[]);let i=1/0,a=-1/0,o=1/0,l=-1/0;const h=10**-4;for(const{x:g,y,width:w,height:k}of e){const C=Math.floor((g-t)/h)*h,P=Math.ceil((g+w+t)/h)*h,N=Math.floor((y-t)/h)*h,I=Math.ceil((y+k+t)/h)*h,M=[C,N,I,!0],L=[P,N,I,!1];c(this,La).push(M,L),i=Math.min(i,C),a=Math.max(a,P),o=Math.min(o,N),l=Math.max(l,I)}const f=a-i+2*n,p=l-o+2*n,m=i-n,b=o-n,x=c(this,La).at(r?-1:-2),v=[x[0],x[2]];for(const g of c(this,La)){const[y,w,k]=g;g[0]=(y-m)/f,g[1]=(w-b)/p,g[2]=(k-b)/p}S(this,mf,new Float32Array([m,b,f,p])),S(this,gf,v)}getOutlines(){c(this,La).sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);const e=[];for(const t of c(this,La))t[3]?(e.push(...j(this,Js,bb).call(this,t)),j(this,Js,wS).call(this,t)):(j(this,Js,kS).call(this,t),e.push(...j(this,Js,bb).call(this,t)));return j(this,Js,vS).call(this,e)}}mf=new WeakMap,gf=new WeakMap,La=new WeakMap,wr=new WeakMap,Js=new WeakSet,vS=function(e){const t=[],n=new Set;for(const a of e){const[o,l,d]=a;t.push([o,l,a],[o,d,a])}t.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=t.length;a<o;a+=2){const l=t[a][2],d=t[a+1][2];l.push(d),d.push(l),n.add(l),n.add(d)}const r=[];let i;for(;n.size>0;){const a=n.values().next().value;let[o,l,d,h,f]=a;n.delete(a);let p=o,m=l;for(i=[o,d],r.push(i);;){let b;if(n.has(h))b=h;else if(n.has(f))b=f;else break;n.delete(b),[o,l,d,h,f]=b,p!==o&&(i.push(p,m,o,m===l?l:d),p=o),m=m===l?d:l}i.push(p,m)}return new Uj(r,c(this,mf),c(this,gf))},qp=function(e){const t=c(this,wr);let n=0,r=t.length-1;for(;n<=r;){const i=n+r>>1,a=t[i][0];if(a===e)return i;a<e?n=i+1:r=i-1}return r+1},wS=function([,e,t]){const n=j(this,Js,qp).call(this,e);c(this,wr).splice(n,0,[e,t])},kS=function([,e,t]){const n=j(this,Js,qp).call(this,e);for(let r=n;r<c(this,wr).length;r++){const[i,a]=c(this,wr)[r];if(i!==e)break;if(i===e&&a===t){c(this,wr).splice(r,1);return}}for(let r=n-1;r>=0;r--){const[i,a]=c(this,wr)[r];if(i!==e)break;if(i===e&&a===t){c(this,wr).splice(r,1);return}}},bb=function(e){const[t,n,r]=e,i=[[t,n,r]],a=j(this,Js,qp).call(this,r);for(let o=0;o<a;o++){const[l,d]=c(this,wr)[o];for(let h=0,f=i.length;h<f;h++){const[,p,m]=i[h];if(!(d<=p||m<=l)){if(p>=l){if(m>d)i[h][1]=d;else{if(f===1)return[];i.splice(h,1),h--,f--}continue}i[h][2]=l,m>d&&i.push([t,d,m])}}}return i};var xf,pd;class Uj extends Se{constructor(t,n,r){super();T(this,xf);T(this,pd);S(this,pd,t),S(this,xf,n),this.lastPoint=r}toSVGPath(){const t=[];for(const n of c(this,pd)){let[r,i]=n;t.push(`M${r} ${i}`);for(let a=2;a<n.length;a+=2){const o=n[a],l=n[a+1];o===r?(t.push(`V${l}`),i=l):l===i&&(t.push(`H${o}`),r=o)}t.push("Z")}return t.join(" ")}serialize([t,n,r,i],a){const o=[],l=r-t,d=i-n;for(const h of c(this,pd)){const f=new Array(h.length);for(let p=0;p<h.length;p+=2)f[p]=t+h[p]*l,f[p+1]=i-h[p+1]*d;o.push(f)}return o}get box(){return c(this,xf)}get classNamesForOutlining(){return["highlightOutline"]}}xf=new WeakMap,pd=new WeakMap;class yb extends Om{newFreeDrawOutline(e,t,n,r,i,a){return new Hj(e,t,n,r,i,a)}}class Hj extends bS{newOutliner(e,t,n,r,i,a=0){return new yb(e,t,n,r,i,a)}}var kr,ml,md,Zt,bf,gd,yf,vf,Da,_r,xd,wf,ht,vb,wb,kb,bo,_S,ca;const on=class on{constructor({editor:e=null,uiManager:t=null}){T(this,ht);T(this,kr,null);T(this,ml,null);T(this,md);T(this,Zt,null);T(this,bf,!1);T(this,gd,!1);T(this,yf,null);T(this,vf);T(this,Da,null);T(this,_r,null);T(this,xd);var n;e?(S(this,gd,!1),S(this,xd,Ke.HIGHLIGHT_COLOR),S(this,yf,e)):(S(this,gd,!0),S(this,xd,Ke.HIGHLIGHT_DEFAULT_COLOR)),S(this,_r,(e==null?void 0:e._uiManager)||t),S(this,vf,c(this,_r)._eventBus),S(this,md,(e==null?void 0:e.color)||((n=c(this,_r))==null?void 0:n.highlightColors.values().next().value)||"#FFFF98"),c(on,wf)||S(on,wf,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return qe(this,"_keyboardManager",new Df([[["Escape","mac+Escape"],on.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],on.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],on.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],on.prototype._moveToPrevious],[["Home","mac+Home"],on.prototype._moveToBeginning],[["End","mac+End"],on.prototype._moveToEnd]]))}renderButton(){const e=S(this,kr,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=c(this,_r)._signal;e.addEventListener("click",j(this,ht,bo).bind(this),{signal:t}),e.addEventListener("keydown",j(this,ht,kb).bind(this),{signal:t});const n=S(this,ml,document.createElement("span"));return n.className="swatch",n.setAttribute("aria-hidden",!0),n.style.backgroundColor=c(this,md),e.append(n),e}renderMainDropdown(){const e=S(this,Zt,j(this,ht,vb).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===c(this,kr)){j(this,ht,bo).call(this,e);return}const t=e.target.getAttribute("data-color");t&&j(this,ht,wb).call(this,t,e)}_moveToNext(e){var t,n;if(!c(this,ht,ca)){j(this,ht,bo).call(this,e);return}if(e.target===c(this,kr)){(t=c(this,Zt).firstChild)==null||t.focus();return}(n=e.target.nextSibling)==null||n.focus()}_moveToPrevious(e){var t,n;if(e.target===((t=c(this,Zt))==null?void 0:t.firstChild)||e.target===c(this,kr)){c(this,ht,ca)&&this._hideDropdownFromKeyboard();return}c(this,ht,ca)||j(this,ht,bo).call(this,e),(n=e.target.previousSibling)==null||n.focus()}_moveToBeginning(e){var t;if(!c(this,ht,ca)){j(this,ht,bo).call(this,e);return}(t=c(this,Zt).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!c(this,ht,ca)){j(this,ht,bo).call(this,e);return}(t=c(this,Zt).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=c(this,Zt))==null||e.classList.add("hidden"),(t=c(this,Da))==null||t.abort(),S(this,Da,null)}_hideDropdownFromKeyboard(){var e;if(!c(this,gd)){if(!c(this,ht,ca)){(e=c(this,yf))==null||e.unselect();return}this.hideDropdown(),c(this,kr).focus({preventScroll:!0,focusVisible:c(this,bf)})}}updateColor(e){if(c(this,ml)&&(c(this,ml).style.backgroundColor=e),!c(this,Zt))return;const t=c(this,_r).highlightColors.values();for(const n of c(this,Zt).children)n.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=c(this,kr))==null||e.remove(),S(this,kr,null),S(this,ml,null),(t=c(this,Zt))==null||t.remove(),S(this,Zt,null)}};kr=new WeakMap,ml=new WeakMap,md=new WeakMap,Zt=new WeakMap,bf=new WeakMap,gd=new WeakMap,yf=new WeakMap,vf=new WeakMap,Da=new WeakMap,_r=new WeakMap,xd=new WeakMap,wf=new WeakMap,ht=new WeakSet,vb=function(){const e=document.createElement("div"),t=c(this,_r)._signal;e.addEventListener("contextmenu",Ir,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[n,r]of c(this,_r).highlightColors){const i=document.createElement("button");i.tabIndex="0",i.role="option",i.setAttribute("data-color",r),i.title=n,i.setAttribute("data-l10n-id",c(on,wf)[n]);const a=document.createElement("span");i.append(a),a.className="swatch",a.style.backgroundColor=r,i.setAttribute("aria-selected",r===c(this,md)),i.addEventListener("click",j(this,ht,wb).bind(this,r),{signal:t}),e.append(i)}return e.addEventListener("keydown",j(this,ht,kb).bind(this),{signal:t}),e},wb=function(e,t){t.stopPropagation(),c(this,vf).dispatch("switchannotationeditorparams",{source:this,type:c(this,xd),value:e})},kb=function(e){on._keyboardManager.exec(this,e)},bo=function(e){if(c(this,ht,ca)){this.hideDropdown();return}if(S(this,bf,e.detail===0),c(this,Da)||(S(this,Da,new AbortController),window.addEventListener("pointerdown",j(this,ht,_S).bind(this),{signal:c(this,_r).combinedSignal(c(this,Da))})),c(this,Zt)){c(this,Zt).classList.remove("hidden");return}const t=S(this,Zt,j(this,ht,vb).call(this));c(this,kr).append(t)},_S=function(e){var t;(t=c(this,Zt))!=null&&t.contains(e.target)||this.hideDropdown()},ca=function(){return c(this,Zt)&&!c(this,Zt).classList.contains("hidden")},T(on,wf,null);let zm=on;var bd,kf,Bi,gl,yd,dn,_f,Sf,xl,Xn,Cn,xs,vd,Ui,Is,wd,Kn,Af,$e,_b,Xp,SS,AS,ES,Sb,yo,sr,sc,NS,Kp,bu,CS,TS,jS,PS,MS;const it=class it extends Mt{constructor(t){super({...t,name:"highlightEditor"});T(this,$e);T(this,bd,null);T(this,kf,0);T(this,Bi);T(this,gl,null);T(this,yd,null);T(this,dn,null);T(this,_f,null);T(this,Sf,0);T(this,xl,null);T(this,Xn,null);T(this,Cn,null);T(this,xs,!1);T(this,vd,null);T(this,Ui);T(this,Is,null);T(this,wd,"");T(this,Kn);T(this,Af,"");this.color=t.color||it._defaultColor,S(this,Kn,t.thickness||it._defaultThickness),S(this,Ui,t.opacity||it._defaultOpacity),S(this,Bi,t.boxes||null),S(this,Af,t.methodOfCreation||""),S(this,wd,t.text||""),this._isDraggable=!1,t.highlightId>-1?(S(this,xs,!0),j(this,$e,Xp).call(this,t),j(this,$e,yo).call(this)):c(this,Bi)&&(S(this,bd,t.anchorNode),S(this,kf,t.anchorOffset),S(this,_f,t.focusNode),S(this,Sf,t.focusOffset),j(this,$e,_b).call(this),j(this,$e,yo).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const t=it.prototype;return qe(this,"_keyboardManager",new Df([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:c(this,xs)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:c(this,Kn),methodOfCreation:c(this,Af)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,n){var r;Mt.initialize(t,n),it._defaultColor||(it._defaultColor=((r=n.highlightColors)==null?void 0:r.values().next().value)||"#fff066")}static updateDefaultParams(t,n){switch(t){case Ke.HIGHLIGHT_DEFAULT_COLOR:it._defaultColor=n;break;case Ke.HIGHLIGHT_THICKNESS:it._defaultThickness=n;break}}translateInPage(t,n){}get toolbarPosition(){return c(this,vd)}updateParams(t,n){switch(t){case Ke.HIGHLIGHT_COLOR:j(this,$e,SS).call(this,n);break;case Ke.HIGHLIGHT_THICKNESS:j(this,$e,AS).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[Ke.HIGHLIGHT_DEFAULT_COLOR,it._defaultColor],[Ke.HIGHLIGHT_THICKNESS,it._defaultThickness]]}get propertiesToUpdate(){return[[Ke.HIGHLIGHT_COLOR,this.color||it._defaultColor],[Ke.HIGHLIGHT_THICKNESS,c(this,Kn)||it._defaultThickness],[Ke.HIGHLIGHT_FREE,c(this,xs)]]}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(S(this,yd,new zm({editor:this})),t.addColorPicker(c(this,yd))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(j(this,$e,bu).call(this))}getBaseTranslation(){return[0,0]}getRect(t,n){return super.getRect(t,n,j(this,$e,bu).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){j(this,$e,Sb).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(j(this,$e,yo).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let n=!1;this.parent&&!t?j(this,$e,Sb).call(this):t&&(j(this,$e,yo).call(this,t),n=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),n&&this.select()}rotate(t){var i,a,o;const{drawLayer:n}=this.parent;let r;c(this,xs)?(t=(t-this.rotation+360)%360,r=j(i=it,sr,sc).call(i,c(this,Xn).box,t)):r=j(a=it,sr,sc).call(a,[this.x,this.y,this.width,this.height],t),n.updateProperties(c(this,Cn),{bbox:r,root:{"data-main-rotation":t}}),n.updateProperties(c(this,Is),{bbox:j(o=it,sr,sc).call(o,c(this,dn).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();c(this,wd)&&(t.setAttribute("aria-label",c(this,wd)),t.setAttribute("role","mark")),c(this,xs)?t.classList.add("free"):this.div.addEventListener("keydown",j(this,$e,NS).bind(this),{signal:this._uiManager._signal});const n=S(this,xl,document.createElement("div"));t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=c(this,gl);const[r,i]=this.parentDimensions;return this.setDims(this.width*r,this.height*i),Lm(this,c(this,xl),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(c(this,Is),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(c(this,Is),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:j(this,$e,Kp).call(this,!0);break;case 1:case 3:j(this,$e,Kp).call(this,!1);break}}select(){var t;super.select(),c(this,Is)&&((t=this.parent)==null||t.drawLayer.updateProperties(c(this,Is),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),c(this,Is)&&((t=this.parent)==null||t.drawLayer.updateProperties(c(this,Is),{rootClass:{selected:!1}}),c(this,xs)||j(this,$e,Kp).call(this,!1))}get _mustFixPosition(){return!c(this,xs)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(c(this,Cn),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(c(this,Is),{rootClass:{hidden:!t}}))}static startHighlighting(t,n,{target:r,x:i,y:a}){const{x:o,y:l,width:d,height:h}=r.getBoundingClientRect(),f=new AbortController,p=t.combinedSignal(f),m=b=>{f.abort(),j(this,sr,PS).call(this,t,b)};window.addEventListener("blur",m,{signal:p}),window.addEventListener("pointerup",m,{signal:p}),window.addEventListener("pointerdown",Ln,{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",Ir,{signal:p}),r.addEventListener("pointermove",j(this,sr,jS).bind(this,t),{signal:p}),this._freeHighlight=new yb({x:i,y:a},[o,l,d,h],t.scale,this._defaultThickness/2,n,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,n,r){var x,v,g,y;let i=null;if(t instanceof rS){const{data:{quadPoints:w,rect:k,rotation:C,id:P,color:N,opacity:I,popupRef:M},parent:{page:{pageNumber:L}}}=t;i=t={annotationType:Be.HIGHLIGHT,color:Array.from(N),opacity:I,quadPoints:w,boxes:null,pageIndex:L-1,rect:k.slice(0),rotation:C,id:P,deleted:!1,popupRef:M}}else if(t instanceof ev){const{data:{inkLists:w,rect:k,rotation:C,id:P,color:N,borderStyle:{rawWidth:I},popupRef:M},parent:{page:{pageNumber:L}}}=t;i=t={annotationType:Be.HIGHLIGHT,color:Array.from(N),thickness:I,inkLists:w,boxes:null,pageIndex:L-1,rect:k.slice(0),rotation:C,id:P,deleted:!1,popupRef:M}}const{color:a,quadPoints:o,inkLists:l,opacity:d}=t,h=await super.deserialize(t,n,r);h.color=Ce.makeHexColor(...a),S(h,Ui,d||1),l&&S(h,Kn,t.thickness),h.annotationElementId=t.id||null,h._initialData=i;const[f,p]=h.pageDimensions,[m,b]=h.pageTranslation;if(o){const w=S(h,Bi,[]);for(let k=0;k<o.length;k+=8)w.push({x:(o[k]-m)/f,y:1-(o[k+1]-b)/p,width:(o[k+2]-o[k])/f,height:(o[k+1]-o[k+5])/p});j(x=h,$e,_b).call(x),j(v=h,$e,yo).call(v),h.rotate(h.rotation)}else if(l){S(h,xs,!0);const w=l[0],k={x:w[0]-m,y:p-(w[1]-b)},C=new yb(k,[0,0,f,p],1,c(h,Kn)/2,!0,.001);for(let I=0,M=w.length;I<M;I+=2)k.x=w[I]-m,k.y=p-(w[I+1]-b),C.add(k);const{id:P,clipPathId:N}=n.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:h.color,"fill-opacity":h._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:C.toSVGPath()}},!0,!0);j(g=h,$e,Xp).call(g,{highlightOutlines:C.getOutlines(),highlightId:P,clipPathId:N}),j(y=h,$e,yo).call(y)}return h}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const n=this.getRect(0,0),r=Mt._colorManager.convert(this.color),i={annotationType:Be.HIGHLIGHT,color:r,opacity:c(this,Ui),thickness:c(this,Kn),quadPoints:j(this,$e,CS).call(this),outlines:j(this,$e,TS).call(this,n),pageIndex:this.pageIndex,rect:n,rotation:j(this,$e,bu).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!j(this,$e,MS).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};bd=new WeakMap,kf=new WeakMap,Bi=new WeakMap,gl=new WeakMap,yd=new WeakMap,dn=new WeakMap,_f=new WeakMap,Sf=new WeakMap,xl=new WeakMap,Xn=new WeakMap,Cn=new WeakMap,xs=new WeakMap,vd=new WeakMap,Ui=new WeakMap,Is=new WeakMap,wd=new WeakMap,Kn=new WeakMap,Af=new WeakMap,$e=new WeakSet,_b=function(){const t=new xb(c(this,Bi),.001);S(this,Xn,t.getOutlines()),[this.x,this.y,this.width,this.height]=c(this,Xn).box;const n=new xb(c(this,Bi),.0025,.001,this._uiManager.direction==="ltr");S(this,dn,n.getOutlines());const{lastPoint:r}=c(this,dn);S(this,vd,[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height])},Xp=function({highlightOutlines:t,highlightId:n,clipPathId:r}){var f,p;if(S(this,Xn,t),S(this,dn,t.getNewOutline(c(this,Kn)/2+1.5,.0025)),n>=0)S(this,Cn,n),S(this,gl,r),this.parent.drawLayer.finalizeDraw(n,{bbox:t.box,path:{d:t.toSVGPath()}}),S(this,Is,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:c(this,dn).box,path:{d:c(this,dn).toSVGPath()}},!0));else if(this.parent){const m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(c(this,Cn),{bbox:j(f=it,sr,sc).call(f,c(this,Xn).box,(m-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(c(this,Is),{bbox:j(p=it,sr,sc).call(p,c(this,dn).box,m),path:{d:c(this,dn).toSVGPath()}})}const[a,o,l,d]=t.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=l,this.height=d;break;case 90:{const[m,b]=this.parentDimensions;this.x=o,this.y=1-a,this.width=l*b/m,this.height=d*m/b;break}case 180:this.x=1-a,this.y=1-o,this.width=l,this.height=d;break;case 270:{const[m,b]=this.parentDimensions;this.x=1-o,this.y=a,this.width=l*b/m,this.height=d*m/b;break}}const{lastPoint:h}=c(this,dn);S(this,vd,[(h[0]-a)/l,(h[1]-o)/d])},SS=function(t){const n=(a,o)=>{var l,d;this.color=a,S(this,Ui,o),(l=this.parent)==null||l.drawLayer.updateProperties(c(this,Cn),{root:{fill:a,"fill-opacity":o}}),(d=c(this,yd))==null||d.updateColor(a)},r=this.color,i=c(this,Ui);this.addCommands({cmd:n.bind(this,t,it._defaultOpacity),undo:n.bind(this,r,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ke.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},AS=function(t){const n=c(this,Kn),r=i=>{S(this,Kn,i),j(this,$e,ES).call(this,i)};this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ke.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},ES=function(t){if(!c(this,xs))return;j(this,$e,Xp).call(this,{highlightOutlines:c(this,Xn).getNewOutline(t/2)}),this.fixAndSetPosition();const[n,r]=this.parentDimensions;this.setDims(this.width*n,this.height*r)},Sb=function(){c(this,Cn)===null||!this.parent||(this.parent.drawLayer.remove(c(this,Cn)),S(this,Cn,null),this.parent.drawLayer.remove(c(this,Is)),S(this,Is,null))},yo=function(t=this.parent){c(this,Cn)===null&&({id:Us(this,Cn)._,clipPathId:Us(this,gl)._}=t.drawLayer.draw({bbox:c(this,Xn).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":c(this,Ui)},rootClass:{highlight:!0,free:c(this,xs)},path:{d:c(this,Xn).toSVGPath()}},!1,!0),S(this,Is,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:c(this,xs)},bbox:c(this,dn).box,path:{d:c(this,dn).toSVGPath()}},c(this,xs))),c(this,xl)&&(c(this,xl).style.clipPath=c(this,gl)))},sr=new WeakSet,sc=function([t,n,r,i],a){switch(a){case 90:return[1-n-i,t,i,r];case 180:return[1-t-r,1-n-i,r,i];case 270:return[n,1-t-r,i,r]}return[t,n,r,i]},NS=function(t){it._keyboardManager.exec(this,t)},Kp=function(t){if(!c(this,bd))return;const n=window.getSelection();t?n.setPosition(c(this,bd),c(this,kf)):n.setPosition(c(this,_f),c(this,Sf))},bu=function(){return c(this,xs)?this.rotation:0},CS=function(){if(c(this,xs))return null;const[t,n]=this.pageDimensions,[r,i]=this.pageTranslation,a=c(this,Bi),o=new Float32Array(a.length*8);let l=0;for(const{x:d,y:h,width:f,height:p}of a){const m=d*t+r,b=(1-h)*n+i;o[l]=o[l+4]=m,o[l+1]=o[l+3]=b,o[l+2]=o[l+6]=m+f*t,o[l+5]=o[l+7]=b-p*n,l+=8}return o},TS=function(t){return c(this,Xn).serialize(t,j(this,$e,bu).call(this))},jS=function(t,n){this._freeHighlight.add(n)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},PS=function(t,n){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(n,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},MS=function(t){const{color:n}=this._initialData;return t.color.some((r,i)=>r!==n[i])},T(it,sr),Pe(it,"_defaultColor",null),Pe(it,"_defaultOpacity",1),Pe(it,"_defaultThickness",12),Pe(it,"_type","highlight"),Pe(it,"_editorType",Be.HIGHLIGHT),Pe(it,"_freeHighlightId",-1),Pe(it,"_freeHighlight",null),Pe(it,"_freeHighlightClipId","");let $m=it;var bl;class Gj{constructor(){T(this,bl,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,n]of Object.entries(e))this.updateProperty(t,n)}updateSVGProperty(e,t){c(this,bl)[e]=t}toSVGProperties(){const e=c(this,bl);return S(this,bl,Object.create(null)),{root:e}}reset(){S(this,bl,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){gt("Not implemented")}}bl=new WeakMap;var Tn,kd,as,yl,vl,Fa,Oa,za,wl,tt,Eb,Nb,Cb,yu,RS,Yp,vu,nc;const Ee=class Ee extends Mt{constructor(t){super(t);T(this,tt);T(this,Tn,null);T(this,kd);Pe(this,"_drawId",null);S(this,kd,t.mustBeCommitted||!1),t.drawOutlines&&(j(this,tt,Eb).call(this,t),j(this,tt,yu).call(this))}static _mergeSVGProperties(t,n){const r=new Set(Object.keys(t));for(const[i,a]of Object.entries(n))r.has(i)?Object.assign(t[i],a):t[i]=a;return t}static getDefaultDrawingOptions(t){gt("Not implemented")}static get typesMap(){gt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,n){const r=this.typesMap.get(t);r&&this._defaultDrawingOptions.updateProperty(r,n),this._currentParent&&(c(Ee,as).updateProperty(r,n),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,n){const r=this.constructor.typesMap.get(t);r&&this._updateProperty(t,r,n)}static get defaultPropertiesToUpdate(){const t=[],n=this._defaultDrawingOptions;for(const[r,i]of this.typesMap)t.push([r,n[i]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:n}=this;for(const[r,i]of this.constructor.typesMap)t.push([r,n[i]]);return t}_updateProperty(t,n,r){const i=this._drawingOptions,a=i[n],o=l=>{var h;i.updateProperty(n,l);const d=c(this,Tn).updateProperty(n,l);d&&j(this,tt,vu).call(this,d),(h=this.parent)==null||h.drawLayer.updateProperties(this._drawId,i.toSVGProperties())};this.addCommands({cmd:o.bind(this,r),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Ee._mergeSVGProperties(c(this,Tn).getPathResizingSVGProperties(j(this,tt,Yp).call(this)),{bbox:j(this,tt,nc).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Ee._mergeSVGProperties(c(this,Tn).getPathResizedSVGProperties(j(this,tt,Yp).call(this)),{bbox:j(this,tt,nc).call(this)}))}_onTranslating(t,n){var r;(r=this.parent)==null||r.drawLayer.updateProperties(this._drawId,{bbox:j(this,tt,nc).call(this,t,n)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Ee._mergeSVGProperties(c(this,Tn).getPathTranslatedSVGProperties(j(this,tt,Yp).call(this),this.parentDimensions),{bbox:j(this,tt,nc).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,c(this,kd)&&(S(this,kd,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){j(this,tt,Cb).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(j(this,tt,yu).call(this),j(this,tt,vu).call(this,c(this,Tn).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let n=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),j(this,tt,Cb).call(this)):t&&(this._uiManager.addShouldRescale(this),j(this,tt,yu).call(this,t),n=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),n&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,Ee._mergeSVGProperties({bbox:j(this,tt,nc).call(this)},c(this,Tn).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&j(this,tt,vu).call(this,c(this,Tn).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;const t=super.render();t.classList.add("draw");const n=document.createElement("div");t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal";const[r,i]=this.parentDimensions;return this.setDims(this.width*r,this.height*i),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,n,r,i,a){gt("Not implemented")}static startDrawing(t,n,r,i){var v;const{target:a,offsetX:o,offsetY:l,pointerId:d,pointerType:h}=i;if(c(Ee,Oa)&&c(Ee,Oa)!==h)return;const{viewport:{rotation:f}}=t,{width:p,height:m}=a.getBoundingClientRect(),b=S(Ee,yl,new AbortController),x=t.combinedSignal(b);if(c(Ee,Fa)||S(Ee,Fa,d),c(Ee,Oa)??S(Ee,Oa,h),window.addEventListener("pointerup",g=>{var y;c(Ee,Fa)===g.pointerId?this._endDraw(g):(y=c(Ee,za))==null||y.delete(g.pointerId)},{signal:x}),window.addEventListener("pointercancel",g=>{var y;c(Ee,Fa)===g.pointerId?this._currentParent.endDrawingSession():(y=c(Ee,za))==null||y.delete(g.pointerId)},{signal:x}),window.addEventListener("pointerdown",g=>{c(Ee,Oa)===g.pointerType&&((c(Ee,za)||S(Ee,za,new Set)).add(g.pointerId),c(Ee,as).isCancellable()&&(c(Ee,as).removeLastElement(),c(Ee,as).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:x}),window.addEventListener("contextmenu",Ir,{signal:x}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:x}),a.addEventListener("touchmove",g=>{g.timeStamp===c(Ee,wl)&&Ln(g)},{signal:x}),t.toggleDrawing(),(v=n._editorUndoBar)==null||v.hide(),c(Ee,as)){t.drawLayer.updateProperties(this._currentDrawId,c(Ee,as).startNew(o,l,p,m,f));return}n.updateUIForDefaultProperties(this),S(Ee,as,this.createDrawerInstance(o,l,p,m,f)),S(Ee,vl,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(c(Ee,vl).toSVGProperties(),c(Ee,as).defaultSVGProperties),!0,!1)}static _drawMove(t){var a;if(S(Ee,wl,-1),!c(Ee,as))return;const{offsetX:n,offsetY:r,pointerId:i}=t;if(c(Ee,Fa)===i){if(((a=c(Ee,za))==null?void 0:a.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,c(Ee,as).add(n,r)),S(Ee,wl,t.timeStamp),Ln(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,S(Ee,as,null),S(Ee,vl,null),S(Ee,Oa,null),S(Ee,wl,NaN)),c(Ee,yl)&&(c(Ee,yl).abort(),S(Ee,yl,null),S(Ee,Fa,NaN),S(Ee,za,null))}static _endDraw(t){const n=this._currentParent;if(n){if(n.toggleDrawing(!0),this._cleanup(!1),t&&n.drawLayer.updateProperties(this._currentDrawId,c(Ee,as).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const r=c(Ee,as),i=this._currentDrawId,a=r.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(i,r.setLastElement(a))},undo:()=>{n.drawLayer.updateProperties(i,r.removeLastElement())},mustExec:!1,type:Ke.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const n=this._currentParent;if(!n)return null;if(n.toggleDrawing(!0),n.cleanUndoStack(Ke.DRAW_STEP),!c(Ee,as).isEmpty()){const{pageDimensions:[r,i],scale:a}=n,o=n.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:c(Ee,as).getOutlines(r*a,i*a,a,this._INNER_MARGIN),drawingOptions:c(Ee,vl),mustBeCommitted:!t});return this._cleanup(!0),o}return n.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,n,r,i,a,o){gt("Not implemented")}static async deserialize(t,n,r){var f,p;const{rawDims:{pageWidth:i,pageHeight:a,pageX:o,pageY:l}}=n.viewport,d=this.deserializeDraw(o,l,i,a,this._INNER_MARGIN,t),h=await super.deserialize(t,n,r);return h.createDrawingOptions(t),j(f=h,tt,Eb).call(f,{drawOutlines:d}),j(p=h,tt,yu).call(p),h.onScaleChanging(),h.rotate(),h}serializeDraw(t){const[n,r]=this.pageTranslation,[i,a]=this.pageDimensions;return c(this,Tn).serialize([n,r,i,a],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Tn=new WeakMap,kd=new WeakMap,as=new WeakMap,yl=new WeakMap,vl=new WeakMap,Fa=new WeakMap,Oa=new WeakMap,za=new WeakMap,wl=new WeakMap,tt=new WeakSet,Eb=function({drawOutlines:t,drawId:n,drawingOptions:r}){S(this,Tn,t),this._drawingOptions||(this._drawingOptions=r),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,t.defaultProperties)):this._drawId=j(this,tt,Nb).call(this,t,this.parent),j(this,tt,vu).call(this,t.box)},Nb=function(t,n){const{id:r}=n.drawLayer.draw(Ee._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return r},Cb=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},yu=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=j(this,tt,Nb).call(this,c(this,Tn),t)}},RS=function([t,n,r,i]){const{parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[n,1-t,r*(o/a),i*(a/o)];case 180:return[1-t,1-n,r,i];case 270:return[1-n,t,r*(o/a),i*(a/o)];default:return[t,n,r,i]}},Yp=function(){const{x:t,y:n,width:r,height:i,parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[1-n,t,r*(a/o),i*(o/a)];case 180:return[1-t,1-n,r,i];case 270:return[n,1-t,r*(a/o),i*(o/a)];default:return[t,n,r,i]}},vu=function(t){if([this.x,this.y,this.width,this.height]=j(this,tt,RS).call(this,t),this.div){this.fixAndSetPosition();const[n,r]=this.parentDimensions;this.setDims(this.width*n,this.height*r)}this._onResized()},nc=function(){const{x:t,y:n,width:r,height:i,rotation:a,parentRotation:o,parentDimensions:[l,d]}=this;switch((a*4+o)/90){case 1:return[1-n-i,t,i,r];case 2:return[1-t-r,1-n-i,r,i];case 3:return[n,1-t-r,i,r];case 4:return[t,n-r*(l/d),i*(d/l),r*(l/d)];case 5:return[1-n,t,r*(l/d),i*(d/l)];case 6:return[1-t-i*(d/l),1-n,i*(d/l),r*(l/d)];case 7:return[n-r*(l/d),1-t-i*(d/l),r*(l/d),i*(d/l)];case 8:return[t-r,n-i,r,i];case 9:return[1-n,t-r,i,r];case 10:return[1-t,1-n,r,i];case 11:return[n-i,1-t,i,r];case 12:return[t-i*(d/l),n,i*(d/l),r*(l/d)];case 13:return[1-n-r*(l/d),t-i*(d/l),r*(l/d),i*(d/l)];case 14:return[1-t,1-n-r*(l/d),i*(d/l),r*(l/d)];case 15:return[n,1-t,r*(l/d),i*(d/l)];default:return[t,n,r,i]}},Pe(Ee,"_currentDrawId",-1),Pe(Ee,"_currentParent",null),T(Ee,as,null),T(Ee,yl,null),T(Ee,vl,null),T(Ee,Fa,NaN),T(Ee,Oa,null),T(Ee,za,null),T(Ee,wl,NaN),Pe(Ee,"_INNER_MARGIN",3);let Ab=Ee;var ei,os,ls,kl,_d,Ws,bs,Yn,_l,Sl,Al,Sd,Qp;class Vj{constructor(e,t,n,r,i,a){T(this,Sd);T(this,ei,new Float64Array(6));T(this,os);T(this,ls);T(this,kl);T(this,_d);T(this,Ws);T(this,bs,"");T(this,Yn,0);T(this,_l,new Bm);T(this,Sl);T(this,Al);S(this,Sl,n),S(this,Al,r),S(this,kl,i),S(this,_d,a),[e,t]=j(this,Sd,Qp).call(this,e,t);const o=S(this,os,[NaN,NaN,NaN,NaN,e,t]);S(this,Ws,[e,t]),S(this,ls,[{line:o,points:c(this,Ws)}]),c(this,ei).set(o,0)}updateProperty(e,t){e==="stroke-width"&&S(this,_d,t)}isEmpty(){return!c(this,ls)||c(this,ls).length===0}isCancellable(){return c(this,Ws).length<=10}add(e,t){[e,t]=j(this,Sd,Qp).call(this,e,t);const[n,r,i,a]=c(this,ei).subarray(2,6),o=e-i,l=t-a;return Math.hypot(c(this,Sl)*o,c(this,Al)*l)<=2?null:(c(this,Ws).push(e,t),isNaN(n)?(c(this,ei).set([i,a,e,t],2),c(this,os).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(c(this,ei)[0])&&c(this,os).splice(6,6),c(this,ei).set([n,r,i,a,e,t],0),c(this,os).push(...Se.createBezierPoints(n,r,i,a,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const n=this.add(e,t);return n||(c(this,Ws).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,r,i){S(this,Sl,n),S(this,Al,r),S(this,kl,i),[e,t]=j(this,Sd,Qp).call(this,e,t);const a=S(this,os,[NaN,NaN,NaN,NaN,e,t]);S(this,Ws,[e,t]);const o=c(this,ls).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),c(this,ls).push({line:a,points:c(this,Ws)}),c(this,ei).set(a,0),S(this,Yn,0),this.toSVGPath(),null}getLastElement(){return c(this,ls).at(-1)}setLastElement(e){return c(this,ls)?(c(this,ls).push(e),S(this,os,e.line),S(this,Ws,e.points),S(this,Yn,0),{path:{d:this.toSVGPath()}}):c(this,_l).setLastElement(e)}removeLastElement(){if(!c(this,ls))return c(this,_l).removeLastElement();c(this,ls).pop(),S(this,bs,"");for(let e=0,t=c(this,ls).length;e<t;e++){const{line:n,points:r}=c(this,ls)[e];S(this,os,n),S(this,Ws,r),S(this,Yn,0),this.toSVGPath()}return{path:{d:c(this,bs)}}}toSVGPath(){const e=Se.svgRound(c(this,os)[4]),t=Se.svgRound(c(this,os)[5]);if(c(this,Ws).length===2)return S(this,bs,`${c(this,bs)} M ${e} ${t} Z`),c(this,bs);if(c(this,Ws).length<=6){const r=c(this,bs).lastIndexOf("M");S(this,bs,`${c(this,bs).slice(0,r)} M ${e} ${t}`),S(this,Yn,6)}if(c(this,Ws).length===4){const r=Se.svgRound(c(this,os)[10]),i=Se.svgRound(c(this,os)[11]);return S(this,bs,`${c(this,bs)} L ${r} ${i}`),S(this,Yn,12),c(this,bs)}const n=[];c(this,Yn)===0&&(n.push(`M ${e} ${t}`),S(this,Yn,6));for(let r=c(this,Yn),i=c(this,os).length;r<i;r+=6){const[a,o,l,d,h,f]=c(this,os).slice(r,r+6).map(Se.svgRound);n.push(`C${a} ${o} ${l} ${d} ${h} ${f}`)}return S(this,bs,c(this,bs)+n.join(" ")),S(this,Yn,c(this,os).length),c(this,bs)}getOutlines(e,t,n,r){const i=c(this,ls).at(-1);return i.line=new Float32Array(i.line),i.points=new Float32Array(i.points),c(this,_l).build(c(this,ls),e,t,n,c(this,kl),c(this,_d),r),S(this,ei,null),S(this,os,null),S(this,ls,null),S(this,bs,null),c(this,_l)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}ei=new WeakMap,os=new WeakMap,ls=new WeakMap,kl=new WeakMap,_d=new WeakMap,Ws=new WeakMap,bs=new WeakMap,Yn=new WeakMap,_l=new WeakMap,Sl=new WeakMap,Al=new WeakMap,Sd=new WeakSet,Qp=function(e,t){return Se._normalizePoint(e,t,c(this,Sl),c(this,Al),c(this,kl))};var qs,Ef,Nf,jn,ti,si,Ad,Ed,Nd,ws,gi,IS,LS,DS;const iv=class iv extends Se{constructor(){super(...arguments);T(this,ws);T(this,qs);T(this,Ef,0);T(this,Nf);T(this,jn);T(this,ti);T(this,si);T(this,Ad);T(this,Ed);T(this,Nd)}build(t,n,r,i,a,o,l){S(this,ti,n),S(this,si,r),S(this,Ad,i),S(this,Ed,a),S(this,Nd,o),S(this,Nf,l??0),S(this,jn,t),j(this,ws,LS).call(this)}setLastElement(t){return c(this,jn).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return c(this,jn).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:n}of c(this,jn)){if(t.push(`M${Se.svgRound(n[4])} ${Se.svgRound(n[5])}`),n.length===6){t.push("Z");continue}if(n.length===12){t.push(`L${Se.svgRound(n[10])} ${Se.svgRound(n[11])}`);continue}for(let r=6,i=n.length;r<i;r+=6){const[a,o,l,d,h,f]=n.subarray(r,r+6).map(Se.svgRound);t.push(`C${a} ${o} ${l} ${d} ${h} ${f}`)}}return t.join("")}serialize([t,n,r,i],a){const o=[],l=[],[d,h,f,p]=j(this,ws,IS).call(this);let m,b,x,v,g,y,w,k,C;switch(c(this,Ed)){case 0:C=Se._rescale,m=t,b=n+i,x=r,v=-i,g=t+d*r,y=n+(1-h-p)*i,w=t+(d+f)*r,k=n+(1-h)*i;break;case 90:C=Se._rescaleAndSwap,m=t,b=n,x=r,v=i,g=t+h*r,y=n+d*i,w=t+(h+p)*r,k=n+(d+f)*i;break;case 180:C=Se._rescale,m=t+r,b=n,x=-r,v=i,g=t+(1-d-f)*r,y=n+h*i,w=t+(1-d)*r,k=n+(h+p)*i;break;case 270:C=Se._rescaleAndSwap,m=t+r,b=n+i,x=-r,v=-i,g=t+(1-h-p)*r,y=n+(1-d-f)*i,w=t+(1-h)*r,k=n+(1-d)*i;break}for(const{line:P,points:N}of c(this,jn))o.push(C(P,m,b,x,v,a?new Array(P.length):null)),l.push(C(N,m,b,x,v,a?new Array(N.length):null));return{lines:o,points:l,rect:[g,y,w,k]}}static deserialize(t,n,r,i,a,{paths:{lines:o,points:l},rotation:d,thickness:h}){const f=[];let p,m,b,x,v;switch(d){case 0:v=Se._rescale,p=-t/r,m=n/i+1,b=1/r,x=-1/i;break;case 90:v=Se._rescaleAndSwap,p=-n/i,m=-t/r,b=1/i,x=1/r;break;case 180:v=Se._rescale,p=t/r+1,m=-n/i,b=-1/r,x=1/i;break;case 270:v=Se._rescaleAndSwap,p=n/i+1,m=t/r+1,b=-1/i,x=-1/r;break}if(!o){o=[];for(const y of l){const w=y.length;if(w===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,y[0],y[1]]));continue}if(w===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,y[0],y[1],NaN,NaN,NaN,NaN,y[2],y[3]]));continue}const k=new Float32Array(3*(w-2));o.push(k);let[C,P,N,I]=y.subarray(0,4);k.set([NaN,NaN,NaN,NaN,C,P],0);for(let M=4;M<w;M+=2){const L=y[M],$=y[M+1];k.set(Se.createBezierPoints(C,P,N,I,L,$),(M-2)*3),[C,P,N,I]=[N,I,L,$]}}}for(let y=0,w=o.length;y<w;y++)f.push({line:v(o[y].map(k=>k??NaN),p,m,b,x),points:v(l[y].map(k=>k??NaN),p,m,b,x)});const g=new iv;return g.build(f,r,i,1,d,h,a),g}get box(){return c(this,qs)}updateProperty(t,n){return t==="stroke-width"?j(this,ws,DS).call(this,n):null}updateParentDimensions([t,n],r){const[i,a]=j(this,ws,gi).call(this);S(this,ti,t),S(this,si,n),S(this,Ad,r);const[o,l]=j(this,ws,gi).call(this),d=o-i,h=l-a,f=c(this,qs);return f[0]-=d,f[1]-=h,f[2]+=2*d,f[3]+=2*h,f}updateRotation(t){return S(this,Ef,t),{path:{transform:this.rotationTransform}}}get viewBox(){return c(this,qs).map(Se.svgRound).join(" ")}get defaultProperties(){const[t,n]=c(this,qs);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Se.svgRound(t)} ${Se.svgRound(n)}`}}}get rotationTransform(){const[,,t,n]=c(this,qs);let r=0,i=0,a=0,o=0,l=0,d=0;switch(c(this,Ef)){case 90:i=n/t,a=-t/n,l=t;break;case 180:r=-1,o=-1,l=t,d=n;break;case 270:i=-n/t,a=t/n,d=n;break;default:return""}return`matrix(${r} ${i} ${a} ${o} ${Se.svgRound(l)} ${Se.svgRound(d)})`}getPathResizingSVGProperties([t,n,r,i]){const[a,o]=j(this,ws,gi).call(this),[l,d,h,f]=c(this,qs);if(Math.abs(h-a)<=Se.PRECISION||Math.abs(f-o)<=Se.PRECISION){const v=t+r/2-(l+h/2),g=n+i/2-(d+f/2);return{path:{"transform-origin":`${Se.svgRound(t)} ${Se.svgRound(n)}`,transform:`${this.rotationTransform} translate(${v} ${g})`}}}const p=(r-2*a)/(h-2*a),m=(i-2*o)/(f-2*o),b=h/r,x=f/i;return{path:{"transform-origin":`${Se.svgRound(l)} ${Se.svgRound(d)}`,transform:`${this.rotationTransform} scale(${b} ${x}) translate(${Se.svgRound(a)} ${Se.svgRound(o)}) scale(${p} ${m}) translate(${Se.svgRound(-a)} ${Se.svgRound(-o)})`}}}getPathResizedSVGProperties([t,n,r,i]){const[a,o]=j(this,ws,gi).call(this),l=c(this,qs),[d,h,f,p]=l;if(l[0]=t,l[1]=n,l[2]=r,l[3]=i,Math.abs(f-a)<=Se.PRECISION||Math.abs(p-o)<=Se.PRECISION){const g=t+r/2-(d+f/2),y=n+i/2-(h+p/2);for(const{line:w,points:k}of c(this,jn))Se._translate(w,g,y,w),Se._translate(k,g,y,k);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Se.svgRound(t)} ${Se.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const m=(r-2*a)/(f-2*a),b=(i-2*o)/(p-2*o),x=-m*(d+a)+t+a,v=-b*(h+o)+n+o;if(m!==1||b!==1||x!==0||v!==0)for(const{line:g,points:y}of c(this,jn))Se._rescale(g,x,v,m,b,g),Se._rescale(y,x,v,m,b,y);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Se.svgRound(t)} ${Se.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,n],r){const[i,a]=r,o=c(this,qs),l=t-o[0],d=n-o[1];if(c(this,ti)===i&&c(this,si)===a)for(const{line:h,points:f}of c(this,jn))Se._translate(h,l,d,h),Se._translate(f,l,d,f);else{const h=c(this,ti)/i,f=c(this,si)/a;S(this,ti,i),S(this,si,a);for(const{line:p,points:m}of c(this,jn))Se._rescale(p,l,d,h,f,p),Se._rescale(m,l,d,h,f,m);o[2]*=h,o[3]*=f}return o[0]=t,o[1]=n,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${Se.svgRound(t)} ${Se.svgRound(n)}`}}}get defaultSVGProperties(){const t=c(this,qs);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${Se.svgRound(t[0])} ${Se.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}};qs=new WeakMap,Ef=new WeakMap,Nf=new WeakMap,jn=new WeakMap,ti=new WeakMap,si=new WeakMap,Ad=new WeakMap,Ed=new WeakMap,Nd=new WeakMap,ws=new WeakSet,gi=function(t=c(this,Nd)){const n=c(this,Nf)+t/2*c(this,Ad);return c(this,Ed)%180===0?[n/c(this,ti),n/c(this,si)]:[n/c(this,si),n/c(this,ti)]},IS=function(){const[t,n,r,i]=c(this,qs),[a,o]=j(this,ws,gi).call(this,0);return[t+a,n+o,r-2*a,i-2*o]},LS=function(){const t=S(this,qs,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:i}of c(this,jn)){if(i.length<=12){for(let l=4,d=i.length;l<d;l+=6){const[h,f]=i.subarray(l,l+2);t[0]=Math.min(t[0],h),t[1]=Math.min(t[1],f),t[2]=Math.max(t[2],h),t[3]=Math.max(t[3],f)}continue}let a=i[4],o=i[5];for(let l=6,d=i.length;l<d;l+=6){const[h,f,p,m,b,x]=i.subarray(l,l+6);Ce.bezierBoundingBox(a,o,h,f,p,m,b,x,t),a=b,o=x}}const[n,r]=j(this,ws,gi).call(this);t[0]=Math.min(1,Math.max(0,t[0]-n)),t[1]=Math.min(1,Math.max(0,t[1]-r)),t[2]=Math.min(1,Math.max(0,t[2]+n)),t[3]=Math.min(1,Math.max(0,t[3]+r)),t[2]-=t[0],t[3]-=t[1]},DS=function(t){const[n,r]=j(this,ws,gi).call(this);S(this,Nd,t);const[i,a]=j(this,ws,gi).call(this),[o,l]=[i-n,a-r],d=c(this,qs);return d[0]-=o,d[1]-=l,d[2]+=2*o,d[3]+=2*l,d};let Bm=iv;var Cd;const av=class av extends Gj{constructor(t){super();T(this,Cd);S(this,Cd,t),super.updateProperties({fill:"none",stroke:Mt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,n){t==="stroke-width"&&(n??(n=this["stroke-width"]),n*=c(this,Cd).realScale),super.updateSVGProperty(t,n)}clone(){const t=new av(c(this,Cd));return t.updateAll(this),t}};Cd=new WeakMap;let Tb=av;var i0,FS;const yc=class yc extends Ab{constructor(t){super({...t,name:"inkEditor"});T(this,i0);this._willKeepAspectRatio=!0}static initialize(t,n){Mt.initialize(t,n),this._defaultDrawingOptions=new Tb(n.viewParameters)}static getDefaultDrawingOptions(t){const n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!0}static get typesMap(){return qe(this,"typesMap",new Map([[Ke.INK_THICKNESS,"stroke-width"],[Ke.INK_COLOR,"stroke"],[Ke.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,n,r,i,a){return new Vj(t,n,r,i,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,n,r,i,a,o){return Bm.deserialize(t,n,r,i,a,o)}static async deserialize(t,n,r){let i=null;if(t instanceof ev){const{data:{inkLists:o,rect:l,rotation:d,id:h,color:f,opacity:p,borderStyle:{rawWidth:m},popupRef:b},parent:{page:{pageNumber:x}}}=t;i=t={annotationType:Be.INK,color:Array.from(f),thickness:m,opacity:p,paths:{points:o},boxes:null,pageIndex:x-1,rect:l.slice(0),rotation:d,id:h,deleted:!1,popupRef:b}}const a=await super.deserialize(t,n,r);return a.annotationElementId=t.id||null,a._initialData=i,a}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:n,parent:r}=this;n.updateSVGProperty("stroke-width"),r.drawLayer.updateProperties(t,n.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:n,opacity:r}){this._drawingOptions=yc.getDefaultDrawingOptions({stroke:Ce.makeHexColor(...t),"stroke-width":n,"stroke-opacity":r})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:n,points:r,rect:i}=this.serializeDraw(t),{_drawingOptions:{stroke:a,"stroke-opacity":o,"stroke-width":l}}=this,d={annotationType:Be.INK,color:Mt._colorManager.convert(a),opacity:o,thickness:l,paths:{lines:n,points:r},pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?d:this.annotationElementId&&!j(this,i0,FS).call(this,d)?null:(d.id=this.annotationElementId,d)}renderAnnotationElement(t){const{points:n,rect:r}=this.serializeDraw(!1);return t.updateEdited({rect:r,thickness:this._drawingOptions["stroke-width"],points:n}),null}};i0=new WeakSet,FS=function(t){const{color:n,thickness:r,opacity:i,pageIndex:a}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((o,l)=>o!==n[l])||t.thickness!==r||t.opacity!==i||t.pageIndex!==a},Pe(yc,"_type","ink"),Pe(yc,"_editorType",Be.INK),Pe(yc,"_defaultDrawingOptions",null);let jb=yc;var jt,ys,$a,Hi,Ba,Td,ni,ri,Pn,jd,st,wu,ku,Zp,Mb,Jp,Rb,em,OS;const Lu=class Lu extends Mt{constructor(t){super({...t,name:"stampEditor"});T(this,st);T(this,jt,null);T(this,ys,null);T(this,$a,null);T(this,Hi,null);T(this,Ba,null);T(this,Td,"");T(this,ni,null);T(this,ri,null);T(this,Pn,!1);T(this,jd,!1);S(this,Hi,t.bitmapUrl),S(this,Ba,t.bitmapFile)}static initialize(t,n){Mt.initialize(t,n)}static get supportedTypes(){return qe(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(n=>`image/${n}`))}static get supportedTypesStr(){return qe(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,n){n.pasteEditor(Be.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const n=t.get("hasAltText");return{hasAltText:n.get(!0)??0,hasNoAltText:n.get(!1)??0}}async mlGuessAltText(t=null,n=!0){if(this.hasAltTextData())return null;const{mlManager:r}=this._uiManager;if(!r)throw new Error("No ML.");if(!await r.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:a,height:o}=t||this.copyCanvas(null,null,!0).imageData,l=await r.guess({name:"altText",request:{data:i,width:a,height:o,channels:i.length/(a*o)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const d=l.output;return await this.setGuessedAltText(d),n&&!this.hasAltTextData()&&(this.altTextData={alt:d,decorative:!1}),d}remove(){var t;c(this,ys)&&(S(this,jt,null),this._uiManager.imageManager.deleteId(c(this,ys)),(t=c(this,ni))==null||t.remove(),S(this,ni,null),c(this,ri)&&(clearTimeout(c(this,ri)),S(this,ri,null))),super.remove()}rebuild(){if(!this.parent){c(this,ys)&&j(this,st,Zp).call(this);return}super.rebuild(),this.div!==null&&(c(this,ys)&&c(this,ni)===null&&j(this,st,Zp).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(c(this,$a)||c(this,jt)||c(this,Hi)||c(this,Ba)||c(this,ys))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,n;if(this.width&&(t=this.x,n=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),c(this,jt)?j(this,st,Mb).call(this):j(this,st,Zp).call(this),this.width&&!this.annotationElementId){const[r,i]=this.parentDimensions;this.setAt(t*r,n*i,this.width*r,this.height*i)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;c(this,ri)!==null&&clearTimeout(c(this,ri)),S(this,ri,setTimeout(()=>{S(this,ri,null),j(this,st,Rb).call(this)},200))}copyCanvas(t,n,r=!1){var m;t||(t=224);const{width:i,height:a}=c(this,jt),o=new Tx;let l=c(this,jt),d=i,h=a,f=null;if(n){if(i>n||a>n){const I=Math.min(n/i,n/a);d=Math.floor(i*I),h=Math.floor(a*I)}f=document.createElement("canvas");const b=f.width=Math.ceil(d*o.sx),x=f.height=Math.ceil(h*o.sy);c(this,Pn)||(l=j(this,st,Jp).call(this,b,x));const v=f.getContext("2d");v.filter=this._uiManager.hcmFilter;let g="white",y="#cfcfd8";this._uiManager.hcmFilter!=="none"?y="black":(m=window.matchMedia)!=null&&m.call(window,"(prefers-color-scheme: dark)").matches&&(g="#8f8f9d",y="#42414d");const w=15,k=w*o.sx,C=w*o.sy,P=new OffscreenCanvas(k*2,C*2),N=P.getContext("2d");N.fillStyle=g,N.fillRect(0,0,k*2,C*2),N.fillStyle=y,N.fillRect(0,0,k,C),N.fillRect(k,C,k,C),v.fillStyle=v.createPattern(P,"repeat"),v.fillRect(0,0,b,x),v.drawImage(l,0,0,l.width,l.height,0,0,b,x)}let p=null;if(r){let b,x;if(o.symmetric&&l.width<t&&l.height<t)b=l.width,x=l.height;else if(l=c(this,jt),i>t||a>t){const y=Math.min(t/i,t/a);b=Math.floor(i*y),x=Math.floor(a*y),c(this,Pn)||(l=j(this,st,Jp).call(this,b,x))}const g=new OffscreenCanvas(b,x).getContext("2d",{willReadFrequently:!0});g.drawImage(l,0,0,l.width,l.height,0,0,b,x),p={width:b,height:x,data:g.getImageData(0,0,b,x).data}}return{canvas:f,width:d,height:h,imageData:p}}getImageForAltText(){return c(this,ni)}static async deserialize(t,n,r){var x;let i=null;if(t instanceof iS){const{data:{rect:v,rotation:g,id:y,structParent:w,popupRef:k},container:C,parent:{page:{pageNumber:P}}}=t,N=C.querySelector("canvas"),I=r.imageManager.getFromCanvas(C.id,N);N.remove();const M=((x=await n._structTree.getAriaAttributes(`${Wy}${y}`))==null?void 0:x.get("aria-label"))||"";i=t={annotationType:Be.STAMP,bitmapId:I.id,bitmap:I.bitmap,pageIndex:P-1,rect:v.slice(0),rotation:g,id:y,deleted:!1,accessibilityData:{decorative:!1,altText:M},isSvg:!1,structParent:w,popupRef:k}}const a=await super.deserialize(t,n,r),{rect:o,bitmap:l,bitmapUrl:d,bitmapId:h,isSvg:f,accessibilityData:p}=t;h&&r.imageManager.isValidId(h)?(S(a,ys,h),l&&S(a,jt,l)):S(a,Hi,d),S(a,Pn,f);const[m,b]=a.pageDimensions;return a.width=(o[2]-o[0])/m,a.height=(o[3]-o[1])/b,a.annotationElementId=t.id||null,p&&(a.altTextData=p),a._initialData=i,S(a,jd,!!i),a}serialize(t=!1,n=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const r={annotationType:Be.STAMP,bitmapId:c(this,ys),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:c(this,Pn),structTreeParentId:this._structTreeParentId};if(t)return r.bitmapUrl=j(this,st,em).call(this,!0),r.accessibilityData=this.serializeAltText(!0),r;const{decorative:i,altText:a}=this.serializeAltText(!1);if(!i&&a&&(r.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const l=j(this,st,OS).call(this,r);if(l.isSame)return null;l.isSameAltText?delete r.accessibilityData:r.accessibilityData.structParent=this._initialData.structParent??-1}if(r.id=this.annotationElementId,n===null)return r;n.stamps||(n.stamps=new Map);const o=c(this,Pn)?(r.rect[2]-r.rect[0])*(r.rect[3]-r.rect[1]):null;if(!n.stamps.has(c(this,ys)))n.stamps.set(c(this,ys),{area:o,serialized:r}),r.bitmap=j(this,st,em).call(this,!1);else if(c(this,Pn)){const l=n.stamps.get(c(this,ys));o>l.area&&(l.area=o,l.serialized.bitmap.close(),l.serialized.bitmap=j(this,st,em).call(this,!1))}return r}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}};jt=new WeakMap,ys=new WeakMap,$a=new WeakMap,Hi=new WeakMap,Ba=new WeakMap,Td=new WeakMap,ni=new WeakMap,ri=new WeakMap,Pn=new WeakMap,jd=new WeakMap,st=new WeakSet,wu=function(t,n=!1){if(!t){this.remove();return}S(this,jt,t.bitmap),n||(S(this,ys,t.id),S(this,Pn,t.isSvg)),t.file&&S(this,Td,t.file.name),j(this,st,Mb).call(this)},ku=function(){if(S(this,$a,null),this._uiManager.enableWaiting(!1),!!c(this,ni)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&c(this,jt)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&c(this,jt)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},Zp=function(){if(c(this,ys)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(c(this,ys)).then(r=>j(this,st,wu).call(this,r,!0)).finally(()=>j(this,st,ku).call(this));return}if(c(this,Hi)){const r=c(this,Hi);S(this,Hi,null),this._uiManager.enableWaiting(!0),S(this,$a,this._uiManager.imageManager.getFromUrl(r).then(i=>j(this,st,wu).call(this,i)).finally(()=>j(this,st,ku).call(this)));return}if(c(this,Ba)){const r=c(this,Ba);S(this,Ba,null),this._uiManager.enableWaiting(!0),S(this,$a,this._uiManager.imageManager.getFromFile(r).then(i=>j(this,st,wu).call(this,i)).finally(()=>j(this,st,ku).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=Lu.supportedTypesStr;const n=this._uiManager._signal;S(this,$a,new Promise(r=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const i=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),j(this,st,wu).call(this,i)}r()},{signal:n}),t.addEventListener("cancel",()=>{this.remove(),r()},{signal:n})}).finally(()=>j(this,st,ku).call(this))),t.click()},Mb=function(){var f;const{div:t}=this;let{width:n,height:r}=c(this,jt);const[i,a]=this.pageDimensions,o=.75;if(this.width)n=this.width*i,r=this.height*a;else if(n>o*i||r>o*a){const p=Math.min(o*i/n,o*a/r);n*=p,r*=p}const[l,d]=this.parentDimensions;this.setDims(n*l/i,r*d/a),this._uiManager.enableWaiting(!1);const h=S(this,ni,document.createElement("canvas"));h.setAttribute("role","img"),this.addContainer(h),this.width=n/i,this.height=r/a,(f=this._initialOptions)!=null&&f.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),j(this,st,Rb).call(this),c(this,jd)||(this.parent.addUndoableEditor(this),S(this,jd,!0)),this._reportTelemetry({action:"inserted_image"}),c(this,Td)&&h.setAttribute("aria-label",c(this,Td))},Jp=function(t,n){const{width:r,height:i}=c(this,jt);let a=r,o=i,l=c(this,jt);for(;a>2*t||o>2*n;){const d=a,h=o;a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*n&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const f=new OffscreenCanvas(a,o);f.getContext("2d").drawImage(l,0,0,d,h,0,0,a,o),l=f.transferToImageBitmap()}return l},Rb=function(){const[t,n]=this.parentDimensions,{width:r,height:i}=this,a=new Tx,o=Math.ceil(r*t*a.sx),l=Math.ceil(i*n*a.sy),d=c(this,ni);if(!d||d.width===o&&d.height===l)return;d.width=o,d.height=l;const h=c(this,Pn)?c(this,jt):j(this,st,Jp).call(this,o,l),f=d.getContext("2d");f.filter=this._uiManager.hcmFilter,f.drawImage(h,0,0,h.width,h.height,0,0,o,l)},em=function(t){if(t){if(c(this,Pn)){const i=this._uiManager.imageManager.getSvgUrl(c(this,ys));if(i)return i}const n=document.createElement("canvas");return{width:n.width,height:n.height}=c(this,jt),n.getContext("2d").drawImage(c(this,jt),0,0),n.toDataURL()}if(c(this,Pn)){const[n,r]=this.pageDimensions,i=Math.round(this.width*n*io.PDF_TO_CSS_UNITS),a=Math.round(this.height*r*io.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(i,a);return o.getContext("2d").drawImage(c(this,jt),0,0,c(this,jt).width,c(this,jt).height,0,0,i,a),o.transferToImageBitmap()}return structuredClone(c(this,jt))},OS=function(t){var o;const{pageIndex:n,accessibilityData:{altText:r}}=this._initialData,i=t.pageIndex===n,a=(((o=t.accessibilityData)==null?void 0:o.alt)||"")===r;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&i&&a,isSameAltText:a}},Pe(Lu,"_type","stamp"),Pe(Lu,"_editorType",Be.STAMP);let Pb=Lu;var El,Pd,ii,Ua,Gi,Qn,Ha,Md,Nl,Sr,Vi,Ls,Wi,Ne,Ga,Et,zS,Br,Lb,Db,tm;const ur=class ur{constructor({uiManager:e,pageIndex:t,div:n,structTreeLayer:r,accessibilityManager:i,annotationLayer:a,drawLayer:o,textLayer:l,viewport:d,l10n:h}){T(this,Et);T(this,El);T(this,Pd,!1);T(this,ii,null);T(this,Ua,null);T(this,Gi,null);T(this,Qn,new Map);T(this,Ha,!1);T(this,Md,!1);T(this,Nl,!1);T(this,Sr,null);T(this,Vi,null);T(this,Ls,null);T(this,Wi,null);T(this,Ne);const f=[...c(ur,Ga).values()];if(!ur._initialized){ur._initialized=!0;for(const p of f)p.initialize(h,e)}e.registerEditorTypes(f),S(this,Ne,e),this.pageIndex=t,this.div=n,S(this,El,i),S(this,ii,a),this.viewport=d,S(this,Ls,l),this.drawLayer=o,this._structTree=r,c(this,Ne).addLayer(this)}get isEmpty(){return c(this,Qn).size===0}get isInvisible(){return this.isEmpty&&c(this,Ne).getMode()===Be.NONE}updateToolbar(e){c(this,Ne).updateToolbar(e)}updateMode(e=c(this,Ne).getMode()){switch(j(this,Et,tm).call(this),e){case Be.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Be.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Be.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const n of c(ur,Ga).values())t.toggle(`${n._type}Editing`,e===n._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=c(this,Ls))==null?void 0:t.div)}setEditingState(e){c(this,Ne).setEditingState(e)}addCommands(e){c(this,Ne).addCommands(e)}cleanUndoStack(e){c(this,Ne).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=c(this,ii))==null||t.div.classList.toggle("disabled",!e)}async enable(){S(this,Nl,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const n of c(this,Qn).values())n.enableEditing(),n.show(!0),n.annotationElementId&&(c(this,Ne).removeChangedExistingAnnotation(n),e.add(n.annotationElementId));if(!c(this,ii)){S(this,Nl,!1);return}const t=c(this,ii).getEditableAnnotations();for(const n of t){if(n.hide(),c(this,Ne).isDeletedAnnotationElement(n.data.id)||e.has(n.data.id))continue;const r=await this.deserialize(n);r&&(this.addOrRebuild(r),r.enableEditing())}S(this,Nl,!1)}disable(){var r;S(this,Md,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const i of c(this,Qn).values())if(i.disableEditing(),!!i.annotationElementId){if(i.serialize()!==null){e.set(i.annotationElementId,i);continue}else t.set(i.annotationElementId,i);(r=this.getEditableAnnotation(i.annotationElementId))==null||r.show(),i.remove()}if(c(this,ii)){const i=c(this,ii).getEditableAnnotations();for(const a of i){const{id:o}=a.data;if(c(this,Ne).isDeletedAnnotationElement(o))continue;let l=t.get(o);if(l){l.resetAnnotationElement(a),l.show(!1),a.show();continue}l=e.get(o),l&&(c(this,Ne).addChangedExistingAnnotation(l),l.renderAnnotationElement(a)&&l.show(!1)),a.show()}}j(this,Et,tm).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const i of c(ur,Ga).values())n.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),S(this,Md,!1)}getEditableAnnotation(e){var t;return((t=c(this,ii))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){c(this,Ne).getActive()!==e&&c(this,Ne).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=c(this,Ls))!=null&&e.div&&!c(this,Wi)){S(this,Wi,new AbortController);const t=c(this,Ne).combinedSignal(c(this,Wi));c(this,Ls).div.addEventListener("pointerdown",j(this,Et,zS).bind(this),{signal:t}),c(this,Ls).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=c(this,Ls))!=null&&e.div&&c(this,Wi)&&(c(this,Wi).abort(),S(this,Wi,null),c(this,Ls).div.classList.remove("highlighting"))}enableClick(){if(c(this,Ua))return;S(this,Ua,new AbortController);const e=c(this,Ne).combinedSignal(c(this,Ua));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=c(this,Ua))==null||e.abort(),S(this,Ua,null)}attach(e){c(this,Qn).set(e.id,e);const{annotationElementId:t}=e;t&&c(this,Ne).isDeletedAnnotationElement(t)&&c(this,Ne).removeDeletedAnnotationElement(e)}detach(e){var t;c(this,Qn).delete(e.id),(t=c(this,El))==null||t.removePointerInTextLayer(e.contentDiv),!c(this,Md)&&e.annotationElementId&&c(this,Ne).addDeletedAnnotationElement(e)}remove(e){this.detach(e),c(this,Ne).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(c(this,Ne).addDeletedAnnotationElement(e.annotationElementId),Mt.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),c(this,Ne).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!c(this,Nl)),c(this,Ne).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var n;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!c(this,Gi)&&(e._focusEventsAllowed=!1,S(this,Gi,setTimeout(()=>{S(this,Gi,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:c(this,Ne)._signal}),t.focus())},0))),e._structTreeParentId=(n=c(this,El))==null?void 0:n.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getNextId(){return c(this,Ne).getId()}combinedSignal(e){return c(this,Ne).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=c(this,Et,Br))==null?void 0:e.canCreateNewEmptyEditor()}pasteEditor(e,t){c(this,Ne).updateToolbar(e),c(this,Ne).updateMode(e);const{offsetX:n,offsetY:r}=j(this,Et,Db).call(this),i=this.getNextId(),a=j(this,Et,Lb).call(this,{parent:this,id:i,x:n,y:r,uiManager:c(this,Ne),isCentered:!0,...t});a&&this.add(a)}async deserialize(e){var t;return await((t=c(ur,Ga).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,c(this,Ne)))||null}createAndAddNewEditor(e,t,n={}){const r=this.getNextId(),i=j(this,Et,Lb).call(this,{parent:this,id:r,x:e.offsetX,y:e.offsetY,uiManager:c(this,Ne),isCentered:t,...n});return i&&this.add(i),i}addNewEditor(){this.createAndAddNewEditor(j(this,Et,Db).call(this),!0)}setSelected(e){c(this,Ne).setSelected(e)}toggleSelected(e){c(this,Ne).toggleSelected(e)}unselect(e){c(this,Ne).unselect(e)}pointerup(e){var n;const{isMac:t}=Qs.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&c(this,Ha)&&(S(this,Ha,!1),!((n=c(this,Et,Br))!=null&&n.isDrawer&&c(this,Et,Br).supportMultipleDrawings))){if(!c(this,Pd)){S(this,Pd,!0);return}if(c(this,Ne).getMode()===Be.STAMP){c(this,Ne).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){var r;if(c(this,Ne).getMode()===Be.HIGHLIGHT&&this.enableTextSelection(),c(this,Ha)){S(this,Ha,!1);return}const{isMac:t}=Qs.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(S(this,Ha,!0),(r=c(this,Et,Br))!=null&&r.isDrawer){this.startDrawingSession(e);return}const n=c(this,Ne).getActive();S(this,Pd,!n||n.isEmpty())}startDrawingSession(e){if(this.div.focus(),c(this,Sr)){c(this,Et,Br).startDrawing(this,c(this,Ne),!1,e);return}c(this,Ne).setCurrentDrawingSession(this),S(this,Sr,new AbortController);const t=c(this,Ne).combinedSignal(c(this,Sr));this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(S(this,Vi,null),this.commitOrRemove())},{signal:t}),c(this,Et,Br).startDrawing(this,c(this,Ne),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&S(this,Vi,t);return}c(this,Vi)&&setTimeout(()=>{var t;(t=c(this,Vi))==null||t.focus(),S(this,Vi,null)},0)}endDrawingSession(e=!1){return c(this,Sr)?(c(this,Ne).setCurrentDrawingSession(null),c(this,Sr).abort(),S(this,Sr,null),S(this,Vi,null),c(this,Et,Br).endDrawing(e)):null}findNewParent(e,t,n){const r=c(this,Ne).findParent(t,n);return r===null||r===this?!1:(r.changeParent(e),!0)}commitOrRemove(){return c(this,Sr)?(this.endDrawingSession(),!0):!1}onScaleChanging(){c(this,Sr)&&c(this,Et,Br).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=c(this,Ne).getActive())==null?void 0:e.parent)===this&&(c(this,Ne).commitOrRemove(),c(this,Ne).setActiveEditor(null)),c(this,Gi)&&(clearTimeout(c(this,Gi)),S(this,Gi,null));for(const n of c(this,Qn).values())(t=c(this,El))==null||t.removePointerInTextLayer(n.contentDiv),n.setParent(null),n.isAttachedToDOM=!1,n.div.remove();this.div=null,c(this,Qn).clear(),c(this,Ne).removeLayer(this)}render({viewport:e}){this.viewport=e,Dl(this.div,e);for(const t of c(this,Ne).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){c(this,Ne).commitOrRemove(),j(this,Et,tm).call(this);const t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,Dl(this.div,{rotation:n}),t!==n)for(const r of c(this,Qn).values())r.rotate(n)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return c(this,Ne).viewParameters.realScale}};El=new WeakMap,Pd=new WeakMap,ii=new WeakMap,Ua=new WeakMap,Gi=new WeakMap,Qn=new WeakMap,Ha=new WeakMap,Md=new WeakMap,Nl=new WeakMap,Sr=new WeakMap,Vi=new WeakMap,Ls=new WeakMap,Wi=new WeakMap,Ne=new WeakMap,Ga=new WeakMap,Et=new WeakSet,zS=function(e){c(this,Ne).unselectAll();const{target:t}=e;if(t===c(this,Ls).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&c(this,Ls).div.contains(t)){const{isMac:n}=Qs.platform;if(e.button!==0||e.ctrlKey&&n)return;c(this,Ne).showAllEditors("highlight",!0,!0),c(this,Ls).div.classList.add("free"),this.toggleDrawing(),$m.startHighlighting(this,c(this,Ne).direction==="ltr",{target:c(this,Ls).div,x:e.x,y:e.y}),c(this,Ls).div.addEventListener("pointerup",()=>{c(this,Ls).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:c(this,Ne)._signal}),e.preventDefault()}},Br=function(){return c(ur,Ga).get(c(this,Ne).getMode())},Lb=function(e){const t=c(this,Et,Br);return t?new t.prototype.constructor(e):null},Db=function(){const{x:e,y:t,width:n,height:r}=this.div.getBoundingClientRect(),i=Math.max(0,e),a=Math.max(0,t),o=Math.min(window.innerWidth,e+n),l=Math.min(window.innerHeight,t+r),d=(i+o)/2-e,h=(a+l)/2-t,[f,p]=this.viewport.rotation%180===0?[d,h]:[h,d];return{offsetX:f,offsetY:p}},tm=function(){for(const e of c(this,Qn).values())e.isEmpty()&&e.remove()},Pe(ur,"_initialized",!1),T(ur,Ga,new Map([mb,jb,Pb,$m].map(e=>[e._editorType,e])));let Ib=ur;var Ar,Cf,Xs,Cl,a0,$S,di,Ob,BS,zb;const Ps=class Ps{constructor({pageIndex:e}){T(this,di);T(this,Ar,null);T(this,Cf,0);T(this,Xs,new Map);T(this,Cl,new Map);this.pageIndex=e}setParent(e){if(!c(this,Ar)){S(this,Ar,e);return}if(c(this,Ar)!==e){if(c(this,Xs).size>0)for(const t of c(this,Xs).values())t.remove(),e.append(t);S(this,Ar,e)}}static get _svgFactory(){return qe(this,"_svgFactory",new Jy)}draw(e,t=!1,n=!1){const r=Us(this,Cf)._++,i=j(this,di,Ob).call(this),a=Ps._svgFactory.createElement("defs");i.append(a);const o=Ps._svgFactory.createElement("path");a.append(o);const l=`path_p${this.pageIndex}_${r}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),t&&c(this,Cl).set(r,o);const d=n?j(this,di,BS).call(this,a,l):null,h=Ps._svgFactory.createElement("use");return i.append(h),h.setAttribute("href",`#${l}`),this.updateProperties(i,e),c(this,Xs).set(r,i),{id:r,clipPathId:`url(#${d})`}}drawOutline(e,t){const n=Us(this,Cf)._++,r=j(this,di,Ob).call(this),i=Ps._svgFactory.createElement("defs");r.append(i);const a=Ps._svgFactory.createElement("path");i.append(a);const o=`path_p${this.pageIndex}_${n}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const f=Ps._svgFactory.createElement("mask");i.append(f),l=`mask_p${this.pageIndex}_${n}`,f.setAttribute("id",l),f.setAttribute("maskUnits","objectBoundingBox");const p=Ps._svgFactory.createElement("rect");f.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");const m=Ps._svgFactory.createElement("use");f.append(m),m.setAttribute("href",`#${o}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}const d=Ps._svgFactory.createElement("use");r.append(d),d.setAttribute("href",`#${o}`),l&&d.setAttribute("mask",`url(#${l})`);const h=d.cloneNode();return r.append(h),d.classList.add("mainOutline"),h.classList.add("secondaryOutline"),this.updateProperties(r,e),c(this,Xs).set(n,r),n}finalizeDraw(e,t){c(this,Cl).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;const{root:n,bbox:r,rootClass:i,path:a}=t,o=typeof e=="number"?c(this,Xs).get(e):e;if(o){if(n&&j(this,di,zb).call(this,o,n),r&&j(l=Ps,a0,$S).call(l,o,r),i){const{classList:d}=o;for(const[h,f]of Object.entries(i))d.toggle(h,f)}if(a){const h=o.firstChild.firstChild;j(this,di,zb).call(this,h,a)}}}updateParent(e,t){if(t===this)return;const n=c(this,Xs).get(e);n&&(c(t,Ar).append(n),c(this,Xs).delete(e),c(t,Xs).set(e,n))}remove(e){c(this,Cl).delete(e),c(this,Ar)!==null&&(c(this,Xs).get(e).remove(),c(this,Xs).delete(e))}destroy(){S(this,Ar,null);for(const e of c(this,Xs).values())e.remove();c(this,Xs).clear(),c(this,Cl).clear()}};Ar=new WeakMap,Cf=new WeakMap,Xs=new WeakMap,Cl=new WeakMap,a0=new WeakSet,$S=function(e,[t,n,r,i]){const{style:a}=e;a.top=`${100*n}%`,a.left=`${100*t}%`,a.width=`${100*r}%`,a.height=`${100*i}%`},di=new WeakSet,Ob=function(){const e=Ps._svgFactory.create(1,1,!0);return c(this,Ar).append(e),e.setAttribute("aria-hidden",!0),e},BS=function(e,t){const n=Ps._svgFactory.createElement("clipPath");e.append(n);const r=`clip_${t}`;n.setAttribute("id",r),n.setAttribute("clipPathUnits","objectBoundingBox");const i=Ps._svgFactory.createElement("use");return n.append(i),i.setAttribute("href",`#${t}`),i.classList.add("clip"),r},zb=function(e,t){for(const[n,r]of Object.entries(t))r===null?e.removeAttribute(n):e.setAttribute(n,r)},T(Ps,a0);let Fb=Ps;globalThis.pdfjsTestingUtils={HighlightOutliner:xb};Fe.AbortException;Fe.AnnotationEditorLayer;Fe.AnnotationEditorParamsType;Fe.AnnotationEditorType;Fe.AnnotationEditorUIManager;Fe.AnnotationLayer;Fe.AnnotationMode;Fe.ColorPicker;Fe.DOMSVGFactory;Fe.DrawLayer;Fe.FeatureTest;var Wj=Fe.GlobalWorkerOptions;Fe.ImageKind;Fe.InvalidPDFException;Fe.MissingPDFException;Fe.OPS;Fe.OutputScale;Fe.PDFDataRangeTransport;Fe.PDFDateString;Fe.PDFWorker;Fe.PasswordResponses;Fe.PermissionFlag;Fe.PixelsPerInch;Fe.RenderingCancelledException;Fe.TextLayer;Fe.TouchManager;Fe.UnexpectedResponseException;Fe.Util;Fe.VerbosityLevel;Fe.XfaLayer;Fe.build;Fe.createValidAbsoluteUrl;Fe.fetchData;var qj=Fe.getDocument;Fe.getFilenameFromUrl;Fe.getPdfFilenameFromUrl;Fe.getXfaPageViewport;Fe.isDataScheme;Fe.isPdfFile;Fe.noContextMenu;Fe.normalizeUnicode;Fe.setLayerDimensions;Fe.shadow;Fe.stopEvent;Fe.version;const Xj="/assets/pdf.worker.min-yatZIOMy.mjs",Kj=s=>typeof s=="object"&&s!==null&&"str"in s;let _g=!1;const Yj=()=>{if(!_g){if(typeof window>"u"){_g=!0;return}try{Wj.workerSrc=Xj,_g=!0}catch(s){console.warn("Не удалось настроить PDF worker",s)}}},Qj=async s=>{const e=await s.arrayBuffer();Yj();const t=await qj({data:e}).promise;try{const n=[];for(let r=1;r<=t.numPages;r+=1){const o=(await(await t.getPage(r)).getTextContent()).items.map(l=>Kj(l)&&typeof l.str=="string"?l.str:"").join(" ").replace(/\s+/g," ").trim();o&&n.push(o)}return n.join(`

`)}finally{t.destroy()}},Zj=["word/document.xml","word/document2.xml","word/document3.xml"],US=s=>{const e=[];return s.childNodes.forEach(t=>{if(t.nodeType===Node.TEXT_NODE&&t.textContent)e.push(t.textContent);else if(t.nodeType===Node.ELEMENT_NODE){const n=t;n.tagName==="w:tab"?e.push("	"):n.tagName==="w:br"?e.push(`
`):e.push(...US(n))}}),e},Jj=async s=>{const e=await WC.loadAsync(await s.arrayBuffer()),t=Zj.map(d=>e.file(d)).find(d=>d!==null&&typeof d<"u");if(!t)throw new Error("В документе DOCX не найден основной текст");const n=await t.async("string"),i=new DOMParser().parseFromString(n,"application/xml");if(i.getElementsByTagName("parsererror").length>0)throw new Error("DOCX содержит некорректный XML");const o=Array.from(i.getElementsByTagName("w:p")),l=[];return o.forEach(d=>{const f=US(d).join("").replace(/\r/g,"").replace(/\t/g," ").replace(/ {2,}/g," ").replace(/\n{3,}/g,`

`).trim();f&&l.push(f)}),l.join(`

`)},eP=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"],Q1=(s,e,t=!0)=>{try{return new TextDecoder(e,{fatal:t}).decode(s)}catch(n){return t||console.warn(`Не удалось декодировать текст как ${e}`,n),null}},tP=s=>s.length>=3&&s[0]===239&&s[1]===187&&s[2]===191?"utf-8":s.length>=2&&s[0]===255&&s[1]===254?"utf-16le":s.length>=2&&s[0]===254&&s[1]===255?"utf-16be":null,sP=async s=>{const e=await s.arrayBuffer(),t=new Uint8Array(e),n=tP(t);if(n){const i=n==="utf-8"?t.subarray(3):t.subarray(2),a=Q1(i,n,!1);if(a)return a.replace(/\r\n?/g,`
`)}const r=["utf-8","windows-1251","koi8-r","utf-16le","utf-16be"];for(const i of r){const a=Q1(t,i,i!=="utf-8");if(a)return a.replace(/\r\n?/g,`
`)}return new TextDecoder().decode(t).replace(/\r\n?/g,`
`)},nP=async s=>{var t;const e=(t=s.name.split(".").pop())==null?void 0:t.toLowerCase();if(s.type==="application/pdf"||e==="pdf")return Qj(s);if(eP.includes(s.type)||e==="docx")return Jj(s);if(e==="doc")throw new Error("Формат DOC не поддерживается. Сохраните файл в DOCX и попробуйте снова.");if(s.type.startsWith("text/")||!s.type)return sP(s);throw new Error(`Неподдерживаемый формат файла: ${s.type||e||s.name}`)},$b="llm-studio-file-processing-state",lp={files:[],qaPairs:[],logs:[],isProcessing:!1,processingProgress:0,generationSource:"remote",validationMode:"auto",defaultPairsPerParagraph:2},rP=()=>{if(typeof window>"u")return lp;try{const s=window.localStorage.getItem($b);if(!s)return lp;const e=JSON.parse(s);return{...lp,...e}}catch(s){return console.warn("Не удалось загрузить состояние обработки файлов",s),lp}},HS=z.createContext(void 0);function iP({children:s}){const e=rP(),[t,n]=z.useState(e.files),[r,i]=z.useState(e.qaPairs),[a,o]=z.useState(e.logs),[l,d]=z.useState(e.isProcessing),[h,f]=z.useState(e.processingProgress),[p,m]=z.useState(e.generationSource),[b,x]=z.useState(e.validationMode),[v,g]=z.useState(e.defaultPairsPerParagraph),y=z.useRef(e.isProcessing);z.useEffect(()=>{if(typeof window>"u")return;const C={files:t,qaPairs:r,logs:a,isProcessing:l,processingProgress:h,generationSource:p,validationMode:b,defaultPairsPerParagraph:v};try{window.localStorage.setItem($b,JSON.stringify(C))}catch(P){console.warn("Не удалось сохранить состояние обработки файлов",P)}},[t,r,a,l,h,p,b,v]),z.useEffect(()=>{y.current&&(y.current=!1,d(!1),f(0))},[]);const w=()=>{n([]),i([]),o([]),d(!1),f(0),m("remote"),x("auto"),g(2),typeof window<"u"&&window.localStorage.removeItem($b)},k=z.useMemo(()=>({files:t,qaPairs:r,logs:a,isProcessing:l,processingProgress:h,generationSource:p,validationMode:b,defaultPairsPerParagraph:v,setFiles:n,setQaPairs:i,setLogs:o,setIsProcessing:d,setProcessingProgress:f,setGenerationSource:m,setValidationMode:x,setDefaultPairsPerParagraph:g,resetState:w}),[t,r,a,l,h,p,b,v]);return u.jsx(HS.Provider,{value:k,children:s})}function aP(){const s=z.useContext(HS);if(!s)throw new Error("useFileProcessing must be used within a FileProcessingProvider");return s}const oP=/[^-a-zA-Zа-яА-ЯёЁ0-9\s.,;:!?'"()]/g,lP=/(.)\1{3,}/,Z1=["согласно тексту","согласно статье","согласно абзацу","в тексте","в абзаце","в статье","по тексту","по статье","в документе","в данном тексте","в данном абзаце","приведённом тексте","представленном тексте"],sm=s=>`${s}-${Date.now()}-${Math.random().toString(16).slice(2,8)}`,Bb=s=>s.trim().split(/\s+/).filter(Boolean).length,cP=s=>s>=180?4:s>=120?3:s>=60?2:s>=30?1:0,dP=s=>{const e=s.replace(/\r\n/g,`
`).trim();if(!e)return[];const t=e.split(/\n{2,}/).map(n=>n.trim()).filter(n=>n.length>0);return t.length===0?[]:t.map((n,r)=>{const i=Bb(n);return{id:sm("paragraph"),index:r,text:n,desiredPairs:cP(i),tokenCount:i}})},xc=s=>s.replace(/^\s*[-*\d.()]+\s*/g,"").replace(/^ответ[:\-\s]+/i,"").replace(/^вопрос[:\-\s]+/i,"").replace(/^(согласно|по|в|во)\s+(данному\s+)?(тексту|абзацу|документу|статье)[^,.:!?]*[,.:!?\s]*/i,"").trim(),J1=s=>{if(!s)throw new Error("Модель не вернула данных");const e=s.match(/```json([\s\S]*?)```/i),t=e?e[1]:s,n=t.indexOf("{"),r=t.lastIndexOf("}");if(n===-1||r===-1||r<=n)throw new Error("Не удалось найти JSON в ответе модели");const i=t.slice(n,r+1);try{return JSON.parse(i)}catch(a){throw console.warn("Не удалось распарсить JSON модели. Исходный ответ:",s,a),new Error("Ответ модели содержит некорректный JSON")}},Ub=s=>{if(!s||typeof s!="object")return[];if(Array.isArray(s))return s.map(t=>{if(!t||typeof t!="object")return null;const n="question"in t&&typeof t.question=="string"?t.question:null,r="answer"in t&&typeof t.answer=="string"?t.answer:null;return!n||!r?null:{question:xc(n),answer:xc(r)}}).filter(t=>!!t);const e=s;return Array.isArray(e.pairs)?Ub(e.pairs):e.question&&e.answer&&typeof e.question=="string"&&typeof e.answer=="string"?[{question:xc(String(e.question)),answer:xc(String(e.answer))}]:[]},uP=(s,e,t)=>{const n=[];let r=1;const i=Bb(s),a=Bb(e);i<5&&(n.push("Вопрос слишком короткий"),r-=.25),s.includes("?")||(n.push("Вопрос не содержит вопросительного знака"),r-=.1),a<8&&(n.push("Ответ слишком короткий"),r-=.25);const o=s.toLowerCase(),l=e.toLowerCase();Z1.some(m=>o.includes(m))&&(n.push("Вопрос ссылается на текст вместо самостоятельной формулировки"),r-=.3),Z1.some(m=>l.includes(m))&&(n.push("Ответ содержит ссылку на текст"),r-=.2);const d=`${s} ${e}`,h=d.match(oP);h&&h.length/d.length>.08&&(n.push("Слишком много специальных символов"),r-=.2),lP.test(d)&&(n.push("Повторяющиеся символы в вопросе или ответе"),r-=.15);const f=t.toLowerCase(),p=e.toLowerCase().match(/[a-zа-яё0-9]{4,}/g);if(p&&p.length>0){const m=Array.from(new Set(p));m.filter(v=>f.includes(v)).length/m.length<.4&&(n.push("Ответ плохо опирается на исходный текст"),r-=.25)}return i>0&&a>0&&new Set(s.toLowerCase().split(/\s+/).filter(Boolean).filter(b=>e.toLowerCase().includes(b))).size/Math.max(i,1)>.7&&(n.push("Вопрос повторяет ответ без переформулировки"),r-=.15),r=Math.max(0,Math.min(1,Number(r.toFixed(2)))),{score:r,issues:n}},hP=()=>{const{files:s,setFiles:e,qaPairs:t,setQaPairs:n,isProcessing:r,setIsProcessing:i,processingProgress:a,setProcessingProgress:o,generationSource:l,setGenerationSource:d,validationMode:h,setValidationMode:f,defaultPairsPerParagraph:p,setDefaultPairsPerParagraph:m,logs:b,setLogs:x}=aP(),{dataset:v,addDatasetItems:g}=Gy(),[y,w]=z.useState(!1),[k,C]=z.useState("all"),[P,N]=z.useState(null),[I,M]=z.useState(!1),L=z.useRef(null),$=z.useRef(null),E=z.useRef(!1),{addProcessingJob:D}=Ul(),{setActivity:_,updateActivity:K,clearActivity:J}=If(),{settings:W}=aa(),Q=z.useCallback((G,ue,Z)=>{const re={id:sm("log"),timestamp:Date.now(),level:G,message:ue,context:Z};x(xe=>[...xe,re].slice(-300))},[x]),H=G=>Math.max(0,Math.min(5,Math.floor(G))),oe=(G,ue,Z)=>{e(re=>re.map(xe=>xe.id!==G?xe:{...xe,paragraphs:xe.paragraphs.map(be=>be.id===ue?{...be,desiredPairs:H(Z)}:be)}))},X=(G,ue)=>{e(Z=>Z.map(re=>{if(re.id!==G)return re;const xe=H(ue);return{...re,paragraphs:re.paragraphs.map(be=>({...be,desiredPairs:xe}))}}))},U=()=>{const G=H(p);e(ue=>ue.map(Z=>({...Z,paragraphs:Z.paragraphs.map(re=>({...re,desiredPairs:G}))}))),Q("info",`Применено ${G} QA на абзац для всех файлов`,"Глобальные настройки")},Y=()=>x([]),V=z.useMemo(()=>s.reduce((G,ue)=>G+ue.paragraphs.reduce((Z,re)=>Z+(re.desiredPairs??0),0),0),[s]),ee={totalFiles:s.length,processedFiles:s.filter(G=>G.processed).length,generatedPairs:t.length,approvedPairs:t.filter(G=>G.approved).length,rejectedPairs:t.filter(G=>G.rejected).length,avgQuality:t.length>0?t.reduce((G,ue)=>G+ue.quality,0)/t.length:0},fe=async G=>{const ue=Array.from(G.target.files||[]);if(ue.length===0)return;const Z=[];for(const re of ue)try{const xe=await nP(re),be=dP(xe);Z.push({id:sm("file"),name:re.name,type:re.type,size:re.size,content:xe,processed:!1,timestamp:Date.now(),paragraphs:be}),Q("info",`Файл "${re.name}" загружен (${be.length} абзацев обнаружено)`,re.name)}catch(xe){const be=xe instanceof Error?xe.message:"неизвестная ошибка";Q("error",`Не удалось прочитать файл "${re.name}": ${be}`,re.name)}Z.length>0&&e(re=>[...re,...Z]),L.current&&(L.current.value="")},se=async(G,ue,Z)=>{var $s,Ft,us;const re=`Тебе дан абзац текста на русском языке. Сформируй ${ue} пар "вопрос-ответ" для обучения модели. Делай вопросы полезными для дообучения LLM, а не ради формальности:
- Выявляй конкретные факты, связи, выводы, аргументы, перечисления, условия, последствия, сравнения и численные данные из абзаца.
- Формулируй вопросы как самостоятельные — не используй выражения вроде "согласно тексту", "в абзаце", "по статье" и т.п.
- Избегай общих или определяющих вопросов вроде "Что такое...", "О чём этот текст?" если абзац не даёт точного ответа.
- Не задавай вопросы, на которые нельзя ответить строго по абзацу, но делай так, чтобы ответ выглядел универсальным знанием, пригодным вне контекста абзаца.
Ответы формулируй кратко, но содержательно и опираясь только на текст. Не выдумывай факты, не ссылайся на внешний контекст. Возвращай только JSON.`,xe=[{role:"system",content:"Ты — помощник по подготовке данных для обучения. Отвечай на русском языке, формируй содержательные вопросы и ответы и соблюдай формат JSON без дополнительных комментариев."},{role:"user",content:`${re}

Абзац:
"""
${G.text}
"""

Формат ответа:
{
  "pairs": [
    { "question": "...", "answer": "..." }
  ]
}

Количество элементов в массиве должно быть ровно ${ue}. Не добавляй других полей.`}];if(l==="remote"){if(!(($s=W.remoteApiUrl)!=null&&$s.trim()))throw new Error("Не указан URL удалённого API");const Oe=await S0(xe,{apiUrl:W.remoteApiUrl,apiKey:W.remoteApiKey,model:W.remoteModelId,maxTokens:Math.min(W.maxTokens,1024),temperature:W.temperature,topP:W.topP,signal:Z}),nt=J1(Oe.content);return Ub(nt)}if(!((Ft=W.baseModelServerUrl)!=null&&Ft.trim())||!((us=W.baseModelPath)!=null&&us.trim()))throw new Error("Не заданы параметры базовой модели");const be=await Pm(xe,{serverUrl:W.baseModelServerUrl,modelPath:W.baseModelPath,maxTokens:Math.min(W.maxTokens,1024),temperature:W.temperature,topP:W.topP,quantization:W.quantization,device:W.deviceType,signal:Z}),Ze=J1(be.content);return Ub(Ze)},ve=async(G,ue)=>{const{resetLogs:Z=!0}=ue??{},re=s.find(mt=>mt.id===G);if(!re)return"error";if(!re.paragraphs||re.paragraphs.length===0)return Q("error",`В файле "${re.name}" не найдено абзацев`,re.name),K("dataset",{status:"error",message:"Не удалось выделить абзацы",progress:0}),"error";const xe=re.paragraphs.filter(mt=>mt.desiredPairs>0);if(xe.length===0)return Q("warn",`Для файла "${re.name}" не задано ни одного абзаца с генерацией QA`,re.name),K("dataset",{status:"error",message:"Нет параграфов для генерации",progress:0}),"error";const be=new AbortController;$.current=be,E.current=!1,M(!1);const Ze=xe.reduce((mt,Ye)=>mt+Ye.desiredPairs,0);let $s=0,Ft=0,us=0,Oe="success",nt=!1,lr=!1,hs=0;const Bs=[],ho=mt=>{mt.length!==0&&(Bs.push(...mt),n(Ye=>{const _t=lr?Ye:Ye.filter(Ct=>Ct.fileId!==re.id);return lr=!0,[..._t,...mt]}))};i(!0),o(0),_("dataset",{message:"Формирует датасет",progress:0}),Z&&x([]),Q("info",`Запуск генерации QA для файла "${re.name}" (${xe.length} абзацев, план: ${Ze} QA, источник: ${l==="remote"?"удалённая модель":"базовая модель"})`,re.name);let cr={status:"error",timeout:4e3};try{const mt=async(Ye,_t)=>{if(E.current){nt=!0;return}Q("info",`Абзац ${_t+1}/${xe.length}: планируется ${Ye.desiredPairs} QA (~${Ye.tokenCount} слов)`,re.name);try{const Ct=await se(Ye,Ye.desiredPairs,be.signal);if(E.current){nt=!0;return}if(Ct.length===0){Q("warn",`Модель не сформировала пары для абзаца ${_t+1}`,re.name);return}const Dr=Math.min(Ye.desiredPairs,Ct.length),Ss=$s;Dr<Ye.desiredPairs&&Q("warn",`Получено только ${Dr} из ${Ye.desiredPairs} пар для абзаца ${_t+1}`,re.name);const Wl=[];Ct.slice(0,Dr).forEach((oa,fo)=>{const B=Ss+fo+1,ie=xc(oa.question),me=xc(oa.answer),{score:we,issues:Ve}=uP(ie,me,Ye.text),dt=h==="auto"&&Ve.length===0,F=h==="auto"&&Ve.length>0;dt?(Ft+=1,Q("info",`QA пара ${B} автоматически одобрена`,re.name)):F?(us+=1,Q("warn",`QA пара ${B} отклонена: ${Ve.join("; ")}`,re.name)):Q("info",`QA пара ${B} создана и ждёт проверки`,re.name),Wl.push({id:sm("qa"),fileId:re.id,paragraphId:Ye.id,question:ie,answer:me,source:`${re.name} • абзац ${Ye.index+1}`,quality:we,approved:dt,rejected:F,issues:Ve.length>0?Ve:void 0,generationSource:l})}),$s+=Dr,ho(Wl);const ui=xe.length>0?Math.min(100,(_t+1)/xe.length*100):100;hs=ui,o(ui),K("dataset",{progress:ui,message:`Абзац ${_t+1} из ${xe.length}`})}catch(Ct){if(E.current){nt=!0,Q("warn",`Генерация остановлена пользователем на абзаце ${_t+1}`,re.name);return}if((Ct instanceof ai||Ct instanceof Zn)&&Ct.message==="Запрос отменён пользователем"){nt=!0,Q("warn",`Генерация остановлена пользователем на абзаце ${_t+1}`,re.name);return}Oe="error";const Ss=Ct instanceof ai||Ct instanceof Zn||Ct instanceof Error?Ct.message:"Неизвестная ошибка генерации";Q("error",`Ошибка при обработке абзаца ${_t+1}: ${Ss}`,re.name)}};for(let Ye=0;Ye<xe.length;Ye+=1){if(E.current){nt=!0;break}if(await mt(xe[Ye],Ye),E.current){nt=!0;break}}if(nt){const Ye=Bs.length>0?`Генерация остановлена пользователем: получено ${Bs.length} QA из запланированных ${Ze}`:"Генерация остановлена пользователем до получения новых QA";return Q("warn",Ye,re.name),K("dataset",{status:"error",message:"Генерация остановлена пользователем",progress:hs}),Bs.length>0&&D({id:Date.now().toString(),timestamp:Date.now(),fileName:re.name,qaGenerated:Bs.length,status:"cancelled"}),cr={status:"cancelled",timeout:4e3},"cancelled"}return Bs.length===0?(Oe="error",K("dataset",{status:"error",message:"Не удалось сгенерировать QA пары",progress:0}),cr={status:"error",timeout:5e3},"error"):(e(Ye=>Ye.map(_t=>_t.id===G?{..._t,processed:!0}:_t)),D({id:Date.now().toString(),timestamp:Date.now(),fileName:re.name,qaGenerated:Bs.length,status:Oe==="success"?"completed":"failed"}),Oe==="success"?(Q("info",`Генерация завершена: создано ${Bs.length} QA пар из запланированных ${Ze} (автоодобрено: ${Ft}, отклонено: ${us})`,re.name),K("dataset",{status:"success",message:"Датасет сформирован",progress:100}),cr={status:"success",timeout:2500},"success"):(K("dataset",{status:"error",message:"Генерация завершилась с ошибками",progress:100}),cr={status:"error",timeout:5e3},"error"))}finally{$.current=null,E.current=!1,M(!1),i(!1),o(0),window.setTimeout(()=>J("dataset"),cr.timeout)}},ce=async()=>{if(r){Q("warn","Генерация уже выполняется, дождитесь завершения текущей задачи","Глобальные настройки");return}const G=s.filter(Z=>!Z.processed&&Z.paragraphs.some(re=>re.desiredPairs>0));if(G.length===0){Q("warn","Нет файлов, готовых к пакетной обработке","Глобальные настройки");return}Q("info",`Пакетная обработка запущена (${G.length} файлов)`,"Глобальные настройки");let ue=!1;for(let Z=0;Z<G.length;Z+=1)if(await ve(G[Z].id,{resetLogs:Z===0})==="cancelled"){ue=!0;break}if(ue){Q("warn","Пакетная обработка остановлена пользователем","Глобальные настройки");return}Q("info","Пакетная обработка завершена","Глобальные настройки")},Re=()=>{var G;!r||E.current||(E.current=!0,M(!0),Q("warn","Остановка генерации запрошена пользователем","Глобальные настройки"),K("dataset",{message:"Останавливаем обработку...",status:"running"}),(G=$.current)==null||G.abort())},Ge=G=>{n(ue=>ue.map(Z=>Z.id===G?{...Z,approved:!0,rejected:!1}:Z))},Ht=G=>{n(ue=>ue.map(Z=>Z.id===G?{...Z,approved:!1,rejected:!0}:Z))},pt=G=>{e(ue=>ue.filter(Z=>Z.id!==G)),n(ue=>ue.filter(Z=>Z.fileId!==G)),Q("info","Файл удалён вместе с QA парами",G)},A=()=>{const ue=t.filter(Ze=>Ze.approved).map(Ze=>({input:Ze.question,output:Ze.answer,source:Ze.source,quality:Ze.quality})),Z=JSON.stringify(ue,null,2),re=new Blob([Z],{type:"application/json"}),xe=URL.createObjectURL(re),be=document.createElement("a");be.href=xe,be.download=`qa-dataset-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(be),be.click(),document.body.removeChild(be),URL.revokeObjectURL(xe)},le=()=>{const G=t.filter(re=>re.approved);if(G.length===0){Q("warn","Нет одобренных QA пар для добавления в обучение","Глобальные настройки");return}const ue=new Set(v.map(re=>re.id)),Z=G.map(re=>({id:re.id,input:re.question.trim(),output:re.answer.trim(),source:re.source})).filter(re=>!ue.has(re.id));if(Z.length===0){Q("info","Все одобренные QA пары уже находятся в датасете обучения","Глобальные настройки"),r||(_("dataset",{message:"Одобренные пары уже в обучении",status:"warning"}),window.setTimeout(()=>J("dataset"),2500));return}g(Z),Q("info",`Добавлено ${Z.length} QA пар в датасет обучения (из ${G.length} одобренных)`,"Глобальные настройки"),r||(_("dataset",{message:`В обучение добавлено ${Z.length} QA пар`,status:"success"}),window.setTimeout(()=>J("dataset"),2500))},ne=t.filter(G=>{switch(k){case"approved":return G.approved;case"rejected":return G.rejected;case"pending":return!G.approved&&!G.rejected;default:return!0}}),{containerRef:O,handleScroll:R,visibleItems:q,hasMore:ae,loadMore:de}=B2(ne,{initialBatchSize:20,batchSize:20,resetKey:`${k}-${t.length}`}),te=G=>G>.8?"text-green-400 bg-green-900/30":G>.6?"text-amber-300 bg-amber-900/30":"text-rose-400 bg-rose-900/30";return u.jsxs("div",{className:"h-full flex",children:[u.jsx("div",{className:"flex-1 p-6 overflow-y-auto",children:u.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("h2",{className:"text-2xl font-bold",children:"Обработка файлов"}),u.jsxs("div",{className:"flex gap-3",children:[u.jsxs("button",{onClick:()=>w(!y),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",title:y?"Скрыть аналитику качества":"Показать аналитику качества",children:[u.jsx(BN,{className:"w-4 h-4"}),"Аналитика"]}),u.jsxs("button",{onClick:A,disabled:ee.approvedPairs===0,className:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Экспортировать одобренные QA пары",children:[u.jsx(Nm,{className:"w-4 h-4"}),"Экспорт"]}),u.jsxs("button",{onClick:le,disabled:ee.approvedPairs===0,className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Добавить одобренные пары в тренировочный датасет",children:[u.jsx(Cm,{className:"w-4 h-4"}),"В обучение"]})]})]}),u.jsx("div",{className:"bg-slate-900 rounded-lg border border-slate-800 p-6",children:u.jsxs("div",{className:"flex flex-wrap gap-6 items-end",children:[u.jsxs("div",{className:"flex flex-col gap-1",children:[u.jsx("label",{className:"text-sm font-medium text-slate-200",children:"Источник генерации"}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(T2,{className:"w-4 h-4 text-slate-400"}),u.jsxs("select",{value:l,onChange:G=>d(G.target.value),className:"border border-slate-700 bg-slate-950 text-slate-100 placeholder-slate-500 rounded-lg px-3 py-2 text-sm",children:[u.jsx("option",{value:"remote",children:"Удалённая модель (API)"}),u.jsx("option",{value:"base",children:"Базовая локальная модель"})]})]})]}),u.jsxs("div",{className:"flex flex-col gap-1",children:[u.jsx("label",{className:"text-sm font-medium text-slate-200",children:"Режим проверки"}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(N2,{className:"w-4 h-4 text-slate-400"}),u.jsxs("select",{value:h,onChange:G=>f(G.target.value),className:"border border-slate-700 bg-slate-950 text-slate-100 placeholder-slate-500 rounded-lg px-3 py-2 text-sm",children:[u.jsx("option",{value:"auto",children:"Автоматический (одобрять/отклонять)"}),u.jsx("option",{value:"manual",children:"Ручной (только флаги качества)"})]})]})]}),u.jsxs("div",{className:"flex flex-col gap-1",children:[u.jsx("label",{className:"text-sm font-medium text-slate-200",children:"QA на абзац (по умолчанию)"}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("input",{type:"number",min:0,max:5,value:p,onChange:G=>{const ue=Number(G.target.value);m(H(Number.isNaN(ue)?0:ue))},className:"w-20 border border-slate-700 bg-slate-950 text-slate-100 placeholder-slate-500 rounded-lg px-3 py-2 text-sm"}),u.jsx("button",{onClick:U,className:"px-3 py-2 text-sm bg-slate-900 text-slate-200 rounded-lg hover:bg-slate-800 transition-colors",title:"Применить выбранное значение ко всем загруженным файлам",children:"Применить ко всем"})]})]}),u.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-300 bg-slate-950/40 border border-slate-800 rounded-lg px-3 py-2",children:[u.jsx($y,{className:"w-4 h-4 text-blue-500"}),u.jsxs("div",{children:["Запланировано генераций: ",u.jsx("span",{className:"font-semibold text-slate-100",children:V})]})]})]})}),u.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[u.jsxs("div",{className:"bg-slate-900 p-4 rounded-lg border border-slate-800",children:[u.jsx("div",{className:"text-sm text-slate-300",children:"Файлов"}),u.jsx("div",{className:"text-2xl font-bold text-slate-50",children:ee.totalFiles})]}),u.jsxs("div",{className:"bg-slate-900 p-4 rounded-lg border border-slate-800",children:[u.jsx("div",{className:"text-sm text-slate-300",children:"Обработано"}),u.jsx("div",{className:"text-2xl font-bold text-blue-400",children:ee.processedFiles})]}),u.jsxs("div",{className:"bg-slate-900 p-4 rounded-lg border border-slate-800",children:[u.jsx("div",{className:"text-sm text-slate-300",children:"QA пар"}),u.jsx("div",{className:"text-2xl font-bold text-purple-400",children:ee.generatedPairs})]}),u.jsxs("div",{className:"bg-slate-900 p-4 rounded-lg border border-slate-800",children:[u.jsx("div",{className:"text-sm text-slate-300",children:"Одобрено"}),u.jsx("div",{className:"text-2xl font-bold text-emerald-400",children:ee.approvedPairs})]}),u.jsxs("div",{className:"bg-slate-900 p-4 rounded-lg border border-slate-800",children:[u.jsx("div",{className:"text-sm text-slate-300",children:"Отклонено"}),u.jsx("div",{className:"text-2xl font-bold text-rose-400",children:ee.rejectedPairs})]}),u.jsxs("div",{className:"bg-slate-900 p-4 rounded-lg border border-slate-800",children:[u.jsx("div",{className:"text-sm text-slate-300",children:"Качество"}),u.jsxs("div",{className:"text-2xl font-bold text-orange-400",children:[(ee.avgQuality*100).toFixed(0),"%"]})]})]}),u.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 p-6",children:[u.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-4",children:[u.jsx("h3",{className:"text-lg font-semibold",children:"Загрузка документов"}),u.jsx("button",{onClick:ce,disabled:r||s.length===0,className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${r||s.length===0?"bg-slate-800 text-slate-400 cursor-not-allowed":"bg-emerald-600 text-white hover:bg-emerald-500"}`,title:"Запустить генерацию QA для всех файлов",children:"Обработать все"})]}),u.jsxs("div",{className:"border-2 border-dashed border-slate-700 rounded-lg p-8 text-center hover:border-slate-500 transition-colors",children:[u.jsx(j2,{className:"w-12 h-12 text-slate-500 mx-auto mb-4"}),u.jsx("p",{className:"text-slate-300 mb-4",children:"Перетащите файлы сюда или нажмите для выбора"}),u.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Поддерживаются: PDF, DOCX, TXT и другие текстовые форматы"}),u.jsx("input",{ref:L,type:"file",multiple:!0,accept:".pdf,.docx,.doc,.txt,.md",onChange:fe,className:"hidden"}),u.jsx("button",{onClick:()=>{var G;return(G=L.current)==null?void 0:G.click()},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",title:"Выбрать документы для загрузки",children:"Выбрать файлы"})]})]}),s.length>0&&u.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 p-6",children:[u.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Загруженные файлы"}),u.jsx("div",{className:"space-y-3",children:s.map(G=>{const ue=G.paragraphs.reduce((re,xe)=>re+xe.desiredPairs,0),Z=P===G.id;return u.jsxs("div",{className:"bg-slate-950/40 border border-slate-800 rounded-lg p-4 space-y-3",children:[u.jsxs("div",{className:"flex flex-wrap justify-between gap-3 items-start",children:[u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx(zy,{className:"w-5 h-5 text-blue-400 mt-1"}),u.jsxs("div",{children:[u.jsx("div",{className:"font-medium text-slate-50",children:G.name}),u.jsxs("div",{className:"text-sm text-slate-400",children:[(G.size/1024).toFixed(1)," KB • ",new Date(G.timestamp).toLocaleString()]}),u.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Абзацев: ",G.paragraphs.length," • План: ",ue," QA"]})]})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("button",{onClick:()=>N(Z?null:G.id),className:"px-3 py-2 text-sm bg-slate-900 border border-slate-700 text-slate-200 rounded-lg hover:bg-slate-900 transition-colors",title:Z?"Скрыть настройки абзацев":"Открыть настройки абзацев",children:Z?"Скрыть абзацы":"Настроить абзацы"}),G.processed?u.jsxs("span",{className:"flex items-center gap-1 text-sm text-emerald-400",children:[u.jsx(ag,{className:"w-4 h-4"}),"Обработан"]}):u.jsxs("button",{onClick:()=>ve(G.id),disabled:r||ue===0,className:"flex items-center gap-2 px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Сгенерировать QA пары для файла",children:[u.jsx(Ju,{className:"w-4 h-4"}),"Обработать"]}),u.jsx("button",{onClick:()=>pt(G.id),className:"p-2 text-rose-400 hover:bg-rose-900/30 rounded-lg transition-colors",title:"Удалить файл",children:u.jsx(jm,{className:"w-4 h-4"})})]})]}),ue===0&&u.jsx("div",{className:"text-sm text-amber-300 bg-amber-900/30 border border-amber-700 rounded-lg px-3 py-2",children:"Для этого файла не запланировано генераций. Установите количество QA на абзац."}),Z&&u.jsxs("div",{className:"border-t border-slate-800 pt-3",children:[u.jsxs("div",{className:"flex justify-between items-center mb-3",children:[u.jsx("span",{className:"text-sm font-semibold text-slate-200",children:"Параметры абзацев"}),u.jsxs("button",{onClick:()=>X(G.id,p),className:"text-sm px-3 py-1 border border-slate-700 text-slate-200 rounded-lg hover:bg-slate-900 transition-colors",title:"Установить одинаковое количество QA для всех абзацев файла",children:["Установить ",p," всем"]})]}),u.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto pr-1",children:G.paragraphs.map(re=>{const xe=re.text.length>240?`${re.text.slice(0,240)}...`:re.text;return u.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-lg p-3",children:[u.jsxs("div",{className:"flex justify-between items-center mb-2 text-xs text-slate-400",children:[u.jsxs("span",{children:["Абзац ",re.index+1," • ",re.tokenCount," слов"]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"text-slate-400",children:"QA"}),u.jsx("input",{type:"number",min:0,max:5,value:re.desiredPairs,onChange:be=>{const Ze=Number(be.target.value);oe(G.id,re.id,Number.isNaN(Ze)?0:Ze)},className:"w-16 border border-slate-700 bg-slate-950 text-slate-100 placeholder-slate-500 rounded px-2 py-1"})]})]}),u.jsx("p",{className:"text-sm text-slate-200 whitespace-pre-wrap max-h-24 overflow-y-auto",children:xe})]},re.id)})})]})]},G.id)})}),r&&u.jsxs("div",{className:"mt-4",children:[u.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 text-sm mb-2",children:[u.jsx("span",{children:I?"Останавливаем генерацию...":"Генерация QA пар..."}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsxs("button",{onClick:Re,disabled:I,className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors ${I?"bg-slate-800 text-slate-400 cursor-not-allowed":"bg-rose-600 text-white hover:bg-rose-500"}`,title:"Остановить текущую обработку",children:[u.jsx(By,{className:"w-3.5 h-3.5"}),"Остановить"]}),u.jsxs("span",{children:[Math.round(a),"%"]})]})]}),u.jsx("div",{className:"w-full bg-slate-800 rounded-full h-2",children:u.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${a}%`}})})]})]}),t.length>0&&u.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 p-6",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h3",{className:"text-lg font-semibold",children:"Сгенерированные QA пары"}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(vx,{className:"w-4 h-4 text-slate-400"}),u.jsxs("select",{value:k,onChange:G=>C(G.target.value),className:"px-3 py-2 border border-slate-700 bg-slate-950 text-slate-100 placeholder-slate-500 rounded-lg focus:ring-2 focus:ring-blue-500",children:[u.jsxs("option",{value:"all",children:["Все (",t.length,")"]}),u.jsxs("option",{value:"pending",children:["Ожидают (",t.filter(G=>!G.approved&&!G.rejected).length,")"]}),u.jsxs("option",{value:"approved",children:["Одобрено (",ee.approvedPairs,")"]}),u.jsxs("option",{value:"rejected",children:["Отклонено (",ee.rejectedPairs,")"]})]})]})]}),u.jsxs("div",{ref:O,onScroll:R,className:"space-y-4 max-h-96 overflow-y-auto pr-1",children:[q.map(G=>u.jsxs("div",{className:"border border-slate-800 rounded-lg p-4",children:[u.jsxs("div",{className:"flex justify-between items-start mb-3",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${te(G.quality)}`,children:[(G.quality*100).toFixed(0),"%"]}),u.jsxs("span",{className:"text-xs text-slate-400",children:["из ",G.source]}),u.jsx("span",{className:"text-xs uppercase font-semibold tracking-wide text-slate-500",children:G.generationSource==="remote"?"REMOTE":"BASE"})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[!G.approved&&!G.rejected&&u.jsxs(u.Fragment,{children:[u.jsxs("button",{onClick:()=>Ge(G.id),className:"flex items-center gap-1 px-3 py-1 text-sm bg-emerald-600 text-white rounded-lg hover:bg-emerald-500 transition-colors",title:"Отметить пару как одобренную",children:[u.jsx(ag,{className:"w-3 h-3"}),"Одобрить"]}),u.jsxs("button",{onClick:()=>Ht(G.id),className:"flex items-center gap-1 px-3 py-1 text-sm bg-rose-600 text-white rounded-lg hover:bg-rose-500 transition-colors",title:"Отклонить пару",children:[u.jsx(wx,{className:"w-3 h-3"}),"Отклонить"]})]}),G.approved&&u.jsxs("span",{className:"flex items-center gap-1 text-sm text-emerald-400",children:[u.jsx(ag,{className:"w-4 h-4"}),"Одобрено"]}),G.rejected&&u.jsxs("span",{className:"flex items-center gap-1 text-sm text-rose-400",children:[u.jsx(wx,{className:"w-4 h-4"}),"Отклонено"]})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{children:[u.jsx("div",{className:"text-sm font-medium text-slate-200 mb-1",children:"Вопрос:"}),u.jsx("div",{className:"text-sm text-slate-50",children:G.question})]}),u.jsxs("div",{children:[u.jsx("div",{className:"text-sm font-medium text-slate-200 mb-1",children:"Ответ:"}),u.jsx("div",{className:"text-sm text-slate-50",children:G.answer})]}),G.issues&&G.issues.length>0&&u.jsxs("div",{children:[u.jsx("div",{className:"text-sm font-medium text-slate-200 mb-1",children:"Предупреждения:"}),u.jsx("div",{className:"flex flex-wrap gap-1",children:G.issues.map((ue,Z)=>u.jsx("span",{className:"px-2 py-1 bg-amber-900/30 text-xs text-amber-300 rounded",children:ue},Z))})]})]})]},G.id)),ae&&u.jsx("div",{className:"flex justify-center py-2",children:u.jsx("button",{type:"button",onClick:de,className:"rounded-lg border border-slate-700 px-4 py-1.5 text-sm text-slate-200 transition-colors hover:border-blue-500 hover:text-blue-300",children:"Показать ещё"})}),ne.length===0&&u.jsx("div",{className:"text-center py-8 text-slate-400",children:k==="all"?"QA пары не созданы":`Нет ${k==="approved"?"одобренных":k==="rejected"?"отклонённых":"ожидающих"} пар`})]})]}),u.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 p-6",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h3",{className:"text-lg font-semibold",children:"Журнал обработки"}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsxs("span",{className:"text-xs text-slate-400",children:["Всего записей: ",b.length]}),u.jsx("button",{onClick:Y,disabled:b.length===0,className:"px-3 py-1 text-sm border border-slate-700 bg-slate-950 text-slate-300 rounded-lg hover:bg-slate-900 disabled:opacity-50 disabled:cursor-not-allowed",title:"Очистить журнал событий",children:"Очистить"})]})]}),u.jsxs("div",{className:"max-h-64 overflow-y-auto space-y-2 pr-1 text-sm",children:[b.length===0&&u.jsx("div",{className:"text-slate-400 text-center py-6",children:"Журнал пуст"}),b.map(G=>u.jsxs("div",{className:`border rounded-lg px-3 py-2 ${G.level==="error"?"border-rose-800 bg-rose-950/40 text-rose-300":G.level==="warn"?"border-amber-700 bg-amber-950/40 text-amber-300":"border-slate-800 bg-slate-950/40 text-slate-200"}`,children:[u.jsxs("div",{className:"flex justify-between items-center text-xs mb-1",children:[u.jsx("span",{className:"font-semibold uppercase tracking-wide",children:G.level==="error"?"Ошибка":G.level==="warn"?"Предупреждение":"Инфо"}),u.jsx("span",{className:"text-slate-400",children:new Date(G.timestamp).toLocaleTimeString()})]}),u.jsx("div",{children:G.message}),G.context&&u.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Контекст: ",G.context]})]},G.id))]})]})]})}),y&&u.jsxs("div",{className:"w-80 bg-slate-900 border-l border-slate-800 p-4",children:[u.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Анализ качества"}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"bg-blue-950/30 p-4 rounded-lg border border-blue-900",children:[u.jsx("div",{className:"text-sm text-blue-300 font-medium",children:"Распределение качества"}),u.jsxs("div",{className:"mt-2 space-y-2",children:[u.jsxs("div",{className:"flex justify-between text-sm",children:[u.jsx("span",{children:"Высокое (80%+)"}),u.jsx("span",{className:"font-medium",children:t.filter(G=>G.quality>.8).length})]}),u.jsxs("div",{className:"flex justify-between text-sm",children:[u.jsx("span",{children:"Среднее (60-80%)"}),u.jsx("span",{className:"font-medium",children:t.filter(G=>G.quality>.6&&G.quality<=.8).length})]}),u.jsxs("div",{className:"flex justify-between text-sm",children:[u.jsx("span",{children:"Низкое (<60%)"}),u.jsx("span",{className:"font-medium",children:t.filter(G=>G.quality<=.6).length})]})]})]}),u.jsxs("div",{className:"bg-emerald-950/30 p-4 rounded-lg border border-emerald-900",children:[u.jsx("div",{className:"text-sm text-emerald-300 font-medium",children:"Готовность датасета"}),u.jsxs("div",{className:"text-2xl font-bold text-emerald-400",children:[t.length>0?Math.round(ee.approvedPairs/ee.generatedPairs*100):0,"%"]}),u.jsxs("div",{className:"text-xs text-emerald-300 mt-1",children:[ee.approvedPairs," из ",ee.generatedPairs," одобрено"]})]}),u.jsxs("div",{className:"bg-amber-950/30 p-4 rounded-lg border border-amber-900",children:[u.jsx("div",{className:"text-sm text-amber-300 font-medium",children:"Рекомендации"}),u.jsxs("div",{className:"text-xs text-amber-200 mt-1",children:[ee.approvedPairs<10&&"Добавьте больше одобренных пар для качественного обучения",ee.avgQuality<.7&&"Рассмотрите улучшение качества генерации",ee.rejectedPairs>ee.approvedPairs&&"Слишком много отклонённых пар - проверьте настройки"]})]})]})]})]})},cp=({icon:s,title:e,subtitle:t,actions:n=null,children:r})=>u.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm shadow-slate-900/10 dark:border-slate-800 dark:bg-slate-900/80 dark:shadow-slate-950/30",children:[u.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"mt-1 flex h-10 w-10 items-center justify-center rounded-xl bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-200",children:u.jsx(s,{className:"h-5 w-5"})}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:e}),t&&u.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:t})]})]}),n&&u.jsx("div",{className:"flex items-center gap-2",children:n})]}),u.jsx("div",{className:"mt-5 space-y-5 text-sm text-slate-700 dark:text-slate-200",children:r})]}),po=({tone:s="info",children:e})=>{const t=s==="warning"?"bg-amber-50 border-amber-300 text-amber-700 dark:bg-amber-500/10 dark:border-amber-400/40 dark:text-amber-100":"bg-sky-50 border-sky-300 text-sky-700 dark:bg-sky-500/10 dark:border-sky-400/40 dark:text-sky-100";return u.jsxs("p",{className:`flex items-start gap-2 rounded-lg border px-3 py-2 text-xs shadow-sm ${t}`,children:[u.jsx($y,{className:"mt-0.5 h-3.5 w-3.5 flex-none"}),u.jsx("span",{children:e})]})},fP=({systemStats:s})=>{const{settings:e,updateSettings:t,resetSettings:n}=aa(),[r,i]=z.useState([]),[a,o]=z.useState(null),[l,d]=z.useState(!1),[h,f]=z.useState(!1),[p,m]=z.useState(!!(e.remoteApiUrl||e.remoteApiKey||e.remoteModelId)),[b,x]=z.useState(!!e.fineTunedModelPath),v=e.baseModelPath.trim()==="",g=e.baseModelServerUrl.trim(),y=!!g&&!/^https?:\/\//i.test(g);z.useEffect(()=>{let E=!1;return(async()=>{if(!e.baseModelServerUrl){i([]);return}d(!0),o(null);try{const _=await zC(e.baseModelServerUrl);E||i(_)}catch(_){E||(i([]),o(_ instanceof Error?_.message:"Не удалось получить список дообученных моделей"))}finally{E||d(!1)}})(),()=>{E=!0}},[e.baseModelServerUrl]);const w=z.useMemo(()=>r.find(E=>E.path===e.fineTunedModelPath)??null,[r,e.fineTunedModelPath]);z.useEffect(()=>{if(!w)return;const E={};w.base_model_path&&w.base_model_path!==e.fineTunedBaseModelPath&&(E.fineTunedBaseModelPath=w.base_model_path);const D=w.method==="full"?"full":"lora";D!==e.fineTunedMethod&&(E.fineTunedMethod=D),Object.keys(E).length>0&&t(E)},[w,e.fineTunedBaseModelPath,e.fineTunedMethod,t]);const k=E=>{if(!E){t({fineTunedModelPath:"",fineTunedBaseModelPath:"",fineTunedMethod:""});return}const D=r.find(K=>K.path===E)??null,_=D?D.method==="full"?"full":"lora":e.fineTunedMethod||"lora";t({fineTunedModelPath:E,fineTunedBaseModelPath:(D==null?void 0:D.base_model_path)??(e.fineTunedBaseModelPath||e.baseModelPath),fineTunedMethod:_})},C=(s==null?void 0:s.gpuBackend)??"cpu",P=C==="cuda",N=z.useMemo(()=>[{value:"cpu",label:"CPU",disabled:!1},{value:"cuda",label:"CUDA (GPU)",disabled:C!=="cuda"},{value:"mps",label:"MPS (Apple Silicon)",disabled:C!=="mps"}],[C]),I=z.useMemo(()=>[{value:"none",label:"Без квантизации",disabled:!1},{value:"8bit",label:"8-bit",disabled:!P},{value:"4bit",label:"4-bit",disabled:!P}],[P]),M=[{value:"light",label:"Светлая",description:"Мягкий светлый интерфейс для дневной работы",icon:rC},{value:"dark",label:"Тёмная",description:"Контрастная тёмная палитра для вечерних сессий",icon:QN}];z.useEffect(()=>{!P&&e.quantization!=="none"&&t({quantization:"none"})},[P,e.quantization,t]),z.useEffect(()=>{x(!!e.fineTunedModelPath)},[e.fineTunedModelPath]),z.useEffect(()=>{(e.remoteApiUrl||e.remoteApiKey||e.remoteModelId)&&m(!0)},[e.remoteApiKey,e.remoteApiUrl,e.remoteModelId]),z.useEffect(()=>{!N.some(D=>D.value===e.deviceType&&!D.disabled)&&C&&t({deviceType:C})},[N,C,e.deviceType,t]);const L=()=>{alert("Настройки сохранены")},$=()=>{confirm("Вы уверены, что хотите сбросить все настройки?")&&n()};return u.jsx("div",{className:"h-full overflow-y-auto bg-slate-950/40 p-6",children:u.jsxs("div",{className:"mx-auto max-w-4xl space-y-8",children:[u.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"Настройки"}),u.jsx("p",{className:"text-sm text-slate-400",children:"Соберите рабочее окружение под вашу инфраструктуру"})]}),u.jsxs("div",{className:"flex gap-3",children:[u.jsxs("button",{onClick:$,className:"flex items-center gap-2 rounded-lg border border-slate-700 px-4 py-2 text-slate-200 transition-colors hover:border-slate-500 hover:bg-slate-900",type:"button",children:[u.jsx(eC,{className:"h-4 w-4"}),"Сбросить"]}),u.jsxs("button",{onClick:L,className:"flex items-center gap-2 rounded-lg bg-blue-500 px-4 py-2 text-white shadow-lg shadow-blue-900/40 transition-colors hover:bg-blue-600",type:"button",children:[u.jsx(tC,{className:"h-4 w-4"}),"Сохранить"]})]})]}),u.jsx(cp,{icon:UN,title:"Рабочие модели",subtitle:"Укажите базовую модель, сервер и подключение адаптеров",children:u.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Каталог базовой модели"}),u.jsx("input",{type:"text",value:e.baseModelPath,onChange:E=>t({baseModelPath:E.target.value}),placeholder:"models/gemma",className:"mt-2 w-full rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-slate-100 placeholder-slate-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50"}),v&&u.jsx("div",{className:"mt-2",children:u.jsx(po,{tone:"warning",children:"Укажите путь к директории модели. Без него локальный сервер не сможет загрузить веса."})})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Адрес локального сервера"}),u.jsx("input",{type:"text",value:e.baseModelServerUrl,onChange:E=>t({baseModelServerUrl:E.target.value}),placeholder:"http://127.0.0.1:8001",className:"mt-2 w-full rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-slate-100 placeholder-slate-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50"}),y&&u.jsx("div",{className:"mt-2",children:u.jsx(po,{tone:"warning",children:"URL должен начинаться с http:// или https://. Проверьте настройки прокси и порт."})})]})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Выберите дообученную модель"}),u.jsxs("select",{value:w?w.path:"",onChange:E=>k(E.target.value),className:"mt-2 w-full rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-slate-100 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[u.jsx("option",{value:"",children:"Без адаптера"}),r.map(E=>u.jsx("option",{value:E.path,children:E.name||E.path},E.path))]}),u.jsxs("div",{className:"mt-2 space-y-2",children:[l&&u.jsx(po,{children:"Загружаю список дообученных моделей…"}),a&&u.jsx(po,{tone:"warning",children:a})]}),u.jsx("button",{type:"button",onClick:()=>x(E=>!E),className:"mt-3 text-xs font-semibold text-blue-400 hover:text-blue-300",children:b?"Скрыть параметры адаптера":"Расширенные параметры адаптера"})]}),b&&u.jsxs("div",{className:"rounded-lg border border-slate-800 bg-slate-950/60 p-4",children:[u.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Путь адаптера"}),u.jsx("input",{type:"text",value:e.fineTunedModelPath,onChange:E=>k(E.target.value),placeholder:"/path/to/finetune",className:"mt-2 w-full rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-slate-100 placeholder-slate-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50"}),u.jsxs("div",{className:"mt-3 space-y-1 text-xs text-slate-400",children:[e.fineTunedBaseModelPath&&u.jsxs("p",{children:["Базовая модель: ",u.jsx("span",{className:"font-mono break-all text-slate-200",children:e.fineTunedBaseModelPath})]}),e.fineTunedMethod&&u.jsxs("p",{children:["Режим: ",e.fineTunedMethod==="full"?"полное дообучение":"LoRA адаптер"]})]})]})]})]})}),u.jsx(cp,{icon:$N,title:"Устройство и генерация",subtitle:"Настройте вычислительный бэкенд и параметры вывода",actions:u.jsx("button",{type:"button",onClick:()=>f(E=>!E),className:"text-xs font-semibold text-blue-400 hover:text-blue-300",children:h?"Скрыть расширенные параметры":"Показать расширенные параметры"}),children:u.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Устройство"}),u.jsx("select",{value:e.deviceType,onChange:E=>{const D=E.target.value;t({deviceType:D})},className:"mt-2 w-full rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-slate-100 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:N.map(E=>u.jsx("option",{value:E.value,disabled:E.disabled,children:E.label},E.value))}),C!==e.deviceType&&u.jsx("div",{className:"mt-2",children:u.jsxs(po,{tone:"warning",children:["Обнаружено устройство ",C.toUpperCase(),". Переключитесь, чтобы использовать его возможности."]})})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Квантизация"}),u.jsx("select",{value:P?e.quantization:"none",onChange:E=>{const D=E.target.value;t({quantization:D})},className:"mt-2 w-full rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-slate-100 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:I.map(E=>u.jsx("option",{value:E.value,disabled:E.disabled,children:E.label},E.value))}),!P&&u.jsx("div",{className:"mt-2",children:u.jsx(po,{children:"Квантизация 4/8-bit активируется автоматически, когда обнаружен CUDA-бэкенд."})})]})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Максимум токенов"}),u.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[u.jsx("input",{type:"range",min:"128",max:"4096",step:"128",value:e.maxTokens,onChange:E=>t({maxTokens:parseInt(E.target.value,10)}),className:"flex-1"}),u.jsx("span",{className:"w-14 text-right text-xs font-semibold text-slate-200",children:e.maxTokens})]})]}),h&&u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Temperature"}),u.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[u.jsx("input",{type:"range",min:"0",max:"2",step:"0.1",value:e.temperature,onChange:E=>t({temperature:parseFloat(E.target.value)}),className:"flex-1"}),u.jsx("span",{className:"w-12 text-right text-xs font-semibold text-slate-200",children:e.temperature.toFixed(1)})]}),u.jsx("p",{className:"mt-2 text-xs text-slate-400",children:"Для чувствительных сценариев держите значение 0–0.3, чтобы избежать шумных ответов."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Top P"}),u.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[u.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:e.topP,onChange:E=>t({topP:parseFloat(E.target.value)}),className:"flex-1"}),u.jsx("span",{className:"w-12 text-right text-xs font-semibold text-slate-200",children:e.topP.toFixed(2)})]})]})]})]})]})}),u.jsx(cp,{icon:qN,title:"Удалённый API",subtitle:"Подключите сторонний провайдер при необходимости",actions:u.jsx("button",{type:"button",onClick:()=>m(E=>!E),className:"text-xs font-semibold text-blue-400 hover:text-blue-300",children:p?"Скрыть":"Настроить"}),children:p?u.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[u.jsxs("div",{className:"lg:col-span-2",children:[u.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-slate-400",children:"URL API"}),u.jsx("input",{type:"text",value:e.remoteApiUrl,onChange:E=>t({remoteApiUrl:E.target.value}),placeholder:"http://127.0.0.1:1234/v1",className:"mt-2 w-full rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-slate-100 placeholder-slate-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Модель"}),u.jsx("input",{type:"text",value:e.remoteModelId,onChange:E=>t({remoteModelId:E.target.value}),placeholder:"google/gemma-3n-e4b",className:"mt-2 w-full rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-slate-100 placeholder-slate-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),u.jsxs("div",{className:"lg:col-span-3",children:[u.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-slate-400",children:"API ключ"}),u.jsx("input",{type:"password",value:e.remoteApiKey,onChange:E=>t({remoteApiKey:E.target.value}),placeholder:"sk-...",className:"mt-2 w-full rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-slate-100 placeholder-slate-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50"}),u.jsx("p",{className:"mt-2 text-xs text-slate-400",children:"Ключ хранится локально в браузере и используется только для запросов к вашему провайдеру."})]})]}):u.jsx(po,{children:"Добавьте URL и ключ, если хотите подключить внешнее API вместо локального сервера."})}),u.jsx(cp,{icon:ZN,title:"Интерфейс",subtitle:"Выберите тему и управление историей",children:u.jsxs("div",{className:"space-y-5",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Тема"}),u.jsx("div",{className:"mt-3 grid gap-3 sm:grid-cols-2",children:M.map(E=>{const D=E.icon,_=e.theme===E.value;return u.jsxs("button",{type:"button",onClick:()=>t({theme:E.value}),className:`flex items-start gap-3 rounded-xl border px-4 py-3 text-left transition-all ${_?"border-blue-500 bg-blue-500/10 shadow-md shadow-blue-900/40":"border-slate-700 hover:border-blue-400 hover:bg-slate-900/40"}`,"aria-pressed":_,children:[u.jsx("span",{className:`mt-1 flex h-10 w-10 items-center justify-center rounded-full ${_?"bg-blue-500 text-white":"bg-slate-800 text-slate-300"}`,children:u.jsx(D,{className:"h-5 w-5"})}),u.jsxs("span",{className:"flex-1",children:[u.jsx("span",{className:"block font-semibold text-slate-100",children:E.label}),u.jsx("span",{className:"text-sm text-slate-400",children:E.description})]})]},E.value)})})]}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("input",{type:"checkbox",id:"autoSave",checked:e.autoSave,onChange:E=>t({autoSave:E.target.checked}),className:"h-4 w-4 rounded border-slate-700 bg-slate-950 text-blue-500 focus:ring-blue-500"}),u.jsx("label",{htmlFor:"autoSave",className:"text-sm font-medium text-slate-200",children:"Автоматически сохранять изменения"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Максимум записей в истории"}),u.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[u.jsx("input",{type:"range",min:"50",max:"1000",step:"50",value:e.maxHistoryItems,onChange:E=>t({maxHistoryItems:parseInt(E.target.value,10)}),className:"flex-1"}),u.jsx("span",{className:"w-14 text-right text-xs font-semibold text-slate-200",children:e.maxHistoryItems})]})]})]})})]})})},pP=({systemStats:s,serverOnline:e,onOpenSystemInfo:t,onOpenHelp:n})=>{const[r,i]=z.useState(new Date),[a,o]=z.useState(e),[l,d]=z.useState(!1),{settings:h}=aa(),{currentActivity:f}=If();z.useEffect(()=>{const _=window.setInterval(()=>{i(new Date)},1e3);return()=>{window.clearInterval(_)}},[]),z.useEffect(()=>{o(e)},[e]);const p=_=>_===null||Number.isNaN(_)?"text-slate-500":_<60?"text-emerald-400":_<85?"text-amber-400":"text-rose-400",m=(f==null?void 0:f.status)==="error"?"text-rose-400":(f==null?void 0:f.status)==="success"?"text-emerald-400":(f==null?void 0:f.status)==="warning"?"text-amber-400":"text-sky-400",b=(f==null?void 0:f.status)==="error"?"bg-rose-400":(f==null?void 0:f.status)==="success"?"bg-emerald-400":(f==null?void 0:f.status)==="warning"?"bg-amber-400":"bg-sky-400",x=(f==null?void 0:f.message)??"Готов",v=typeof(f==null?void 0:f.progress)=="number"?`${Math.round(Math.max(0,Math.min(f.progress,100)))}%`:null,g=typeof(f==null?void 0:f.progress)=="number"?Math.max(0,Math.min(f.progress,100)):null,y=s.modelsDirGb!==null?`${s.modelsDirGb.toFixed(2)} GB`:"Нет данных",w=s.latencyMs,k=w!==null?`${Math.round(w)} мс`:"—",C=w===null?"idle":w<150?"good":w<350?"warn":"bad",P=C==="good"?"bg-emerald-400":C==="warn"?"bg-amber-400":C==="bad"?"bg-rose-400":"bg-slate-600",N=C==="good"?"text-emerald-600 dark:text-emerald-300":C==="warn"?"text-amber-600 dark:text-amber-300":C==="bad"?"text-rose-600 dark:text-rose-300":"text-slate-600 dark:text-slate-400",I="flex items-center gap-1 rounded-full border px-2 py-1 text-[11px] shadow-sm transition-colors text-slate-600 dark:text-slate-200",M="border-slate-200 bg-white/80 shadow-slate-900/5",L="dark:border-slate-700 dark:bg-slate-900/70 dark:shadow-none",$="flex h-7 w-7 items-center justify-center rounded-full border border-slate-200 bg-white/80 text-slate-500 transition-colors hover:border-blue-500 hover:text-blue-500 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-300 dark:hover:text-white",E=r.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),D=async()=>{if(!l){if(!a){alert("Сервер локальной модели недоступен. Запустите его, чтобы открыть каталог моделей.");return}if(!h.baseModelServerUrl){alert("Укажите URL сервера базовой модели на вкладке «Настройки».");return}d(!0);try{await fC(h.baseModelServerUrl)}catch(_){const K=_ instanceof Error?_.message:"Не удалось открыть каталог моделей";alert(K)}finally{d(!1)}}};return u.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[u.jsxs("div",{className:`flex items-center gap-2 rounded-xl border px-3 py-1 shadow-sm ${M} ${L} min-w-[280px]`,children:[u.jsx(Ru,{className:`h-3 w-3 ${m}`}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:x}),v&&u.jsx("span",{className:"text-slate-500 dark:text-slate-500",children:v})]}),g!==null&&u.jsx("div",{className:"ml-2 h-1.5 w-80 overflow-hidden rounded-full bg-slate-200 dark:bg-slate-800",children:u.jsx("div",{className:`h-full ${b} transition-[width] duration-300 ease-out`,style:{width:`${g}%`}})})]}),u.jsxs("div",{className:`${I} ${M} ${L}`,children:[a?u.jsx(cC,{className:"h-3 w-3 text-emerald-400"}):u.jsx(lC,{className:"h-3 w-3 text-rose-400"}),u.jsx("span",{children:a?"Сервер онлайн":"Сервер офлайн"})]}),u.jsxs("div",{className:`${I} ${M} ${L}`,children:[u.jsx("span",{className:`flex h-2.5 w-2.5 items-center justify-center rounded-full ${P}`}),u.jsx(iC,{className:`h-3 w-3 ${N}`}),u.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Задержка"}),u.jsx("span",{className:`min-w-[3.5rem] tabular-nums font-mono text-right ${N}`,children:k})]}),u.jsxs("button",{type:"button",onClick:D,className:`${I} ${M} ${L} ${l?"cursor-wait opacity-70":a?"cursor-pointer hover:border-blue-500 hover:text-blue-500":"cursor-pointer opacity-75"}`,title:a?"Открыть каталог моделей":"Сервер недоступен — запустите его, чтобы открыть каталог моделей","aria-label":"Папка моделей",children:[u.jsx(GN,{className:`h-3 w-3 ${p(s.ramPercent)}`}),u.jsxs("span",{children:["Папка моделей: ",y]})]}),s.cpuProcessPercent!==null&&u.jsxs("div",{className:`${I} ${M} ${L}`,children:[u.jsx(Ru,{className:"h-3 w-3 text-slate-500"}),u.jsxs("span",{children:["Процессор: ",Math.round(s.cpuProcessPercent),"%"]})]}),u.jsxs("div",{className:`${I} ${M} ${L}`,children:[u.jsx(zN,{className:"h-3 w-3 text-slate-500"}),u.jsx("span",{className:"min-w-[4.5rem] tabular-nums font-mono text-right text-slate-600 dark:text-slate-200",children:E})]}),t&&u.jsx("button",{type:"button",onClick:t,className:$,title:"Информация о системе","aria-label":"Информация о системе",children:u.jsx($y,{className:"h-3.5 w-3.5"})}),n&&u.jsx("button",{type:"button",onClick:n,className:$,title:"Справка","aria-label":"Справка",children:u.jsx(VN,{className:"h-3.5 w-3.5"})})]})},ew=s=>s?s==="completed"?3:s==="running"?2:1:0,mP=({data:s})=>{if(s.length===0)return u.jsx("div",{className:"flex h-10 items-center justify-center text-[11px] text-slate-500",children:"Нет данных"});const e=Math.max(...s,1);return u.jsx("div",{className:"flex h-10 items-end gap-[2px]","aria-hidden":"true",children:s.map((t,n)=>{const r=t/e*100,i=Math.max(6,r),a=t>=3?"bg-emerald-400/80":t>=2?"bg-amber-400/80":"bg-rose-500/80";return u.jsx("span",{className:`block flex-1 rounded-sm ${a}`,style:{height:`${i}%`}},`${t}-${n}`)})})},Sg=({label:s,data:e,summary:t})=>{const n=t.completed+t.failed+t.running;return u.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white/80 px-4 py-3 shadow-sm shadow-slate-900/5 dark:border-slate-800 dark:bg-slate-900/70 dark:shadow-none",children:[u.jsxs("div",{className:"flex items-center justify-between text-[11px] text-slate-500 dark:text-slate-400",children:[u.jsx("span",{children:s}),u.jsxs("span",{children:[n," записей"]})]}),u.jsx("div",{className:"mt-3",children:u.jsx(mP,{data:e})}),u.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2 text-center text-[11px] text-slate-500 dark:text-slate-400",children:[u.jsxs("div",{className:"flex flex-col items-center gap-1",children:[u.jsx("span",{className:"text-[10px] uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"Успех"}),u.jsx("span",{className:"text-xs font-semibold text-emerald-500 dark:text-emerald-300",children:t.completed})]}),u.jsxs("div",{className:"flex flex-col items-center gap-1",children:[u.jsx("span",{className:"text-[10px] uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"В работе"}),u.jsx("span",{className:"text-xs font-semibold text-amber-500 dark:text-amber-300",children:t.running})]}),u.jsxs("div",{className:"flex flex-col items-center gap-1",children:[u.jsx("span",{className:"text-[10px] uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"Сбой/Отмена"}),u.jsx("span",{className:"text-xs font-semibold text-rose-500 dark:text-rose-300",children:t.failed})]})]})]})},gP=s=>new Date(s).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}),GS=(s,e=160)=>s.length<=e?s:`${s.slice(0,e).trim()}...`,xP=s=>s==="completed"?"completed":s==="failed"?"failed":"running",bP=(s,e)=>s==="waiting_review"?"Требуется ручная проверка результатов":s==="failed"?e&&e.trim().length>0?GS(`Ошибка тестирования: ${e.trim()}`,200):"Тестирование завершилось с ошибкой":"Результаты тестирования модели",yP=(s,e)=>e===0?"0/0":`${s}/${e}`,vP=({onClose:s,lastViewedAt:e})=>{const{chatHistory:t,trainingHistory:n,processingHistory:r,evaluationHistory:i,exportHistory:a,clearHistory:o}=Ul(),[l,d]=z.useState("all"),[h,f]=z.useState(""),p=h.trim().toLowerCase(),m=z.useMemo(()=>{const N=t.map($=>{const E=$.role==="assistant"?"Ответ ассистента":"Сообщение пользователя",D=$.model?`Модель: ${$.model}`:void 0;return{id:$.id,type:"chat",timestamp:$.timestamp,title:E,subtitle:D,description:GS($.content,220),status:void 0,metrics:void 0,searchText:[E,$.content,$.model??"",$.role].join(" ").toLowerCase()}}),I=n.map($=>({id:$.id,type:"training",timestamp:$.timestamp,title:$.modelName,subtitle:`Датасет: ${$.datasetSize} примеров`,description:"История обучения модели",status:$.status,metrics:$.metrics,searchText:[$.modelName,$.status,$.datasetSize,Object.entries($.metrics??{}).map(([E,D])=>`${E} ${D}`).join(" ")].join(" ").toLowerCase()})),M=r.map($=>({id:$.id,type:"processing",timestamp:$.timestamp,title:$.fileName,subtitle:`QA-пары: ${$.qaGenerated}`,description:"Обработка датасета",status:$.status,metrics:void 0,searchText:[$.fileName,$.status,$.qaGenerated].join(" ").toLowerCase()})),L=i.map($=>{const E=$.overallScore!=null?$.overallScore.toFixed(3):"—",D=$.coverage!=null?`${Math.round($.coverage*100)}%`:"—",_=yP($.scored,$.total),K=xP($.status),J=bP($.status,$.error);return{id:$.id,type:"evaluation",timestamp:$.timestamp,title:$.datasetName,subtitle:`Модель: ${$.modelVariant}`,description:J,status:K,metrics:{Score:E,Coverage:D,Оценено:_},searchText:[$.datasetName,$.modelVariant,$.overallScore??"",$.coverage??"",$.status,$.error??""].join(" ").toLowerCase()}});return[...N,...I,...M,...L].sort(($,E)=>E.timestamp-$.timestamp)},[t,n,r,i]),b=z.useMemo(()=>m.filter(N=>l!=="all"&&N.type!==l?!1:p?N.searchText.includes(p):!0),[m,l,p]),x=z.useMemo(()=>n.slice(-24).map(N=>ew(N.status)),[n]),v=z.useMemo(()=>r.slice(-24).map(N=>ew(N.status)),[r]),g=z.useMemo(()=>i.slice(-24).map(N=>N.status==="failed"?1:N.status==="completed"?N.overallScore===null||N.overallScore===void 0?2:N.overallScore>=.75?3:N.overallScore>=.5?2:1:2),[i]),y=z.useMemo(()=>{let N=0,I=0,M=0;return n.forEach(L=>{L.status==="completed"?N+=1:L.status==="failed"?I+=1:M+=1}),{completed:N,failed:I,running:M}},[n]),w=z.useMemo(()=>{let N=0,I=0,M=0;return r.forEach(L=>{L.status==="completed"?N+=1:L.status==="failed"||L.status==="cancelled"?I+=1:M+=1}),{completed:N,failed:I,running:M}},[r]),k=z.useMemo(()=>{let N=0,I=0,M=0;return i.forEach(L=>{L.status==="completed"?N+=1:L.status==="failed"?I+=1:M+=1}),{completed:N,failed:I,running:M}},[i]),C=[{id:"all",label:"Все"},{id:"chat",label:"Чат"},{id:"training",label:"Обучение"},{id:"evaluation",label:"Тесты"},{id:"processing",label:"Датасеты"}],P={chat:C2,training:yx,processing:zy,evaluation:Tm};return u.jsxs("div",{className:"flex h-full flex-col border-l border-slate-900 bg-slate-950 text-slate-100",children:[u.jsxs("div",{className:"sticky top-0 z-30 border-b border-slate-200 bg-white/90 backdrop-blur dark:border-slate-900 dark:bg-slate-950/95",children:[u.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[u.jsxs("div",{children:[u.jsx("h2",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"История"}),u.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:"Поиск по чатам, обучению и обработке датасетов"})]}),u.jsx("button",{type:"button",onClick:s,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-slate-200 bg-white/80 text-slate-600 shadow-sm shadow-slate-900/5 transition-colors hover:border-blue-500 hover:text-blue-600 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-300 dark:shadow-none dark:hover:text-white",title:"Закрыть историю",children:u.jsx(_0,{className:"h-4 w-4"})})]}),u.jsxs("div",{className:"space-y-3 px-5 pb-4",children:[u.jsxs("div",{className:"relative",children:[u.jsx(sC,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400 dark:text-slate-500"}),u.jsx("input",{type:"search",value:h,onChange:N=>f(N.target.value),placeholder:"Поиск по истории",className:"w-full rounded-lg border border-slate-200 bg-white py-2 pl-10 pr-3 text-sm text-slate-700 placeholder:text-slate-400 shadow-sm shadow-slate-900/5 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:placeholder:text-slate-500 dark:shadow-none"})]}),u.jsx("div",{className:"flex gap-2 overflow-x-auto text-xs",children:C.map(N=>{const I=l===N.id;return u.jsx("button",{type:"button",onClick:()=>d(N.id),className:`rounded-full px-3 py-1 font-medium transition-colors ${I?"bg-blue-500 text-white shadow shadow-blue-900/40":"border border-slate-800 bg-slate-900 text-slate-300 hover:border-blue-500 hover:text-white"}`,children:N.label},N.id)})})]})]}),u.jsxs("div",{className:"flex-1 space-y-4 overflow-y-auto px-5 py-4",children:[u.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[u.jsx(Sg,{label:"Обучение",data:x,summary:y}),u.jsx(Sg,{label:"Обработка",data:v,summary:w}),u.jsx(Sg,{label:"Тестирование",data:g,summary:k})]}),u.jsx("div",{className:"space-y-3",children:b.length===0?u.jsx("div",{className:"rounded-xl border border-dashed border-slate-300 bg-white/70 px-4 py-8 text-center text-sm text-slate-500 dark:border-slate-800 dark:bg-slate-900/40",children:"Ничего не найдено. Попробуйте изменить фильтр или запрос."}):b.map(N=>{const I=P[N.type],M=N.timestamp>e;return u.jsxs("article",{className:"rounded-xl border border-slate-200 bg-white/90 px-4 py-3 shadow-sm shadow-slate-900/10 dark:border-slate-800 dark:bg-slate-900/70 dark:shadow-slate-900/20",children:[u.jsxs("div",{className:"flex items-start justify-between gap-3",children:[u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"mt-1 rounded-lg border border-slate-200 bg-white/70 p-2 text-slate-500 shadow-sm shadow-slate-900/5 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-400 dark:shadow-none",children:u.jsx(I,{className:"h-4 w-4"})}),u.jsxs("div",{className:"space-y-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("h3",{className:"text-sm font-semibold text-slate-800 dark:text-slate-100",children:N.title}),N.status&&u.jsxs("span",{className:`rounded-full px-2 py-0.5 text-[11px] font-semibold ${N.status==="completed"?"bg-emerald-500/10 text-emerald-300":N.status==="running"?"bg-amber-500/10 text-amber-300":"bg-rose-500/10 text-rose-300"}`,children:[N.status==="completed"&&"Готово",N.status==="running"&&"В работе",N.status==="failed"&&"Ошибка",N.status==="cancelled"&&"Отменено"]}),M&&u.jsx("span",{className:"rounded-full bg-blue-500/10 px-2 py-0.5 text-[11px] font-semibold text-blue-300",children:"Новое"})]}),N.subtitle&&u.jsx("p",{className:"text-[13px] text-slate-500 dark:text-slate-400",children:N.subtitle})]})]}),u.jsx("span",{className:"shrink-0 text-[11px] text-slate-500",children:gP(N.timestamp)})]}),N.description&&u.jsx("p",{className:"mt-3 whitespace-pre-wrap text-[13px] leading-relaxed text-slate-600 dark:text-slate-300",children:(N.type==="chat",N.description)}),N.metrics&&Object.keys(N.metrics).length>0&&u.jsx("div",{className:"mt-3 grid grid-cols-2 gap-2 text-[11px] text-slate-500 dark:text-slate-400",children:Object.entries(N.metrics).map(([L,$])=>u.jsx("div",{className:"rounded-lg border border-slate-200 bg-white/80 px-3 py-2 shadow-sm shadow-slate-900/5 dark:border-slate-800 dark:bg-slate-950/40",children:u.jsxs("div",{className:"flex items-baseline justify-between gap-2",children:[u.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:L}),u.jsx("span",{className:"font-semibold text-slate-700 dark:text-slate-100",children:$})]})},L))})]},`${N.type}-${N.id}`)})})]}),u.jsx("div",{className:"border-t border-slate-200 bg-white/90 px-5 py-4 text-xs text-slate-500 dark:border-slate-900 dark:bg-slate-950/95 dark:text-slate-400",children:u.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[u.jsx("button",{type:"button",onClick:()=>{const N=new Blob([a("chat","json")],{type:"application/json"}),I=URL.createObjectURL(N),M=document.createElement("a");M.href=I,M.download=`chat-history-${Date.now()}.json`,M.click(),URL.revokeObjectURL(I)},className:"rounded-lg border border-slate-200 bg-white/80 px-3 py-1.5 text-slate-600 shadow-sm shadow-slate-900/5 transition-colors hover:border-blue-500 hover:text-blue-600 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-300 dark:shadow-none dark:hover:text-white",children:"Экспорт чатов"}),u.jsx("button",{type:"button",onClick:()=>{const N=new Blob([a("evaluation","json")],{type:"application/json"}),I=URL.createObjectURL(N),M=document.createElement("a");M.href=I,M.download=`evaluation-history-${Date.now()}.json`,M.click(),URL.revokeObjectURL(I)},className:"rounded-lg border border-slate-200 bg-white/80 px-3 py-1.5 text-slate-600 shadow-sm shadow-slate-900/5 transition-colors hover:border-blue-500 hover:text-blue-600 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-300 dark:shadow-none dark:hover:text-white",children:"Экспорт тестов"}),u.jsx("button",{type:"button",onClick:()=>{window.confirm("Очистить все записи истории?")&&o("all")},className:"rounded-lg border border-rose-200 bg-rose-50 px-3 py-1.5 text-rose-500 shadow-sm shadow-rose-200/40 transition-colors hover:border-rose-400 hover:text-rose-600 dark:border-rose-500/40 dark:bg-rose-500/10 dark:text-rose-300 dark:shadow-none",children:"Очистить всё"})]})})]})},wP="modulepreload",kP=function(s){return"/"+s},tw={},_P=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(t.map(l=>{if(l=kP(l),l in tw)return;tw[l]=!0;const d=l.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":wP,d||(f.as="script"),f.crossOrigin="",f.href=l,o&&f.setAttribute("nonce",o),document.head.appendChild(f),d)return new Promise((p,m)=>{f.addEventListener("load",p),f.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return r.then(a=>{for(const o of a||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})},VS="llm-studio-evaluation-state-v1",WS="llm-studio-evaluation-preferences-v1",dp={autoPollIntervalMs:15e3,autoAssignBaseline:!0,defaultReviewer:null,qualityGate:.7,compactMode:!1},Nr=s=>{const e=typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`${Date.now().toString(36)}-${Math.random().toString(16).slice(2,10)}`;return`${s}-${e}`},_u=()=>{const s=Date.now(),e=[{id:Nr("eval-item"),domain:"Математика",question:"Решите уравнение: 2x + 5 = 17",referenceAnswer:"x = 6",difficulty:"easy",tags:["linear"]},{id:Nr("eval-item"),domain:"Физика",question:"Сформулируйте второй закон Ньютона и приведите пример.",referenceAnswer:"F = ma. Например, сила 10 Н разгоняет тело массой 2 кг с ускорением 5 м/с².",difficulty:"medium",tags:["theory"]},{id:Nr("eval-item"),domain:"История",question:"Назовите три ключевых последствий распада СССР.",referenceAnswer:"1) Образование независимых государств; 2) Экономические реформы и кризис; 3) Изменение геополитического баланса.",difficulty:"hard",tags:["politics"]},{id:Nr("eval-item"),domain:"Биология",question:"Что такое митоз и каковы его фазы?",referenceAnswer:"Митоз — деление соматической клетки, включает профазу, метафазу, анафазу и телофазу.",difficulty:"medium",tags:["cell"]},{id:Nr("eval-item"),domain:"Программирование",question:"Объясните разницу между стеком и кучей в управлении памятью.",referenceAnswer:"Стек — память для статически распределённых кадров функций, куча — динамическое распределение объектов во время выполнения.",difficulty:"medium",tags:["memory"]},{id:Nr("eval-item"),domain:"Экономика",question:"Что такое инфляция и какие факторы на неё влияют?",referenceAnswer:"Инфляция — рост общего уровня цен. Влияние оказывают денежная масса, выпуск, ожидания, валютный курс и издержки.",difficulty:"medium",tags:["macro"]}];return{id:Nr("eval-dataset"),name:"Базовый эталон",description:"Стартовый набор вопросов по ключевым предметным областям для регрессионного тестирования модели.",createdAt:s,updatedAt:s,items:e}},qS=s=>{const t=[s.humanScore,s.remoteScore,s.autoScore].find(n=>typeof n=="number"&&Number.isFinite(n));return typeof t=="number"?t:null},Gn=s=>Math.round(s*1e3)/1e3,SP=(s,e)=>{if(!s.length)return null;const t=[...s].sort((r,i)=>r-i),n=Math.min(t.length-1,Math.max(0,Math.round((t.length-1)*e)));return t[n]},XS=s=>{const{items:e}=s,t=e.length;if(t===0)return{total:t,answered:0,scored:0,needsReview:0,coverage:0,overallScore:null,autoScoreAverage:null,humanApprovalRate:null,averageLatencySeconds:null,latencyP95Seconds:null,averageTokensPerResponse:null,tokensPerSecond:null,domainSummaries:[]};let n=0,r=0,i=0,a=0,o=0,l=0,d=0,h=0,f=0;const p=[],m=[];let b=0,x=0;const v=new Map;e.forEach(D=>{const _=D.domain||"Без категории",K=qS(D);D.status!=="pending"&&(n+=1),D.status==="needs_review"&&(i+=1),(D.status==="scored"||D.status==="reviewed")&&(r+=1),typeof D.autoScore=="number"&&Number.isFinite(D.autoScore)&&(a+=D.autoScore,o+=1),typeof K=="number"&&Number.isFinite(K)&&(l+=K,d+=1);const J=typeof D.answerStartedAt=="number"?D.answerStartedAt:null,W=typeof D.answerCompletedAt=="number"?D.answerCompletedAt:null,Q=typeof D.tokens=="number"&&Number.isFinite(D.tokens)&&D.tokens>=0?D.tokens:null;if(J!==null&&W!==null&&W>=J){const oe=(W-J)/1e3;p.push(oe),Q!==null&&(b+=Q,x+=oe)}Q!==null&&m.push(Q);const H=v.get(_)??{summary:{domain:_,total:0,answered:0,scored:0,needsReview:0,averageScore:null,autoScoreAverage:null,humanApprovalRate:null},aggregateSum:0,aggregateCount:0,autoScoreSum:0,autoScoreCount:0,humanApproved:0,humanTotal:0};H.summary.total+=1,D.status!=="pending"&&(H.summary.answered+=1),D.status==="needs_review"&&(H.summary.needsReview+=1),(D.status==="scored"||D.status==="reviewed")&&(H.summary.scored+=1),typeof K=="number"&&Number.isFinite(K)&&(H.aggregateSum+=K,H.aggregateCount+=1),typeof D.autoScore=="number"&&Number.isFinite(D.autoScore)&&(H.autoScoreSum+=D.autoScore,H.autoScoreCount+=1),D.reviewStatus==="approved"?(h+=1,f+=1,H.humanApproved+=1,H.humanTotal+=1):D.reviewStatus==="rejected"&&(f+=1,H.humanTotal+=1),v.set(_,H)});const g=Array.from(v.values()).map(D=>{const{summary:_,aggregateSum:K,aggregateCount:J,autoScoreSum:W,autoScoreCount:Q,humanApproved:H,humanTotal:oe}=D;return{..._,averageScore:J>0?Gn(K/J):null,autoScoreAverage:Q>0?Gn(W/Q):null,humanApprovalRate:oe>0?Gn(H/oe):null}}),y=p.length>0?Gn(p.reduce((D,_)=>D+_,0)/p.length):null,w=SP(p,.95),k=w===null?null:Gn(w),C=m.reduce((D,_)=>D+_,0),P=m.length>0?Gn(C/m.length):null,N=x>0&&b>0?Gn(b/x):null,I=Gn(n/t),M=d>0?Gn(l/d):null,L=o>0?Gn(a/o):null,$=typeof s.config.qualityGateThreshold=="number"?s.config.qualityGateThreshold:null,E=$!==null&&M!==null?M>=$:null;return{total:t,answered:n,scored:r,needsReview:i,coverage:I,overallScore:M,autoScoreAverage:L,humanApprovalRate:f>0?Gn(h/f):null,averageLatencySeconds:y,latencyP95Seconds:k,averageTokensPerResponse:P,tokensPerSecond:N,qualityGateThreshold:$,qualityGatePassed:E,domainSummaries:g}},xi=s=>{if(s.length===0)return s;const e=s.map(t=>({...t,metrics:XS(t)}));return e.map(t=>{if(!t.baselineRunId)return t;const n=e.find(o=>o.id===t.baselineRunId);if(!n)return t;const r=n.metrics.overallScore??null,i=t.metrics.overallScore??null,a=r!==null&&i!==null?Gn(i-r):null;return{...t,metrics:{...t.metrics,baselineScore:r,scoreDelta:a}}})},KS=s=>({...s,items:s.items.map(e=>({...e,tags:Array.isArray(e.tags)?e.tags.slice(0,12):[]}))}),AP=()=>{var s;if(typeof window>"u"){const e=_u();return{datasets:[e],runs:[],activeDatasetId:e.id,activeRunId:null}}try{const e=window.localStorage.getItem(VS);if(!e){const r=_u();return{datasets:[r],runs:[],activeDatasetId:r.id,activeRunId:null}}const t=JSON.parse(e);if(!t||!Array.isArray(t.datasets))throw new Error("Invalid evaluation state structure");const n=t.datasets.map(KS);return{datasets:n.length>0?n:[_u()],runs:Array.isArray(t.runs)?xi(t.runs):[],activeDatasetId:t.activeDatasetId??((s=n[0])==null?void 0:s.id)??null,activeRunId:t.activeRunId??null}}catch(e){console.warn("Не удалось загрузить состояние тестирования моделей",e);const t=_u();return{datasets:[t],runs:[],activeDatasetId:t.id,activeRunId:null}}},EP=()=>{if(typeof window>"u")return dp;try{const s=window.localStorage.getItem(WS);if(!s)return dp;const e=JSON.parse(s);return{...dp,...e}}catch(s){return console.warn("Не удалось загрузить настройки тестирования",s),dp}},YS=z.createContext(void 0);function NP({children:s}){const e=z.useMemo(AP,[]),[t,n]=z.useState(e.datasets),[r,i]=z.useState(e.runs),[a,o]=z.useState(e.activeDatasetId),[l,d]=z.useState(e.activeRunId),[h,f]=z.useState(EP),{addEvaluationSession:p}=Ul(),m=z.useRef({});z.useEffect(()=>{if(typeof window>"u")return;const Y={datasets:t,runs:r,activeDatasetId:a,activeRunId:l};try{window.localStorage.setItem(VS,JSON.stringify(Y))}catch(V){console.warn("Не удалось сохранить состояние тестирования моделей",V)}},[t,r,a,l]),z.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(WS,JSON.stringify(h))}catch(Y){console.warn("Не удалось сохранить настройки тестирования",Y)}},[h]),z.useEffect(()=>{const Y=m.current;r.forEach(V=>{const ee=Y[V.id];Y[V.id]=V.status;const fe=ee!==V.status,se=V.status==="completed"||V.status==="waiting_review"||V.status==="failed";if(!fe||!se)return;const ve=V.status==="completed"?V.completedAt??V.updatedAt??Date.now():V.updatedAt??Date.now();p({id:V.id,timestamp:ve,datasetName:V.config.datasetName,modelVariant:V.config.modelVariant,total:V.metrics.total,scored:V.metrics.scored,overallScore:V.metrics.overallScore,coverage:V.metrics.coverage,status:V.status,baselineScore:V.metrics.baselineScore??null,scoreDelta:V.metrics.scoreDelta??null,error:V.error??null})})},[r,p]);const b=z.useMemo(()=>t.find(Y=>Y.id===a)??null,[t,a]),x=z.useMemo(()=>r.find(Y=>Y.id===l)??null,[r,l]),v=z.useMemo(()=>r.flatMap(Y=>Y.items.filter(V=>V.status==="needs_review").map(V=>({runId:Y.id,itemId:V.id,domain:V.domain,question:V.question,modelAnswer:V.modelAnswer??null,referenceAnswer:V.referenceAnswer,submittedAt:V.answerCompletedAt??Y.updatedAt,reviewer:V.reviewer??null,status:"pending"}))),[r]),g=z.useCallback(Y=>{o(Y)},[]),y=z.useCallback(Y=>{d(Y)},[]),w=z.useCallback(Y=>{f(V=>({...V,...Y}))},[]),k=z.useCallback((Y,V)=>{const ee={id:Nr("eval-dataset"),name:Y,description:V,createdAt:Date.now(),updatedAt:Date.now(),items:[]};return n(fe=>[...fe,ee]),o(ee.id),ee},[]),C=z.useCallback((Y,V)=>{n(ee=>ee.map(fe=>fe.id!==Y?fe:{...fe,...V,updatedAt:Date.now()}))},[]),P=z.useCallback(Y=>{n(V=>V.filter(ee=>ee.id!==Y)),i(V=>{const ee=V.filter(fe=>fe.config.datasetId!==Y);return xi(ee)}),o(V=>V===Y?null:V)},[]),N=z.useCallback((Y,V)=>{V.length&&n(ee=>ee.map(fe=>{if(fe.id!==Y)return fe;const se=new Set(fe.items.map(ce=>ce.id)),ve=V.filter(ce=>se.has(ce.id)?!1:!!(ce.question&&ce.referenceAnswer&&ce.domain));return ve.length?{...fe,items:[...fe.items,...ve],updatedAt:Date.now()}:fe}))},[]),I=z.useCallback((Y,V,ee)=>{n(fe=>fe.map(se=>se.id!==Y?se:{...se,items:se.items.map(ve=>ve.id!==V?ve:{...ve,...ee}),updatedAt:Date.now()}))},[]),M=z.useCallback((Y,V)=>{n(ee=>ee.map(fe=>fe.id!==Y?fe:{...fe,items:fe.items.filter(se=>se.id!==V),updatedAt:Date.now()}))},[]),L=z.useCallback(()=>{const Y=_u();n([Y]),i([]),o(Y.id),d(null)},[]),$=z.useCallback(Y=>{const V=KS({...Y,id:Y.id||Nr("eval-dataset"),createdAt:Y.createdAt??Date.now(),updatedAt:Date.now()});n(ee=>[...ee,V]),o(V.id)},[]),E=z.useCallback(Y=>t.find(V=>V.id===Y)??null,[t]),D=z.useCallback(Y=>{i(xi(Y))},[]),_=z.useCallback(Y=>{const{datasetId:V,name:ee,config:fe,sampleSize:se,domainFilter:ve,difficultyFilter:ce,tagFilter:Re,manualSelection:Ge,baselineRunId:Ht}=Y,pt=t.find(ae=>ae.id===V);if(!pt)return console.warn("Dataset not found for evaluation run"),null;let A=pt.items.slice();if(Ge&&Ge.length>0){const ae=new Set(Ge);A=A.filter(de=>ae.has(de.id))}if(ve&&ve.length>0){const ae=new Set(ve);A=A.filter(de=>ae.has(de.domain))}if(ce&&ce.length>0){const ae=new Set(ce);A=A.filter(de=>ae.has(de.difficulty))}if(Re&&Re.length>0){const ae=new Set(Re);A=A.filter(de=>de.tags.some(te=>ae.has(te)))}fe.shuffle&&(A=[...A].sort(()=>Math.random()-.5));const le=typeof se=="number"&&se>0?A.slice(0,Math.min(se,A.length)):A;if(!le.length)return console.warn("Нет доступных примеров для запуска тестирования"),null;const ne=Date.now(),O=le.map(ae=>{var de;return{id:Nr("eval-run-item"),datasetItemId:ae.id,domain:ae.domain,subdomain:ae.subdomain,question:ae.question,referenceAnswer:ae.referenceAnswer,scoringMode:fe.scoringMode,difficulty:ae.difficulty,tags:((de=ae.tags)==null?void 0:de.slice())??[],status:"pending"}}),R={id:Nr("eval-run"),name:ee||`${pt.name} — ${new Date(ne).toLocaleString()}`,createdAt:ne,updatedAt:ne,status:"queued",config:{...fe,datasetId:pt.id,datasetName:pt.name,sampleSize:le.length},items:O,metrics:{total:O.length,answered:0,scored:0,needsReview:0,coverage:0,overallScore:null,autoScoreAverage:null,humanApprovalRate:null,averageLatencySeconds:null,latencyP95Seconds:null,averageTokensPerResponse:null,tokensPerSecond:null,qualityGateThreshold:fe.qualityGateThreshold??null,qualityGatePassed:null,domainSummaries:[]},baselineRunId:Ht??null},q={...R,metrics:XS(R)};return i(ae=>xi([...ae,q])),d(q.id),q},[t]),K=z.useCallback((Y,V,ee)=>{i(fe=>xi(fe.map(se=>{if(se.id!==Y)return se;const ve=Date.now();return{...se,status:V,error:ee??void 0,startedAt:se.startedAt??(V==="running"?ve:se.startedAt),completedAt:V==="completed"?ve:se.completedAt,updatedAt:ve}})))},[]),J=z.useCallback((Y,V,ee)=>{i(fe=>xi(fe.map(se=>{if(se.id!==Y)return se;const ve=se.items.map(ce=>ce.id!==V?ce:{...ce,...ee,autoScore:ee.autoScore??ce.autoScore,remoteScore:ee.remoteScore??ce.remoteScore,humanScore:ee.humanScore??ce.humanScore,status:ee.status??ce.status,answerCompletedAt:ee.answerCompletedAt??ce.answerCompletedAt,answerStartedAt:ee.answerStartedAt??ce.answerStartedAt});return{...se,items:ve,updatedAt:Date.now()}})))},[]),W=z.useCallback((Y,V)=>{i(ee=>xi(ee.map(fe=>fe.id!==Y?fe:{...fe,baselineRunId:V,updatedAt:Date.now()})))},[]),Q=z.useCallback((Y,V,ee)=>{i(fe=>xi(fe.map(se=>{if(se.id!==Y)return se;const ve=se.items.map(ce=>{if(ce.id!==V)return ce;const Re=typeof ee.scoreOverride=="number"?ee.scoreOverride:qS(ce),Ge={...ce,humanScore:typeof ee.scoreOverride=="number"?ee.scoreOverride:ce.humanScore,reviewStatus:ee.status,reviewer:ee.reviewer!==void 0?ee.reviewer:ce.reviewer,reviewNotes:ee.notes??ce.reviewNotes,status:"reviewed",autoScore:ce.autoScore,remoteScore:ce.remoteScore};return Re!==null&&(Ge.autoScore=Ge.autoScore??Re),Ge});return{...se,items:ve,status:ve.every(ce=>ce.status==="reviewed"||ce.status==="scored")?"completed":se.status,updatedAt:Date.now()}})))},[]),H=z.useCallback(Y=>{i(V=>xi(V.filter(ee=>ee.id!==Y))),d(V=>V===Y?null:V)},[]),oe=z.useCallback(()=>{i([]),d(null)},[]),X=z.useCallback((Y,V)=>{i(ee=>ee.map(fe=>fe.id!==Y?fe:{...fe,notes:[fe.notes,V].filter(Boolean).join(`

`),updatedAt:Date.now()}))},[]),U=z.useMemo(()=>({datasets:t,activeDatasetId:a,activeDataset:b,runs:r,activeRunId:l,activeRun:x,preferences:h,reviewTasks:v,setActiveDatasetId:g,setActiveRunId:y,updatePreferences:w,createDataset:k,updateDataset:C,removeDataset:P,addDatasetItems:N,updateDatasetItem:I,removeDatasetItem:M,resetDatasets:L,importDataset:$,exportDataset:E,startRun:_,updateRunStatus:K,updateRunItem:J,attachBaseline:W,submitReview:Q,discardRun:H,clearRuns:oe,appendRunNote:X,hydrateRuns:D}),[t,a,b,r,l,x,h,v,g,y,w,k,C,P,N,I,M,L,$,E,_,K,J,W,Q,H,oe,X,D]);return u.jsx(YS.Provider,{value:U,children:s})}function CP(){const s=z.useContext(YS);if(s===void 0)throw new Error("useEvaluation must be used within an EvaluationProvider");return s}const QS="llm-studio-auto-training",at={aggregatorUrl:"http://127.0.0.1:5050",endpoint:"/export/csv",collection:"LLM Feedback",tags:"ready-for-training",status:"ready",query:"",limit:500,authHeader:"Authorization",authToken:"",includePreviousDataset:!0,previousFineTunePath:"",deduplicate:!0,minExamples:1,scoreThreshold:null,targetPairs:30,pairsPerSnippet:1,includeReferencePair:!0,minParagraphChars:140,maxParagraphChars:680,maxSegments:4,topK:5,deepSearch:!0,maxCandidates:20,maxSnippets:3,chunkChars:5e3,maxChunks:25,autoLaunchFineTune:!0,pipelineDryRun:!1,includeDatasetPreview:!1,fineTuneTimeout:900},yn=(s,e)=>{const t=Number(s);return Number.isFinite(t)?t:e},TP=s=>{if(s==null||s==="")return null;const e=Number(s);return Number.isFinite(e)?e:null},up=(s,e)=>{if(typeof s=="boolean")return s;if(typeof s=="string"){if(s.toLowerCase()==="true")return!0;if(s.toLowerCase()==="false")return!1}return e},jP=()=>{if(typeof window>"u")return at;try{const s=window.localStorage.getItem(QS);if(!s)return at;const e=JSON.parse(s);return{...at,...e,limit:yn(e==null?void 0:e.limit,at.limit),minExamples:yn(e==null?void 0:e.minExamples,at.minExamples),scoreThreshold:TP(e==null?void 0:e.scoreThreshold),targetPairs:yn(e==null?void 0:e.targetPairs,at.targetPairs),pairsPerSnippet:yn(e==null?void 0:e.pairsPerSnippet,at.pairsPerSnippet),minParagraphChars:yn(e==null?void 0:e.minParagraphChars,at.minParagraphChars),maxParagraphChars:yn(e==null?void 0:e.maxParagraphChars,at.maxParagraphChars),maxSegments:yn(e==null?void 0:e.maxSegments,at.maxSegments),topK:yn(e==null?void 0:e.topK,at.topK),deepSearch:up(e==null?void 0:e.deepSearch,at.deepSearch),maxCandidates:yn(e==null?void 0:e.maxCandidates,at.maxCandidates),maxSnippets:yn(e==null?void 0:e.maxSnippets,at.maxSnippets),chunkChars:yn(e==null?void 0:e.chunkChars,at.chunkChars),maxChunks:yn(e==null?void 0:e.maxChunks,at.maxChunks),autoLaunchFineTune:up(e==null?void 0:e.autoLaunchFineTune,at.autoLaunchFineTune),pipelineDryRun:up(e==null?void 0:e.pipelineDryRun,at.pipelineDryRun),includeDatasetPreview:up(e==null?void 0:e.includeDatasetPreview,at.includeDatasetPreview),fineTuneTimeout:yn(e==null?void 0:e.fineTuneTimeout,at.fineTuneTimeout)}}catch(s){return console.warn("Failed to load auto training config from storage",s),at}},PP=s=>{if(!(typeof window>"u"))try{window.localStorage.setItem(QS,JSON.stringify(s))}catch(e){console.warn("Failed to persist auto training config",e)}},MP=async(s,e)=>{const n=`${e.baseUrl.replace(/\/$/,"")}/api/training/problem-pipeline`,r=new AbortController,i=e.timeout??18e4,a=setTimeout(()=>r.abort(),i);try{const o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",...e.headers??{}},body:JSON.stringify(s),signal:e.signal??r.signal,credentials:e.credentials??"same-origin"}),l=await o.text();let d;try{d=l?JSON.parse(l):{ok:o.ok}}catch{throw new Error(l||`Agregator pipeline failed with status ${o.status}`)}if(!o.ok||d.ok===!1){const h=(d==null?void 0:d.error)||l||`Agregator pipeline failed with status ${o.status}`;throw new Error(h)}return d}finally{clearTimeout(a)}},RP=[],Hb=s=>s.toLowerCase().replace(/\s+/g," ").trim(),sw=s=>Hb(s).split(/[^\p{L}\p{N}]+/u).filter(Boolean),nw=s=>Array.from(new Set(s)),rw=s=>s.reduce((e,t)=>(e[t]=(e[t]??0)+1,e),{}),IP=(s,e)=>s===0&&e===0?0:2*s*e/(s+e),LP=(s,e)=>{if(!s.length||!e.length)return 0;const t=new Set(s),n=new Set(e),r=Array.from(t).filter(a=>n.has(a)),i=t.size+n.size-r.length;return i===0?0:r.length/i},DP=(s,e)=>{let t=0,n=0,r=0;Object.entries(e).forEach(([o,l])=>{n+=l,s[o]&&(t+=Math.min(l,s[o]))}),Object.values(s).forEach(o=>{r+=o});const i=n===0?0:t/n,a=r===0?0:t/r;return{precision:i,recall:a}},FP=(s,e,t={})=>{var N;const n=Hb(s),r=Hb(e);if(!n||!r)return{score:0,breakdown:{exactMatch:+(n===r&&n.length>0),tokenPrecision:0,tokenRecall:0,tokenF1:0,jaccard:0,lengthRatio:n?r.length/n.length:0,keywordRecall:0,weightedScore:0},reasons:[n?"Ответ модели пустой":"Эталон пустой"]};const i=sw(s),a=sw(e),o=rw(i),l=rw(a),{precision:d,recall:h}=DP(o,l),f=IP(d,h),p=LP(i,a),m=+(n===r),b=n.length>0?Math.min(r.length/n.length,2):0,x=(N=t.keywords)!=null&&N.length?t.keywords:RP;let v=0;if(x.length>0){const I=new Set(nw(a)),M=new Set(nw(i)),L=x.filter($=>M.has($));L.length>0&&(v=L.filter(E=>I.has(E)).length/L.length)}const g=t.weightExact??.2,y=t.weightF1??.5,w=t.weightJaccard??.2,k=t.weightKeyword??.1,C=Math.max(0,Math.min(1,m*g+f*y+p*w+v*k)),P=[];return m===1?P.push("Ответ совпадает с эталоном"):(f>.75&&P.push("Высокое пересечение ключевых слов"),v<.5&&x.length>0&&P.push("Покрытие ключевых терминов ниже 50%"),p<.3&&P.push("Слабое совпадение лексики с эталоном")),{score:C,breakdown:{exactMatch:m,tokenPrecision:d,tokenRecall:h,tokenF1:f,jaccard:p,lengthRatio:b,keywordRecall:v,weightedScore:C},reasons:P}},OP=()=>{try{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return`pipeline-${crypto.randomUUID()}`}catch(e){console.warn("Не удалось сгенерировать UUID через crypto.randomUUID",e)}const s=Math.random().toString(16).slice(2,10);return`pipeline-${Date.now().toString(36)}-${s}`},iw={question:"",referenceAnswer:"",domain:"",difficulty:"medium",tags:""},aw={datasetId:null,modelVariant:"base",scoringMode:"auto",sampleSize:null,domains:[],difficulties:[],tags:[],requireHumanReview:!1,baselineRunId:null},ow={good:"text-emerald-400",warn:"text-amber-400",bad:"text-rose-400"},lw=["#34d399","#60a5fa","#facc15","#f472b6","#a78bfa","#38bdf8","#fb7185","#2dd4bf","#e879f9","#f97316"],cw=z.lazy(()=>_P(()=>import("./QualityDashboard-BHYEUvhb.js"),[])),Ag={easy:"Лёгкая",medium:"Средняя",hard:"Сложная",unknown:"Не указана"},Kl=(s,e=1)=>typeof s!="number"||Number.isNaN(s)?"—":`${(s*100).toFixed(e)}%`,Hs=(s,e=3)=>typeof s!="number"||Number.isNaN(s)?"—":s.toFixed(e),dw=s=>{if(typeof s!="number"||Number.isNaN(s))return"—";if(s>=60){const t=Math.floor(s/60),n=s-t*60,r=n>=10?n.toFixed(0):n.toFixed(1);return`${t}м ${r}с`}const e=s>=10?1:2;return`${s.toFixed(e)} с`},zP=s=>typeof s!="number"||Number.isNaN(s)?"—":s>=100?Math.round(s).toString():s.toFixed(1),uw=(s,e)=>{const t=zP(s);return t==="—"?t:`${t} ${e}`},Eg=s=>typeof s.humanScore=="number"?s.humanScore:typeof s.remoteScore=="number"?s.remoteScore:typeof s.autoScore=="number"?s.autoScore:null,$P=(s,e=96)=>s.length<=e?s:`${s.slice(0,e-1)}…`,Yl=(s,e)=>s===null?"warn":s>=e?"good":s>=e*.85?"warn":"bad",BP=s=>`Ответь на вопрос максимально точно и лаконично.

Вопрос: ${s}`,hw=(s,e)=>{if(!s.length)return[];const n=(e.length>0?s.filter(r=>e.includes(r.domain)):s).flatMap(r=>r.tags??[]);return Array.from(new Set(n.map(r=>r.toLowerCase()))).slice(0,12)},UP=s=>Number.isFinite(s)?s<0?0:s>1?1:s:null,HP=s=>{const e=s.indexOf("{"),t=s.lastIndexOf("}");if(e===-1||t===-1||t<=e)throw new Error("LLM не вернула корректный JSON");const n=s.slice(e,t+1);return JSON.parse(n)},GP=async(s,e,t,n,r)=>{const i=["Ты выступаешь как строгий проверяющий ответов модели.","Тебе дан вопрос, эталонный ответ и ответ модели.","Поставь оценку от 0 до 1 (1 — точно соответствует эталону).",'Верни JSON вида {"score":0.85,"verdict":"короткий вывод","reason":"обоснование"}.',"Всегда возвращай только JSON, без дополнительного текста.","",`Вопрос: ${s}`,`Эталонный ответ: ${e}`,`Ответ модели: ${t}`,`Порог прохода: ${n.toFixed(2)}`].join(`
`),a=await S0([{role:"system",content:"Ты оцениваешь ответы модели и всегда отвечаешь строгим JSON-объектом. Поля: score (0..1), verdict (строка), reason (строка)."},{role:"user",content:i}],{apiUrl:r.apiUrl,apiKey:r.apiKey,maxTokens:Math.min(r.maxTokens,256),temperature:Math.min(.2,r.temperature),topP:r.topP,model:r.modelId,signal:r.signal}),o=HP(a.content);return{score:UP(Number(o.score)),verdict:typeof o.verdict=="string"?o.verdict:void 0,reason:typeof o.reason=="string"?o.reason:void 0}},VP=()=>{var dt;const{datasets:s,activeDatasetId:e,activeRun:t,runs:n,reviewTasks:r,preferences:i,setActiveDatasetId:a,setActiveRunId:o,updatePreferences:l,startRun:d,updateRunItem:h,updateRunStatus:f,submitReview:p,addDatasetItems:m,resetDatasets:b,exportDataset:x,importDataset:v,attachBaseline:g,clearRuns:y,appendRunNote:w}=CP(),{settings:k}=aa(),{setActivity:C,updateActivity:P,clearActivity:N}=If(),I=!!((dt=k.remoteApiUrl)!=null&&dt.trim()),M=i.compactMode??!1,[L,$]=z.useState(()=>{var F;return{...aw,datasetId:e??((F=s[0])==null?void 0:F.id)??null,baselineRunId:null}}),[E,D]=z.useState(i.qualityGate??.7),[_,K]=z.useState(iw),[J,W]=z.useState(!1),[Q,H]=z.useState([]),[oe,X]=z.useState(null),U=z.useRef(null),Y=z.useRef(n),{config:V,addDatasetItems:ee,dataset:fe}=Gy(),[se,ve]=z.useState(()=>jP()),[ce,Re]=z.useState(!1),[Ge,Ht]=z.useState(null),[pt,A]=z.useState(null),[le,ne]=z.useState(!1),O=z.useCallback(F=>{ve(he=>{const _e={...he,...F};return PP(_e),_e})},[]);z.useEffect(()=>{Y.current=n},[n]),z.useEffect(()=>{L.datasetId!==e&&L.datasetId&&a(L.datasetId)},[L.datasetId,e,a]),z.useEffect(()=>{if(!t)return;const F=t.baselineRunId;F&&L.baselineRunId!==F&&$(he=>({...he,baselineRunId:F}))},[t,L.baselineRunId]),z.useEffect(()=>{i.qualityGate!==void 0&&i.qualityGate!==null&&D(i.qualityGate)},[i.qualityGate]),z.useEffect(()=>{L.scoringMode==="human"&&!L.requireHumanReview&&$(F=>({...F,requireHumanReview:!0}))},[L.scoringMode,L.requireHumanReview]);const R=z.useMemo(()=>L.datasetId?s.find(F=>F.id===L.datasetId)??null:null,[s,L.datasetId]),q=z.useMemo(()=>R?Array.from(new Set(R.items.map(he=>he.domain))).sort():[],[R]),ae=z.useMemo(()=>R?Array.from(new Set(R.items.map(he=>he.difficulty))):[],[R]),de=z.useMemo(()=>R?hw(R.items,L.domains):[],[R,L.domains]),te=z.useMemo(()=>R?R.items.filter(F=>!(L.domains.length>0&&!L.domains.includes(F.domain)||L.difficulties.length>0&&!L.difficulties.includes(F.difficulty)||L.tags.length>0&&!L.tags.every(he=>F.tags.includes(he)))):[],[R,L.domains,L.difficulties,L.tags]),G=z.useMemo(()=>{if(!R)return[];const F=new Map;return R.items.forEach(he=>{const _e=F.get(he.domain)??{domain:he.domain,total:0,difficultyMap:{}};_e.total+=1,_e.difficultyMap[he.difficulty]=(_e.difficultyMap[he.difficulty]??0)+1,F.set(he.domain,_e)}),Array.from(F.values()).sort((he,_e)=>_e.total-he.total)},[R]),ue=z.useMemo(()=>n.filter(F=>F.config.datasetId===L.datasetId).sort((F,he)=>he.createdAt-F.createdAt),[n,L.datasetId]),Z=z.useCallback(F=>{H(he=>[...he,`${new Date().toLocaleTimeString()} — ${F}`].slice(-120))},[]),re=z.useCallback(()=>{$(F=>({...aw,datasetId:F.datasetId,baselineRunId:F.baselineRunId}))},[]),xe=z.useCallback((F,he)=>{$(_e=>({..._e,[F]:he}))},[]),be=z.useCallback((F,he)=>{$(_e=>{const Le=_e[F],Gt=Le.includes(he)?Le.filter(As=>As!==he):[...Le,he];return F==="difficulties"?{..._e,[F]:Gt}:{..._e,[F]:Gt}})},[]),Ze=z.useCallback(()=>{if(!L.datasetId||!_.question.trim()||!_.referenceAnswer.trim()||!_.domain.trim())return;const F={id:`${L.datasetId}-${Date.now()}-${Math.random().toString(16).slice(2,7)}`,domain:_.domain.trim(),question:_.question.trim(),referenceAnswer:_.referenceAnswer.trim(),difficulty:_.difficulty,tags:_.tags.split(",").map(he=>he.trim()).filter(Boolean)};m(L.datasetId,[F]),K(iw),Z(`Добавлен новый пример в датасет «${_.domain.trim()}».`)},[L.datasetId,_,m,Z]),$s=z.useCallback(F=>{var Le;const he=(Le=F.target.files)==null?void 0:Le[0];if(!he)return;const _e=new FileReader;_e.onload=()=>{try{const Je=JSON.parse(String(_e.result));if(!Je||typeof Je!="object")throw new Error("Некорректный формат файла");v(Je),X(null),Z(`Импортирован датасет из файла «${he.name}».`)}catch(Je){X(Je instanceof Error?Je.message:"Не удалось импортировать датасет")}},_e.readAsText(he)},[v,Z]),Ft=z.useCallback(()=>{if(!L.datasetId)return;const F=x(L.datasetId);if(!F)return;const he=new Blob([JSON.stringify(F,null,2)],{type:"application/json"}),_e=URL.createObjectURL(he),Le=document.createElement("a");Le.href=_e,Le.download=`${F.name.replace(/[^a-zA-Z0-9-_]+/g,"_")||"dataset"}.json`,Le.click(),URL.revokeObjectURL(_e)},[L.datasetId,x]),us=z.useCallback((F,he,_e="running")=>{P("evaluation",{message:F,progress:Math.round(he),status:_e})},[P]),Oe=z.useCallback((F,he)=>{P("evaluation",{message:he,status:F,progress:F==="success"||F==="warning"?100:void 0}),setTimeout(()=>{N("evaluation")},1200)},[P,N]),nt=z.useCallback(F=>{const he=BP(F.question);return[{role:"system",content:"Ты — ассистент, отвечающий на проверочный вопрос максимально точно."},{role:"user",content:he}]},[]),lr=z.useCallback((F,he)=>{const _e=hw([{...F,tags:F.tags??[],difficulty:F.difficulty??"medium",referenceAnswer:F.referenceAnswer,question:F.question,domain:F.domain,id:F.datasetItemId}],[]);return FP(F.referenceAnswer,he,{keywords:_e,weightExact:.25,weightF1:.5,weightJaccard:.15,weightKeyword:.1})},[]),hs=z.useCallback(async F=>{W(!0),Z(`Запуск тестирования (${F.items.length} примеров)...`),C("evaluation",{message:"Запуск тестирования",progress:0,status:"running"});const he=new AbortController;U.current=he;const{modelVariant:_e,scoringMode:Le,requireHumanReview:Je,qualityGateThreshold:Gt}=F.config,As=k.maxTokens,xn=Le==="auto"?Math.min(k.temperature,.4):k.temperature,Es=typeof Gt=="number"?Gt:E,sn=Le==="auto",hi=Le==="llm",fs=Le==="human";let ss=0;try{for(const rt of F.items){if(he.signal.aborted){Z("Тестирование остановлено пользователем."),f(F.id,"failed","Отменено пользователем"),Oe("error","Тестирование остановлено");break}h(F.id,rt.id,{status:"answering",answerStartedAt:Date.now()}),Z(`Генерация ответа для вопроса: ${rt.question.slice(0,64)}...`);let ps="",ut=null;try{if(_e==="remote"){const De=await S0(nt(rt),{apiUrl:k.remoteApiUrl,apiKey:k.remoteApiKey,maxTokens:As,temperature:xn,topP:k.topP,model:k.remoteModelId,signal:he.signal});ps=De.content,ut=De.tokens??null}else{let De=k.baseModelPath,xt;if(_e==="fine_tuned"){const bn=k.fineTunedModelPath.trim(),Fr=k.fineTunedMethod||"lora",ql=(k.fineTunedBaseModelPath||k.baseModelPath).trim();if(!bn)throw new Error("Не указан путь до дообученной модели");Fr==="full"?De=bn:(De=ql,xt=bn)}const Ot=await Pm(nt(rt),{serverUrl:k.baseModelServerUrl,modelPath:De,adapterPath:xt,maxTokens:As,temperature:xn,topP:k.topP,quantization:k.quantization,device:k.deviceType,signal:he.signal});ps=Ot.content,ut=Ot.tokens??null}}catch(De){const xt=De instanceof Error?De.message:"Неизвестная ошибка генерации";Z(`⚠️ Ошибка генерации ответа: ${xt}`),h(F.id,rt.id,{modelAnswer:`Ошибка генерации: ${xt}`,status:"needs_review",reviewStatus:"pending",answerCompletedAt:Date.now()}),ss+=1,us("Ожидание проверки проблемных ответов",ss/F.items.length*100);continue}let ge=null,je;if(sn){const De=lr(rt,ps);ge=De.score,je=De.reasons.join(`
`)}else if(hi)if(!I)Z("Удалённая модель не настроена, ответ передан на ручную проверку.");else try{const De=await GP(rt.question,rt.referenceAnswer,ps,Es,{apiUrl:k.remoteApiUrl,apiKey:k.remoteApiKey??"",maxTokens:k.maxTokens,temperature:k.temperature,topP:k.topP,modelId:k.remoteModelId,signal:he.signal});ge=De.score,je=[De.verdict,De.reason].filter(Boolean).join(`
`),Z(`LLM-оценка ответа: ${ge!==null?ge.toFixed(3):"нет оценки"}`)}catch(De){const xt=De instanceof Error?De.message:"Ошибка удалённой оценки";Z(`⚠️ ${xt}`)}const Ie=fs||Je||(ge!==null?ge<Math.max(Es,.6):!0),Qe=Ie||hi?je:void 0;h(F.id,rt.id,{modelAnswer:ps,autoScore:ge,status:Ie?"needs_review":"scored",reviewStatus:Ie?"pending":"approved",answerCompletedAt:Date.now(),tokens:ut,reviewNotes:Qe}),ss+=1,us(sn?"Расчёт локальных метрик":hi?"Удалённая проверка ответов":"Подготовка результатов",ss/F.items.length*100)}const nn=Y.current.find(rt=>rt.id===F.id);if(!nn){Z("Не удалось обновить состояние прогона."),Oe("error","Ошибка состояния теста"),W(!1);return}const ze=nn.items.filter(rt=>rt.status==="needs_review").length;if(ze>0)f(F.id,"waiting_review"),Oe("warning","Требуется ручная проверка"),Z(`Ожидает проверки: ${ze} ответов.`);else{f(F.id,"completed");const rt=nn.metrics.qualityGatePassed??null,ps=nn.metrics.qualityGateThreshold??Es,ut=Hs(nn.metrics.overallScore,3),ge=Hs(ps,3);rt===!1?(Oe("warning","Скор ниже критерия качества"),Z(`Итоговый скор ${ut} ниже порога ${ge}.`),w(F.id,`Скор ${ut} ниже порога ${ge}. Проверьте проблемные ответы.`)):(Oe("success","Тестирование завершено"),Z(rt===!0?`Итоговый скор ${ut} ≥ порога ${ge}.`:"Тестирование завершено без необходимости ручной проверки."))}}catch(nn){const ze=nn instanceof Error?nn.message:"Неизвестная ошибка тестирования";Z(`Ошибка тестирования: ${ze}`),f(F.id,"failed",ze),Oe("error","Тестирование завершилось с ошибкой")}finally{U.current=null,W(!1)}},[Z,E,nt,lr,C,k.baseModelPath,k.baseModelServerUrl,k.deviceType,k.fineTunedModelPath,k.maxTokens,k.remoteApiKey,k.remoteApiUrl,k.remoteModelId,k.quantization,k.temperature,k.topP,I,us,h,f,Oe,w]),Bs=z.useCallback(async()=>{if(!L.datasetId||!R)return;let F=L.scoringMode;L.scoringMode==="llm"&&!I&&(Z("Удалённая модель не настроена. Переключаемся на ручную проверку."),F="human",$(Je=>({...Je,scoringMode:"human",requireHumanReview:!0})));const he=F==="human"?!0:L.requireHumanReview,_e={datasetId:L.datasetId,datasetName:R.name,modelVariant:L.modelVariant,scoringMode:F,sampleSize:L.sampleSize??void 0,shuffle:!0,qualityGateThreshold:E,requireHumanReview:he},Le=d({datasetId:L.datasetId,name:`Тест ${new Date().toLocaleString()}`,config:_e,sampleSize:L.sampleSize,domainFilter:L.domains,difficultyFilter:L.difficulties,tagFilter:L.tags,baselineRunId:L.baselineRunId});if(!Le){Z("Не удалось создать прогон тестирования. Проверьте настройки.");return}o(Le.id),f(Le.id,"running"),hs(Le)},[L,R,d,Z,o,f,hs,I]),ho=z.useCallback(()=>{var F;(F=U.current)==null||F.abort()},[]),cr=z.useCallback(F=>{D(F),l({qualityGate:F})},[l]);z.useEffect(()=>{if(!i.autoAssignBaseline||L.baselineRunId)return;const F=n.filter(he=>he.id!==(t==null?void 0:t.id)&&he.config.datasetId===L.datasetId).sort((he,_e)=>(_e.completedAt??0)-(he.completedAt??0));F.length>0&&$(he=>({...he,baselineRunId:F[0].id}))},[i.autoAssignBaseline,n,L.datasetId,L.baselineRunId,t==null?void 0:t.id]);const mt=(t==null?void 0:t.metrics.qualityGateThreshold)??E,Ye=(t==null?void 0:t.metrics.qualityGatePassed)??null,_t=Ye===null?"Нет данных":Ye?"Пройден":"Не пройден",Ct=Ye===null?"text-slate-400":Ye?"text-emerald-300":"text-rose-300",Dr=Yl((t==null?void 0:t.metrics.overallScore)??null,mt),Ss=z.useMemo(()=>n.find(F=>F.id===L.baselineRunId)??null,[n,L.baselineRunId]),Wl=z.useMemo(()=>{if(!t)return{domains:[],tags:[],difficulties:[],hotspots:[],recommendations:[]};const F=ge=>Math.round(ge*1e3)/1e3,he=typeof mt=="number"&&!Number.isNaN(mt)?mt:.7,_e=Ss?new Map(Ss.metrics.domainSummaries.map(ge=>[ge.domain,ge])):new Map,Le=t.metrics.domainSummaries.reduce((ge,je)=>ge+je.total,0),Je=t.metrics.domainSummaries.map((ge,je)=>{const Ie=ge.total>0?ge.scored/ge.total:0,Qe=_e.get(ge.domain),De=(Qe==null?void 0:Qe.averageScore)??null,xt=ge.averageScore!=null&&De!=null?F(ge.averageScore-De):null,Ot=Yl(ge.averageScore??null,he),bn=Ot==="good"?"bg-emerald-400":Ot==="warn"?"bg-amber-400":"bg-rose-400",Fr=Le>0?ge.total/Le:0,ql=lw[je%lw.length];return{...ge,coverageShare:Ie,delta:xt,toneClass:bn,share:Fr,color:ql}}).sort((ge,je)=>{const Ie=ge.averageScore??-1,Qe=je.averageScore??-1;return Ie-Qe}),Gt=new Map,As=ge=>{const je=new Map;return ge&&ge.items.forEach(Ie=>{const Qe=Ie.difficulty??"unknown",De=je.get(Qe)??{total:0,scored:0,needsReview:0,scoreSum:0,scoreCount:0};De.total+=1,(Ie.status==="scored"||Ie.status==="reviewed")&&(De.scored+=1),Ie.status==="needs_review"&&(De.needsReview+=1);const xt=Eg(Ie);typeof xt=="number"&&(De.scoreSum+=xt,De.scoreCount+=1),je.set(Qe,De)}),je};t.items.forEach(ge=>{const je=Eg(ge),Ie=ge.status==="scored"||ge.status==="reviewed";(ge.tags??[]).forEach(De=>{const xt=De.trim();if(!xt)return;const Ot=Gt.get(xt)??{tag:xt,total:0,scored:0,needsReview:0,scoreSum:0,scoreCount:0};Ot.total+=1,Ie&&(Ot.scored+=1),ge.status==="needs_review"&&(Ot.needsReview+=1),typeof je=="number"&&(Ot.scoreSum+=je,Ot.scoreCount+=1),Gt.set(xt,Ot)})});const xn=Array.from(Gt.values()).map(({tag:ge,total:je,scored:Ie,needsReview:Qe,scoreSum:De,scoreCount:xt})=>{const Ot=je>0?Ie/je:0,bn=xt>0?F(De/xt):null,Fr=Yl(bn,he);return{tag:ge,total:je,scored:Ie,needsReview:Qe,coverageShare:Ot,averageScore:bn,toneClass:Fr==="good"?"text-emerald-300":Fr==="warn"?"text-amber-300":"text-rose-300"}}).sort((ge,je)=>{const Ie=ge.averageScore??-1,Qe=je.averageScore??-1;return Ie===Qe?je.total-ge.total:Ie-Qe}),Es=As(t),sn=As(Ss),fs=Array.from(new Set([...Es.keys(),...sn.keys()])).map(ge=>{const je=Es.get(ge)??{total:0,scored:0,needsReview:0,scoreSum:0,scoreCount:0},Ie=sn.get(ge)??{total:0,scored:0,needsReview:0,scoreSum:0,scoreCount:0},Qe=je.scoreCount>0?F(je.scoreSum/je.scoreCount):null,De=Ie.scoreCount>0?F(Ie.scoreSum/Ie.scoreCount):null,xt=Qe!==null&&De!==null?F(Qe-De):null,Ot=Yl(Qe,he),bn=Ot==="good"?"text-emerald-300":Ot==="warn"?"text-amber-300":"text-rose-300";return{difficulty:ge,total:je.total,scored:je.scored,needsReview:je.needsReview,averageScore:Qe,baselineScore:De,delta:xt,toneClass:bn}}).sort((ge,je)=>{const Ie=["hard","medium","easy","unknown"],Qe=Ie.indexOf(ge.difficulty),De=Ie.indexOf(je.difficulty);return(Qe===-1?Ie.length:Qe)-(De===-1?Ie.length:De)}),ze=t.items.map(ge=>({item:ge,aggregateScore:Eg(ge)})).filter(({item:ge,aggregateScore:je})=>ge.status==="needs_review"?!0:je===null?!1:je<he*.95).sort((ge,je)=>{const Ie=ge.aggregateScore??2,Qe=je.aggregateScore??2;return Ie-Qe}).slice(0,8).map(({item:ge,aggregateScore:je})=>{const Ie=Yl(je,he),Qe=Ie==="good"?"text-emerald-300":Ie==="warn"?"text-amber-300":"text-rose-300";return{id:ge.id,question:$P(ge.question),domain:ge.domain,tags:ge.tags??[],difficulty:ge.difficulty??"unknown",score:je,status:ge.status,needsReview:ge.status==="needs_review",reviewNotes:ge.reviewNotes??null,toneClass:Qe}}),rt=new Map,ps=(ge,je)=>{const Ie=rt.get(ge)??{key:ge,label:je,count:0};Ie.count+=1,rt.set(ge,Ie)};ze.forEach(ge=>{ps(`domain:${ge.domain}`,`Добавить QA по домену «${ge.domain}»`),ge.tags.forEach(je=>{ps(`tag:${je}`,`Расширить примеры с тегом «${je}»`)}),ps(`difficulty:${ge.difficulty}`,`Укрепить задания уровня «${Ag[ge.difficulty]}»`)});const ut=Array.from(rt.values()).sort((ge,je)=>je.count-ge.count).slice(0,6);return{domains:Je,tags:xn,difficulties:fs,hotspots:ze,recommendations:ut}},[t,Ss,mt]),{domains:ui,tags:oa,difficulties:fo,hotspots:B,recommendations:ie}=Wl,me=z.useCallback((F,he)=>{p(F.runId,F.itemId,{status:he?"approved":"rejected",reviewer:i.defaultReviewer??"analyst",scoreOverride:void 0}),Z(`Ответ ${he?"одобрен":"отклонён"} вручную.`)},[p,i.defaultReviewer,Z]),we=z.useCallback(()=>{if(!t)return;const F={id:t.id,name:t.name,createdAt:t.createdAt,metrics:t.metrics,items:t.items},he=new Blob([JSON.stringify(F,null,2)],{type:"application/json"}),_e=URL.createObjectURL(he),Le=document.createElement("a");Le.href=_e,Le.download=`${t.name.replace(/[^a-zA-Z0-9-_]+/g,"_")||"evaluation"}-results.json`,Le.click(),URL.revokeObjectURL(_e)},[t]),Ve=z.useCallback(async()=>{var hi,fs,ss,nn;if(!t){Z("Нет активного прогона для отправки в Agregator.");return}const F=se.aggregatorUrl.trim();if(!F){Z("URL сервиса Agregator не задан. Откройте раздел автообучения и укажите адрес."),A("Не задан URL Agregator");return}const he=k.baseModelPath.trim(),_e=k.baseModelServerUrl.trim();if(se.autoLaunchFineTune&&(!he||!_e)){Z("Для запуска дообучения укажите путь к базовой модели и URL сервера модели во вкладке «Настройки»."),A("Не заданы параметры базовой модели или сервера");return}Re(!0),Ht(null),A(null),Z("Передаём проблемные вопросы в Agregator…");const Le=t.items.map(ze=>({question:ze.question,referenceAnswer:ze.referenceAnswer,modelAnswer:ze.modelAnswer??"",autoScore:ze.autoScore??null,humanScore:ze.humanScore??null,remoteScore:ze.remoteScore??null,status:ze.status,reviewStatus:ze.reviewStatus,domain:ze.domain,difficulty:ze.difficulty??null,tags:ze.tags??[],datasetItemId:ze.datasetItemId})),Je={id:t.id,name:t.name,created_at:t.createdAt,metrics:t.metrics,quality_gate:t.metrics.qualityGateThreshold??mt??null,items:Le},Gt=se.scoreThreshold??mt??null,As={pairs_per_snippet:Math.max(1,se.pairsPerSnippet),include_reference_pair:se.includeReferencePair,min_paragraph_chars:Math.max(40,se.minParagraphChars),max_paragraph_chars:Math.max(se.minParagraphChars,se.maxParagraphChars),max_segments:Math.max(1,se.maxSegments)},xn={top_k:Math.max(1,se.topK),deep_search:se.deepSearch,max_candidates:Math.max(5,se.maxCandidates),max_snippets:Math.max(1,se.maxSnippets),chunk_chars:Math.max(500,se.chunkChars),max_chunks:Math.max(1,se.maxChunks),max_segments:Math.max(1,se.maxSegments)},Es={evaluation:Je,score_threshold:Gt,target_pairs:Math.max(1,se.targetPairs),generation:As,search:xn,dry_run:se.pipelineDryRun,include_dataset:se.includeDatasetPreview};if(se.autoLaunchFineTune&&he&&_e){const ze=V.targetModules?V.targetModules.split(",").map(ps=>ps.trim()).filter(Boolean):void 0,rt={server_url:_e,base_model_path:he,output_dir:V.outputDir.trim()||void 0,include_previous_dataset:se.includePreviousDataset,previous_fine_tune_path:se.previousFineTunePath.trim()||void 0,deduplicate:se.deduplicate,min_examples:Math.max(1,se.minExamples),timeout:Math.max(60,se.fineTuneTimeout),config:{method:V.method,quantization:V.quantization,lora_rank:V.loraRank,lora_alpha:V.loraAlpha,learning_rate:V.learningRate,batch_size:V.batchSize,epochs:V.epochs,max_length:V.maxLength,warmup_steps:V.warmupSteps,target_modules:ze&&ze.length>0?ze:void 0,initial_adapter_path:((hi=V.initialAdapterPath)==null?void 0:hi.trim())||void 0}};Es.fine_tune=rt}const sn=se.authToken.trim()?{[se.authHeader.trim()||"Authorization"]:se.authToken.trim()}:void 0;try{const ze=await MP(Es,{baseUrl:F,headers:sn,timeout:Math.max(6e4,se.fineTuneTimeout*1e3),credentials:se.authToken.trim()?"omit":"include"}),rt=ze.dataset_size??0,ps=((fs=ze.logs)==null?void 0:fs.length)??0;Z(`Agregator: сформировано ${rt} QA-пар (логов: ${ps}).`),(ss=ze.fine_tune_job)!=null&&ss.id&&Z(`Agregator: запущено дообучение (задача ${ze.fine_tune_job.id}).`);const ut=Array.isArray(ze.dataset)?ze.dataset:Array.isArray(ze.dataset_preview_full)?ze.dataset_preview_full:[];if(se.pipelineDryRun)ut.length>0&&Z("Agregator: dry-run — датасет не импортирован во вкладку «Датасеты», доступен только в ответе.");else if(ut.length>0){const ge=new Set;for(const Ie of fe){const Qe=`${Ie.input.trim()}${Ie.output.trim()}`;ge.add(Qe)}const je=ut.reduce((Ie,Qe)=>{if(!Qe||typeof Qe!="object")return Ie;const De=Qe,xt=typeof De.input=="string"?De.input.trim():"",Ot=typeof De.output=="string"?De.output.trim():"";if(!xt||!Ot)return Ie;const bn=`${xt}${Ot}`;if(ge.has(bn))return Ie;ge.add(bn);const Fr=De.source,ql=typeof Fr=="string"&&Fr.trim()?Fr.trim():void 0;return Ie.push({id:OP(),input:xt,output:Ot,source:ql}),Ie},[]);je.length>0&&(ee(je),Z(`Agregator: ${je.length} новых примеров добавлены во вкладку «Датасеты».`))}else rt>0&&!se.includeDatasetPreview&&Z("Agregator: датасет не загружен в интерфейс — включите опцию «Вернуть полный датасет», чтобы увидеть его на вкладке «Датасеты».");Ht(`QA-пар: ${rt}${(nn=ze.fine_tune_job)!=null&&nn.id?` • задача ${ze.fine_tune_job.id}`:""}`),A(null)}catch(ze){const rt=ze instanceof Error?ze.message:String(ze??"Неизвестная ошибка");Z(`Agregator: ошибка — ${rt}`),A(rt),Ht(null)}finally{Re(!1)}},[t,Z,ee,se,mt,k.baseModelPath,k.baseModelServerUrl,V,fe]);return M?u.jsxs("div",{className:"flex h-full flex-col gap-4 overflow-y-auto p-4",children:[u.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(y1,{className:"h-5 w-5 text-sky-400"}),u.jsxs("div",{className:"flex flex-col text-xs text-slate-500 dark:text-slate-300",children:[u.jsx("span",{className:"text-sm font-semibold text-slate-700 dark:text-slate-100",children:R?R.name:"Датасет не выбран"}),t&&u.jsxs("span",{children:["Прогон: ",t.name]})]})]}),u.jsxs("button",{type:"button",onClick:()=>l({compactMode:!1}),className:"inline-flex items-center gap-1 rounded-lg border border-emerald-500/60 bg-emerald-500/15 px-2 py-1 text-xs text-emerald-200 hover:border-emerald-400 hover:text-emerald-100",children:[u.jsx(og,{className:"h-3 w-3"})," Обычный вид"]})]}),t?u.jsx("section",{className:"rounded-2xl border border-slate-200 bg-white/90 p-4 shadow-sm shadow-slate-900/20 dark:border-slate-800 dark:bg-slate-900/70 dark:shadow-none",children:u.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs sm:grid-cols-3",children:[u.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white/90 p-3 dark:border-slate-800 dark:bg-slate-900/70",children:[u.jsx("p",{className:"text-[11px] text-slate-500",children:"Итоговый скор"}),u.jsx("p",{className:`mt-1 text-lg font-semibold ${ow[Yl(t.metrics.overallScore??null,E)]}`,children:Hs(t.metrics.overallScore,3)})]}),u.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white/90 p-3 dark:border-slate-800 dark:bg-slate-900/70",children:[u.jsx("p",{className:"text-[11px] text-slate-500",children:"Покрытие"}),u.jsx("p",{className:"mt-1 text-lg font-semibold text-sky-300",children:Kl(t.metrics.coverage)})]}),u.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white/90 p-3 dark:border-slate-800 dark:bg-slate-900/70",children:[u.jsx("p",{className:"text-[11px] text-slate-500",children:"Ручные оценки"}),u.jsx("p",{className:"mt-1 text-lg font-semibold text-amber-300",children:Kl(t.metrics.humanApprovalRate)})]})]})}):u.jsx("section",{className:"rounded-2xl border border-dashed border-slate-300 bg-white/80 p-6 text-center text-sm text-slate-500 dark:border-slate-700 dark:bg-slate-900/40",children:"Запустите прогон, чтобы увидеть метрики."}),u.jsx(z.Suspense,{fallback:u.jsx("section",{className:"rounded-2xl border border-slate-200 bg-white/90 p-4 shadow-sm shadow-slate-900/20 dark:border-slate-800 dark:bg-slate-900/70 dark:shadow-none",children:u.jsx("div",{className:"h-40 animate-pulse rounded-2xl bg-slate-200/60 dark:bg-slate-700/40"})}),children:u.jsx(cw,{activeRun:t,domains:ui,tags:oa,difficulties:fo,hotspots:B,recommendations:ie,compact:!0,formatScore:Hs,formatPercent:Kl,difficultyLabels:Ag})})]}):u.jsxs("div",{className:"flex h-full flex-col gap-4 overflow-y-auto p-4",children:[u.jsxs("div",{className:"grid grid-cols-1 gap-4 xl:grid-cols-3",children:[u.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white/90 p-4 shadow-sm shadow-slate-900/20 dark:border-slate-800 dark:bg-slate-900/60 dark:shadow-none",children:[u.jsxs("header",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(y1,{className:"h-5 w-5 text-sky-400"}),u.jsx("h2",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200",children:"Эталонный датасет"})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsxs("button",{type:"button",onClick:()=>l({compactMode:!0}),className:"inline-flex items-center gap-1 rounded-lg border border-slate-300 bg-white px-2 py-1 text-xs text-slate-600 hover:border-emerald-400 hover:text-emerald-600 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-300 dark:hover:text-emerald-200",children:[u.jsx(og,{className:"h-3 w-3"})," Компактно"]}),u.jsxs("button",{type:"button",onClick:Ft,className:"rounded-lg border border-slate-700 bg-slate-800 px-2 py-1 text-xs text-slate-500 dark:text-slate-300 hover:border-slate-500 hover:text-white",children:[u.jsx(Nm,{className:"mr-1 inline h-3 w-3"}),"Экспорт"]}),u.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-lg border border-slate-700 bg-slate-800 px-2 py-1 text-xs text-slate-500 dark:text-slate-300 hover:border-slate-500 hover:text-white",children:[u.jsx("input",{type:"file",accept:"application/json",className:"hidden",onChange:$s}),u.jsx(v1,{className:"h-3 w-3"}),"Импорт"]}),u.jsx("button",{type:"button",onClick:b,className:"rounded-lg border border-rose-400 bg-rose-100 px-2 py-1 text-xs text-rose-600 hover:border-rose-500 hover:text-rose-700 dark:border-rose-500/50 dark:bg-rose-500/10 dark:text-rose-300",children:"Сброс"})]})]}),u.jsxs("div",{className:"mt-3 space-y-3 text-xs text-slate-500 dark:text-slate-300",children:[u.jsxs("div",{children:[u.jsx("label",{className:"text-[11px] uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"Датасет"}),u.jsx("select",{value:L.datasetId??"",onChange:F=>xe("datasetId",F.target.value||null),className:"mt-1 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-sky-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100",children:s.map(F=>u.jsxs("option",{value:F.id,children:[F.name," (",F.items.length,")"]},F.id))}),oe&&u.jsx("p",{className:"mt-1 text-[11px] text-rose-300",children:oe})]}),u.jsxs("div",{className:"flex flex-wrap gap-3 text-[11px] text-slate-500 dark:text-slate-400",children:[u.jsxs("span",{className:"rounded-full border border-slate-300 bg-white px-2 py-1 dark:border-slate-700 dark:bg-slate-800",children:["Всего: ",(R==null?void 0:R.items.length)??0]}),u.jsxs("span",{className:"rounded-full border border-slate-300 bg-white px-2 py-1 flex items-center gap-1 dark:border-slate-700 dark:bg-slate-800",children:[u.jsx(vx,{className:"h-3 w-3"}),"Фильтр: ",te.length]}),u.jsxs("span",{className:"rounded-full border border-slate-300 bg-white px-2 py-1 flex items-center gap-1 dark:border-slate-700 dark:bg-slate-800",children:[u.jsx(b1,{className:"h-3 w-3"}),"Домены: ",q.length]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx("p",{className:"text-[11px] uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"Домены"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:q.map(F=>{const he=L.domains.includes(F);return u.jsx("button",{type:"button",onClick:()=>be("domains",F),className:`rounded-full border px-3 py-1 text-[11px] transition ${he?"border-sky-400 bg-sky-100 text-sky-700 dark:border-sky-500 dark:bg-sky-500/20 dark:text-sky-100":"border-slate-300 bg-white text-slate-600 hover:border-slate-400 hover:text-slate-800 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-300 dark:hover:text-slate-100"}`,children:F},F)})})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx("p",{className:"text-[11px] uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"Сложность"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:ae.map(F=>{const he=L.difficulties.includes(F);return u.jsx("button",{type:"button",onClick:()=>be("difficulties",F),className:`rounded-full border px-3 py-1 text-[11px] transition ${he?"border-amber-400 bg-amber-100 text-amber-700 dark:border-amber-500 dark:bg-amber-500/20 dark:text-amber-100":"border-slate-300 bg-white text-slate-600 hover:border-slate-400 hover:text-slate-800 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-300 dark:hover:text-slate-100"}`,children:F},F)})})]}),de.length>0&&u.jsxs("div",{className:"space-y-2",children:[u.jsx("p",{className:"text-[11px] uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"Теги"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:de.map(F=>{const he=L.tags.includes(F);return u.jsx("button",{type:"button",onClick:()=>be("tags",F),className:`rounded-full border px-3 py-1 text-[11px] transition ${he?"border-emerald-400 bg-emerald-100 text-emerald-700 dark:border-emerald-500 dark:bg-emerald-500/20 dark:text-emerald-100":"border-slate-300 bg-white text-slate-600 hover:border-slate-400 hover:text-slate-800 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-300 dark:hover:text-slate-100"}`,children:F},F)})})]})]}),u.jsx("footer",{className:"mt-4 border-t border-slate-200 pt-3 text-xs text-slate-500 dark:border-slate-800 dark:text-slate-400",children:u.jsxs("p",{children:["Распределение: ",G.map(F=>`${F.domain} (${F.total})`).join(", ")]})})]}),u.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white/90 p-4 shadow-sm shadow-slate-900/20 dark:border-slate-800 dark:bg-slate-900/60 dark:shadow-none xl:col-span-2",children:[u.jsxs("header",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(Tm,{className:"h-5 w-5 text-emerald-400"}),u.jsx("h2",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200",children:"Планировщик прогона"})]}),u.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400",children:[u.jsx(lg,{className:"h-3.5 w-3.5"})," Критерий качества: ",Hs(E,2),u.jsx("input",{type:"range",min:.4,max:.95,step:.01,value:E,onChange:F=>cr(Number(F.target.value)),className:"ml-2 w-32"})]})]}),u.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 md:grid-cols-2",children:[u.jsxs("div",{children:[u.jsx("label",{className:"text-[11px] uppercase tracking-wide text-slate-500",children:"Вариант модели"}),u.jsxs("select",{value:L.modelVariant,onChange:F=>xe("modelVariant",F.target.value),className:"mt-1 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-emerald-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100",children:[u.jsx("option",{value:"base",children:"Базовая модель"}),u.jsx("option",{value:"fine_tuned",disabled:!k.fineTunedModelPath,children:"Дообученная модель"}),u.jsx("option",{value:"remote",children:"Удалённый API"})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"text-[11px] uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"Режим скоринга"}),u.jsxs("select",{value:L.scoringMode,onChange:F=>xe("scoringMode",F.target.value),className:"mt-1 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-emerald-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100",children:[u.jsx("option",{value:"auto",children:"Только локальные метрики"}),u.jsx("option",{value:"llm",disabled:!I,children:"Оценка удалённой моделью"}),u.jsx("option",{value:"human",children:"Только ручная проверка"})]}),!I&&L.scoringMode==="llm"&&u.jsx("p",{className:"mt-1 text-[11px] text-rose-400",children:"Укажите настройки удалённой модели в разделе «Настройки», чтобы использовать автоматическую проверку."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"text-[11px] uppercase tracking-wide text-slate-500",children:"Размер выборки"}),u.jsx("input",{type:"number",min:1,max:te.length,value:L.sampleSize??"",onChange:F=>xe("sampleSize",F.target.value?Number(F.target.value):null),placeholder:`до ${te.length}`,className:"mt-1 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-emerald-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("input",{id:"require-human-review",type:"checkbox",checked:L.requireHumanReview,onChange:F=>xe("requireHumanReview",F.target.checked),disabled:L.scoringMode==="human",className:"h-4 w-4 rounded border border-slate-300 bg-white text-emerald-500 focus:ring-emerald-500 disabled:opacity-60 dark:border-slate-700 dark:bg-slate-900"}),u.jsx("label",{htmlFor:"require-human-review",className:"text-xs text-slate-500 dark:text-slate-300",children:"Требовать ручную проверку независимо от авто-скора"})]}),u.jsxs("div",{className:"md:col-span-2",children:[u.jsx("label",{className:"text-[11px] uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"Базовый прогон для сравнения"}),u.jsxs("select",{value:L.baselineRunId??"",onChange:F=>{const he=F.target.value||null;xe("baselineRunId",he),t&&g(t.id,he)},className:"mt-1 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-emerald-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100",children:[u.jsx("option",{value:"",children:"Без сравнения"}),ue.filter(F=>F.id!==(t==null?void 0:t.id)).map(F=>u.jsxs("option",{value:F.id,children:[F.name," — ",Hs(F.metrics.overallScore,2)]},F.id))]})]})]}),u.jsxs("footer",{className:"mt-4 flex flex-wrap items-center gap-3",children:[u.jsxs("button",{type:"button",onClick:Bs,disabled:J||te.length===0,className:"inline-flex items-center gap-2 rounded-xl border border-emerald-500 bg-emerald-500/15 px-4 py-2 text-sm font-medium text-emerald-200 hover:border-emerald-400 hover:text-emerald-100 disabled:cursor-not-allowed disabled:border-slate-700 disabled:bg-slate-800 disabled:text-slate-500",children:[u.jsx(Ju,{className:"h-4 w-4"}),"Запустить тестирование"]}),u.jsxs("button",{type:"button",onClick:ho,disabled:!J,className:"inline-flex items-center gap-2 rounded-xl border border-rose-500 bg-rose-500/15 px-4 py-2 text-sm font-medium text-rose-200 hover:border-rose-400 hover:text-rose-100 disabled:cursor-not-allowed disabled:border-slate-700 disabled:bg-slate-800 disabled:text-slate-500",children:[u.jsx(By,{className:"h-4 w-4"}),"Остановить"]}),u.jsxs("button",{type:"button",onClick:re,className:"inline-flex items-center gap-2 rounded-xl border border-slate-300 bg-white px-4 py-2 text-sm text-slate-600 hover:border-slate-400 hover:text-slate-800 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-300",children:[u.jsx(v1,{className:"h-4 w-4"}),"Сбросить фильтры"]}),u.jsxs("span",{className:"ml-auto text-xs text-slate-400",children:["Выбрано ",te.length," примеров"]})]})]})]}),u.jsxs("div",{className:"grid flex-1 grid-cols-1 gap-4 xl:grid-cols-2",children:[u.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white/90 p-4 shadow-sm shadow-slate-900/20 dark:border-slate-800 dark:bg-slate-900/70 dark:shadow-none",children:[u.jsxs("header",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(lg,{className:"h-5 w-5 text-emerald-400"}),u.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200",children:"Итоговые метрики"})]}),t&&u.jsxs("button",{type:"button",onClick:we,className:"rounded-lg border border-slate-700 bg-slate-800 px-2 py-1 text-xs text-slate-500 dark:text-slate-300 hover:border-slate-500 hover:text-slate-100",children:[u.jsx(Nm,{className:"mr-1 inline h-3 w-3"}),"JSON"]})]}),t?u.jsxs("div",{className:"mt-3 space-y-3",children:[u.jsxs("div",{className:"grid grid-cols-1 gap-2 text-xs sm:grid-cols-2",children:[u.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white/90 dark:bg-slate-900/70 p-3",children:[u.jsx("p",{className:"text-[11px] text-slate-500",children:"Итоговый скор"}),u.jsx("p",{className:`mt-1 text-lg font-semibold ${ow[Dr]}`,children:Hs(t.metrics.overallScore,3)}),u.jsxs("p",{className:"text-[11px] text-slate-500",children:["Порог: ",Hs(mt,2)]}),u.jsxs("p",{className:`text-[11px] font-medium ${Ct}`,children:["Критерий: ",_t]})]}),u.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white/90 dark:bg-slate-900/70 p-3",children:[u.jsx("p",{className:"text-[11px] text-slate-500",children:"Покрытие"}),u.jsx("p",{className:"mt-1 text-lg font-semibold text-sky-300",children:Kl(t.metrics.coverage)}),u.jsxs("p",{className:"text-[11px] text-slate-500",children:["Оценено: ",t.metrics.scored,"/",t.metrics.total]})]}),u.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white/90 dark:bg-slate-900/70 p-3",children:[u.jsx("p",{className:"text-[11px] text-slate-500",children:"Авто-скор"}),u.jsx("p",{className:"mt-1 text-lg font-semibold text-emerald-300",children:Hs(t.metrics.autoScoreAverage,3)}),u.jsx("p",{className:"text-[11px] text-slate-500",children:"Локальные метрики"})]}),u.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white/90 dark:bg-slate-900/70 p-3",children:[u.jsx("p",{className:"text-[11px] text-slate-500",children:"Ручные оценки"}),u.jsx("p",{className:"mt-1 text-lg font-semibold text-amber-300",children:Kl(t.metrics.humanApprovalRate)}),u.jsxs("p",{className:"text-[11px] text-slate-500",children:["Отклонения: ",t.metrics.needsReview]})]}),u.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white/90 dark:bg-slate-900/70 p-3",children:[u.jsx("p",{className:"text-[11px] text-slate-500",children:"Время ответа"}),u.jsx("p",{className:"mt-1 text-lg font-semibold text-sky-300",children:dw(t.metrics.averageLatencySeconds)}),u.jsxs("p",{className:"text-[11px] text-slate-500",children:["P95: ",dw(t.metrics.latencyP95Seconds)]})]}),u.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white/90 dark:bg-slate-900/70 p-3",children:[u.jsx("p",{className:"text-[11px] text-slate-500",children:"Токены"}),u.jsx("p",{className:"mt-1 text-lg font-semibold text-violet-300",children:uw(t.metrics.averageTokensPerResponse,"ток./ответ")}),u.jsxs("p",{className:"text-[11px] text-slate-500",children:["Скорость: ",uw(t.metrics.tokensPerSecond,"ток./с")]})]})]}),Ss&&u.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white/90 dark:bg-slate-900/70 p-3 text-xs text-slate-500 dark:text-slate-300",children:[u.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-slate-500",children:[u.jsx(aC,{className:"h-3.5 w-3.5 text-emerald-400"}),"Сравнение с базовым прогоном"]}),u.jsxs("p",{className:"mt-2 text-sm text-slate-600 dark:text-slate-200",children:["Δ общий скор: ",Hs(t.metrics.scoreDelta,3)," (база: ",Hs(t.metrics.baselineScore,3),")"]}),u.jsx("p",{className:"text-[11px] text-slate-500",children:Ss.name})]}),u.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white/90 dark:bg-slate-900/70 p-3 text-xs text-slate-500 dark:border-slate-800 dark:bg-slate-950/40 dark:text-slate-400",children:[u.jsx("p",{className:"text-[11px] uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"Доменные показатели"}),u.jsx("div",{className:"mt-2 space-y-2 max-h-60 overflow-y-auto pr-1",children:t.metrics.domainSummaries.map(F=>{const he=Ss==null?void 0:Ss.metrics.domainSummaries.find(Je=>Je.domain===F.domain),_e=(he==null?void 0:he.averageScore)!=null&&F.averageScore!=null?F.averageScore-he.averageScore:null,Le=_e==null?"text-slate-300":_e>=0?"text-emerald-300":"text-rose-300";return u.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2 text-slate-600 dark:border-slate-800 dark:bg-slate-900/80 dark:text-slate-200",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx("span",{children:F.domain}),u.jsx("span",{className:"text-sm font-semibold text-emerald-500 dark:text-emerald-200",children:Hs(F.averageScore,3)})]}),u.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-[11px] text-slate-500 dark:text-slate-400",children:[u.jsxs("span",{children:["Оценено: ",F.scored,"/",F.total]}),u.jsxs("span",{children:["Авто: ",Hs(F.autoScoreAverage,3)]}),u.jsx("span",{className:Le,children:_e!=null?`${_e>=0?"+":""}${_e.toFixed(3)}`:"—"})]})]},F.domain)})})]})]}):u.jsx("div",{className:"mt-6 rounded-xl border border-dashed border-slate-300 bg-white p-6 text-center text-sm text-slate-500 dark:border-slate-700 dark:bg-slate-900/40",children:"Запустите прогон тестирования, чтобы увидеть метрики."})]}),u.jsx(z.Suspense,{fallback:u.jsx("section",{className:"rounded-2xl border border-slate-200 bg-white/90 p-4 shadow-sm shadow-slate-900/20 dark:border-slate-800 dark:bg-slate-900/70 dark:shadow-none xl:col-span-2",children:u.jsx("div",{className:"h-40 animate-pulse rounded-2xl bg-slate-200/60 dark:bg-slate-700/40"})}),children:u.jsx(cw,{activeRun:t,domains:ui,tags:oa,difficulties:fo,hotspots:B,recommendations:ie,compact:!1,formatScore:Hs,formatPercent:Kl,difficultyLabels:Ag})}),u.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white/90 p-4 shadow-sm shadow-slate-900/20 dark:border-slate-800 dark:bg-slate-900/60 dark:shadow-none xl:col-span-2",children:[u.jsxs("header",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(Ru,{className:"h-5 w-5 text-sky-400"}),u.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200",children:"Очередь проверки"})]}),u.jsxs("span",{className:"rounded-full border border-slate-300 bg-white px-2 py-1 text-[11px] text-slate-500 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-300",children:["В очереди: ",r.length]})]}),u.jsxs("div",{className:"mt-3 space-y-3 overflow-y-auto pr-1 text-xs text-slate-500 dark:text-slate-300",style:{maxHeight:"320px"},children:[r.length===0&&u.jsx("div",{className:"rounded-xl border border-dashed border-slate-300 bg-white p-6 text-center text-slate-500 dark:border-slate-700 dark:bg-slate-900/50",children:"Нет ответов, требующих ручной проверки."}),r.map(F=>u.jsxs("article",{className:"rounded-xl border border-slate-200 bg-white p-3 text-slate-600 dark:border-slate-800 dark:bg-slate-950/40 dark:text-slate-200",children:[u.jsxs("header",{className:"flex items-center justify-between text-[11px] text-slate-500 dark:text-slate-400",children:[u.jsx("span",{children:F.domain}),u.jsx("span",{children:new Date(F.submittedAt).toLocaleTimeString()})]}),u.jsx("p",{className:"mt-2 text-sm font-medium text-slate-700 dark:text-slate-100",children:F.question}),u.jsxs("p",{className:"mt-2 whitespace-pre-wrap text-xs text-slate-500 dark:text-slate-400",children:[u.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Ответ модели:"})," ",F.modelAnswer??"—"]}),u.jsxs("p",{className:"mt-2 whitespace-pre-wrap text-xs text-emerald-600 dark:text-emerald-300",children:[u.jsx("span",{className:"text-emerald-600 dark:text-emerald-400",children:"Эталон:"})," ",F.referenceAnswer]}),u.jsxs("footer",{className:"mt-3 flex items-center gap-2",children:[u.jsxs("button",{type:"button",onClick:()=>me({runId:F.runId,itemId:F.itemId},!0),className:"inline-flex items-center gap-1 rounded-lg border border-emerald-500 bg-emerald-500/15 px-3 py-1 text-xs text-emerald-600 hover:border-emerald-400 hover:text-emerald-500 dark:text-emerald-200 dark:hover:text-emerald-100",children:[u.jsx(LN,{className:"h-3 w-3"}),"Одобрить"]}),u.jsxs("button",{type:"button",onClick:()=>me({runId:F.runId,itemId:F.itemId},!1),className:"inline-flex items-center gap-1 rounded-lg border border-rose-500 bg-rose-500/15 px-3 py-1 text-xs text-rose-600 hover:border-rose-400 hover:text-rose-500 dark:text-rose-200 dark:hover:text-rose-100",children:[u.jsx(_0,{className:"h-3 w-3"}),"Отклонить"]})]})]},`${F.runId}-${F.itemId}`))]})]}),u.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white/90 p-4 shadow-sm shadow-slate-900/20 dark:border-slate-800 dark:bg-slate-900/60 dark:shadow-none",children:[u.jsxs("header",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(b1,{className:"h-5 w-5 text-amber-400"}),u.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200",children:"Последние прогоны"})]}),u.jsx("button",{type:"button",onClick:y,className:"rounded-lg border border-slate-300 bg-white px-3 py-1 text-xs text-slate-600 hover:border-slate-400 hover:text-slate-800 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-300",children:"Очистить историю"})]}),u.jsxs("div",{className:"mt-3 space-y-2 overflow-y-auto pr-1 text-xs text-slate-500 dark:text-slate-300",style:{maxHeight:"320px"},children:[ue.length===0&&u.jsx("div",{className:"rounded-xl border border-dashed border-slate-300 bg-white p-6 text-center text-slate-500 dark:border-slate-700 dark:bg-slate-900/50",children:"История тестов появится после первого запуска."}),ue.map(F=>u.jsxs("div",{className:`cursor-pointer rounded-xl border px-3 py-2 transition ${F.id===(t==null?void 0:t.id)?"border-emerald-500 bg-emerald-500/10":"border-slate-200 bg-white hover:border-slate-400 dark:border-slate-800 dark:bg-slate-950/30 dark:hover:border-slate-600"}`,onClick:()=>o(F.id),role:"button",tabIndex:0,children:[u.jsxs("div",{className:"flex items-center justify-between text-slate-700 dark:text-slate-200",children:[u.jsx("span",{className:"text-sm font-medium",children:F.name}),u.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:new Date(F.updatedAt).toLocaleString()})]}),u.jsxs("div",{className:"mt-1 flex items-center gap-3 text-[11px] text-slate-500 dark:text-slate-400",children:[u.jsxs("span",{className:"flex items-center gap-1",children:[u.jsx(lg,{className:"h-3 w-3 text-emerald-400"}),Hs(F.metrics.overallScore,2)]}),u.jsxs("span",{className:"flex items-center gap-1",children:[u.jsx(Ru,{className:"h-3 w-3 text-sky-400"}),F.status]}),u.jsxs("span",{className:"flex items-center gap-1",children:[u.jsx(N2,{className:"h-3 w-3 text-amber-400"}),F.metrics.needsReview]})]})]},F.id))]})]})]}),u.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white/90 p-4 shadow-sm shadow-slate-900/20 dark:border-slate-800 dark:bg-slate-900/60 dark:shadow-none",children:[u.jsxs("header",{className:"flex flex-wrap items-center justify-between gap-3 text-sm font-semibold text-slate-700 dark:text-slate-200",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(Tm,{className:"h-5 w-5 text-emerald-400"}),u.jsx("span",{children:"Agregator: генерация датасета по проблемным вопросам"})]}),u.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-[11px] text-slate-500 dark:text-slate-400",children:[u.jsxs("span",{children:["URL: ",se.aggregatorUrl||"не задан"]}),u.jsxs("span",{children:["Цель: ",se.targetPairs]}),u.jsxs("span",{children:["Порог: ",se.scoreThreshold??mt??"—"]})]})]}),u.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-3",children:[u.jsxs("button",{type:"button",onClick:Ve,disabled:!t||ce,className:"inline-flex items-center gap-2 rounded-xl border border-emerald-500 bg-emerald-500/15 px-4 py-2 text-sm font-medium text-emerald-200 hover:border-emerald-400 hover:text-emerald-100 disabled:cursor-not-allowed disabled:border-slate-700 disabled:bg-slate-800 disabled:text-slate-500",children:[ce?u.jsx(Ru,{className:"h-4 w-4 animate-spin"}):u.jsx(Ju,{className:"h-4 w-4"}),ce?"Отправка…":"Сформировать датасет"]}),u.jsxs("button",{type:"button",onClick:()=>ne(F=>!F),className:"inline-flex items-center gap-2 rounded-xl border border-slate-300 bg-white px-3 py-2 text-xs text-slate-600 hover:border-slate-400 hover:text-slate-800 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-300",children:[le?u.jsx(og,{className:"h-3.5 w-3.5"}):u.jsx(vx,{className:"h-3.5 w-3.5"}),le?"Скрыть настройки":"Показать настройки"]}),Ge&&u.jsx("span",{className:"text-xs text-emerald-400",children:Ge}),pt&&u.jsx("span",{className:"text-xs text-rose-400",children:pt})]}),le&&u.jsxs("div",{className:"mt-4 grid gap-4 text-xs text-slate-600 dark:text-slate-300 md:grid-cols-2",children:[u.jsxs("label",{className:"flex flex-col gap-1",children:[u.jsx("span",{children:"URL Agregator"}),u.jsx("input",{type:"text",value:se.aggregatorUrl,onChange:F=>O({aggregatorUrl:F.target.value}),className:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-emerald-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"})]}),u.jsxs("label",{className:"flex flex-col gap-1",children:[u.jsx("span",{children:"Количество пар в датасете"}),u.jsx("input",{type:"number",min:1,value:se.targetPairs,onChange:F=>O({targetPairs:Math.max(1,Number(F.target.value)||at.targetPairs)}),className:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-emerald-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"})]}),u.jsxs("label",{className:"flex flex-col gap-1",children:[u.jsx("span",{children:"Порог проблемного скора"}),u.jsx("input",{type:"number",step:"0.05",value:se.scoreThreshold??"",onChange:F=>{const he=F.target.value;if(he===""){O({scoreThreshold:null});return}const _e=Number(he);O({scoreThreshold:Number.isFinite(_e)?_e:null})},placeholder:`${mt??.7}`,className:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-emerald-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"})]}),u.jsxs("label",{className:"flex flex-col gap-1",children:[u.jsx("span",{children:"Пар на сниппет"}),u.jsx("input",{type:"number",min:1,value:se.pairsPerSnippet,onChange:F=>O({pairsPerSnippet:Math.max(1,Number(F.target.value)||at.pairsPerSnippet)}),className:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-emerald-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"})]}),u.jsxs("label",{className:"flex flex-col gap-1",children:[u.jsx("span",{children:"Мин. длина абзаца"}),u.jsx("input",{type:"number",min:40,value:se.minParagraphChars,onChange:F=>O({minParagraphChars:Math.max(40,Number(F.target.value)||at.minParagraphChars)}),className:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-emerald-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"})]}),u.jsxs("label",{className:"flex flex-col gap-1",children:[u.jsx("span",{children:"Макс. длина абзаца"}),u.jsx("input",{type:"number",min:se.minParagraphChars,value:se.maxParagraphChars,onChange:F=>O({maxParagraphChars:Math.max(se.minParagraphChars,Number(F.target.value)||at.maxParagraphChars)}),className:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-emerald-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"})]}),u.jsxs("label",{className:"flex flex-col gap-1",children:[u.jsx("span",{children:"Top k поиска"}),u.jsx("input",{type:"number",min:1,value:se.topK,onChange:F=>O({topK:Math.max(1,Number(F.target.value)||at.topK)}),className:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-emerald-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"})]}),u.jsxs("label",{className:"flex flex-col gap-1",children:[u.jsx("span",{children:"Макс. кандидатов"}),u.jsx("input",{type:"number",min:5,value:se.maxCandidates,onChange:F=>O({maxCandidates:Math.max(5,Number(F.target.value)||at.maxCandidates)}),className:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-emerald-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"})]}),u.jsxs("label",{className:"flex flex-col gap-1",children:[u.jsx("span",{children:"Макс. сниппетов"}),u.jsx("input",{type:"number",min:1,value:se.maxSnippets,onChange:F=>O({maxSnippets:Math.max(1,Number(F.target.value)||at.maxSnippets)}),className:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-emerald-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"})]}),u.jsxs("label",{className:"flex flex-col gap-1",children:[u.jsx("span",{children:"Размер чанка (символов)"}),u.jsx("input",{type:"number",min:500,value:se.chunkChars,onChange:F=>O({chunkChars:Math.max(500,Number(F.target.value)||at.chunkChars)}),className:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-emerald-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"})]}),u.jsxs("label",{className:"flex flex-col gap-1",children:[u.jsx("span",{children:"Макс. чанков"}),u.jsx("input",{type:"number",min:1,value:se.maxChunks,onChange:F=>O({maxChunks:Math.max(1,Number(F.target.value)||at.maxChunks)}),className:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-emerald-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"})]}),u.jsxs("label",{className:"flex flex-col gap-1",children:[u.jsx("span",{children:"Таймаут дообучения (сек)"}),u.jsx("input",{type:"number",min:60,value:se.fineTuneTimeout,onChange:F=>O({fineTuneTimeout:Math.max(60,Number(F.target.value)||at.fineTuneTimeout)}),className:"rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-emerald-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"})]}),u.jsxs("div",{className:"flex flex-col gap-2 md:col-span-2",children:[u.jsx("span",{className:"text-[11px] uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"Дополнительно"}),u.jsxs("div",{className:"flex flex-wrap gap-3",children:[u.jsxs("label",{className:"inline-flex items-center gap-2",children:[u.jsx("input",{type:"checkbox",checked:se.includeReferencePair,onChange:F=>O({includeReferencePair:F.target.checked}),className:"h-4 w-4 rounded border border-slate-300 text-emerald-500 focus:ring-emerald-500 dark:border-slate-700 dark:bg-slate-900"}),u.jsx("span",{children:"Добавлять эталонные пары"})]}),u.jsxs("label",{className:"inline-flex items-center gap-2",children:[u.jsx("input",{type:"checkbox",checked:se.deepSearch,onChange:F=>O({deepSearch:F.target.checked}),className:"h-4 w-4 rounded border border-slate-300 text-emerald-500 focus:ring-emerald-500 dark:border-slate-700 dark:bg-slate-900"}),u.jsx("span",{children:"Глубокий поиск"})]}),u.jsxs("label",{className:"inline-flex items-center gap-2",children:[u.jsx("input",{type:"checkbox",checked:se.autoLaunchFineTune,onChange:F=>O({autoLaunchFineTune:F.target.checked}),className:"h-4 w-4 rounded border border-slate-300 text-emerald-500 focus:ring-emerald-500 dark:border-slate-700 dark:bg-slate-900"}),u.jsx("span",{children:"Запускать дообучение"})]}),u.jsxs("label",{className:"inline-flex items-center gap-2",children:[u.jsx("input",{type:"checkbox",checked:se.pipelineDryRun,onChange:F=>O({pipelineDryRun:F.target.checked}),className:"h-4 w-4 rounded border border-slate-300 text-emerald-500 focus:ring-emerald-500 dark:border-slate-700 dark:bg-slate-900"}),u.jsx("span",{children:"Только собрать датасет"})]}),u.jsxs("label",{className:"inline-flex items-center gap-2",children:[u.jsx("input",{type:"checkbox",checked:se.includeDatasetPreview,onChange:F=>O({includeDatasetPreview:F.target.checked}),className:"h-4 w-4 rounded border border-slate-300 text-emerald-500 focus:ring-emerald-500 dark:border-slate-700 dark:bg-slate-900"}),u.jsx("span",{children:"Вернуть полный датасет"})]})]})]})]})]}),u.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white/90 p-4 shadow-sm shadow-slate-900/20 dark:border-slate-800 dark:bg-slate-900/60 dark:shadow-none",children:[u.jsxs("header",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(HN,{className:"h-5 w-5 text-slate-300"}),u.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200",children:"Журнал"})]}),u.jsx("button",{type:"button",onClick:()=>H([]),className:"rounded-lg border border-slate-300 bg-white px-2 py-1 text-xs text-slate-600 hover:border-slate-400 hover:text-slate-800 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-300",children:"Очистить"})]}),u.jsxs("div",{className:"mt-3 max-h-40 overflow-y-auto rounded-xl border border-slate-200 bg-white p-3 text-[11px] text-slate-600 dark:border-slate-800 dark:bg-slate-950/40 dark:text-slate-400",children:[Q.length===0&&u.jsx("p",{className:"text-slate-500 dark:text-slate-500",children:"Журнал событий появится во время тестирования."}),Q.map(F=>u.jsx("div",{children:F},F))]})]}),u.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white/90 p-4 shadow-sm shadow-slate-900/20 dark:border-slate-800 dark:bg-slate-900/60 dark:shadow-none",children:[u.jsxs("header",{className:"flex items-center gap-2 text-sm font-semibold text-slate-700 dark:text-slate-200",children:[u.jsx(Cm,{className:"h-5 w-5 text-emerald-400"}),"Добавить новый пример"]}),u.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 md:grid-cols-2",children:[u.jsxs("div",{className:"md:col-span-2",children:[u.jsx("label",{className:"text-[11px] uppercase tracking-wide text-slate-500",children:"Вопрос"}),u.jsx("textarea",{value:_.question,onChange:F=>K(he=>({...he,question:F.target.value})),rows:2,className:"mt-1 w-full rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-100 focus:border-emerald-500 focus:outline-none"})]}),u.jsxs("div",{className:"md:col-span-2",children:[u.jsx("label",{className:"text-[11px] uppercase tracking-wide text-slate-500",children:"Эталонный ответ"}),u.jsx("textarea",{value:_.referenceAnswer,onChange:F=>K(he=>({...he,referenceAnswer:F.target.value})),rows:3,className:"mt-1 w-full rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-100 focus:border-emerald-500 focus:outline-none"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"text-[11px] uppercase tracking-wide text-slate-500",children:"Домен"}),u.jsx("input",{value:_.domain,onChange:F=>K(he=>({...he,domain:F.target.value})),className:"mt-1 w-full rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-100 focus:border-emerald-500 focus:outline-none"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"text-[11px] uppercase tracking-wide text-slate-500",children:"Сложность"}),u.jsxs("select",{value:_.difficulty,onChange:F=>K(he=>({...he,difficulty:F.target.value})),className:"mt-1 w-full rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-100 focus:border-emerald-500 focus:outline-none",children:[u.jsx("option",{value:"easy",children:"easy"}),u.jsx("option",{value:"medium",children:"medium"}),u.jsx("option",{value:"hard",children:"hard"})]})]}),u.jsxs("div",{className:"md:col-span-2",children:[u.jsx("label",{className:"text-[11px] uppercase tracking-wide text-slate-500",children:"Теги (через запятую)"}),u.jsx("input",{value:_.tags,onChange:F=>K(he=>({...he,tags:F.target.value})),className:"mt-1 w-full rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-100 focus:border-emerald-500 focus:outline-none"})]})]}),u.jsxs("footer",{className:"mt-4 flex items-center gap-2",children:[u.jsxs("button",{type:"button",onClick:Ze,className:"inline-flex items-center gap-2 rounded-xl border border-emerald-500 bg-emerald-500/15 px-4 py-2 text-sm font-medium text-emerald-200 hover:border-emerald-400 hover:text-emerald-100",children:[u.jsx(Cm,{className:"h-4 w-4"}),"Добавить пример"]}),u.jsx("span",{className:"text-xs text-slate-500",children:"Используйте новые примеры для расширения покрытия предметных областей."})]})]})]})},ZS="1.2.12",Gb=s=>s===null||Number.isNaN(s)?"—":`${Math.round(s)}%`,JS=(s,e)=>s===null||e===null||Number.isNaN(s)||Number.isNaN(e)?"—":`${s.toFixed(1)} / ${e.toFixed(1)} GB`,WP=(s,e,t)=>{const n=JS(s,e);if(n==="—")return n;const r=Gb(t);return r==="—"?n:`${n} (${r})`},qP=s=>s===null||Number.isNaN(s)?"—":`${Math.round(s)} мс`,XP=s=>{if(s===null||Number.isNaN(s))return"—";const e=s<1e12?s*1e3:s,t=new Date(e);if(Number.isNaN(t.getTime())||t.getFullYear()<2e3)return"—";const n=t.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit"}),r=t.toLocaleDateString(void 0,{day:"2-digit",month:"2-digit",year:"numeric"});return`${n} (${r})`},KP=({isOpen:s,onClose:e,systemStats:t})=>{const{settings:n}=aa(),{trainingHistory:r}=Ul();z.useEffect(()=>{if(!s)return;const l=d=>{d.key==="Escape"&&e()};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[s,e]);const i=z.useMemo(()=>{var d;if(typeof navigator>"u")return"Web Browser";const l=navigator;return((d=l.userAgentData)==null?void 0:d.platform)||l.platform||"Web Browser"},[]),a=z.useMemo(()=>{let l=0,d=0,h=0;return r.forEach(f=>{f.status==="completed"?l+=1:f.status==="failed"?d+=1:f.status==="running"&&(h+=1)}),{completed:l,failed:d,running:h,total:r.length}},[r]);if(!s)return null;const o={cpu:"CPU",cuda:"CUDA",mps:"MPS"};return u.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[u.jsx("div",{className:"absolute inset-0 bg-slate-950/70 backdrop-blur-sm",onClick:e,"aria-hidden":"true"}),u.jsxs("div",{role:"dialog","aria-modal":"true",className:"relative z-10 w-full max-w-5xl overflow-hidden rounded-3xl border border-slate-200 bg-white/95 shadow-2xl shadow-slate-900/40 backdrop-blur dark:border-slate-800 dark:bg-slate-900",children:[u.jsxs("header",{className:"flex items-start justify-between gap-4 border-b border-slate-200 px-6 py-4 dark:border-slate-800",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 dark:text-slate-500",children:"Сводка системы"}),u.jsx("h2",{className:"text-2xl font-semibold text-slate-900 dark:text-slate-100",children:"Текущая конфигурация"}),u.jsxs("p",{className:"mt-1 text-sm text-slate-500 dark:text-slate-400",children:["Данные обновлены ",XP(t.timestamp)]})]}),u.jsx("button",{type:"button",onClick:e,className:"flex h-9 w-9 items-center justify-center rounded-full border border-slate-200 text-slate-500 transition-colors hover:border-blue-500 hover:text-blue-500 dark:border-slate-700 dark:text-slate-400 dark:hover:text-slate-200","aria-label":"Закрыть системную информацию",children:u.jsx(_0,{className:"h-5 w-5"})})]}),t.message&&u.jsx("div",{className:"border-b border-amber-200 bg-amber-50/70 px-6 py-3 text-sm text-amber-700 dark:border-amber-500/40 dark:bg-amber-500/10 dark:text-amber-200",children:t.message}),u.jsxs("div",{className:"grid gap-6 px-6 py-6 lg:grid-cols-2",children:[u.jsxs("section",{className:"space-y-3 rounded-2xl border border-slate-200/70 bg-slate-50/80 p-5 text-sm text-slate-600 shadow-sm shadow-slate-900/5 dark:border-slate-800 dark:bg-slate-900/80 dark:text-slate-300",children:[u.jsx("h3",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400 dark:text-slate-500",children:"Среда"}),u.jsxs("dl",{className:"space-y-2",children:[u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"Платформа"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:i})]}),u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"Версия интерфейса"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:ZS})]}),u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"Тема"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:n.theme==="light"?"Светлая":"Тёмная"})]}),u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"Автосохранение"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:n.autoSave?"Да":"Нет"})]}),u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"Сервер"}),u.jsx("dd",{className:"max-w-[260px] text-right font-semibold text-slate-900 dark:text-slate-100 break-words",children:n.baseModelServerUrl||"Не указан"})]})]})]}),u.jsxs("section",{className:"space-y-3 rounded-2xl border border-slate-200/70 bg-slate-50/80 p-5 text-sm text-slate-600 shadow-sm shadow-slate-900/5 dark:border-slate-800 dark:bg-slate-900/80 dark:text-slate-300",children:[u.jsx("h3",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400 dark:text-slate-500",children:"Производительность"}),u.jsxs("dl",{className:"space-y-2",children:[u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"CPU (система)"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:Gb(t.cpuPercent??null)})]}),u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"CPU (приложение)"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:Gb(t.cpuProcessPercent??null)})]}),u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"RAM"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:WP(t.ramUsedGb??null,t.ramTotalGb??null,t.ramPercent??null)})]}),u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"Папка моделей"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:t.modelsDirGb!==null&&t.modelsDirGb!==void 0?`${t.modelsDirGb.toFixed(2)} GB`:"—"})]})]})]}),u.jsxs("section",{className:"space-y-3 rounded-2xl border border-slate-200/70 bg-slate-50/80 p-5 text-sm text-slate-600 shadow-sm shadow-slate-900/5 dark:border-slate-800 dark:bg-slate-900/80 dark:text-slate-300",children:[u.jsx("h3",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400 dark:text-slate-500",children:"Графика и задержки"}),u.jsxs("dl",{className:"space-y-2",children:[u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"GPU Backend"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:o[t.gpuBackend]})]}),u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"GPU"}),u.jsx("dd",{className:"max-w-[260px] text-right font-semibold text-slate-900 dark:text-slate-100 break-words",children:t.gpuName?t.gpuName:t.gpuBackend==="cpu"?"—":"Не определено"})]}),u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"GPU память"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:JS(t.gpuMemoryUsedGb??null,t.gpuMemoryTotalGb??null)})]}),u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"Задержка"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:qP(t.latencyMs)})]})]})]}),u.jsxs("section",{className:"space-y-3 rounded-2xl border border-slate-200/70 bg-slate-50/80 p-5 text-sm text-slate-600 shadow-sm shadow-slate-900/5 dark:border-slate-800 dark:bg-slate-900/80 dark:text-slate-300",children:[u.jsx("h3",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400 dark:text-slate-500",children:"Обучение моделей"}),u.jsxs("dl",{className:"space-y-2",children:[u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"Успешно"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:a.completed})]}),u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"С ошибкой"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:a.failed})]}),u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"В процессе"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:a.running})]}),u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"Всего"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:a.total})]})]})]}),u.jsxs("section",{className:"space-y-3 rounded-2xl border border-slate-200/70 bg-slate-50/80 p-5 text-sm text-slate-600 shadow-sm shadow-slate-900/5 dark:border-slate-800 dark:bg-slate-900/80 dark:text-slate-300 lg:col-span-2",children:[u.jsx("h3",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400 dark:text-slate-500",children:"Текущие настройки"}),u.jsxs("dl",{className:"grid gap-3 sm:grid-cols-2",children:[u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"Устройство"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:n.deviceType.toUpperCase()})]}),u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"Квантизация"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:n.quantization==="none"?"Отключена":n.quantization})]}),u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"Макс. токены"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:n.maxTokens})]}),u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"Макс. история"}),u.jsx("dd",{className:"text-right font-semibold text-slate-900 dark:text-slate-100",children:n.maxHistoryItems})]}),u.jsxs("div",{className:"flex justify-between gap-4 sm:col-span-2",children:[u.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:"Адаптер"}),u.jsx("dd",{className:"max-w-[420px] text-right font-semibold text-slate-900 dark:text-slate-100 break-words",children:n.fineTunedModelPath||"Не выбран"})]})]})]})]})]})]})},YP=["Запуск локальных языковых моделей и подключение к удалённым провайдерам через единый интерфейс.","Дообучение моделей на своих данных с отслеживанием прогресса и истории запусков.","Подготовка датасетов: загрузка файлов, извлечение знаний и генерация Q&A.","Мониторинг системных ресурсов, задержек и состояния серверов в реальном времени.","Настройка интерфейса, автоматического сохранения и параметров генерации под конкретные сценарии."],QP=["Укажите путь к базовой модели и URL локального сервера на вкладке «Рабочие модели».","Подключите удалённый API, если требуется комбинированная инфраструктура.","Загрузите материалы во вкладке «Датасеты» и запустите генерацию Q&A или fine-tuning.","Переключайтесь между чатами, обучением и датасетами с помощью навигации слева.","Следите за статусом задач и ресурсами через статус-бар и модальное окно системы."],ZP=({isOpen:s,onClose:e})=>(z.useEffect(()=>{if(!s)return;const t=n=>{n.key==="Escape"&&e()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[s,e]),s?u.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[u.jsx("div",{className:"absolute inset-0 bg-slate-950/70 backdrop-blur-sm",onClick:e,"aria-hidden":"true"}),u.jsxs("div",{role:"dialog","aria-modal":"true",className:"relative z-10 w-full max-w-3xl overflow-hidden rounded-3xl border border-slate-200 bg-white/95 shadow-2xl shadow-slate-900/40 backdrop-blur dark:border-slate-800 dark:bg-slate-900",children:[u.jsxs("header",{className:"flex items-start justify-between gap-4 border-b border-slate-200 px-6 py-4 dark:border-slate-800",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 dark:text-slate-500",children:"Справка"}),u.jsx("h2",{className:"text-2xl font-semibold text-slate-900 dark:text-slate-100",children:"Об LLM Studio"}),u.jsx("p",{className:"mt-1 text-sm text-slate-500 dark:text-slate-400",children:"Краткое описание возможностей и сценариев использования"})]}),u.jsx("button",{type:"button",onClick:e,className:"flex h-9 w-9 items-center justify-center rounded-full border border-slate-200 text-slate-500 transition-colors hover:border-blue-500 hover:text-blue-500 dark:border-slate-700 dark:text-slate-400 dark:hover:text-slate-200","aria-label":"Закрыть справку",children:u.jsx(_0,{className:"h-5 w-5"})})]}),u.jsxs("div",{className:"space-y-6 px-6 py-6 text-sm text-slate-600 dark:text-slate-300",children:[u.jsx("section",{className:"space-y-3",children:u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("span",{className:"flex h-10 w-10 items-center justify-center rounded-xl border border-slate-200 bg-white text-slate-600 shadow-sm shadow-slate-900/5 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200",children:u.jsx(MN,{className:"h-5 w-5"})}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:"Назначение"}),u.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"LLM Studio помогает разрабатывать и сопровождать прикладные решения на базе языковых моделей: от подготовки данных до мониторинга и интеграции в продукты."})]})]})}),u.jsxs("section",{className:"space-y-3",children:[u.jsx("h4",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400 dark:text-slate-500",children:"Основные функции"}),u.jsx("ul",{className:"space-y-2",children:YP.map(t=>u.jsx("li",{className:"rounded-lg border border-slate-200/60 bg-white/60 px-4 py-2 text-slate-600 shadow-sm shadow-slate-900/5 dark:border-slate-700/70 dark:bg-slate-900/70 dark:text-slate-300",children:t},t))})]}),u.jsxs("section",{className:"space-y-3",children:[u.jsx("h4",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400 dark:text-slate-500",children:"Как начать"}),u.jsx("ol",{className:"list-decimal space-y-2 pl-5",children:QP.map(t=>u.jsx("li",{className:"text-slate-600 dark:text-slate-300",children:t},t))})]})]})]})]}):null);function JP(){const[s,e]=z.useState("chat"),[t,n]=z.useState(!1),[r,i]=z.useState(!1),[a,o]=z.useState(!1),{settings:l,updateSettings:d}=aa(),{chatHistory:h,processingHistory:f,trainingHistory:p,evaluationHistory:m}=Ul(),[b,x]=z.useState(()=>{if(typeof window>"u")return Date.now();const U=window.localStorage.getItem("llm-studio-history-last-opened"),Y=U?Number.parseInt(U,10):NaN;return Number.isFinite(Y)?Y:Date.now()}),v=z.useCallback(()=>{n(!1),x(Date.now())},[n,x]),[g,y]=z.useState({status:"error",cpuPercent:null,cpuProcessPercent:null,ramPercent:null,ramUsedGb:null,ramTotalGb:null,modelsDirGb:null,gpuPercent:null,gpuMemoryUsedGb:null,gpuMemoryTotalGb:null,gpuName:null,gpuBackend:"cpu",message:void 0,timestamp:null,latencyMs:null}),[w,k]=z.useState(!1),[C,P]=z.useState(!1),N=[{id:"chat",icon:C2,label:"Чат"},{id:"training",icon:yx,label:"Обучение"},{id:"evaluation",icon:Tm,label:"Тестирование"},{id:"files",icon:zy,label:"Датасеты"},{id:"settings",icon:T2,label:"Настройки"}],I=()=>{switch(s){case"chat":return u.jsx(A1,{});case"training":return u.jsx(GC,{systemStats:g});case"evaluation":return u.jsx(VP,{});case"files":return u.jsx(hP,{});case"settings":return u.jsx(fP,{systemStats:g});default:return u.jsx(A1,{})}};z.useEffect(()=>{let U=!0,Y=null;const V=async()=>{const ee=await M2(l.baseModelServerUrl);U&&y(ee)};return V(),Y=window.setInterval(()=>{V()},5e3),()=>{U=!1,Y!==null&&window.clearInterval(Y)}},[l.baseModelServerUrl]),z.useEffect(()=>{if(!t)return;const U=Y=>{Y.key==="Escape"&&v()};return window.addEventListener("keydown",U),()=>window.removeEventListener("keydown",U)},[t,v]),z.useEffect(()=>{if(typeof document>"u")return;const U=l.theme==="dark",Y=document.documentElement,{body:V}=document;Y.classList.toggle("dark",U),V.classList.remove("theme-dark","theme-light"),V.classList.add(U?"theme-dark":"theme-light"),V.setAttribute("data-theme",l.theme)},[l.theme]);const M=U=>U===null||Number.isNaN(U)?"text-slate-600":U<60?"text-emerald-400":U<85?"text-amber-400":"text-rose-400",L=U=>U===null||Number.isNaN(U)?"—":`${Math.round(U)}%`,$=(U,Y)=>U===null||Y===null?"":`${U.toFixed(1)} / ${Y.toFixed(1)} GB`,E=z.useMemo(()=>({chat:h.length,training:p.length,files:f.length,evaluation:m.length,total:h.length+p.length+f.length+m.length}),[h,p,f,m]),D=z.useMemo(()=>{const U=se=>se.filter(ve=>ve.timestamp>b).length,Y=U(h),V=U(p),ee=U(f),fe=U(m);return{chat:Y,training:V,files:ee,evaluation:fe,total:Y+V+ee+fe}},[h,p,f,m,b]),_=z.useMemo(()=>[{id:"chat",label:"Чат",compactLabel:"Чат",total:E.chat,fresh:D.chat},{id:"training",label:"Обучение",compactLabel:"Обуч.",total:E.training,fresh:D.training},{id:"evaluation",label:"Тесты",compactLabel:"Тесты",total:E.evaluation,fresh:D.evaluation},{id:"files",label:"Датасеты",compactLabel:"Датасеты",total:E.files,fresh:D.files}],[E,D]);z.useEffect(()=>{typeof window>"u"||window.localStorage.setItem("llm-studio-history-last-opened",String(b))},[b]);const K=r?"w-64 lg:w-20":"w-64",J=!r||a,W=U=>`w-full flex items-center ${J?"gap-3 px-4 justify-start":"justify-center px-2"} py-3 rounded-lg transition-all duration-200 ${U?"bg-blue-500 text-white shadow-lg shadow-blue-900/40":"text-slate-300 hover:bg-slate-900 hover:text-white"}`,Q=r?FN:DN,H=()=>d({theme:l.theme==="dark"?"light":"dark"}),oe=()=>{n(!0),o(!1)},X=`${K} bg-slate-950 text-slate-100 flex flex-col border-r border-slate-900 transition-all duration-300 fixed inset-y-0 z-30 transform ${a?"translate-x-0":"-translate-x-full lg:translate-x-0"} lg:static lg:z-0`;return u.jsxs("div",{className:"flex h-screen bg-slate-950 text-slate-100",children:[u.jsxs("div",{className:X,children:[u.jsxs("div",{className:"flex items-center justify-between gap-2 border-b border-slate-900 px-4 py-4",children:[u.jsxs("div",{className:`flex items-center ${J?"gap-3":"justify-center w-full"}`,children:[u.jsx(yx,{className:"h-6 w-6 text-blue-400"}),J&&u.jsxs("div",{children:[u.jsx("h1",{className:"text-xl font-bold leading-tight",children:"Obuchator"}),u.jsx("p",{className:"text-[10px] leading-tight text-slate-500",children:"Made by Ryltsin I.A."}),u.jsxs("p",{className:"text-xs text-slate-500",children:["Версия ",ZS]})]})]}),u.jsx("button",{type:"button",onClick:()=>i(U=>!U),className:"hidden lg:flex h-9 w-9 items-center justify-center rounded-lg border border-slate-800 bg-slate-900 text-slate-300 hover:border-blue-500 hover:text-white",title:r?"Раскрыть меню":"Свернуть меню",children:u.jsx(Q,{className:"h-4 w-4"})})]}),u.jsx("nav",{className:`flex-1 ${J?"px-4 py-4":"px-2 py-4"}`,children:u.jsx("ul",{className:"space-y-2",children:N.map(U=>{const Y=U.icon,V=s===U.id;return u.jsx("li",{children:u.jsxs("button",{onClick:()=>{e(U.id),o(!1)},className:W(V),children:[u.jsx(Y,{className:"h-5 w-5"}),J&&U.label]})},U.id)})})}),u.jsx("div",{className:`border-t border-slate-900 ${J?"px-4 py-3":"px-2 py-3"}`,children:u.jsxs("button",{type:"button",onClick:oe,className:`w-full rounded-xl border border-slate-200 bg-white/80 text-slate-800 shadow-sm shadow-slate-900/5 transition-colors hover:border-blue-500 hover:bg-white dark:border-slate-800 dark:bg-slate-900/80 dark:text-slate-100 dark:shadow-none ${J?"px-4 py-3":"px-2 py-2"}`,children:[u.jsxs("div",{className:`flex items-center ${J?"justify-between gap-3":"flex-col gap-3 text-center"}`,children:[u.jsxs("div",{className:`flex items-center ${J?"gap-3":"flex-col gap-1 text-[11px] w-full"}`,children:[u.jsx(WN,{className:"h-4 w-4 shrink-0 text-blue-500 dark:text-blue-400"}),J?u.jsx("span",{className:"text-sm font-semibold leading-snug text-slate-700 dark:text-slate-100",children:"История"}):u.jsx("span",{className:"w-full max-w-[60px] break-words text-center text-[11px] font-semibold leading-tight text-slate-700 dark:text-slate-100",children:"История"})]}),u.jsxs("div",{className:`flex items-center ${J?"gap-2":"gap-1 text-[11px]"}`,children:[u.jsx("span",{className:"rounded-full bg-blue-500/15 px-2 py-0.5 text-[11px] font-semibold text-blue-600 dark:bg-blue-500/20 dark:text-blue-100",children:E.total}),D.total>0&&u.jsxs("span",{className:"rounded-full bg-emerald-500/10 px-2 py-0.5 text-[11px] font-semibold text-emerald-300",children:["+",D.total]})]})]}),J?u.jsx("div",{className:"mt-3 space-y-1 text-[10px] text-slate-500 dark:text-slate-400",children:_.map(U=>u.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-slate-200 bg-white/70 px-2.5 py-1 shadow-sm shadow-slate-900/10 dark:border-slate-800/60 dark:bg-slate-950/40 dark:text-slate-400 dark:shadow-none",children:[u.jsx("span",{className:"font-medium text-slate-600 dark:text-slate-300",children:U.label}),u.jsxs("div",{className:"flex items-center gap-1 text-slate-700 dark:text-slate-100",children:[u.jsx("span",{className:"text-[11px] font-semibold",children:U.total}),U.fresh>0&&u.jsxs("span",{className:"text-[11px] font-semibold text-emerald-500 dark:text-emerald-300",children:["+",U.fresh]})]})]},U.id))}):u.jsx("div",{className:"mt-2 flex w-full justify-center",children:u.jsx("span",{className:"min-w-[48px] rounded-full border border-slate-200 bg-white/80 px-3 py-1 text-center text-[11px] font-semibold text-slate-700 dark:border-slate-800 dark:bg-slate-900/70 dark:text-slate-100",children:E.total})})]})}),u.jsxs("div",{className:`border-t border-slate-900 ${J?"px-4 py-4":"px-2 py-4 text-center"}`,children:[J&&u.jsx("div",{className:"mb-2 text-xs text-slate-500",children:"Ресурсы"}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"flex justify-between text-sm",children:[u.jsx("span",{children:"CPU"}),u.jsx("span",{className:M(g.cpuPercent),children:L(g.cpuPercent)})]}),u.jsxs("div",{className:"flex justify-between text-sm",children:[u.jsx("span",{children:"RAM"}),u.jsx("span",{className:M(g.ramPercent),children:L(g.ramPercent)})]}),u.jsxs("div",{className:"flex justify-between text-sm",children:[u.jsx("span",{children:"GPU"}),u.jsx("span",{className:M(g.gpuPercent),children:L(g.gpuPercent)})]})]}),g.ramUsedGb!==null&&g.ramTotalGb!==null&&u.jsxs("div",{className:"mt-3 text-[11px] text-slate-500",children:["RAM: ",$(g.ramUsedGb,g.ramTotalGb)]}),g.message&&u.jsx("div",{className:"mt-3 text-[11px] text-amber-400",children:g.message})]})]}),a&&u.jsx("div",{className:"fixed inset-0 z-20 bg-slate-950/40 lg:hidden",onClick:()=>o(!1),"aria-hidden":"true"}),u.jsxs("div",{className:"flex-1 flex flex-col bg-slate-900",children:[u.jsxs("header",{className:"flex flex-wrap items-center justify-between gap-3 border-b border-slate-200 bg-white/90 px-4 py-3 shadow-sm shadow-slate-900/5 backdrop-blur dark:border-slate-800 dark:bg-slate-900/80 dark:shadow-none",children:[u.jsx("div",{className:"flex items-center gap-2",children:u.jsx("button",{type:"button",onClick:()=>o(U=>!U),className:"flex h-9 w-9 items-center justify-center rounded-lg border border-slate-200 bg-white text-slate-600 shadow-sm shadow-slate-900/5 transition-colors hover:border-blue-500 hover:text-blue-600 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:shadow-none dark:hover:text-white lg:hidden",title:"Меню",children:u.jsx(YN,{className:"h-5 w-5"})})}),u.jsxs("div",{className:"flex flex-1 items-center justify-end gap-3",children:[u.jsx(pP,{systemStats:g,serverOnline:g.status==="ok",onOpenSystemInfo:()=>k(!0),onOpenHelp:()=>P(!0)}),u.jsx("button",{type:"button",className:"flex h-9 w-9 items-center justify-center rounded-full border border-slate-200 bg-white/80 text-slate-700 shadow-sm shadow-slate-900/5 transition-colors hover:border-blue-500 hover:text-blue-600 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:shadow-none",onClick:H,title:l.theme==="dark"?"Переключить на светлую тему":"Переключить на тёмную тему",children:u.jsx(XN,{className:"h-4 w-4"})})]})]}),u.jsx("main",{className:"flex-1 overflow-hidden",children:I()})]}),u.jsx(KP,{isOpen:w,onClose:()=>k(!1),systemStats:g}),u.jsx(ZP,{isOpen:C,onClose:()=>P(!1)}),t&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"fixed inset-0 bg-slate-950/40 backdrop-blur-sm",onClick:v,"aria-hidden":"true"}),u.jsx("div",{className:"fixed inset-y-0 right-0 z-40 w-full max-w-3xl shadow-2xl",children:u.jsx(vP,{onClose:v,lastViewedAt:b})})]})]})}function e5(){return u.jsx(pC,{children:u.jsx(gC,{children:u.jsx(xC,{children:u.jsx(MC,{children:u.jsx(NP,{children:u.jsx(iP,{children:u.jsx(JP,{})})})})})})})}E2(document.getElementById("root")).render(u.jsx(z.StrictMode,{children:u.jsx(e5,{})}));export{u as j};
